<# start.ps1
	.SYNOPSIS
		Initializes and launches the Entropia Dashboard application.

	.DESCRIPTION
		This script is the main entry point for the Entropia Dashboard application. 
		It performs a sequence of critical actions to ensure the application starts correctly, remains stable, and shuts down cleanly.

		Its primary responsibilities include:

		1.  **Environment Verification and Elevation:**
			*   It first checks if it's running with Administrator privileges, in a 32-bit PowerShell process, and with the 'Bypass' execution policy.
			*   If these requirements are not met, it automatically attempts to relaunch itself with the correct permissions, prompting the user for elevation via UAC if necessary.

		2.  **Configuration and Directory Setup:**
			*   It establishes a global configuration structure (`$global:DashboardConfig`) to manage all application settings, state, paths, and resources.
			*   It ensures that the required application data directories exist in the user's `%APPDATA%\Entropia_Dashboard` folder and that it has write permissions.

		3.  **Module Management and Loading:**
			*   It defines a set of modules with specific priorities (Critical, Important, Optional), dependencies, and a defined loading order.
			*   It intelligently deploys modules from source files or embedded Base64 strings into the AppData directory. To optimize startup, it uses SHA256 hash checks to avoid rewriting files that haven't changed.
			*   It uses a robust, multi-attempt strategy to import PowerShell modules (.psm1), gracefully falling back to alternative methods (including reflection-based loading and, as a last resort, Invoke-Expression) to handle different execution contexts (script vs. compiled EXE) and potential loading issues. Only failures of 'Critical' modules will prevent the application from starting.

		4.  **UI Initialization and Lifecycle Management:**
			*   After successfully loading the critical modules, it initializes the main graphical user interface (UI) by calling functions from the 'ui.psm1' module.
			*   It starts and manages the Windows Forms message loop, which keeps the application's UI responsive to user input and other events. It prioritizes an efficient, low-CPU P/Invoke-based message loop if available.
			*   The entire execution is wrapped in comprehensive error handling. Critical failures are displayed to the user in a dialog box, and a final cleanup routine is executed upon exit to stop timers and dispose of UI resources properly.

	.NOTES
		Author: Immortal / Divine
		Version: 1.3.1
		Requires: PowerShell 5.1+, .NET Framework 4.5+, Administrator privileges, Bypassed 32-bit PowerShell execution.

		Documentation Standards Followed:
		- Module Level Documentation: Synopsis, Description, Notes.
		- Function Level Documentation: Synopsis, Parameter Descriptions, Output Specifications.
		- Code Organization: Logical grouping using #region Description/ #endregion Description. Functions organized by workflow.
		- Step Documentation: Code blocks enclosed in '#region Step: Description' / '#endregion Step: Description'.
		- Error Handling: Comprehensive try/catch/finally blocks with verbose logging and user notification on critical failure.

		Execution Policy Note: This script requires and attempts to set the execution policy to 'Bypass' for the *current process*.
		This is necessary for its dynamic module loading and execution features but reduces script execution security restrictions.
		Ensure you understand the implications before running this script in sensitive environments.

		Invoke-Expression Note: The fallback module import methods uses Invoke-Expression. This cmdlet
		can execute arbitrary code and poses a security risk if the module content is compromised.
#>

#region Custom Write-Verbose

[CmdletBinding()]
param()

#region Step: Detect -Verbose argument when running as EXE/Script
	# If -Verbose is passed as a command-line argument, manually set the $VerbosePreference. 
	if ($args -contains '-Verbose') {
		$VerbosePreference = "Continue"
		Write-Verbose "-Verbose argument detected, enabling verbose preference."
	}
#endregion Step: Detect -Verbose argument when running as EXE/Script

Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force -ErrorAction Stop

function Write-Verbose {
	[CmdletBinding()]
	param(
	[Parameter(Mandatory = $true, Position = 0)]
	[string]$Message,
	[string]$ForegroundColor = 'DarkGray'
	)
	
	# Only proceed if verbose output is enabled
	if ($VerbosePreference -eq "Continue") {
		$dateStr = (Get-Date).ToString("yyyy-MM-dd HH:mm:ss")
		$callStack = Get-PSCallStack
		$caller = if ($callStack.Count -gt 1) { $callStack[1] } else { $callStack[0] }
		
		$callerName = if ($caller.Command) { $caller.Command } else { "Script" }
		
		$bracketedCaller = "[$callerName]"
		$paddedCaller = $bracketedCaller.PadRight(35)
		$prefix = " | $dateStr - $paddedCaller - "
		$indentation = " " * $prefix.Length + "| "
		
		# Get console width for proper wrapping
		$consoleWidth = if ($Host.UI.RawUI.WindowSize.Width -gt 800) {
			$Host.UI.RawUI.WindowSize.Width # Use actual width if available
		} else {
			800 # Default fallback width if console width can't be determined or is to small
		}
		# Ensure consoleWidth is an integer for calculations
		try {
			$consoleWidth = [int]$consoleWidth
		} catch {
			$consoleWidth = 800 # Fallback if conversion fails
		}

		# Process message with proper wrapping and indentation
		$lines = $Message -split "`r`n"
		$formattedLines = @()
		
		# Calculate available width for text once
		$availableWidth = $consoleWidth - $prefix.Length - 5 # Subtract 2 for potential padding/margin

		foreach ($line in $lines) {
			# If line is shorter than available width, add it as-is
			if ($line.Length -le $availableWidth) {
				$formattedLines += $line
			} else {
				# For long lines, wrap them with proper word breaks
				$words = $line -split ' '
				$currentLine = ""
				
				foreach ($word in $words) {
					# Check if adding this word would exceed the line length
					if (($currentLine.Length + $word.Length + 1) -le $availableWidth) {
						# Add word with space
						if ($currentLine.Length -gt 0) {
							$currentLine += " $word"
						} else {
							$currentLine = $word
						}
					} else {
						# Line would be too long, add current line to results and start a new one
						if ($currentLine.Length -gt 0) {
							$formattedLines += $currentLine
							$currentLine = $word
						} else {
							# Word itself is too long for a line, add it anyway (might still overflow slightly)
							$formattedLines += $word
							$currentLine = ""
						}
					}
				}
				
				# Add the last line if not empty
				if ($currentLine.Length -gt 0) {
					$formattedLines += $currentLine
				}
			}
		}
		
		# Join lines with proper indentation for wrapped lines
		$formattedMessage = ""
		if ($formattedLines.Count -gt 0) {
			$formattedMessage = $formattedLines[0]
			for ($i = 1; $i -lt $formattedLines.Count; $i++) {
				$formattedMessage += "`r`n$indentation$($formattedLines[$i])"
			}
		}
		
		# Set color based on message type
		$color = switch ($ForegroundColor.ToLower()) {
			'red'    { [ConsoleColor]::Red }
			'yellow' { [ConsoleColor]::Yellow }
			'green'  { [ConsoleColor]::Green }
			'cyan'   { [ConsoleColor]::Cyan }
			default  { [ConsoleColor]::DarkGray }
		}

		# Output to console with color
		$originalColor = $host.UI.RawUI.ForegroundColor
		try {
			$host.UI.RawUI.ForegroundColor = $color
			# Write to Error stream to ensure it appears like standard Write-Verbose
			[Console]::Error.WriteLine("$prefix$formattedMessage")
		} finally {
			$host.UI.RawUI.ForegroundColor = $originalColor
		}
		
		# Also write to the verbose stream for proper logging/capture
		$wrappedCmdlet = $ExecutionContext.InvokeCommand.GetCommand(
		"Microsoft.PowerShell.Utility\Write-Verbose",
		[System.Management.Automation.CommandTypes]::Cmdlet
		)
		
		# Use steppable pipeline
		$scriptCmd = { & $wrappedCmdlet "$prefix$formattedMessage" }
		$steppablePipeline = $scriptCmd.GetSteppablePipeline()
		$steppablePipeline.Begin($true)
		# Ensure pipeline output is ended if necessary
		$steppablePipeline.End() # Ensure pipeline completes
	}
}

try {
	Add-Type -AssemblyName System.Windows.Forms, System.Drawing
	Write-Verbose "INFO: Loaded System.Windows.Forms and System.Drawing assembly" # This will now work if -Verbose was passed
} catch {
	# Use the custom Write-Verbose for consistency, it checks $VerbosePreference internally
	Write-Verbose "ERROR: Failed to load required assemblies: $_" -ForegroundColor Red
	throw "Failed to initialize application. Required assemblies could not be loaded: $_"
}

#endregion Custom Write-Verbose

#region Global Configuration

#region Step: Define Global Configuration Hashtable
	# This main hashtable holds all our settings, states, paths, resources, and module info. It's available everywhere in the script.
	$global:DashboardConfig = @{
		# Paths: Stores important folders and file locations for the app.
		Paths            = @{
			# Source: Folder with the dashboard's source scripts (.ps1, .psm1) and things like .dlls or .icos. Usually in the user's profile.
			Source   = Join-Path $env:USERPROFILE 'Entropia_Dashboard\.main'
			# App: The main app data folder in AppData\Roaming. We put modules, config files, and maybe logs here.
			App      = Join-Path $env:APPDATA 'Entropia_Dashboard\'
			# Modules: Subfolder in the AppData path. Write-Module puts module files (.psm1), libraries (.dll), and icons (.ico) here before loading them.
			Modules  = Join-Path $env:APPDATA 'Entropia_Dashboard\modules'
			# Icon: Full path to the app's icon file (.ico) for the main window. It should end up in the Modules folder.
			Icon     = Join-Path $env:APPDATA 'Entropia_Dashboard\modules\icon.ico'
			# FtoolDLL: Full path to ftool.dll, needed if the optional 'ftool.psm1' module is used. Should also be in the Modules folder.
			FtoolDLL = Join-Path $env:APPDATA 'Entropia_Dashboard\modules\ftool.dll'
			# Config: Full path to the main settings file ('config.ini'). Saves user choices and app settings. Found in the main AppData folder.
			Ini   = Join-Path $env:APPDATA 'Entropia_Dashboard\config.ini'
		}
		# State: Keeps track of what the application is doing right now.
		State            = @{
			# ConfigInitialized: Flag ($true/$false) to check if basic setup (like creating app folders) worked.
			ConfigInitialized   = $false
			# UIInitialized: Flag ($true/$false) to see if the main window was set up correctly by 'ui.psm1'.
			UIInitialized       = $false
			# LoginActive: Flag ($true/$false) showing if an auto-login (from 'login.psm1') is running. Prevents doing it twice.
			LoginActive         = $false
			# LaunchActive: Flag ($true/$false) showing if a game launch (from 'launch.psm1') is happening. Prevents double launches.
			LaunchActive        = $false
			# PreviousLaunchState: Flag ($true/$false) showing if a game launch (from 'launch.psm1') happened.
			PreviousLaunchState = $false
			# PreviousLoginState: Flag ($true/$false) showing if a game login (from 'login.psm1') happened.
			PreviousLoginState  = $false
			# IsRunningAsExe: Flag ($true/$false) figured out at start. True if running as an .exe, not a .ps1 script. Changes how modules load.
			IsRunningAsExe      = $false
			IsDragging 			= $false
		}
		# Resources: Groups for handling things that change, like timers, windows, and shared info.
		Resources        = @{
			# Timers: An ordered list ([ordered]@{...}) holding active timers (System.Windows.Forms.Timer) used by the app or modules. Stopped/cleaned up on exit.
			Timers              = [ordered]@{}
			# FtoolForms: An ordered list ([ordered]@{...}) keeping track of active Ftool windows (from 'ftool.psm1'). Closed/cleaned up on exit.
			FtoolForms          = [ordered]@{}
			# LastEventTimes: A list (@{...}) remembering when named events last happened. Good for slowing down or grouping actions in modules.
			LastEventTimes      = @{}
			# ExtensionData: A general list (@{...}) for modules/extensions to store and share any data needed across the app.
			ExtensionData       = @{}
			# ExtensionTracking: A list (@{...}) for modules/extensions to track things like status flags, process IDs, or other state info.
			ExtensionTracking   = @{}
			# LoadedModuleContent: A list (@{...}) holding the actual text content of loaded .psm1 modules. Mainly for backup loading methods or debugging.
			LoadedModuleContent = @{}
			# LaunchResources: A list (@{...}) for the launch module to store resources specific to launching game clients.
			LaunchResources     = @{}
			DragSourceGrid 		= $null
		}
		# UI: Empty list (@{...}) filled by 'ui.psm1' when the UI starts. Holds references to important UI parts (windows, buttons, grids).
		UI               = @{
			Login        = @{}
		}
		# DefaultConfig: An ordered list ([ordered]@{...}) with default settings. Used by 'ini.psm1' if 'config.ini' is missing or incomplete.
		DefaultConfig    = [ordered]@{
			'LauncherPath' = [ordered]@{ 'LauncherPath' = 'Select_Launcher' } # Default if the game launcher path isn't in config.ini.
			'ProcessName'  = [ordered]@{ 'ProcessName' = 'neuz' }         # Default game process name to watch or use.
			'MaxClients'   = [ordered]@{ 'MaxClients' = '1' }                # Default max number of game clients allowed.
			'Login'        = [ordered]@{ 'Login' = '1,1,1,1,1,1,1,1,1,1'; 'FinalizeCollectorLogin' = '0'; 'NeverRestartingCollectorLogin' = '0' }             # Default list of login settings (format depends on 'login.psm1').
			'Ftool'        = [ordered]@{}                                    # Default empty section for 'ftool.psm1' related settings.
			'Options'      = [ordered]@{ 'HideMinimizedWindows' = '0' }      # Default options for the dashboard.
			'LoginConfig'  = [ordered]@{
                'PostLoginDelay' = '1'
                'Server1Coords' = '0,0'; 'Server2Coords' = '0,0'
                'Channel1Coords' = '0,0'; 'Channel2Coords' = '0,0'
                'Char1Coords' = '0,0'; 'Char2Coords' = '0,0'; 'Char3Coords' = '0,0'
                'CollectorStartCoords' = '0,0' 
            }
		}
		# Config: An ordered list ([ordered]@{...}) filled by 'ini.psm1' with settings from 'config.ini'. Overwrites defaults.
		Config           = [ordered]@{}
		# ConfigWriteTimer: Might hold a timer used by 'ini.psm1' to delay saving 'config.ini' often. Better performance, less disk activity.
		ConfigWriteTimer = @{}
		# LoadedModules: A list (@{...}) tracking filenames and full paths of modules that were written to AppData and/or loaded. Used for checking dependencies.
		LoadedModules    = @{}
	}
#endregion Step: Define Global Configuration Hashtable

#region Step: Define Module Metadata
	# Info about all known app modules: load order, importance (critical?), dependencies, and source file path.
	$global:DashboardConfig.Modules = @{
		# Critical modules: Must have these for the dashboard to work. If they fail, the app won't start.
		'ftool.dll'     = @{ 
			Priority = 'Critical';  
			Order = 1; 
			Dependencies = @();
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'ftool.dll');
			Base64Content = '
TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6AAAAA4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ0KJAAAAAAAAADylR4YtvRwS7b0cEu29HBLkTILS7T0cEuRMg1Lt/RwS5EyHku09HBLkTIdS7v0cEt1+y1LtfRwS7b0cUuX9HBLkTICS7f0cEuRMgpLt/RwS5EyCEu39HBLUmljaLb0cEsAAAAAAAAAAFBFAABMAQUApBpbSAAAAAAAAAAA4AACIQsBCAAACgAAAA4AAAAAAAClFAAAABAAAAAgAAAAAAAQABAAAAACAAAEAAAAAAAAAAQAAAAAAAAAAGAAAAAEAAB7lQAAAgAAAAAAEAAAEAAAAAAQAAAQAAAAAAAAEAAAAPAlAADPAAAAnCIAADwAAAAAQAAArAEAAAAAAAAAAAAAAAAAAAAAAAAAUAAAbAEAAKAgAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQCEAAEAAAAAAAAAAAAAAAAAgAACMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALnRleHQAAABoCQAAABAAAAAKAAAABAAAAAAAAAAAAAAAAAAAIAAAYC5yZGF0YQAAvwYAAAAgAAAACAAAAA4AAAAAAAAAAAAAAAAAAEAAAEAuZGF0YQAAAHwDAAAAMAAAAAIAAAAWAAAAAAAAAAAAAAAAAABAAADALnJzcmMAAACsAQAAAEAAAAACAAAAGAAAAAAAAAAAAAAAAAAAQAAAQC5yZWxvYwAApAEAAABQAAAAAgAAABoAAAAAAAAAAAAAAAAAAEAAAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIv/VYvs/yVcMwAQzMzMzMyL/1WL7P8lVDMAEMzMzMzMi/9Vi+z/JUwzABDMzMzMzIv/VYvs/yVYMwAQzMzMzMyL/1WL7P8lSDMAEMzMzMzMuPcRAAD/JWAzABDMzMzMzItEJAiD+ANWD4fsAAAA/ySFYBEAEGjIIAAQ/xUAIAAQgz1cMwAQAIs1CCAAEKNQMwAQdRVo4CAAEFD/1oPABaNcMwAQoVAzABCDPVQzABAAdRVo8CAAEFD/1oPABaNUMwAQoVAzABCDPUwzABAAdRVoACEAEFD/1oPABaNMMwAQoVAzABCDPVgzABAAdRVoECEAEFD/1oPABaNYMwAQoVAzABCDPUgzABAAdRVoICEAEFD/1oPABaNIMwAQoVAzABCDPWAzABAAdTBoMCEAEFD/1oPABaNgMwAQsAFewgwAoVAzABCFwHQRUP8VBCAAEMcFUDMAEAAAAACwAV7CDABAEQAQdRAAEHUQABBAEQAQOw0AMAAQdQLzw+lHAwAAVmiAAAAA/xV8IAAQi/BW/xWAIAAQhfZZWaN0MwAQo3AzABB1BTPAQF7DgyYA6NwEAABosRYAEOjABAAAxwQkyhUAEOi0BAAAWTPAXsOLRCQIVTPtO8V1DjktEDAAEH46/w0QMAAQg/gBiw1gIAAQiwlTVleJDWQzABAPhdQAAABkoRgAAACLcASLHTAgABCJbCQYv2wzABDrFjPA6WsBAAA7xnQWaOgDAAD/FTQgABBVVlf/0zvFdejrCMdEJBgBAAAAoWgzABCFwGoCXnQJah/o0wUAAOs8aJwgABBolCAAEMcFaDMAEAEAAADosgUAAIXAWVl0BzPA6QsBAABokCAAEGiMIAAQ6JAFAABZiTVoMwAQOWwkHFl1CFVX/xU4IAAQOS14MwAQdB5oeDMAEOisBAAAhcBZdA//dCQcVv90JBz/FXgzABD/BRAwABDpsgAAADvFD4WqAAAAizUwIAAQv2wzABDrC2joAwAA/xU0IAAQVWoBV//WhcB166FoMwAQg/gCdApqH+gaBQAAWet0/zV0MwAQix1wIAAQ/9OL6IXtWXRM/zVwMwAQ/9NZi/DrIIM+AHQbiwaJRCQY/xV0IAAQOUQkGHQJ/3QkGP/TWf/Qg+4EO/Vz2VX/FXggABBZ/xV0IAAQo3AzABCjdDMAEGoAV8cFaDMAEAAAAAD/FTggABAzwEBfXltdwgwAahBoOCIAEOiZBAAAi/mL8otdCDPAQIlF5DPJiU38iTUIMAAQiUX8O/F1EDkNEDAAEHUIiU3k6bcAAAA78HQFg/4CdS6hvCAAEDvBdAhXVlP/0IlF5IN95AAPhJMAAABXVlPo1v3//4lF5IXAD4SAAAAAV1ZT6Ff8//+JReSD/gF1JIXAdSBXUFPoQ/z//1dqAFPopv3//6G8IAAQhcB0BldqAFP/0IX2dAWD/gN1Q1dWU+iG/f//hcB1AyFF5IN95AB0LqG8IAAQhcB0JVdWU//QiUXk6xuLReyLCIsJiU3gUFHotwMAAFlZw4tl6INl5ACDZfwAx0X8/v///+gJAAAAi0Xk6OADAADDxwUIMAAQ/////8ODfCQIAXUF6P8DAAD/dCQEi0wkEItUJAzozf7//1nCDABVi+yB7CgDAACjIDEAEIkNHDEAEIkVGDEAEIkdFDEAEIk1EDEAEIk9DDEAEGaMFTgxABBmjA0sMQAQZowdCDEAEGaMBQQxABBmjCUAMQAQZowt/DAAEJyPBTAxABCLRQCjJDEAEItFBKMoMQAQjUUIozQxABCLheD8///HBXAwABABAAEAoSgxABCjJDAAEMcFGDAAEAkEAMDHBRwwABABAAAAoQAwABCJhdj8//+hBDAAEImF3Pz///8VHCAAEKNoMAAQagHoswMAAFlqAP8VICAAEGjAIAAQ/xUkIAAQgz1oMAAQAHUIagHojwMAAFloCQQAwP8VKCAAEFD/FSwgABDJw2hAMwAQ6HYDAABZw2oUaGAiABDoUgIAAP81dDMAEIs1cCAAEP/WWYlF5IP4/3UM/3UI/xVMIAAQWetnagjoUAMAAFmDZfwA/zV0MwAQ/9aJReT/NXAzABD/1llZiUXgjUXgUI1F5FD/dQiLNYAgABD/1llQ6BMDAACJRdz/deT/1qN0MwAQ/3Xg/9aDxBSjcDMAEMdF/P7////oCQAAAItF3OgIAgAAw2oI6NcCAABZw/90JAToUv////fYG8D32FlIw1ZXuCgiABC/KCIAEDvHi/BzD4sGhcB0Av/Qg8YEO/dy8V9ew1ZXuDAiABC/MCIAEDvHi/BzD4sGhcB0Av/Qg8YEO/dy8V9ew8zMzMzMzMzMzMzMi0wkBGaBOU1adAMzwMOLQTwDwYE4UEUAAHXwM8lmgXgYCwEPlMGLwcPMzMzMzMzMi0QkBItIPAPID7dBFFNWD7dxBjPShfZXjUQIGHYei3wkFItIDDv5cgmLWAgD2Tv7cgyDwgGDwCg71nLmM8BfXlvDzMzMzMzMzMzMzMzMzMxVi+xq/miAIgAQaI0YABBkoQAAAABQg+wIU1ZXoQAwABAxRfgzxVCNRfBkowAAAACJZejHRfwAAAAAaAAAABDoPP///4PEBIXAdFWLRQgtAAAAEFBoAAAAEOhS////g8QIhcB0O4tAJMHoH/fQg+ABx0X8/v///4tN8GSJDQAAAABZX15bi+Vdw4tF7IsIiwEz0j0FAADAD5TCi8LDi2Xox0X8/v///zPAi03wZIkNAAAAAFlfXluL5V3DzP8lbCAAEP8laCAAEP8lZCAAEP8lXCAAEGiNGAAQZP81AAAAAItEJBCJbCQQjWwkECvgU1ZXoQAwABAxRfwzxVCJZej/dfiLRfzHRfz+////iUX4jUXwZKMAAAAAw4tN8GSJDQAAAABZX19eW4vlXVHD/3QkEP90JBD/dCQQ/3QkEGhwEQAQaAAwABDotgAAAIPEGMNVi+yD7BChADAAEINl+ACDZfwAU1e/TuZAuzvHuwAA//90DYXDdAn30KMEMAAQ62BWjUX4UP8VPCAAEIt1/DN1+P8VDCAAEDPw/xUQIAAQM/D/FRQgABAz8I1F8FD/FRggABCLRfQzRfAz8Dv3dQe+T+ZAu+sLhfN1B4vGweAQC/CJNQAwABD31ok1BDAAEF5fW8nD/yVYIAAQ/yVUIAAQ/yVEIAAQ/yWEIAAQ/yVIIAAQ/yVQIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABkIwAAdCMAAIIjAACyJQAAnCUAAIwlAAByJQAAXiUAAEAlAAAkJQAAECUAAPwkAADeJAAA1iQAAMAkAADIJQAAAAAAAHAkAACIJAAAkCQAAKYkAABMJAAANiQAACQkAAAUJAAABiQAAPgjAADsIwAA2iMAAMojAADCIwAAtCMAAKIjAAB6JAAAAAAAAAAAAAAAAAAAAAAAAH8RABAAAAAAAAAAAKQaW0gAAAAAAgAAAIkAAACIIQAAiA8AAAAAAAAYMAAQcDAAEHUAcwBlAHIAMwAyAC4AZABsAGwAAAAAAFBvc3RNZXNzYWdlQQAAAABQb3N0TWVzc2FnZVcAAAAAU2VuZE1lc3NhZ2VBAAAAAFNlbmRNZXNzYWdlVwAAAABTZXRDdXJzb3JQb3MAAAAAU2V0QWN0aXZlV2luZG93AEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwABAgIgAQAQAAAFJTRFNTUO3S8L97Q4yN0/DLuR2RBwAAAGM6XERvY3VtZW50cyBhbmQgU2V0dGluZ3NcQWxkZVxNeSBEb2N1bWVudHNcVmlzdWFsIFN0dWRpbyAyMDA1XFByb2plY3RzXEZseUZGIEFwcGxpY2F0aW9uc1xyZWxlYXNlXEZ1bmN0aW9ucy5wZGIAAAAAAAAAAAAAAAAAAAAAjRgAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/v///wAAAADQ////AAAAAP7///8AAAAAmhQAEAAAAABmFAAQehQAEP7///8AAAAAzP///wAAAAD+////AAAAAHIWABAAAAAA/v///wAAAADY////AAAAAP7////pFwAQ/RcAENgiAAAAAAAAAAAAAJQjAAAAIAAAHCMAAAAAAAAAAAAAmiQAAEQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGQjAAB0IwAAgiMAALIlAACcJQAAjCUAAHIlAABeJQAAQCUAACQlAAAQJQAA/CQAAN4kAADWJAAAwCQAAMglAAAAAAAAcCQAAIgkAACQJAAApiQAAEwkAAA2JAAAJCQAABQkAAAGJAAA+CMAAOwjAADaIwAAyiMAAMIjAAC0IwAAoiMAAHokAAAAAAAAVQJMb2FkTGlicmFyeVcAAPgARnJlZUxpYnJhcnkAoAFHZXRQcm9jQWRkcmVzcwAAS0VSTkVMMzIuZGxsAAByAV9lbmNvZGVfcG9pbnRlcgCTAl9tYWxsb2NfY3J0APQEZnJlZQAAcwFfZW5jb2RlZF9udWxsAGgBX2RlY29kZV9wb2ludGVyABACX2luaXR0ZXJtABECX2luaXR0ZXJtX2UAHQFfYW1zZ19leGl0AAATAV9hZGp1c3RfZmRpdgAAbQBfX0NwcFhjcHRGaWx0ZXIAUwFfY3J0X2RlYnVnZ2VyX2hvb2sAAI8AX19jbGVhbl90eXBlX2luZm9fbmFtZXNfaW50ZXJuYWwAAPMDX3VubG9jawCZAF9fZGxsb25leGl0AIICX2xvY2sAKANfb25leGl0AE1TVkNSODAuZGxsAHsBX2V4Y2VwdF9oYW5kbGVyNF9jb21tb24AKQJJbnRlcmxvY2tlZEV4Y2hhbmdlAFYDU2xlZXAAJgJJbnRlcmxvY2tlZENvbXBhcmVFeGNoYW5nZQAAXgNUZXJtaW5hdGVQcm9jZXNzAABCAUdldEN1cnJlbnRQcm9jZXNzAG4DVW5oYW5kbGVkRXhjZXB0aW9uRmlsdGVyAABKA1NldFVuaGFuZGxlZEV4Y2VwdGlvbkZpbHRlcgA5AklzRGVidWdnZXJQcmVzZW50AKMCUXVlcnlQZXJmb3JtYW5jZUNvdW50ZXIA3wFHZXRUaWNrQ291bnQAAEYBR2V0Q3VycmVudFRocmVhZElkAABDAUdldEN1cnJlbnRQcm9jZXNzSWQAygFHZXRTeXN0ZW1UaW1lQXNGaWxlVGltZQAAAAAAAAAAAAAAAAAAAAAAAACkGltIAAAAAFQmAAABAAAABgAAAAYAAAAYJgAAMCYAAEgmAAAAEAAAEBAAACAQAAAwEAAAUBAAAEAQAABiJgAAcSYAAIAmAACPJgAAniYAALAmAAAAAAEAAgADAAQABQBGdW5jdGlvbnMuZGxsAGZuUG9zdE1lc3NhZ2VBAGZuUG9zdE1lc3NhZ2VXAGZuU2VuZE1lc3NhZ2VBAGZuU2VuZE1lc3NhZ2VXAGZuU2V0QWN0aXZlV2luZG93AGZuU2V0Q3Vyc29yUG9zAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE7mQLuxGb9E//////////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAABABgAAAAYAACAAAAAAAAAAAAEAAAAAAABAAIAAAAwAACAAAAAAAAAAAAEAAAAAAABAAkEAABIAAAAWEAAAFQBAADkBAAAAAAAADxhc3NlbWJseSB4bWxucz0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTphc20udjEiIG1hbmlmZXN0VmVyc2lvbj0iMS4wIj4NCiAgPGRlcGVuZGVuY3k+DQogICAgPGRlcGVuZGVudEFzc2VtYmx5Pg0KICAgICAgPGFzc2VtYmx5SWRlbnRpdHkgdHlwZT0id2luMzIiIG5hbWU9Ik1pY3Jvc29mdC5WQzgwLkNSVCIgdmVyc2lvbj0iOC4wLjUwNzI3Ljc2MiIgcHJvY2Vzc29yQXJjaGl0ZWN0dXJlPSJ4ODYiIHB1YmxpY0tleVRva2VuPSIxZmM4YjNiOWExZTE4ZTNiIj48L2Fzc2VtYmx5SWRlbnRpdHk+DQogICAgPC9kZXBlbmRlbnRBc3NlbWJseT4NCiAgPC9kZXBlbmRlbmN5Pg0KPC9hc3NlbWJseT5QQURESU5HWFhQQURESU5HUEFERElOR1hYUEFERElOR1BBRERJTkdYWFBBRERJTkdQQURESU5HWFhQQURESU5HUEFERElOR1hYUEFERElOR1BBREQAEAAATAEAAAcwFzAnMDcwRzBXMHEwdjB8MIIwiTCOMJUwoDClMKswszC+MMMwyTDRMNww4TDnMO8w+jD/MAUxDTEYMR0xIzErMTYxQTFMMVIxYDFkMWgxbDFyMYcxkDGZMZ4xsjG+Mdkx4THqMfUxCjITMisyQzJYMl0yYzJ+MoMyjzKeMqQyqzLEMsoy3TLiMu8y/jITMxkzKDNAM10zZDNpM24zdzOBM5IzrzO8M9QzJzRUNJw00DTWNNw04jToNO409TT8NAM1CjURNRg1HzUnNS81NzVDNUw1UTVXNWE1ajV1NYE1hjWWNZs1oTWnNb01xDXLNdk15DXqNf41EzYeNjY2TDZZNpA2lTa0Nrk2ZjdrN303mzevN7U3HjgkOCo4MDg1OFI4njijOLc42jjnOPM4+zgDOQ85Mzk7OUY5TDlSOVg5XjlkOQAgAAAgAAAAmDDAMMQwfDGAMVAyWDJcMngylDKYMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==
			'
		}
		'icon.ico'      = @{ 
			Priority = 'Critical';  
			Order = 2; 
			Dependencies = @();
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'icon.ico');
			Base64Content = '
AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAABAAACMuAAAjLgAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AQEB/wEBAf8BAQH/AgIC/wICAv8CAgL/BAQC/wUEAv8FBAL/BQQC/wUEAv8FBAL/BQQC/wUEAv8FBAL/BQQC/wUEAv8FBAL/BQQC/wUEAv8FBAL/BQQC/wUEAv8FBAL/BQQC/wUEAv8FBAL/BQQC/wUEAv8FBAL/BQQC/wQEAv8CAgL/AgIC/wICAv8DAwP/AwMD/wMDA/8HBgP/BwYD/wcGA/8HBgP/BwYD/wcGA/8HBgP/BwYD/wcGA/8GBgP/BQUD/wUEA/8NDgP/DQ4D/wUEA/8FBQP/BgYD/wcGA/8HBgP/BwYD/wcGA/8HBgP/BwYD/wcGA/8HBgP/BgYD/wMDA/8DAwP/AwMD/wQEBP8EBAT/BAQE/wMDBP8DAwT/AwME/wMDBP8DAwT/AwME/wQFBP8CAwT/BQQE/xIPA/8jHQP/LiUD/zo0A/86NAP/LiUD/yMdA/8SDwP/BQQE/wIDBP8EBQT/AwME/wMDBP8DAwT/AwME/wMDBP8DAwT/BAQE/wQEBP8EBAT/BAQE/wQEBP8EBAT/BAQE/wQEBP8EBAT/BAQE/wQEBP8DAwT/EBME/ycmBP84LQP/OC0E/ykhBP8cFwT/FxME/xcTBP8cFwT/KSEE/zgtBP84LQP/JyYE/xATBP8DAwT/BAQE/wQEBP8EBAT/BAQE/wQEBP8EBAT/BAQE/wQEBP8FBQX/BQUF/wUFBf8FBQX/BQUF/wUFBf8FBQX/BAQF/w0MBf83LgT/OjIE/xYSBf8JCgX/Cw0F/w4QBf8PEQX/DhEF/w4QBf8LDQX/CQoF/xYSBf86MgT/OC4E/w0MBf8EBAX/BQUF/wUFBf8FBQX/BQUF/wUFBf8FBQX/BQUF/wYGBv8GBgb/BgYG/wYGBv8GBgb/BgYG/wUFBv8SEAb/PjIF/yMdBf8JCQb/DxIG/xETBv8MDgb/CQoG/wgJBv8ICQb/CQoG/wwOBv8REwb/DxIG/wkJBv8jHQX/PjIF/xIQBv8FBQb/BgYG/wYGBv8GBgb/BgYG/wYGBv8GBgb/BwcH/wcHB/8HBwf/BwcH/wcHB/8GBgf/Dw0H/z4zBf8dGAb/CwwH/xIVBv8MDQf/BwcH/wYGB/8HBwf/BwcH/wcHB/8HBwf/BgYH/wcHB/8MDQf/EhUG/wsMB/8dGAb/PjMF/w8NB/8GBgf/BwcH/wcHB/8HBwf/BwcH/wcHB/8ICAj/CAgI/wgICP8ICAj/CQkI/xMWB/85MAb/JR4H/wsNCP8TFgf/CQoI/wgHCP8ICAj/CAgI/wgICP8ICAj/CAgI/wgICP8ICAj/CAgI/wgHCP8JCgj/ExYH/wsNCP8lHgf/OTAG/xMWB/8JCQj/CAgI/wgICP8ICAj/CAgI/wkJCf8JCQn/CQkJ/wkJCf8ICAn/KykH/z01B/8LDAn/FBcI/woKCf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8KCgn/FBcI/wsMCf89NQf/KykH/wgICf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/woKCf88MQf/GRYI/xIVCf8ODwn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8JCQn/CQkJ/wkJCf8ODwn/EhUJ/xkWCP88MQf/CgoJ/wkJCf8JCQn/CQkJ/wkJCf8KCgr/CgoK/woKCv8JCQr/GBUJ/zwyCP8ODgr/FRcK/woKCv8KCgr/CgoK/woKCv8KCgr/CgoK/woKCv8KCgr/CgoK/woKCv8KCgr/CgoK/woKCv8KCgr/CgoK/woKCv8UFwr/Dg4K/zwyCP8YFQn/CQkK/woKCv8KCgr/CgoK/wsLC/8LCwv/CwsL/wkKC/8qIwr/LiYJ/xATC/8REwv/CwsL/wsLC/8LCwv/CwsL/wsLC/8LCwv/CwsL/wsLC/8LCwv/CwsL/wsLC/8LCwv/CwsL/wsLC/8LCwv/CwsL/xETC/8QEgv/LiYJ/yojCv8JCgv/CwsL/wsLC/8LCwv/DAwM/wwMDP8MDAz/CgoM/zUsCv8jHgv/FBcL/w8QDP8MDAz/DAwM/wwMDP8MDAz/DAwM/wwMDP8MDAz/CwoM/wsKDP8MDAz/DAwM/wwMDP8MDAz/DAwM/wwMDP8MDAz/DxAM/xQXC/8jHgv/NSwK/woKDP8MDAz/DAwM/wwMDP8NDQ3/DQ0N/w0NDf8SFQ3/QTsK/x4bDP8WGQz/Dw8N/w0NDf8NDQ3/DQ0N/w0NDf8NDQ3/DQ0N/wwMDf9JWQn/SVkJ/wwMDf8NDQ3/DQ0N/w0NDf8NDQ3/DQ0N/w0NDf8PEA3/FxoM/x4bDP9BOwr/EhUN/w0NDf8NDQ3/DQ0N/w0NDf8NDQ3/DQ0N/xMVDf9COwr/HhsM/xYZDP8PDw3/DQ0N/w0NDf8NDQ3/DQ0N/w0NDf8NDQ3/CwoN/1ltCP9ZbQj/CwoN/w0NDf8NDQ3/DQ0N/w0NDf8NDQ3/DQ0N/w8QDf8XGgz/HhsM/0I7Cv8TFQ3/DQ0N/w0NDf8NDQ3/Dg4O/w4ODv8ODg7/DAwO/zYuDP8lIA3/FhkN/xESDv8ODg7/Dg4O/w4ODv8ODg7/Dg4O/w4ODv8MCw7/Mz0L/zM9C/8MCw7/Dg4O/w4ODv8ODg7/Dg4O/w4ODv8ODg7/ERIO/xYZDf8lIA3/Ni4M/wwMDv8ODg7/Dg4O/w4ODv8PDw//Dw8P/w8PD/8NDg//LScN/zEqDf8UFg//FRcO/w8PD/8PDw//Dw8P/w8PD/8PDw//Dw8P/w0MD/81Pwz/NT8M/w0MD/8PDw//Dw8P/w8PD/8PDw//Dw8P/w8PD/8VFw//FBYP/zEqDf8tJw3/DQ4P/w8PD/8PDw//Dw8P/xAQEP8QEBD/EBAQ/w8PEP8eGw//QTYN/xMUEP8aHQ//EBAQ/xAQEP8QEBD/EBAQ/xAQEP8QEBD/Dg0Q/zZADf82QA3/Dg0Q/xAQEP8QEBD/EBAQ/xAQEP8QEBD/EBAQ/xodD/8TFBD/QTYN/x4bD/8PDxD/EBAQ/xAQEP8QEBD/ERER/xEREf8RERH/ERER/xISEf9CNw3/IB0Q/xkcEP8VFhD/ERER/xEREf8RERH/ERER/xEREf8PDhH/NkAO/zZADv8PDhH/ERER/xEREf8RERH/ERER/xEREf8VFhD/GRwQ/yAdEP9CNw3/EhIR/xEREf8RERH/ERER/xEREf8RERH/ERER/xEREf8RERH/EBAR/zIxD/9EPA7/FBUR/xwfEP8TExH/ERER/xEREf8RERH/ERER/w8OEf82QA7/NkAO/w8OEf8RERH/ERER/xEREf8RERH/ExMR/xwfEP8UFBH/RDwO/zIxD/8QEBH/ERER/xEREf8RERH/ERER/xISEv8SEhL/EhIS/xISEv8TExL/HSAR/0I5D/8uKBD/FhgS/x0gEf8UFBL/EhIS/xISEv8SEhL/EA8S/zdBDv83QQ7/EA8S/xISEv8SEhL/EhIS/xQUEv8dIBH/FhcS/y4oEP9COQ//HSAR/xMTEv8SEhL/EhIS/xISEv8SEhL/ExMT/xMTE/8TExP/ExMT/xMTE/8SEhP/GxkS/0g8D/8oIxH/FxgT/x4hEv8XGRP/ExMT/xMTE/8REBP/OEIP/zhCD/8REBP/ExMT/xMTE/8XGRP/HiES/xcYE/8oIxH/SDwP/xsZEv8SEhP/ExMT/xMTE/8TExP/ExMT/xMTE/8UFBT/FBQU/xQUFP8UFBT/FBQU/xQUFP8TExT/IB0T/0k9D/8vKRL/FhcU/xwfE/8eIRP/GhwT/xUVFP87RRD/O0UQ/xUVFP8aHBP/HiAT/xwfE/8WFxT/LykS/0k9D/8gHRP/ExMU/xQUFP8UFBT/FBQU/xQUFP8UFBT/FBQU/xUVFf8VFRX/FRUV/xUVFf8VFRX/FRUV/xUVFf8UFBX/HBsU/0Q7EP9GPhD/JCAT/xgZFP8aHBT/Gx0U/zpFEP87RhD/Gx0U/xocFP8YGRT/JCAT/0Y+EP9EOxD/HBsU/xQUFf8VFRX/FRUV/xUVFf8VFRX/FRUV/xUVFf8VFRX/FhYW/xYWFv8WFhb/FhYW/xYWFv8WFhb/FhYW/xYWFv8VFBb/ICMV/zY0Ev9FOxH/RTsR/zcvEv8rJhT/KSYU/ykmFP8rJhT/Ny8S/0U7Ef9FOxH/NjQS/yAjFP8VFBb/FhYW/xYWFv8WFhb/FhYW/xYWFv8WFhb/FhYW/xYWFv8WFhb/FhYW/xYWFv8WFhb/FhYW/xYWFv8WFhb/FhYW/xYWFv8XFxb/FRYW/xcXFv8kIRX/NC0U/z01E/9JQhH/SUIR/z41E/80LRT/JCEV/xcXFv8VFhb/FxcW/xYWFv8WFhb/FhYW/xYWFv8WFhb/FhYW/xYWFv8WFhb/FhYW/xcXF/8XFxf/FxcX/xcXF/8XFxf/FxcX/xcXF/8XFxf/FxcX/xcXF/8XFxf/FxcX/xYXF/8VFhf/FRUX/xwfFv8cHxb/FRUX/xUWF/8WFxf/FxcX/xcXF/8XFxf/FxcX/xcXF/8XFxf/FxcX/xcXF/8XFxf/FxcX/xcXF/8XFxf/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8YGBj/GBgY/xgYGP8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xkZGf8ZGRn/GRkZ/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/Ghoa/xoaGv8aGhr/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
			'
		}
		'classes.psm1'  = @{ 
			Priority = 'Critical';  
			Order = 3; 
			Dependencies = @();
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'classes.psm1');
			Base64Content = '
PCMgY2xhc3Nlcy5wc20xDQogICAgLlNZTk9QU0lTDQogICAgICAgIFByb3ZpZGVzIGEgbGlicmFyeSBvZiBjdXN0b20gQyMgY2xhc3NlcyBjb21waWxlZCBpbi1tZW1vcnkgZm9yIHVzZSB3aXRoaW4gdGhlIEVudHJvcGlhIERhc2hib2FyZCBhcHBsaWNhdGlvbi4gDQoJCVRoZXNlIGNsYXNzZXMgb2ZmZXIgbG93LWxldmVsIHN5c3RlbSBpbnRlZ3JhdGlvbiwgSU5JIGZpbGUgaGFuZGxpbmcsIGFuZCBjdXN0b20tdGhlbWVkIFVJIGNvbnRyb2xzLg0KDQogICAgLkRFU0NSSVBUSU9ODQogICAgICAgIFRoaXMgUG93ZXJTaGVsbCBtb2R1bGUgc2VydmVzIGFzIGEgZm91bmRhdGlvbmFsIGxpYnJhcnkgYnkgZGVmaW5pbmcgYW5kIGNvbXBpbGluZyBhIHN1aXRlIG9mIGN1c3RvbSBDIyBjbGFzc2VzIGRpcmVjdGx5IGludG8gdGhlIFBvd2VyU2hlbGwgc2Vzc2lvbiB1c2luZyBgQWRkLVR5cGVgLiBUaGVzZSBjbGFzc2VzIHByb3ZpZGUgZXNzZW50aWFsIGxvdy1sZXZlbCBmdW5jdGlvbmFsaXRpZXMgYW5kIGN1c3RvbSBVSSBlbGVtZW50cyB0aGF0IGFyZSBub3QgbmF0aXZlbHkgYXZhaWxhYmxlIGluIFBvd2VyU2hlbGwgb3IgLk5FVCwgZW5hYmxpbmcgdGhlIHJlc3Qgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIHBlcmZvcm0gYWR2YW5jZWQgdGFza3MuDQoNCiAgICAgICAgVGhlIHByb3ZpZGVkIGNsYXNzZXMgZmFsbCBpbnRvIHNldmVyYWwgY2F0ZWdvcmllczoNCg0KICAgICAgICAxLiAgKipMb3ctTGV2ZWwgU3lzdGVtIEludGVncmF0aW9uIChgQ3VzdG9tLk5hdGl2ZWAsIGBDdXN0b20uTW91c2VIb29rTWFuYWdlcmApOioqDQogICAgICAgICAgICAqICAgKipgTmF0aXZlYDoqKiBBIGNvbXByZWhlbnNpdmUgc3RhdGljIHV0aWxpdHkgY2xhc3MgdGhhdCBleHBvc2VzIGEgd2lkZSBhcnJheSBvZiBXaW5kb3dzIEFQSSBmdW5jdGlvbnMgdGhyb3VnaCBQL0ludm9rZSAoYERsbEltcG9ydGApLiBJdHMgY2FwYWJpbGl0aWVzIGluY2x1ZGUgYWR2YW5jZWQgd2luZG93IG1hbmFnZW1lbnQgKG1vdmluZywgcmVzaXppbmcsIGNoYW5naW5nIFotb3JkZXIpLCBjaGVja2luZyB3aW5kb3cgc3RhdGVzIChtaW5pbWl6ZWQsIHJlc3BvbnNpdmUpLCBzaW11bGF0aW5nIHVzZXIgaW5wdXQgKG1vdXNlIGFuZCBrZXlib2FyZCBldmVudHMpLCBhbmQgcHJvdmlkaW5nIHRoZSBuZWNlc3NhcnkgY29tcG9uZW50cyBmb3IgYW4gZWZmaWNpZW50LCBsb3ctQ1BVIFVJIG1lc3NhZ2UgbG9vcC4NCiAgICAgICAgICAgICogICAqKmBNb3VzZUhvb2tNYW5hZ2VyYDoqKiBQcm92aWRlcyBhIHNpbXBsZSBpbnRlcmZhY2UgdG8gaW5zdGFsbCBhbmQgcmVtb3ZlIGEgc3lzdGVtLXdpZGUgbG93LWxldmVsIG1vdXNlIGhvb2ssIGFsbG93aW5nIHRoZSBhcHBsaWNhdGlvbiB0byBpbnRlcmNlcHQgYW5kIHJlYWN0IHRvIG1vdXNlIGV2ZW50cyBnbG9iYWxseS4NCg0KICAgICAgICAyLiAgKipDb25maWd1cmF0aW9uIE1hbmFnZW1lbnQgKGBDdXN0b20uSW5pRmlsZWApOioqDQogICAgICAgICAgICAqICAgQSBzZWxmLWNvbnRhaW5lZCBjbGFzcyBmb3IgcGFyc2luZyBhbmQgZ2VuZXJhdGluZyBJTkktZm9ybWF0dGVkIGZpbGVzLiBJdCByZWFkcyBJTkkgZmlsZXMgaW50byBzdHJ1Y3R1cmVkIGBPcmRlcmVkRGljdGlvbmFyeWAgb2JqZWN0cyBhbmQgY2FuIHdyaXRlIHRoZW0gYmFjayB0byBkaXNrLCBmb3JtaW5nIHRoZSBjb3JlIG9mIHRoZSBhcHBsaWNhdGlvbidzIGNvbmZpZ3VyYXRpb24gcGVyc2lzdGVuY2UgbWVjaGFuaXNtLg0KDQogICAgICAgIDMuICAqKkV4dGVybmFsIExpYnJhcnkgSW50ZWdyYXRpb24gKGBDdXN0b20uRnRvb2xgKToqKg0KICAgICAgICAgICAgKiAgIEEgc3BlY2lhbGl6ZWQgY2xhc3MgdGhhdCBhY3RzIGFzIGEgYnJpZGdlIHRvIGFuIGV4dGVybmFsIGBmdG9vbC5kbGxgIGxpYnJhcnkuIEl0IHVzZXMgUC9JbnZva2UgdG8gY2FsbCBhIHNwZWNpZmljIGZ1bmN0aW9uIHdpdGhpbiB0aGUgRExMLCBkZW1vbnN0cmF0aW5nIGhvdyB0aGUgYXBwbGljYXRpb24gaW50ZWdyYXRlcyB3aXRoIHByZS1jb21waWxlZCBuYXRpdmUgY29tcG9uZW50cy4NCg0KICAgICAgICA0LiAgKipDdXN0b20gIkRhcmsgTW9kZSIgVUkgQ29udHJvbHM6KioNCiAgICAgICAgICAgICogICBBIGNvbGxlY3Rpb24gb2Ygb3duZXItZHJhd24gV2luZG93cyBGb3JtcyBjb250cm9scyBkZXNpZ25lZCB0byBnaXZlIHRoZSBhcHBsaWNhdGlvbiBhIGNvbnNpc3RlbnQsIG1vZGVybiwgZGFyay10aGVtZWQgYXBwZWFyYW5jZS4gQnkgb3ZlcnJpZGluZyB0aGUgYE9uUGFpbnRgIG1ldGhvZCwgdGhlc2UgY2xhc3NlcyB0YWtlIGZ1bGwgY29udHJvbCBvZiB0aGVpciByZW5kZXJpbmcuDQogICAgICAgICAgICAqICAgSW5jbHVkZXMgYERhcmtDb21ib0JveGAsIGBEYXJrVGFiQ29udHJvbGAsIGEgYFRvZ2dsZWAgc3dpdGNoIChiYXNlZCBvbiBgQ2hlY2tCb3hgKSwgYW5kIGEgYFRleHRQcm9ncmVzc0JhcmAuDQoNCiAgICAgICAgVXBvbiBpbXBvcnQsIHRoZSBtb2R1bGUgaW1tZWRpYXRlbHkgY29tcGlsZXMgdGhpcyBDIyBzb3VyY2UgY29kZSwgbWFraW5nIHRoZXNlIGNsYXNzZXMgYXZhaWxhYmxlIGZvciBpbnN0YW50aWF0aW9uIGFuZCB1c2UgYnkgb3RoZXIgYXBwbGljYXRpb24gbW9kdWxlcy4NCiM+DQoNCiNyZWdpb24gR2xvYmFsIENvbmZpZ3VyYXRpb24NCiAgICAkc2NyaXB0OlJlZmVyZW5jZWRBc3NlbWJsaWVzID0gQCgNCiAgICAgICAgJ1N5c3RlbS5XaW5kb3dzLkZvcm1zJywNCiAgICAgICAgJ1N5c3RlbS5EcmF3aW5nJywNCiAgICAgICAgJ1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24nDQogICAgKQ0KDQogICAgJHNjcmlwdDpDb21waWxhdGlvbk9wdGlvbnMgPSBAew0KICAgICAgICBMYW5ndWFnZSAgICAgICAgICAgICA9ICdDU2hhcnAnDQogICAgICAgIFJlZmVyZW5jZWRBc3NlbWJsaWVzID0gJHNjcmlwdDpSZWZlcmVuY2VkQXNzZW1ibGllcw0KICAgICAgICBXYXJuaW5nQWN0aW9uICAgICAgICA9ICdTaWxlbnRseUNvbnRpbnVlJyANCiAgICB9DQojZW5kcmVnaW9uIEdsb2JhbCBDb25maWd1cmF0aW9uDQoNCiNyZWdpb24gQyMgQ2xhc3MgRGVmaW5pdGlvbnMNCiAgICAkY2xhc3NlcyA9IEAiDQp1c2luZyBTeXN0ZW07DQp1c2luZyBTeXN0ZW0uV2luZG93cy5Gb3JtczsNCnVzaW5nIFN5c3RlbS5EaWFnbm9zdGljczsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9uczsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLlNwZWNpYWxpemVkOw0KdXNpbmcgU3lzdGVtLkRyYXdpbmc7DQp1c2luZyBTeXN0ZW0uSU87DQp1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7DQp1c2luZyBTeXN0ZW0uVGV4dDsNCnVzaW5nIFN5c3RlbS5UaHJlYWRpbmc7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbjsgDQoNCm5hbWVzcGFjZSBDdXN0b20NCnsNCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIE1vdXNlSG9va01hbmFnZXIgew0KICAgICAgICBwdWJsaWMgZGVsZWdhdGUgSW50UHRyIEhvb2tQcm9jKGludCBuQ29kZSwgSW50UHRyIHdQYXJhbSwgSW50UHRyIGxQYXJhbSk7DQogICAgICAgIHByaXZhdGUgc3RhdGljIEhvb2tQcm9jIGhvb2tEZWxlZ2F0ZTsgLy8gR0MgcHJvdGVjdG9yDQogICAgICAgIHB1YmxpYyBzdGF0aWMgSW50UHRyIEhvb2tJZCA9IEludFB0ci5aZXJvOw0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBTdGFydChIb29rUHJvYyBwcm9jKSB7DQogICAgICAgICAgICBob29rRGVsZWdhdGUgPSBwcm9jOw0KICAgICAgICAgICAgSG9va0lkID0gU2V0V2luZG93c0hvb2tFeCgxNCwgcHJvYywgR2V0TW9kdWxlSGFuZGxlKG51bGwpLCAwKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBTdG9wKCkgew0KICAgICAgICAgICAgaWYgKEhvb2tJZCAhPSBJbnRQdHIuWmVybykgew0KICAgICAgICAgICAgICAgIFVuaG9va1dpbmRvd3NIb29rRXgoSG9va0lkKTsNCiAgICAgICAgICAgICAgICBIb29rSWQgPSBJbnRQdHIuWmVybzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBDaGFyU2V0ID0gQ2hhclNldC5BdXRvLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIEludFB0ciBTZXRXaW5kb3dzSG9va0V4KGludCBpZEhvb2ssIEhvb2tQcm9jIGxwZm4sIEludFB0ciBoTW9kLCB1aW50IGR3VGhyZWFkSWQpOw0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBDaGFyU2V0ID0gQ2hhclNldC5BdXRvLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgW3JldHVybjogTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQm9vbCldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgVW5ob29rV2luZG93c0hvb2tFeChJbnRQdHIgaGhrKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgQ2hhclNldCA9IENoYXJTZXQuQXV0bywgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBDYWxsTmV4dEhvb2tFeChJbnRQdHIgaGhrLCBpbnQgbkNvZGUsIEludFB0ciB3UGFyYW0sIEludFB0ciBsUGFyYW0pOw0KICAgICAgICANCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgQ2hhclNldCA9IENoYXJTZXQuQXV0bywgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBJbnRQdHIgR2V0TW9kdWxlSGFuZGxlKHN0cmluZyBscE1vZHVsZU5hbWUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTmF0aXZlDQogICAgew0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gT3JpZ2luYWwgU291cmNlIEEgSW1wb3J0cw0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiU2V0V2luZG93UG9zIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgUG9zaXRpb25XaW5kb3coSW50UHRyIHdpbmRvd0hhbmRsZSwgSW50UHRyIGluc2VydEFmdGVySGFuZGxlLCBpbnQgWCwgaW50IFksIGludCB3aWR0aCwgaW50IGhlaWdodCwgdWludCBmbGFncyk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiR2V0V2luZG93UmVjdCIpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIEdldFdpbmRvd1JlY3QoSW50UHRyIHdpbmRvd0hhbmRsZSwgb3V0IFJFQ1QgcmVjdCk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiU2hvd1dpbmRvdyIpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFNob3dXaW5kb3coSW50UHRyIHdpbmRvd0hhbmRsZSwgaW50IG5DbWRTaG93KTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJTZXRGb3JlZ3JvdW5kV2luZG93IildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgU2V0Rm9yZWdyb3VuZFdpbmRvdyhJbnRQdHIgd2luZG93SGFuZGxlKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJHZXRGb3JlZ3JvdW5kV2luZG93IildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBHZXRGb3JlZ3JvdW5kV2luZG93KCk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIpXQ0KICAgICAgICBbcmV0dXJuOiBNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5Cb29sKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBJc1dpbmRvdyhJbnRQdHIgaFduZCk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiB1aW50IEdldFdpbmRvd1RocmVhZFByb2Nlc3NJZChJbnRQdHIgaFduZCwgb3V0IHVpbnQgbHBkd1Byb2Nlc3NJZCk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiSXNJY29uaWMiKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBJc1dpbmRvd01pbmltaXplZChJbnRQdHIgd2luZG93SGFuZGxlKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJTZW5kTWVzc2FnZVRpbWVvdXQiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gSW50UHRyIEdldFdpbmRvd1Jlc3BvbnNlKEludFB0ciBoV25kLCB1aW50IE1zZywgSW50UHRyIHdQYXJhbSwgSW50UHRyIGxQYXJhbSwgdWludCBmdUZsYWdzLCB1aW50IHVUaW1lb3V0LCBvdXQgSW50UHRyIGxwZHdSZXN1bHQpOw0KDQogICAgICAgIFtEbGxJbXBvcnQoInBzYXBpLmRsbCIsIEVudHJ5UG9pbnQgPSAiRW1wdHlXb3JraW5nU2V0IildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgRW1wdHlXb3JraW5nU2V0KEludFB0ciBoUHJvY2Vzcyk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiTXNnV2FpdEZvck11bHRpcGxlT2JqZWN0cyIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiB1aW50IEFzeW5jRXhlY3V0aW9uKHVpbnQgbkNvdW50LCBJbnRQdHJbXSBwSGFuZGxlcywgYm9vbCBiV2FpdEFsbCwgdWludCBkd01pbGxpc2Vjb25kcywgdWludCBkd1dha2VNYXNrKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJQZWVrTWVzc2FnZSIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFBlZWtNZXNzYWdlKG91dCBNU0cgbHBNc2csIEludFB0ciBoV25kLCB1aW50IHdNc2dGaWx0ZXJNaW4sIHVpbnQgd01zZ0ZpbHRlck1heCwgdWludCB3UmVtb3ZlTXNnKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJUcmFuc2xhdGVNZXNzYWdlIiApXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFRyYW5zbGF0ZU1lc3NhZ2UocmVmIE1TRyBscE1zZyk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiRGlzcGF0Y2hNZXNzYWdlIiApXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBJbnRQdHIgRGlzcGF0Y2hNZXNzYWdlKHJlZiBNU0cgbHBNc2cpOw0KDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiLCBFbnRyeVBvaW50ID0gIlJlbGVhc2VDYXB0dXJlIiApXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFJlbGVhc2VDYXB0dXJlKCk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiU2VuZE1lc3NhZ2UiICldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBTZW5kTWVzc2FnZShJbnRQdHIgaFduZCwgaW50IE1zZywgaW50IHdQYXJhbSwgaW50IGxQYXJhbSk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIENsaWVudFRvU2NyZWVuKEludFB0ciBoV25kLCByZWYgUG9pbnQgbHBQb2ludCk7DQogICAgICAgIA0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFNldEN1cnNvclBvcyhpbnQgeCwgaW50IHkpOyANCiAgICAgICAgDQogICAgICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gdm9pZCBtb3VzZV9ldmVudCh1aW50IGR3RmxhZ3MsIHVpbnQgZHgsIHVpbnQgZHksIHVpbnQgZHdEYXRhLCBpbnQgZHdFeHRyYUluZm8pOw0KICAgICAgICANCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiB2b2lkIGtleWJkX2V2ZW50KGJ5dGUgYlZrLCBieXRlIGJTY2FuLCB1aW50IGR3RmxhZ3MsIEludFB0ciBkd0V4dHJhSW5mbyk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIENsaXBDdXJzb3IocmVmIFJFQ1QgbHBSZWN0KTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgQ2xpcEN1cnNvcihJbnRQdHIgbHBSZWN0KTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgR2V0Q3Vyc29yUG9zKG91dCBQb2ludCBscFBvaW50KTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBHZXRXaW5kb3coSW50UHRyIGhXbmQsIHVpbnQgdUNtZCk7DQoNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIEFEREVEOiBNaXNzaW5nIFdpbmRvdyBNYW5pcHVsYXRpb24gZnJvbSBTb3VyY2UgQg0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiR2V0QWN0aXZlV2luZG93IildDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBHZXRBY3RpdmVXaW5kb3dIYW5kbGUoKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJJc1dpbmRvd1Zpc2libGUiKV0NCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBJc1dpbmRvd0FjdGl2ZShJbnRQdHIgd2luZG93SGFuZGxlKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJTZXRXaW5kb3dUZXh0IiwgU2V0TGFzdEVycm9yID0gdHJ1ZSwgQ2hhclNldCA9IENoYXJTZXQuQXV0byldDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgU2V0V2luZG93VGl0bGUoSW50UHRyIHdpbmRvd0hhbmRsZSwgc3RyaW5nIHdpbmRvd1RpdGxlKTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJHZXRXaW5kb3dMb25nIildDQogICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBJbnRQdHIgR2V0V2luZG93TG9uZzMyKEludFB0ciBoV25kLCBpbnQgbkluZGV4KTsNCg0KICAgICAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgRW50cnlQb2ludCA9ICJHZXRXaW5kb3dMb25nUHRyIildDQogICAgICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBJbnRQdHIgR2V0V2luZG93TG9uZ1B0cjY0KEludFB0ciBoV25kLCBpbnQgbkluZGV4KTsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIEludFB0ciBHZXRXaW5kb3dMb25nUHRyKEludFB0ciBoV25kLCBpbnQgbkluZGV4KQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBDaGVjayBpZiBydW5uaW5nIG9uIDY0LWJpdCAoOCBieXRlcykgb3IgMzItYml0ICg0IGJ5dGVzKQ0KICAgICAgICAgICAgcmV0dXJuIEludFB0ci5TaXplID09IDggPyBHZXRXaW5kb3dMb25nUHRyNjQoaFduZCwgbkluZGV4KSA6IEdldFdpbmRvd0xvbmczMihoV25kLCBuSW5kZXgpOw0KICAgICAgICB9DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiU2V0V2luZG93TG9uZyIpXQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gSW50UHRyIFNldFdpbmRvd0xvbmczMihJbnRQdHIgaFduZCwgaW50IG5JbmRleCwgSW50UHRyIGR3TmV3TG9uZyk7DQoNCiAgICAgICAgW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIEVudHJ5UG9pbnQgPSAiU2V0V2luZG93TG9uZ1B0ciIpXQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBleHRlcm4gSW50UHRyIFNldFdpbmRvd0xvbmdQdHI2NChJbnRQdHIgaFduZCwgaW50IG5JbmRleCwgSW50UHRyIGR3TmV3TG9uZyk7DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBJbnRQdHIgU2V0V2luZG93TG9uZ1B0cihJbnRQdHIgaFduZCwgaW50IG5JbmRleCwgSW50UHRyIGR3TmV3TG9uZykNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIEludFB0ci5TaXplID09IDggPyBTZXRXaW5kb3dMb25nUHRyNjQoaFduZCwgbkluZGV4LCBkd05ld0xvbmcpIDogU2V0V2luZG93TG9uZzMyKGhXbmQsIG5JbmRleCwgZHdOZXdMb25nKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIEludFB0ciBHZXRXaW5kb3dIYW5kbGUob2JqZWN0IHdpbmRvd0lkZW50aWZpZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh3aW5kb3dJZGVudGlmaWVyIGlzIEludFB0cikgcmV0dXJuIChJbnRQdHIpd2luZG93SWRlbnRpZmllcjsNCiAgICAgICAgICAgIGlmICh3aW5kb3dJZGVudGlmaWVyIGlzIGludCkgcmV0dXJuIEZpbmRXaW5kb3dCeVByb2Nlc3NJZCgoaW50KXdpbmRvd0lkZW50aWZpZXIpOw0KICAgICAgICAgICAgcmV0dXJuIEludFB0ci5aZXJvOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBJbnRQdHIgRmluZFdpbmRvd0J5UHJvY2Vzc0lkKGludCBwcm9jZXNzSWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeSB7IHJldHVybiBQcm9jZXNzLkdldFByb2Nlc3NCeUlkKHByb2Nlc3NJZCkuTWFpbldpbmRvd0hhbmRsZTsgfQ0KICAgICAgICAgICAgY2F0Y2ggeyByZXR1cm4gSW50UHRyLlplcm87IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBCcmluZ1RvRnJvbnQob2JqZWN0IHdpbmRvd0lkZW50aWZpZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIEludFB0ciB3aW5kb3dIYW5kbGUgPSBHZXRXaW5kb3dIYW5kbGUod2luZG93SWRlbnRpZmllcik7DQogICAgICAgICAgICBpZiAod2luZG93SGFuZGxlID09IEludFB0ci5aZXJvKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICBpZiAoTmF0aXZlLklzV2luZG93TWluaW1pemVkKHdpbmRvd0hhbmRsZSkpIE5hdGl2ZS5TaG93V2luZG93KHdpbmRvd0hhbmRsZSwgTmF0aXZlLlNXX1JFU1RPUkUpOw0KICAgICAgICAgICAgcmV0dXJuIE5hdGl2ZS5TZXRGb3JlZ3JvdW5kV2luZG93KHdpbmRvd0hhbmRsZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgU2VuZFRvQmFjayhvYmplY3Qgd2luZG93SWRlbnRpZmllcikNCiAgICAgICAgew0KICAgICAgICAgICAgSW50UHRyIHdpbmRvd0hhbmRsZSA9IEdldFdpbmRvd0hhbmRsZSh3aW5kb3dJZGVudGlmaWVyKTsNCiAgICAgICAgICAgIGlmICh3aW5kb3dIYW5kbGUgPT0gSW50UHRyLlplcm8pIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIHJldHVybiBOYXRpdmUuU2hvd1dpbmRvdyh3aW5kb3dIYW5kbGUsIE5hdGl2ZS5TV19NSU5JTUlaRSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgSXNNaW5pbWl6ZWQob2JqZWN0IHdpbmRvd0lkZW50aWZpZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIEludFB0ciB3aW5kb3dIYW5kbGUgPSBHZXRXaW5kb3dIYW5kbGUod2luZG93SWRlbnRpZmllcik7DQogICAgICAgICAgICBpZiAod2luZG93SGFuZGxlID09IEludFB0ci5aZXJvKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICByZXR1cm4gTmF0aXZlLklzV2luZG93TWluaW1pemVkKHdpbmRvd0hhbmRsZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgUmVzcG9uc2l2ZShJbnRQdHIgaFduZCwgdWludCB0aW1lb3V0ID0gMTAwKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoaFduZCA9PSBJbnRQdHIuWmVybykgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIEludFB0ciByZXN1bHQ7DQogICAgICAgICAgICAgICAgSW50UHRyIHNlbmRSZXN1bHQgPSBOYXRpdmUuR2V0V2luZG93UmVzcG9uc2UoaFduZCwgTmF0aXZlLldNX05VTEwsIEludFB0ci5aZXJvLCBJbnRQdHIuWmVybywgTmF0aXZlLlNNVE9fQUJPUlRJRkhVTkcsIHRpbWVvdXQsIG91dCByZXN1bHQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBzZW5kUmVzdWx0ICE9IEludFB0ci5aZXJvOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgVGFzazxib29sPiBSZXNwb25zaXZlQXN5bmMoSW50UHRyIGhXbmQsIHVpbnQgdGltZW91dCA9IDEwMCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHRjcyA9IG5ldyBUYXNrQ29tcGxldGlvblNvdXJjZTxib29sPigpOw0KICAgICAgICAgICAgVGhyZWFkUG9vbC5RdWV1ZVVzZXJXb3JrSXRlbShzdGF0ZSA9PiB7DQogICAgICAgICAgICAgICAgdHJ5IHsgdGNzLlNldFJlc3VsdChSZXNwb25zaXZlKGhXbmQsIHRpbWVvdXQpKTsgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpIHsgdGNzLlNldEV4Y2VwdGlvbihleCk7IH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuIHRjcy5UYXNrOw0KICAgICAgICB9DQoNCiAgICAgICAgW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQ0KICAgICAgICBwdWJsaWMgc3RydWN0IFJFQ1QgeyBwdWJsaWMgaW50IExlZnQ7IHB1YmxpYyBpbnQgVG9wOyBwdWJsaWMgaW50IFJpZ2h0OyBwdWJsaWMgaW50IEJvdHRvbTsgfQ0KDQogICAgICAgIFtTdHJ1Y3RMYXlvdXQoTGF5b3V0S2luZC5TZXF1ZW50aWFsKV0NCiAgICAgICAgcHVibGljIHN0cnVjdCBNU0cgeyBwdWJsaWMgSW50UHRyIGh3bmQ7IHB1YmxpYyB1aW50IG1lc3NhZ2U7IHB1YmxpYyBVSW50UHRyIHdQYXJhbTsgcHVibGljIEludFB0ciBsUGFyYW07IHB1YmxpYyB1aW50IHRpbWU7IHB1YmxpYyBTeXN0ZW0uRHJhd2luZy5Qb2ludCBwdDsgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgSW50UHRyIFRvcFdpbmRvd0hhbmRsZSA9IG5ldyBJbnRQdHIoMCk7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgSW50UHRyIEhXTkRfVE9QTU9TVCA9IG5ldyBJbnRQdHIoLTEpOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEludFB0ciBIV05EX05PVE9QTU9TVCA9IG5ldyBJbnRQdHIoLTIpOw0KICAgICAgICBwdWJsaWMgY29uc3QgdWludCBXTV9OVUxMID0gMHgwMDAwOw0KICAgICAgICBwdWJsaWMgY29uc3QgdWludCBTTVRPX0FCT1JUSUZIVU5HID0gMHgwMDAyOw0KICAgICAgICANCiAgICAgICAgLy8gR2V0V2luZG93IGNvbW1hbmRzDQogICAgICAgIHB1YmxpYyBjb25zdCB1aW50IEdXX0hXTkRORVhUID0gMjsNCiAgICAgICAgcHVibGljIGNvbnN0IHVpbnQgR1dfSFdORFBSRVYgPSAzOw0KDQogICAgICAgIC8vIFdpbmRvdyBTdGF0ZXMNCiAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19ISURFID0gMDsgICAgICAgLy8gQWRkZWQgZnJvbSBCDQogICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfU0hPVyA9IDU7ICAgICAgIC8vIEFkZGVkIGZyb20gQg0KICAgICAgICBwdWJsaWMgY29uc3QgaW50IFNXX01BWElNSVpFID0gMzsgICAvLyBBZGRlZCBmcm9tIEINCiAgICAgICAgcHVibGljIGNvbnN0IGludCBTV19NSU5JTUlaRSA9IDY7DQogICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dfUkVTVE9SRSA9IDk7DQoNCiAgICAgICAgcHVibGljIGNvbnN0IHVpbnQgUVNfQUxMSU5QVVQgPSAweDA0RkY7DQogICAgICAgIHB1YmxpYyBjb25zdCB1aW50IFBNX1JFTU9WRSA9IDB4MDAwMTsNCiAgICAgICAgDQogICAgICAgIC8vIFBvc2l0aW9uaW5nIEZsYWdzDQogICAgICAgIHB1YmxpYyBjb25zdCB1aW50IFNXUF9OT1NJWkUgPSAweDAwMDE7ICAgICAgDQogICAgICAgIHB1YmxpYyBjb25zdCB1aW50IFNXUF9OT01PVkUgPSAweDAwMDI7ICAgICAgDQogICAgICAgIHB1YmxpYyBjb25zdCB1aW50IFNXUF9OT1pPUkRFUiA9IDB4MDAwNDsgICAgDQogICAgICAgIHB1YmxpYyBjb25zdCB1aW50IFNXUF9OT0FDVElWQVRFID0gMHgwMDEwOw0KICAgICAgICBwdWJsaWMgY29uc3QgdWludCBTV1BfRlJBTUVDSEFOR0VEID0gMHgwMDIwOyAvLyA8LS0tIEFERCBUSElTDQogICAgICAgIHB1YmxpYyBjb25zdCBpbnQgU1dQX1NIT1dXSU5ET1cgPSAweDAwNDA7ICAgDQogICAgICAgIA0KICAgICAgICAvLyBPdGhlciBjb25zdGFudHMgYWRkZWQgZnJvbSBCDQogICAgICAgIHB1YmxpYyBjb25zdCBpbnQgRVJST1JfVElNRU9VVCA9IDE0NjA7DQogICAgICAgIHB1YmxpYyBjb25zdCB1aW50IFdBSVRfVElNRU9VVCA9IDI1ODsNCiAgICAgICAgcHVibGljIGNvbnN0IGludCBHV0xfRVhTVFlMRSA9IC0yMDsNCiAgICAgICAgcHVibGljIGNvbnN0IHVpbnQgV1NfRVhfVE9QTU9TVCA9IDB4MDAwMDAwMDg7DQoNCiAgICAgICAgcHVibGljIGNvbnN0IGJ5dGUgVktfTUVOVSA9IDB4MTI7IA0KICAgICAgICBwdWJsaWMgY29uc3QgdWludCBLRVlFVkVOVEZfRVhURU5ERURLRVkgPSAweDAwMDE7IA0KICAgICAgICBwdWJsaWMgY29uc3QgdWludCBLRVlFVkVOVEZfS0VZVVAgPSAweDAwMDI7IA0KDQogICAgICAgIFtGbGFnc10NCiAgICAgICAgcHVibGljIGVudW0gV2luZG93UG9zaXRpb25PcHRpb25zIDogdWludCANCiAgICAgICAgeyANCiAgICAgICAgICAgIE5vWk9yZGVyQ2hhbmdlID0gU1dQX05PWk9SREVSLCAgIC8vIEFkZGVkIGZyb20gQg0KICAgICAgICAgICAgRG9Ob3RBY3RpdmF0ZSA9IFNXUF9OT0FDVElWQVRFLA0KICAgICAgICAgICAgTWFrZVZpc2libGUgPSBTV1BfU0hPV1dJTkRPVyAgICAgLy8gQWRkZWQgZnJvbSBCDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEZ0b29sDQogICAgew0KICAgICAgICBbRGxsSW1wb3J0KEAiJCgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5QYXRocy5GdG9vbERMTCkiLCBFbnRyeVBvaW50ID0gImZuUG9zdE1lc3NhZ2UiLCBDYWxsaW5nQ29udmVudGlvbiA9IENhbGxpbmdDb252ZW50aW9uLlN0ZENhbGwpXQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiB2b2lkIGZuUG9zdE1lc3NhZ2UoSW50UHRyIGhXbmQsIGludCBtc2csIGludCB3UGFyYW0sIGludCBsUGFyYW0pOw0KICAgIH0NCg0KICAgIHB1YmxpYyBjbGFzcyBJbmlGaWxlDQogICAgew0KICAgICAgICBwcml2YXRlIHN0cmluZyBmaWxlUGF0aDsNCiAgICAgICAgcHVibGljIEluaUZpbGUoc3RyaW5nIGZpbGVQYXRoKSB7IHRoaXMuZmlsZVBhdGggPSBmaWxlUGF0aDsgfQ0KDQogICAgICAgIHB1YmxpYyBPcmRlcmVkRGljdGlvbmFyeSBSZWFkSW5pRmlsZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIE9yZGVyZWREaWN0aW9uYXJ5IGNvbmZpZyA9IG5ldyBPcmRlcmVkRGljdGlvbmFyeSgpOw0KICAgICAgICAgICAgaWYgKCFGaWxlLkV4aXN0cyhmaWxlUGF0aCkpIHJldHVybiBjb25maWc7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgY3VycmVudFNlY3Rpb24gPSBudWxsOw0KICAgICAgICAgICAgICAgIHN0cmluZ1tdIGxpbmVzID0gRmlsZS5SZWFkQWxsTGluZXMoZmlsZVBhdGgpOw0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyBsaW5lIGluIGxpbmVzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHRyaW1tZWRMaW5lID0gbGluZS5UcmltKCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmcuSXNOdWxsT3JXaGl0ZVNwYWNlKHRyaW1tZWRMaW5lKSB8fCB0cmltbWVkTGluZS5TdGFydHNXaXRoKCI7IikgfHwgdHJpbW1lZExpbmUuU3RhcnRzV2l0aCgiIyIpKSBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRyaW1tZWRMaW5lLlN0YXJ0c1dpdGgoIlsiKSAmJiB0cmltbWVkTGluZS5FbmRzV2l0aCgiXSIpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2VjdGlvbiA9IHRyaW1tZWRMaW5lLlN1YnN0cmluZygxLCB0cmltbWVkTGluZS5MZW5ndGggLSAyKS5UcmltKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbmZpZy5Db250YWlucyhjdXJyZW50U2VjdGlvbikpIGNvbmZpZ1tjdXJyZW50U2VjdGlvbl0gPSBuZXcgT3JkZXJlZERpY3Rpb25hcnkoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGludCBlcXVhbHNQb3MgPSB0cmltbWVkTGluZS5JbmRleE9mKCI9Iik7DQogICAgICAgICAgICAgICAgICAgIGlmIChlcXVhbHNQb3MgPiAwICYmIGN1cnJlbnRTZWN0aW9uICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBrZXkgPSB0cmltbWVkTGluZS5TdWJzdHJpbmcoMCwgZXF1YWxzUG9zKS5UcmltKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdmFsdWUgPSB0cmltbWVkTGluZS5TdWJzdHJpbmcoZXF1YWxzUG9zICsgMSkuVHJpbSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLlN0YXJ0c1dpdGgoIlwiIikgJiYgdmFsdWUuRW5kc1dpdGgoIlwiIikpIHZhbHVlID0gdmFsdWUuU3Vic3RyaW5nKDEsIHZhbHVlLkxlbmd0aCAtIDIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgKChPcmRlcmVkRGljdGlvbmFyeSljb25maWdbY3VycmVudFNlY3Rpb25dKVtrZXldID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIHsgcmV0dXJuIG5ldyBPcmRlcmVkRGljdGlvbmFyeSgpOyB9DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBXcml0ZUluaUZpbGUoT3JkZXJlZERpY3Rpb25hcnkgY29uZmlnKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcgZGlyZWN0b3J5ID0gUGF0aC5HZXREaXJlY3RvcnlOYW1lKGZpbGVQYXRoKTsNCiAgICAgICAgICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KGRpcmVjdG9yeSkgJiYgIURpcmVjdG9yeS5FeGlzdHMoZGlyZWN0b3J5KSkgRGlyZWN0b3J5LkNyZWF0ZURpcmVjdG9yeShkaXJlY3RvcnkpOw0KICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBsaW5lcyA9IG5ldyBMaXN0PHN0cmluZz4oKTsNCiAgICAgICAgICAgICAgICBib29sIGZpcnN0U2VjdGlvbiA9IHRydWU7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoRGljdGlvbmFyeUVudHJ5IHNlY3Rpb25FbnRyeSBpbiBjb25maWcpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdHJpbmcgc2VjdGlvbiA9IHNlY3Rpb25FbnRyeS5LZXkuVG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICAgICAgT3JkZXJlZERpY3Rpb25hcnkgc2VjdGlvbkRhdGEgPSAoT3JkZXJlZERpY3Rpb25hcnkpc2VjdGlvbkVudHJ5LlZhbHVlOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIWZpcnN0U2VjdGlvbikgbGluZXMuQWRkKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgbGluZXMuQWRkKCJbIiArIHNlY3Rpb24gKyAiXSIpOw0KICAgICAgICAgICAgICAgICAgICBmaXJzdFNlY3Rpb24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoRGljdGlvbmFyeUVudHJ5IGt2cEVudHJ5IGluIHNlY3Rpb25EYXRhKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcga2V5ID0ga3ZwRW50cnkuS2V5LlRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdmFsdWUgPSBrdnBFbnRyeS5WYWx1ZS5Ub1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLkNvbnRhaW5zKCIgIikgJiYgISh2YWx1ZS5TdGFydHNXaXRoKCJcIiIpICYmIHZhbHVlLkVuZHNXaXRoKCJcIiIpKSkgdmFsdWUgPSAiXCIiICsgdmFsdWUgKyAiXCIiOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMuQWRkKGtleSArICIgPSAiICsgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIEZpbGUuV3JpdGVBbGxMaW5lcyhmaWxlUGF0aCwgbGluZXMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggeyB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgY2xhc3MgRGFya0NvbWJvQm94IDogQ29tYm9Cb3gNCiAgICB7DQogICAgICAgIHByaXZhdGUgQ29sb3IgQmFja2dyb3VuZENvbG9yID0gQ29sb3IuRnJvbUFyZ2IoNDAsIDQwLCA0MCk7DQogICAgICAgIHByaXZhdGUgQ29sb3IgVGV4dENvbG9yID0gQ29sb3IuRnJvbUFyZ2IoMjQwLCAyNDAsIDI0MCk7DQogICAgICAgIHByaXZhdGUgQ29sb3IgQm9yZGVyQ29sb3IgPSBDb2xvci5Gcm9tQXJnYig2NSwgNjUsIDcwKTsNCiAgICAgICAgcHJpdmF0ZSBDb2xvciBBcnJvd0NvbG9yID0gQ29sb3IuRnJvbUFyZ2IoMjQwLCAyNDAsIDI0MCk7DQogICAgICAgIHByaXZhdGUgQ29sb3IgU2VsZWN0ZWRJdGVtQmFja0NvbG9yID0gQ29sb3IuRnJvbUFyZ2IoMCwgMTIwLCAyMDApOw0KICAgICAgICBwcml2YXRlIENvbG9yIFNlbGVjdGVkSXRlbUZvcmVDb2xvciA9IENvbG9yLkZyb21BcmdiKDI0MCwgMjQwLCAyNDApOw0KICAgICAgICBwcml2YXRlIENvbG9yIERyb3BEb3duQmFja0NvbG9yID0gQ29sb3IuRnJvbUFyZ2IoNDAsIDQwLCA0MCk7DQoNCiAgICAgICAgcHVibGljIERhcmtDb21ib0JveCgpIDogYmFzZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRoaXMuU2V0U3R5bGUoQ29udHJvbFN0eWxlcy5Vc2VyUGFpbnQgfCBDb250cm9sU3R5bGVzLk9wdGltaXplZERvdWJsZUJ1ZmZlciB8IENvbnRyb2xTdHlsZXMuUmVzaXplUmVkcmF3LCB0cnVlKTsNCiAgICAgICAgICAgIHRoaXMuRHJhd01vZGUgPSBEcmF3TW9kZS5Pd25lckRyYXdGaXhlZDsNCiAgICAgICAgICAgIHRoaXMuRHJvcERvd25TdHlsZSA9IENvbWJvQm94U3R5bGUuRHJvcERvd25MaXN0Ow0KICAgICAgICAgICAgdGhpcy5GbGF0U3R5bGUgPSBGbGF0U3R5bGUuRmxhdDsNCiAgICAgICAgfQ0KDQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIE9uUGFpbnQoUGFpbnRFdmVudEFyZ3MgZSkNCiAgICAgICAgew0KICAgICAgICAgICAgR3JhcGhpY3MgZyA9IGUuR3JhcGhpY3M7DQogICAgICAgICAgICBSZWN0YW5nbGUgYm91bmRzID0gdGhpcy5DbGllbnRSZWN0YW5nbGU7DQogICAgICAgICAgICB1c2luZyAoU29saWRCcnVzaCBiYWNrQnJ1c2ggPSBuZXcgU29saWRCcnVzaCh0aGlzLkVuYWJsZWQgPyBCYWNrZ3JvdW5kQ29sb3IgOiBTeXN0ZW1Db2xvcnMuQ29udHJvbERhcmspKQ0KICAgICAgICAgICAgICAgIGcuRmlsbFJlY3RhbmdsZShiYWNrQnJ1c2gsIGJvdW5kcyk7DQoNCiAgICAgICAgICAgIGlmICh0aGlzLkRyb3BEb3duU3R5bGUgPT0gQ29tYm9Cb3hTdHlsZS5Ecm9wRG93bkxpc3QpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIHRleHQgPSB0aGlzLlRleHQ7DQogICAgICAgICAgICAgICAgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eSh0ZXh0KSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIFJlY3RhbmdsZSB0ZXh0UmVjdCA9IG5ldyBSZWN0YW5nbGUoYm91bmRzLkxlZnQgLSA4LCBib3VuZHMuVG9wLCBib3VuZHMuV2lkdGgsIGJvdW5kcy5IZWlnaHQpOw0KICAgICAgICAgICAgICAgICAgICBUZXh0UmVuZGVyZXIuRHJhd1RleHQoZywgdGV4dCwgdGhpcy5Gb250LCB0ZXh0UmVjdCwgdGhpcy5FbmFibGVkID8gVGV4dENvbG9yIDogU3lzdGVtQ29sb3JzLkdyYXlUZXh0LCBUZXh0Rm9ybWF0RmxhZ3MuSG9yaXpvbnRhbENlbnRlciB8IFRleHRGb3JtYXRGbGFncy5WZXJ0aWNhbENlbnRlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdXNpbmcgKFBlbiBib3JkZXJQZW4gPSBuZXcgUGVuKHRoaXMuRW5hYmxlZCA/IEJvcmRlckNvbG9yIDogU3lzdGVtQ29sb3JzLkNvbnRyb2xEYXJrRGFyaykpDQogICAgICAgICAgICAgICAgZy5EcmF3UmVjdGFuZ2xlKGJvcmRlclBlbiwgYm91bmRzLkxlZnQsIGJvdW5kcy5Ub3AsIGJvdW5kcy5XaWR0aCAtIDIsIGJvdW5kcy5IZWlnaHQpOw0KDQogICAgICAgICAgICBSZWN0YW5nbGUgYnV0dG9uUmVjdCA9IG5ldyBSZWN0YW5nbGUoYm91bmRzLldpZHRoLCBib3VuZHMuVG9wLCBib3VuZHMuTGVmdCwgYm91bmRzLkhlaWdodCk7DQogICAgICAgICAgICBQb2ludCBjZW50ZXIgPSBuZXcgUG9pbnQoYnV0dG9uUmVjdC5MZWZ0ICsgYnV0dG9uUmVjdC5XaWR0aCAvIDIsIGJ1dHRvblJlY3QuVG9wICsgYnV0dG9uUmVjdC5IZWlnaHQgLyAyKTsNCiAgICAgICAgICAgIFBvaW50W10gYXJyb3dQb2ludHMgPSBuZXcgUG9pbnRbXSB7IG5ldyBQb2ludChjZW50ZXIuWCAtIDUsIGNlbnRlci5ZIC0gMiksIG5ldyBQb2ludChjZW50ZXIuWCArIDUsIGNlbnRlci5ZIC0gMiksIG5ldyBQb2ludChjZW50ZXIuWCwgY2VudGVyLlkgKyAzKSB9Ow0KICAgICAgICAgICAgdXNpbmcgKFNvbGlkQnJ1c2ggYXJyb3dCcnVzaCA9IG5ldyBTb2xpZEJydXNoKHRoaXMuRW5hYmxlZCA/IEFycm93Q29sb3IgOiBTeXN0ZW1Db2xvcnMuR3JheVRleHQpKQ0KICAgICAgICAgICAgICAgIGcuRmlsbFBvbHlnb24oYXJyb3dCcnVzaCwgYXJyb3dQb2ludHMpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIHZvaWQgT25EcmF3SXRlbShEcmF3SXRlbUV2ZW50QXJncyBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoZS5JbmRleCA8IDAgfHwgZS5JbmRleCA+PSB0aGlzLkl0ZW1zLkNvdW50KSByZXR1cm47DQogICAgICAgICAgICBHcmFwaGljcyBnID0gZS5HcmFwaGljczsNCiAgICAgICAgICAgIFJlY3RhbmdsZSBib3VuZHMgPSBlLkJvdW5kczsNCiAgICAgICAgICAgIENvbG9yIGN1cnJlbnRCYWNrQ29sb3IgPSAoKGUuU3RhdGUgJiBEcmF3SXRlbVN0YXRlLlNlbGVjdGVkKSA9PSBEcmF3SXRlbVN0YXRlLlNlbGVjdGVkKSA/IFNlbGVjdGVkSXRlbUJhY2tDb2xvciA6IERyb3BEb3duQmFja0NvbG9yOw0KICAgICAgICAgICAgQ29sb3IgY3VycmVudEZvcmVDb2xvciA9ICgoZS5TdGF0ZSAmIERyYXdJdGVtU3RhdGUuU2VsZWN0ZWQpID09IERyYXdJdGVtU3RhdGUuU2VsZWN0ZWQpID8gU2VsZWN0ZWRJdGVtRm9yZUNvbG9yIDogVGV4dENvbG9yOw0KDQogICAgICAgICAgICB1c2luZyAoU29saWRCcnVzaCBiYWNrQnJ1c2ggPSBuZXcgU29saWRCcnVzaChjdXJyZW50QmFja0NvbG9yKSkNCiAgICAgICAgICAgICAgICBnLkZpbGxSZWN0YW5nbGUoYmFja0JydXNoLCBib3VuZHMuTGVmdCwgYm91bmRzLlRvcCwgYm91bmRzLldpZHRoLCBib3VuZHMuSGVpZ2h0KTsNCg0KICAgICAgICAgICAgc3RyaW5nIGl0ZW1UZXh0ID0gdGhpcy5JdGVtc1tlLkluZGV4XS5Ub1N0cmluZygpOw0KICAgICAgICAgICAgUmVjdGFuZ2xlIHRleHRCb3VuZHMgPSBuZXcgUmVjdGFuZ2xlKGJvdW5kcy5MZWZ0LCBib3VuZHMuVG9wLCBib3VuZHMuV2lkdGgsIGJvdW5kcy5IZWlnaHQpOw0KICAgICAgICAgICAgVGV4dFJlbmRlcmVyLkRyYXdUZXh0KGcsIGl0ZW1UZXh0LCB0aGlzLkZvbnQsIHRleHRCb3VuZHMsIGN1cnJlbnRGb3JlQ29sb3IsIFRleHRGb3JtYXRGbGFncy5Ib3Jpem9udGFsQ2VudGVyIHwgVGV4dEZvcm1hdEZsYWdzLlZlcnRpY2FsQ2VudGVyKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBjbGFzcyBEYXJrVGFiQ29udHJvbCA6IFRhYkNvbnRyb2wNCiAgICB7DQogICAgICAgIHB1YmxpYyBEYXJrVGFiQ29udHJvbCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRoaXMuU2V0U3R5bGUoQ29udHJvbFN0eWxlcy5Vc2VyUGFpbnQgfCBDb250cm9sU3R5bGVzLkFsbFBhaW50aW5nSW5XbVBhaW50IHwgQ29udHJvbFN0eWxlcy5PcHRpbWl6ZWREb3VibGVCdWZmZXIgfCBDb250cm9sU3R5bGVzLlJlc2l6ZVJlZHJhdywgdHJ1ZSk7DQogICAgICAgICAgICB0aGlzLkRyYXdNb2RlID0gVGFiRHJhd01vZGUuT3duZXJEcmF3Rml4ZWQ7DQogICAgICAgICAgICB0aGlzLlNpemVNb2RlID0gVGFiU2l6ZU1vZGUuRml4ZWQ7DQogICAgICAgICAgICB0aGlzLkl0ZW1TaXplID0gbmV3IFNpemUoMTIwLCAzMCk7DQogICAgICAgIH0NCg0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdm9pZCBPblBhaW50KFBhaW50RXZlbnRBcmdzIGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHVzaW5nIChTb2xpZEJydXNoIGIgPSBuZXcgU29saWRCcnVzaChDb2xvci5Gcm9tQXJnYigzMCwgMzAsIDMwKSkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZS5HcmFwaGljcy5GaWxsUmVjdGFuZ2xlKGIsIHRoaXMuQ2xpZW50UmVjdGFuZ2xlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0aGlzLlRhYkNvdW50OyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgUmVjdGFuZ2xlIHRhYlJlY3QgPSB0aGlzLkdldFRhYlJlY3QoaSk7DQogICAgICAgICAgICAgICAgYm9vbCBpc1NlbGVjdGVkID0gKHRoaXMuU2VsZWN0ZWRJbmRleCA9PSBpKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBDb2xvciBiZyA9IGlzU2VsZWN0ZWQgPyBDb2xvci5Gcm9tQXJnYig1MCwgNTAsIDUwKSA6IENvbG9yLkZyb21BcmdiKDMwLCAzMCwgMzApOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHVzaW5nIChTb2xpZEJydXNoIGIgPSBuZXcgU29saWRCcnVzaChiZykpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBlLkdyYXBoaWNzLkZpbGxSZWN0YW5nbGUoYiwgdGFiUmVjdCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHN0cmluZyB0ZXh0ID0gdGhpcy5UYWJQYWdlc1tpXS5UZXh0Ow0KICAgICAgICAgICAgICAgIFRleHRSZW5kZXJlci5EcmF3VGV4dChlLkdyYXBoaWNzLCB0ZXh0LCB0aGlzLkZvbnQsIHRhYlJlY3QsIENvbG9yLldoaXRlLCBUZXh0Rm9ybWF0RmxhZ3MuSG9yaXpvbnRhbENlbnRlciB8IFRleHRGb3JtYXRGbGFncy5WZXJ0aWNhbENlbnRlcik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0ZWQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2luZyAoUGVuIHAgPSBuZXcgUGVuKENvbG9yLkZyb21BcmdiKDAsIDEyMCwgMjE1KSwgMikpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGUuR3JhcGhpY3MuRHJhd0xpbmUocCwgdGFiUmVjdC5MZWZ0LCB0YWJSZWN0LkJvdHRvbSAtIDEsIHRhYlJlY3QuUmlnaHQsIHRhYlJlY3QuQm90dG9tIC0gMSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIE9uUGFpbnRCYWNrZ3JvdW5kKFBhaW50RXZlbnRBcmdzIHBldmVudCkge30NCiAgICB9DQoNCiAgICBwdWJsaWMgY2xhc3MgVG9nZ2xlIDogQ2hlY2tCb3gNCiAgICB7DQogICAgICAgIHB1YmxpYyBUb2dnbGUoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0aGlzLlNldFN0eWxlKENvbnRyb2xTdHlsZXMuVXNlclBhaW50IHwgQ29udHJvbFN0eWxlcy5BbGxQYWludGluZ0luV21QYWludCwgdHJ1ZSk7DQogICAgICAgICAgICB0aGlzLlBhZGRpbmcgPSBuZXcgUGFkZGluZygxKTsNCiAgICAgICAgICAgIHRoaXMuQXBwZWFyYW5jZSA9IEFwcGVhcmFuY2UuQnV0dG9uOw0KICAgICAgICAgICAgdGhpcy5GbGF0U3R5bGUgPSBGbGF0U3R5bGUuRmxhdDsNCiAgICAgICAgICAgIHRoaXMuRmxhdEFwcGVhcmFuY2UuQm9yZGVyU2l6ZSA9IDA7DQogICAgICAgIH0NCiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIHZvaWQgT25QYWludChQYWludEV2ZW50QXJncyBlKQ0KICAgICAgICB7DQogICAgICAgICAgICBiYXNlLk9uUGFpbnQoZSk7DQogICAgICAgICAgICBlLkdyYXBoaWNzLlNtb290aGluZ01vZGUgPSBTeXN0ZW0uRHJhd2luZy5EcmF3aW5nMkQuU21vb3RoaW5nTW9kZS5BbnRpQWxpYXM7DQogICAgICAgICAgICBDb2xvciBiYWNrQ29sb3IgPSB0aGlzLlBhcmVudCAhPSBudWxsID8gdGhpcy5QYXJlbnQuQmFja0NvbG9yIDogU3lzdGVtQ29sb3JzLkNvbnRyb2w7DQogICAgICAgICAgICBlLkdyYXBoaWNzLkNsZWFyKGJhY2tDb2xvcik7DQogICAgICAgICAgICBDb2xvciBvbkNvbG9yID0gQ29sb3IuRnJvbUFyZ2IoMzUsIDE3NSwgNzUpOw0KICAgICAgICAgICAgQ29sb3Igb2ZmQ29sb3IgPSBDb2xvci5Gcm9tQXJnYigyMTAsIDQ1LCA0NSk7DQoNCiAgICAgICAgICAgIHVzaW5nICh2YXIgcGF0aCA9IG5ldyBTeXN0ZW0uRHJhd2luZy5EcmF3aW5nMkQuR3JhcGhpY3NQYXRoKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLlBhZGRpbmcuQWxsOw0KICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5IZWlnaHQgLSAyICogZDsNCiAgICAgICAgICAgICAgICBwYXRoLkFkZEFyYyhkLCBkLCByLCByLCA5MCwgMTgwKTsNCiAgICAgICAgICAgICAgICBwYXRoLkFkZEFyYyh0aGlzLldpZHRoIC0gciAtIGQsIGQsIHIsIHIsIC05MCwgMTgwKTsNCiAgICAgICAgICAgICAgICBwYXRoLkNsb3NlRmlndXJlKCk7DQogICAgICAgICAgICAgICAgdXNpbmcodmFyIGJydXNoID0gbmV3IFNvbGlkQnJ1c2godGhpcy5DaGVja2VkID8gb25Db2xvciA6IG9mZkNvbG9yKSkgZS5HcmFwaGljcy5GaWxsUGF0aChicnVzaCwgcGF0aCk7DQoNCiAgICAgICAgICAgICAgICByID0gdGhpcy5IZWlnaHQgLSA2Ow0KICAgICAgICAgICAgICAgIHZhciByZWN0ID0gdGhpcy5DaGVja2VkID8gbmV3IFJlY3RhbmdsZSh0aGlzLldpZHRoIC0gciAtIDMsIDMsIHIsIHIpIDogbmV3IFJlY3RhbmdsZSgzLCAzLCByLCByKTsNCiAgICAgICAgICAgICAgICBlLkdyYXBoaWNzLkZpbGxFbGxpcHNlKEJydXNoZXMuV2hpdGUsIHJlY3QpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIENvbG9yIHRyYWNrQ29sb3IgPSB0aGlzLkNoZWNrZWQgPyBvbkNvbG9yIDogb2ZmQ29sb3I7DQogICAgICAgICAgICAgICAgZG91YmxlIGx1bWluYW5jZSA9ICgwLjIxMjYgKiB0cmFja0NvbG9yLlIpICsgKDAuNzE1MiAqIHRyYWNrQ29sb3IuRykgKyAoMC4wNzIyICogdHJhY2tDb2xvci5CKTsNCiAgICAgICAgICAgICAgICBDb2xvciB0ZXh0Q29sb3IgPSAobHVtaW5hbmNlIDwgMTQwKSA/IENvbG9yLldoaXRlIDogQ29sb3IuQmxhY2s7DQoNCiAgICAgICAgICAgICAgICB1c2luZyAodmFyIHNoYWRvd0JydXNoID0gbmV3IFNvbGlkQnJ1c2goQ29sb3IuRnJvbUFyZ2IoMTQwLCAwLCAwLCAwKSkpDQogICAgICAgICAgICAgICAgdXNpbmcgKHZhciB0ZXh0QnJ1c2ggPSBuZXcgU29saWRCcnVzaCh0ZXh0Q29sb3IpKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHNmID0gbmV3IFN5c3RlbS5EcmF3aW5nLlN0cmluZ0Zvcm1hdCgpOw0KICAgICAgICAgICAgICAgICAgICBzZi5BbGlnbm1lbnQgPSBTeXN0ZW0uRHJhd2luZy5TdHJpbmdBbGlnbm1lbnQuQ2VudGVyOw0KICAgICAgICAgICAgICAgICAgICBzZi5MaW5lQWxpZ25tZW50ID0gU3lzdGVtLkRyYXdpbmcuU3RyaW5nQWxpZ25tZW50LkNlbnRlcjsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGJvdW5kc0YgPSBuZXcgUmVjdGFuZ2xlRigwLCAwLCB0aGlzLldpZHRoLCB0aGlzLkhlaWdodCk7DQogICAgICAgICAgICAgICAgICAgIHZhciBzaGFkb3dCb3VuZHMgPSBuZXcgUmVjdGFuZ2xlRihib3VuZHNGLlggKyAxLCBib3VuZHNGLlkgKyAxLCBib3VuZHNGLldpZHRoLCBib3VuZHNGLkhlaWdodCk7DQogICAgICAgICAgICAgICAgICAgIGUuR3JhcGhpY3MuRHJhd1N0cmluZyh0aGlzLlRleHQsIHRoaXMuRm9udCwgc2hhZG93QnJ1c2gsIHNoYWRvd0JvdW5kcywgc2YpOw0KICAgICAgICAgICAgICAgICAgICBlLkdyYXBoaWNzLkRyYXdTdHJpbmcodGhpcy5UZXh0LCB0aGlzLkZvbnQsIHRleHRCcnVzaCwgYm91bmRzRiwgc2YpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBjbGFzcyBUZXh0UHJvZ3Jlc3NCYXIgOiBQcm9ncmVzc0Jhcg0KICAgIHsNCiAgICAgICAgcHVibGljIHN0cmluZyBDdXN0b21UZXh0IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgDQogICAgICAgIHB1YmxpYyBUZXh0UHJvZ3Jlc3NCYXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICBDdXN0b21UZXh0ID0gIiI7DQogICAgICAgICAgICB0aGlzLlNldFN0eWxlKENvbnRyb2xTdHlsZXMuVXNlclBhaW50IHwgQ29udHJvbFN0eWxlcy5BbGxQYWludGluZ0luV21QYWludCB8IENvbnRyb2xTdHlsZXMuT3B0aW1pemVkRG91YmxlQnVmZmVyLCB0cnVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIE9uUGFpbnQoUGFpbnRFdmVudEFyZ3MgZSkNCiAgICAgICAgew0KICAgICAgICAgICAgUmVjdGFuZ2xlIHJlY3QgPSBDbGllbnRSZWN0YW5nbGU7DQogICAgICAgICAgICBHcmFwaGljcyBnID0gZS5HcmFwaGljczsNCg0KICAgICAgICAgICAgUHJvZ3Jlc3NCYXJSZW5kZXJlci5EcmF3SG9yaXpvbnRhbEJhcihnLCByZWN0KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHRoaXMuVmFsdWUgPiAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFJlY3RhbmdsZSBjbGlwID0gbmV3IFJlY3RhbmdsZShyZWN0LlgsIHJlY3QuWSwgKGludClNYXRoLlJvdW5kKCgoZmxvYXQpdGhpcy5WYWx1ZSAvIHRoaXMuTWF4aW11bSkgKiByZWN0LldpZHRoKSwgcmVjdC5IZWlnaHQpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIERyYXcgZGVmYXVsdCBjaHVua3MgbWFudWFsbHkgdG8gY29udHJvbCBjb2xvciBiZXR0ZXIgb3IgdXNlIHJlbmRlcmVyDQogICAgICAgICAgICAgICAgdXNpbmcgKFNvbGlkQnJ1c2ggYiA9IG5ldyBTb2xpZEJydXNoKENvbG9yLkZyb21BcmdiKDAsIDEyMCwgMjE1KSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBnLkZpbGxSZWN0YW5nbGUoYiwgY2xpcCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB1c2luZyAoRm9udCBmID0gbmV3IEZvbnQoIlNlZ29lIFVJIiwgOCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgc3RyaW5nIHRleHQgPSBzdHJpbmcuSXNOdWxsT3JFbXB0eShDdXN0b21UZXh0KSA/ICIiIDogQ3VzdG9tVGV4dDsNCiAgICAgICAgICAgICAgICBTaXplRiBsZW4gPSBnLk1lYXN1cmVTdHJpbmcodGV4dCwgZik7DQogICAgICAgICAgICAgICAgUG9pbnQgbG9jYXRpb24gPSBuZXcgUG9pbnQoKGludCkoKHJlY3QuV2lkdGggLyAyKSAtIChsZW4uV2lkdGggLyAyKSksIChpbnQpKChyZWN0LkhlaWdodCAvIDIpIC0gKGxlbi5IZWlnaHQgLyAyKSkpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIERyYXcgdGV4dCBzaGFkb3cNCiAgICAgICAgICAgICAgICBnLkRyYXdTdHJpbmcodGV4dCwgZiwgQnJ1c2hlcy5CbGFjaywgbG9jYXRpb24uWCArIDEsIGxvY2F0aW9uLlkgKyAxKTsNCiAgICAgICAgICAgICAgICAvLyBEcmF3IHRleHQNCiAgICAgICAgICAgICAgICBnLkRyYXdTdHJpbmcodGV4dCwgZiwgQnJ1c2hlcy5XaGl0ZSwgbG9jYXRpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KIkAgDQojZW5kcmVnaW9uIFN0ZXA6IERlZmluZSBDIyBDbGFzcyBTdHJpbmcNCg0KI3JlZ2lvbiBNb2R1bGUgSW5pdGlhbGl6YXRpb24NCiAgICAgICAgZnVuY3Rpb24gSW5pdGlhbGl6ZS1DbGFzc2VzTW9kdWxlDQogICAgICAgIHsNCiAgICAgICAgICAgIFtDbWRsZXRCaW5kaW5nKCldDQogICAgICAgICAgICBwYXJhbSgpDQogICAgICAgICAgICB0cnkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJJbml0aWFsaXppbmcgc3lzdGVtIGludGVncmF0aW9uIGNsYXNzZXMuLi4iIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KICAgICAgICAgICAgICAgICRhZGRUeXBlQXJncyA9IEB7DQogICAgICAgICAgICAgICAgICAgIFR5cGVEZWZpbml0aW9uICAgICAgID0gJGNsYXNzZXMNCiAgICAgICAgICAgICAgICAgICAgTGFuZ3VhZ2UgICAgICAgICAgICAgPSAkc2NyaXB0OkNvbXBpbGF0aW9uT3B0aW9ucy5MYW5ndWFnZQ0KICAgICAgICAgICAgICAgICAgICBSZWZlcmVuY2VkQXNzZW1ibGllcyA9ICRzY3JpcHQ6Q29tcGlsYXRpb25PcHRpb25zLlJlZmVyZW5jZWRBc3NlbWJsaWVzDQogICAgICAgICAgICAgICAgICAgIFdhcm5pbmdBY3Rpb24gICAgICAgID0gJHNjcmlwdDpDb21waWxhdGlvbk9wdGlvbnMuV2FybmluZ0FjdGlvbg0KICAgICAgICAgICAgICAgICAgICBFcnJvckFjdGlvbiAgICAgICAgICA9ICdTdG9wJw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBBZGQtVHlwZSBAYWRkVHlwZUFyZ3MNCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJTeXN0ZW0gaW50ZWdyYXRpb24gY2xhc3NlcyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgICAgICAgICAgcmV0dXJuICR0cnVlDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFdyaXRlLUVycm9yICJGYWlsZWQgdG8gaW5pdGlhbGl6ZS9jb21waWxlIHN5c3RlbSBpbnRlZ3JhdGlvbiBjbGFzc2VzLiBFcnJvcjogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiDQogICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgSW5pdGlhbGl6ZS1DbGFzc2VzTW9kdWxlDQojZW5kcmVnaW9uIE1vZHVsZSBJbml0aWFsaXphdGlvbg0KDQojcmVnaW9uIE1vZHVsZSBFeHBvcnRzDQogICAgICAgIEV4cG9ydC1Nb2R1bGVNZW1iZXIgLUZ1bmN0aW9uIEluaXRpYWxpemUtQ2xhc3Nlc01vZHVsZQ0KI2VuZHJlZ2lvbiBNb2R1bGUgRXhwb3J0cw==
			'
		}
		'ini.psm1'      = @{ 
			Priority = 'Critical';  
			Order = 4; 
			Dependencies = @('classes.psm1');
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'ini.psm1');
			Base64Content = '
PCMgaW5pLnBzbTENCiAgICAuU1lOT1BTSVMNCiAgICAgICAgSU5JIENvbmZpZ3VyYXRpb24gTWFuYWdlbWVudCBNb2R1bGUgZm9yIEVudHJvcGlhIERhc2hib2FyZC4NCiAgICAuREVTQ1JJUFRJT04NCiAgICAgICAgVGhpcyBQb3dlclNoZWxsIG1vZHVsZSBpcyBkZWRpY2F0ZWQgdG8gbWFuYWdpbmcgYWxsIGFzcGVjdHMgb2YgSU5JIGZpbGUgY29uZmlndXJhdGlvbiBmb3IgdGhlIEVudHJvcGlhIERhc2hib2FyZCBhcHBsaWNhdGlvbi4gDQogICAgICAgIEl0IHNlcnZlcyBhcyB0aGUgYnJpZGdlIGJldHdlZW4gdGhlIGFwcGxpY2F0aW9uJ3MgaW4tbWVtb3J5IGNvbmZpZ3VyYXRpb24gc3RhdGUgKGAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZ2ApIGFuZCB0aGUgcGVyc2lzdGVudCBgY29uZmlnLmluaWAgZmlsZSBvbiBkaXNrLg0KICAgICAgICBUaGUgbW9kdWxlJ3MgY29yZSBmdW5jdGlvbmFsaXR5IHJlbGllcyBvbiBhIGN1c3RvbSBDIyBgSW5pRmlsZWAgY2xhc3MgKGV4cGVjdGVkIHRvIGJlIGxvYWRlZCBmcm9tIGBjbGFzc2VzLnBzbTFgKSBmb3IgZWZmaWNpZW50IGFuZCBzdHJ1Y3R1cmVkIHBhcnNpbmcgb2YgSU5JIGRhdGEuDQoNCiAgICAgICAgVGhlIG1vZHVsZSdzIHByaW1hcnkgcmVzcG9uc2liaWxpdGllcyBhbmQga2V5IGZ1bmN0aW9ucyBhcmU6DQoNCiAgICAgICAgMS4gICoqQ29uZmlndXJhdGlvbiBJbml0aWFsaXphdGlvbiBhbmQgU3luY2hyb25pemF0aW9uIChgSW5pdGlhbGl6ZS1JbmlDb25maWdgKToqKg0KICAgICAgICAgICAgKiAgIFRoaXMgaXMgdGhlIHByaW1hcnkgZW50cnkgcG9pbnQgZm9yIGNvbmZpZ3VyYXRpb24gaGFuZGxpbmcuIEl0IGVuc3VyZXMgdGhlIGFwcGxpY2F0aW9uIHN0YXJ0cyB3aXRoIGEgdmFsaWQgYW5kIGNvbXBsZXRlIGNvbmZpZ3VyYXRpb24uDQogICAgICAgICAgICAqICAgT24gZmlyc3QgcnVuLCBpdCBjcmVhdGVzIGEgYGNvbmZpZy5pbmlgIGZpbGUgZnJvbSBhIHByZWRlZmluZWQgZGVmYXVsdCB0ZW1wbGF0ZS4NCiAgICAgICAgICAgICogICBPbiBzdWJzZXF1ZW50IHJ1bnMsIGl0IHJlYWRzIHRoZSBleGlzdGluZyBgY29uZmlnLmluaWAgYW5kIGludGVsbGlnZW50bHkgc3luY2hyb25pemVzIGl0IHdpdGggdGhlIGRlZmF1bHQgdGVtcGxhdGUuIEl0IGF1dG9tYXRpY2FsbHkgYWRkcyBhbnkgbmV3IHNlY3Rpb25zIG9yIGtleXMgdGhhdCBtaWdodCBoYXZlIGJlZW4gaW50cm9kdWNlZCBpbiBhbiBhcHBsaWNhdGlvbiB1cGRhdGUsIGVuc3VyaW5nIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgYW5kIHByZXZlbnRpbmcgZXJyb3JzIGZyb20gbWlzc2luZyBzZXR0aW5ncy4gVGhlIHVwZGF0ZWQgY29uZmlndXJhdGlvbiBpcyB0aGVuIHNhdmVkIGJhY2sgdG8gdGhlIGZpbGUuDQoNCiAgICAgICAgMi4gICoqQ29uZmlndXJhdGlvbiBSZWFkaW5nIGFuZCBXcml0aW5nOioqDQogICAgICAgICAgICAqICAgKipgUmVhZC1Db25maWdgOioqIFJlYWRzIHRoZSBgY29uZmlnLmluaWAgZmlsZSBhbmQgcG9wdWxhdGVzIHRoZSBnbG9iYWwgY29uZmlndXJhdGlvbiB2YXJpYWJsZS4gSXQgaW5jbHVkZXMgYSByb2J1c3QgZmFsbGJhY2sgbWVjaGFuaXNtOiBpZiB0aGUgZmlsZSBjYW5ub3QgYmUgcmVhZCwgaXQgbG9hZHMgdGhlIGRlZmF1bHQgc2V0dGluZ3MgaW50byBtZW1vcnkgdG8gYWxsb3cgdGhlIGFwcGxpY2F0aW9uIHRvIHN0YXJ0IHdpdGggYSBzYWZlLCBiYXNlbGluZSBjb25maWd1cmF0aW9uLg0KICAgICAgICAgICAgKiAgICoqYFdyaXRlLUNvbmZpZ2A6KiogUGVyc2lzdHMgdGhlIGluLW1lbW9yeSBjb25maWd1cmF0aW9uIHRvIHRoZSBgY29uZmlnLmluaWAgZmlsZS4gSXQgaW5jbHVkZXMgZGF0YSBwcmVwYXJhdGlvbiBsb2dpYywgc3VjaCBhcyBjb252ZXJ0aW5nIFBvd2VyU2hlbGwgYXJyYXlzIGludG8gY29tbWEtc2VwYXJhdGVkIHN0cmluZ3Mgc3VpdGFibGUgZm9yIHRoZSBJTkkgZm9ybWF0LiBUaGlzIGZ1bmN0aW9uIGFsc28gc3VwcG9ydHMgUG93ZXJTaGVsbCdzIGAtV2hhdElmYCBhbmQgYC1Db25maXJtYCBwYXJhbWV0ZXJzIGZvciBzYWZlIGV4ZWN1dGlvbi4NCg0KICAgICAgICAzLiAgKipVdGlsaXR5IGFuZCBIZWxwZXIgRnVuY3Rpb25zOioqDQogICAgICAgICAgICAqICAgKipgR2V0LUluaUZpbGVDb250ZW50YDoqKiBBIGdlbmVyYWwtcHVycG9zZSBmdW5jdGlvbiBmb3IgcmVhZGluZyBhbnkgYXJiaXRyYXJ5IElOSSBmaWxlIGludG8gYSBQb3dlclNoZWxsIG9yZGVyZWQgZGljdGlvbmFyeS4NCiAgICAgICAgICAgICogICAqKmBDb3B5LU9yZGVyZWREaWN0aW9uYXJ5YDoqKiBBIGNydWNpYWwgaGVscGVyIHRoYXQgcGVyZm9ybXMgYSBkZWVwIGNvcHkgb2YgY29uZmlndXJhdGlvbiBkaWN0aW9uYXJpZXMsIHdoaWNoIGlzIHVzZWQgdG8gc2FmZWx5IGluc3RhbnRpYXRlIGRlZmF1bHQgc2V0dGluZ3Mgd2l0aG91dCBtb2RpZnlpbmcgdGhlIG9yaWdpbmFsIHRlbXBsYXRlLg0KICAgICAgICAgICAgKiAgICoqYExvYWREZWZhdWx0Q29uZmlnT25FcnJvcmA6KiogQW4gaW50ZXJuYWwgaGVscGVyIHRoYXQgcHJvdmlkZXMgdGhlIGZhbGxiYWNrLXRvLWRlZmF1bHQgZnVuY3Rpb25hbGl0eSBmb3IgYFJlYWQtQ29uZmlnYC4NCiM+DQoNCiNyZWdpb24gSGVscGVyIEZ1bmN0aW9ucw0KDQogICAgI3JlZ2lvbiBGdW5jdGlvbjogQ29weS1PcmRlcmVkRGljdGlvbmFyeQ0KICAgIGZ1bmN0aW9uIENvcHktT3JkZXJlZERpY3Rpb25hcnkNCiAgICB7DQogICAgICAgIDwjDQogICAgICAgIC5TWU5PUFNJUw0KICAgICAgICAgICAgUmVjdXJzaXZlbHkgY29waWVzIGEgU3lzdGVtLkNvbGxlY3Rpb25zLlNwZWNpYWxpemVkLk9yZGVyZWREaWN0aW9uYXJ5IG9yIGEgUG93ZXJTaGVsbCBbb3JkZXJlZF0gZGljdGlvbmFyeS4NCiAgICAgICAgLkRFU0NSSVBUSU9ODQogICAgICAgICAgICBDcmVhdGVzIGEgZGVlcCBjb3B5IG9mIGFuIG9yZGVyZWQgZGljdGlvbmFyeSwgaGFuZGxpbmcgbmVzdGVkIG9yZGVyZWQgZGljdGlvbmFyaWVzLg0KICAgICAgICAgICAgVGhpcyBpcyB1c2VmdWwgZm9yIGNyZWF0aW5nIGluZGVwZW5kZW50IGNvcGllcyBvZiBjb25maWd1cmF0aW9uIG9iamVjdHMuDQogICAgICAgIC5QQVJBTUVURVIgRGljdGlvbmFyeQ0KICAgICAgICAgICAgW1N5c3RlbS5Db2xsZWN0aW9ucy5JRGljdGlvbmFyeV0gVGhlIG9yZGVyZWQgZGljdGlvbmFyeSAoW1N5c3RlbS5Db2xsZWN0aW9ucy5TcGVjaWFsaXplZC5PcmRlcmVkRGljdGlvbmFyeV0gb3IgW29yZGVyZWRdKSB0byBjb3B5LiAoTWFuZGF0b3J5KQ0KICAgICAgICAuT1VUUFVUUw0KICAgICAgICAgICAgW29yZGVyZWRdIEEgbmV3IFBvd2VyU2hlbGwgb3JkZXJlZCBkaWN0aW9uYXJ5IGNvbnRhaW5pbmcgYSBkZWVwIGNvcHkgb2YgdGhlIGlucHV0Lg0KICAgICAgICAuTk9URVMNCiAgICAgICAgICAgIEVuc3VyZXMgbmVzdGVkIGRpY3Rpb25hcmllcyBhcmUgYWxzbyBjb3BpZWQsIG5vdCBqdXN0IHJlZmVyZW5jZWQuDQogICAgICAgICAgICBIYW5kbGVzIHBvdGVudGlhbCBlcnJvcnMgZHVyaW5nIHRoZSBjb3B5IHByb2Nlc3MuDQogICAgICAgICM+DQogICAgICAgIHBhcmFtICgNCiAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQ0KICAgICAgICAgICAgW1ZhbGlkYXRlTm90TnVsbCgpXQ0KICAgICAgICAgICAgW1N5c3RlbS5Db2xsZWN0aW9ucy5JRGljdGlvbmFyeV0kRGljdGlvbmFyeSAjIEFjY2VwdHMgYm90aCAuTkVUIGFuZCBQUyBvcmRlcmVkIGRpY3Rpb25hcmllcw0KICAgICAgICApDQoNCiAgICAgICAgI3JlZ2lvbiBTdGVwOiBJbml0aWFsaXplIE91dHB1dCBEaWN0aW9uYXJ5DQogICAgICAgICAgICAjICRjb3B5OiBUaGUgbmV3IG9yZGVyZWQgZGljdGlvbmFyeSB0byBob2xkIHRoZSBjb3BpZWQgZGF0YS4NCiAgICAgICAgICAgICRjb3B5ID0gW29yZGVyZWRdQHt9DQogICAgICAgICNlbmRyZWdpb24gU3RlcDogSW5pdGlhbGl6ZSBPdXRwdXQgRGljdGlvbmFyeQ0KDQogICAgICAgICNyZWdpb24gU3RlcDogSXRlcmF0ZSBUaHJvdWdoIEtleXMgYW5kIENvcHkgVmFsdWVzDQogICAgICAgIHRyeQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3JlYWNoICgka2V5IGluICREaWN0aW9uYXJ5LktleXMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDaGVjayBmb3IgTmVzdGVkIERpY3Rpb25hcnkNCiAgICAgICAgICAgICAgICBpZiAoJERpY3Rpb25hcnlbJGtleV0gLWlzIFtTeXN0ZW0uQ29sbGVjdGlvbnMuSURpY3Rpb25hcnldKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBSZWN1cnNpdmVseSBDb3B5IE5lc3RlZCBEaWN0aW9uYXJ5DQogICAgICAgICAgICAgICAgICAgICRjb3B5WyRrZXldID0gQ29weS1PcmRlcmVkRGljdGlvbmFyeSAtRGljdGlvbmFyeSAkRGljdGlvbmFyeVska2V5XQ0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFJlY3Vyc2l2ZWx5IENvcHkgTmVzdGVkIERpY3Rpb25hcnkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBDaGVjayBmb3IgTmVzdGVkIERpY3Rpb25hcnkNCiAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IENvcHkgU2ltcGxlIFZhbHVlDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgJGNvcHlbJGtleV0gPSAkRGljdGlvbmFyeVska2V5XQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENvcHkgU2ltcGxlIFZhbHVlDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2gNCiAgICAgICAgew0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBFcnJvciBIYW5kbGluZyAtIEZhaWxlZCB0byBDb3B5IERpY3Rpb25hcnkgRWxlbWVudA0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBGYWlsZWQgdG8gY29weSBkaWN0aW9uYXJ5IGVsZW1lbnQgd2l0aCBrZXkgJyRrZXknOiAkXyIgLUZvcmVncm91bmRDb2xvciBSZWQNCiAgICAgICAgICAgICMgQ29uc2lkZXIgcmUtdGhyb3dpbmcgb3IgcmV0dXJuaW5nIG51bGwvZW1wdHkgZGVwZW5kaW5nIG9uIGRlc2lyZWQgYmVoYXZpb3INCiAgICAgICAgICAgIHRocm93ICJGYWlsZWQgdG8gY29tcGxldGUgZGljdGlvbmFyeSBjb3B5LiINCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogRXJyb3IgSGFuZGxpbmcgLSBGYWlsZWQgdG8gQ29weSBEaWN0aW9uYXJ5IEVsZW1lbnQNCiAgICAgICAgfQ0KICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEl0ZXJhdGUgVGhyb3VnaCBLZXlzIGFuZCBDb3B5IFZhbHVlcw0KDQogICAgICAgICNyZWdpb24gU3RlcDogUmV0dXJuIENvcHkNCiAgICAgICAgcmV0dXJuICRjb3B5DQogICAgICAgICNlbmRyZWdpb24gU3RlcDogUmV0dXJuIENvcHkNCiAgICB9DQogICAgI2VuZHJlZ2lvbiBGdW5jdGlvbjogQ29weS1PcmRlcmVkRGljdGlvbmFyeQ0KDQogICAgI3JlZ2lvbiBGdW5jdGlvbjogR2V0LUluaUZpbGVDb250ZW50DQogICAgZnVuY3Rpb24gR2V0LUluaUZpbGVDb250ZW50DQogICAgew0KICAgICAgICA8Iw0KICAgICAgICAuU1lOT1BTSVMNCiAgICAgICAgICAgIFJlYWRzIHRoZSBjb250ZW50IG9mIGEgc3BlY2lmaWVkIElOSSBmaWxlIGludG8gYSBQb3dlclNoZWxsIG9yZGVyZWQgZGljdGlvbmFyeS4NCiAgICAgICAgLkRFU0NSSVBUSU9ODQogICAgICAgICAgICBVc2VzIHRoZSBDIyAnSW5pRmlsZScgY2xhc3MgKGZyb20gY2xhc3Nlcy5wc20xKSB0byByZWFkIHRoZSBzdHJ1Y3R1cmUgYW5kIGNvbnRlbnQgb2YgYW4gSU5JIGZpbGUuDQogICAgICAgICAgICBJdCB0aGVuIGNvbnZlcnRzIHRoZSAuTkVUIE9yZGVyZWREaWN0aW9uYXJ5IHJldHVybmVkIGJ5IHRoZSBjbGFzcyBpbnRvIGEgUG93ZXJTaGVsbCBbb3JkZXJlZF0gZGljdGlvbmFyeQ0KICAgICAgICAgICAgZm9yIGVhc2llciBtYW5pcHVsYXRpb24gd2l0aGluIHNjcmlwdHMuDQogICAgICAgIC5QQVJBTUVURVIgSW5pUGF0aA0KICAgICAgICAgICAgW3N0cmluZ10gVGhlIGZ1bGwgcGF0aCB0byB0aGUgSU5JIGZpbGUgdG8gYmUgcmVhZC4gKE1hbmRhdG9yeSkNCiAgICAgICAgLk9VVFBVVFMNCiAgICAgICAgICAgIFtvcmRlcmVkXSBBbiBvcmRlcmVkIGRpY3Rpb25hcnkgcmVwcmVzZW50aW5nIHRoZSBJTkkgZmlsZSBzdHJ1Y3R1cmUgKFtTZWN0aW9uXVtLZXldID0gVmFsdWUpLg0KICAgICAgICAgICAgUmV0dXJucyBhbiBlbXB0eSBvcmRlcmVkIGRpY3Rpb25hcnkgaWYgdGhlIGZpbGUgaXMgbm90IGZvdW5kIG9yIGFuIGVycm9yIG9jY3VycyBkdXJpbmcgcmVhZGluZy4NCiAgICAgICAgLk5PVEVTDQogICAgICAgICAgICBSZXF1aXJlcyB0aGUgJ0luaUZpbGUnIGNsYXNzIHRvIGJlIGF2YWlsYWJsZSAodHlwaWNhbGx5IGxvYWRlZCB2aWEgQWRkLVR5cGUgZnJvbSBjbGFzc2VzLnBzbTEpLg0KICAgICAgICAgICAgRXJyb3IgbWVzc2FnZXMgYXJlIHdyaXR0ZW4gdG8gdGhlIGhvc3Qgc3RyZWFtLg0KICAgICAgICAjPg0KICAgICAgICBbQ21kbGV0QmluZGluZygpXQ0KICAgICAgICBbT3V0cHV0VHlwZShbb3JkZXJlZF0pXQ0KICAgICAgICBwYXJhbSgNCiAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQ0KICAgICAgICAgICAgW3N0cmluZ10kSW5pUGF0aA0KICAgICAgICApDQoNCiAgICAgICAgI3JlZ2lvbiBTdGVwOiBJbml0aWFsaXplIFJlc3VsdCBEaWN0aW9uYXJ5DQogICAgICAgICMgJHJlc3VsdDogVGhlIG9yZGVyZWQgZGljdGlvbmFyeSB0byBzdG9yZSB0aGUgSU5JIGNvbnRlbnQuDQogICAgICAgICRyZXN1bHQgPSBbb3JkZXJlZF1Ae30NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBJbml0aWFsaXplIFJlc3VsdCBEaWN0aW9uYXJ5DQoNCiAgICAgICAgI3JlZ2lvbiBTdGVwOiBSZWFkIElOSSBGaWxlIHVzaW5nIEMjIENsYXNzDQogICAgICAgIHRyeQ0KICAgICAgICB7DQogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFZhbGlkYXRlIEZpbGUgRXhpc3RlbmNlDQogICAgICAgICAgICBpZiAoLW5vdCAoVGVzdC1QYXRoIC1QYXRoICRJbmlQYXRoIC1QYXRoVHlwZSBMZWFmKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEdldC1JbmlGaWxlQ29udGVudCk6IEZpbGUgbm90IGZvdW5kIGF0ICckSW5pUGF0aCcuIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KICAgICAgICAgICAgICAgIHJldHVybiAkcmVzdWx0ICMgUmV0dXJuIGVtcHR5IGRpY3Rpb25hcnkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVmFsaWRhdGUgRmlsZSBFeGlzdGVuY2UNCg0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBJbnN0YW50aWF0ZSBJbmlGaWxlIEhhbmRsZXINCiAgICAgICAgICAgICMgRW5zdXJlIHJlcXVpcmVkIC5ORVQgYXNzZW1ibGllcyBhcmUgbG9hZGVkICh0aG91Z2ggaWRlYWxseSBkb25lIGF0IG1vZHVsZSBsb2FkKQ0KICAgICAgICAgICAgaWYgKC1ub3QgKFtTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoJ1N5c3RlbS5Db2xsZWN0aW9ucy5TcGVjaWFsaXplZCcpKSkgew0KICAgICAgICAgICAgICAgIEFkZC1UeXBlIC1Bc3NlbWJseU5hbWUgU3lzdGVtLkNvbGxlY3Rpb25zLlNwZWNpYWxpemVkDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoLW5vdCAoW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZFdpdGhQYXJ0aWFsTmFtZSgnU3lzdGVtLklPJykpKSB7DQogICAgICAgICAgICAgICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uSU8NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICMgQXNzdW1pbmcgSW5pRmlsZSBjbGFzcyBpcyBsb2FkZWQgZWxzZXdoZXJlIChlLmcuLCBhdCBtb2R1bGUgaW1wb3J0KQ0KICAgICAgICAgICAgIyAkaW5pSGFuZGxlcjogSW5zdGFuY2Ugb2YgdGhlIEMjIGNsYXNzIHVzZWQgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgSU5JIGZpbGUuDQogICAgICAgICAgICAkaW5pSGFuZGxlciA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIEluaUZpbGUgLUFyZ3VtZW50TGlzdCAkSW5pUGF0aA0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBJbnN0YW50aWF0ZSBJbmlGaWxlIEhhbmRsZXINCg0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBSZWFkIEZpbGUgQ29udGVudA0KICAgICAgICAgICAgIyAkaW5pQ29udGVudDogVGhlIHJhdyBjb250ZW50IHJlYWQgZnJvbSB0aGUgSU5JIGZpbGUgYXMgYSAuTkVUIE9yZGVyZWREaWN0aW9uYXJ5Lg0KICAgICAgICAgICAgJGluaUNvbnRlbnQgPSAkaW5pSGFuZGxlci5SZWFkSW5pRmlsZSgpDQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFJlYWQgRmlsZSBDb250ZW50DQoNCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogQ29udmVydCAuTkVUIERpY3Rpb25hcnkgdG8gUG93ZXJTaGVsbCBPcmRlcmVkIERpY3Rpb25hcnkNCiAgICAgICAgICAgIGlmICgkbnVsbCAtbmUgJGluaUNvbnRlbnQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHNlY3Rpb24gaW4gJGluaUNvbnRlbnQuS2V5cykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICRyZXN1bHRbJHNlY3Rpb25dID0gW29yZGVyZWRdQHt9DQogICAgICAgICAgICAgICAgICAgICRzZWN0aW9uRGljdCA9ICRpbmlDb250ZW50WyRzZWN0aW9uXQ0KICAgICAgICAgICAgICAgICAgICAjIEVuc3VyZSB0aGUgc2VjdGlvbidzIHZhbHVlIGlzIGRpY3Rpb25hcnktbGlrZSBiZWZvcmUgaXRlcmF0aW5nDQogICAgICAgICAgICAgICAgICAgIGlmICgkc2VjdGlvbkRpY3QgLWlzIFtTeXN0ZW0uQ29sbGVjdGlvbnMuSURpY3Rpb25hcnldKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgka2V5IGluICRzZWN0aW9uRGljdC5LZXlzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHRbJHNlY3Rpb25dWyRrZXldID0gJHNlY3Rpb25EaWN0WyRrZXldDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEdldC1JbmlGaWxlQ29udGVudCk6IFNlY3Rpb24gJ1skc2VjdGlvbl0nIGluICckSW5pUGF0aCcgZG9lcyBub3QgY29udGFpbiBleHBlY3RlZCBrZXktdmFsdWUgcGFpcnMuIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBDb252ZXJ0IC5ORVQgRGljdGlvbmFyeSB0byBQb3dlclNoZWxsIE9yZGVyZWQgRGljdGlvbmFyeQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoDQogICAgICAgIHsNCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogRXJyb3IgSGFuZGxpbmcgLSBGYWlsZWQgdG8gUmVhZCBJTkkNCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoR2V0LUluaUZpbGVDb250ZW50KTogRmFpbGVkIHRvIHJlYWQgSU5JIGZpbGUgJyRJbmlQYXRoJy4gRXJyb3I6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICAgICAgIyBSZXR1cm4gZW1wdHkgZGljdGlvbmFyeSBvbiBmYWlsdXJlDQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEVycm9yIEhhbmRsaW5nIC0gRmFpbGVkIHRvIFJlYWQgSU5JDQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBSZWFkIElOSSBGaWxlIHVzaW5nIEMjIENsYXNzDQoNCiAgICAgICAgI3JlZ2lvbiBTdGVwOiBSZXR1cm4gUmVzdWx0DQogICAgICAgIHJldHVybiAkcmVzdWx0DQogICAgICAgICNlbmRyZWdpb24gU3RlcDogUmV0dXJuIFJlc3VsdA0KICAgIH0NCiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBHZXQtSW5pRmlsZUNvbnRlbnQNCg0KICAgICNyZWdpb24gRnVuY3Rpb246IExvYWREZWZhdWx0Q29uZmlnT25FcnJvcg0KICAgIGZ1bmN0aW9uIExvYWREZWZhdWx0Q29uZmlnT25FcnJvcg0KICAgIHsNCiAgICAgICAgPCMNCiAgICAgICAgLlNZTk9QU0lTDQogICAgICAgICAgICBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb24gdG8gbG9hZCBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIHJlYWRpbmcuDQogICAgICAgIC5ERVNDUklQVElPTg0KICAgICAgICAgICAgQ2FsbGVkIGJ5IFJlYWQtQ29uZmlnIHdoZW4gaXQgZmFpbHMgdG8gcmVhZCB0aGUgc3BlY2lmaWVkIElOSSBmaWxlLiBJdCBsb2dzIGEgd2FybmluZw0KICAgICAgICAgICAgd2l0aCB0aGUgcmVhc29uIGFuZCBhdHRlbXB0cyB0byBwb3B1bGF0ZSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcgd2l0aCBhIGNvcHkNCiAgICAgICAgICAgIG9mICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkRlZmF1bHRDb25maWcuDQogICAgICAgIC5QQVJBTUVURVIgUmVhc29uDQogICAgICAgICAgICBbc3RyaW5nXSBBIGRlc2NyaXB0aW9uIG9mIHRoZSBlcnJvciB0aGF0IHRyaWdnZXJlZCBsb2FkaW5nIGRlZmF1bHRzLiAoTWFuZGF0b3J5KQ0KICAgICAgICAuT1VUUFVUUw0KICAgICAgICAgICAgW2Jvb2xdIEFsd2F5cyByZXR1cm5zICRmYWxzZSB0byBpbmRpY2F0ZSB0aGF0IHRoZSBvcmlnaW5hbCByZWFkIG9wZXJhdGlvbiBmYWlsZWQsDQogICAgICAgICAgICBldmVuIGlmIGxvYWRpbmcgZGVmYXVsdHMgd2FzIHN1Y2Nlc3NmdWwuIFJldHVybnMgJGZhbHNlIGFsc28gaWYgbG9hZGluZyBkZWZhdWx0cyBmYWlscy4NCiAgICAgICAgLk5PVEVTDQogICAgICAgICAgICBNb2RpZmllcyAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcuDQogICAgICAgICAgICBVc2VzIENvcHktT3JkZXJlZERpY3Rpb25hcnkuDQogICAgICAgICAgICBMb2dzIGVycm9ycyBpZiBsb2FkaW5nIGRlZmF1bHRzIGFsc28gZmFpbHMuDQogICAgICAgICM+DQogICAgICAgIHBhcmFtKA0KICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldDQogICAgICAgICAgICBbc3RyaW5nXSRSZWFzb24NCiAgICAgICAgKQ0KDQogICAgICAgICNyZWdpb24gU3RlcDogTG9nIFdhcm5pbmcgYW5kIEF0dGVtcHQgdG8gTG9hZCBEZWZhdWx0cw0KICAgICAgICB0cnkNCiAgICAgICAgew0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChSZWFkLUNvbmZpZyk6IExvYWRpbmcgZGVmYXVsdCBjb25maWd1cmF0aW9uIGJlY2F1c2U6ICRSZWFzb24iIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQogICAgICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcgPSBDb3B5LU9yZGVyZWREaWN0aW9uYXJ5IC1EaWN0aW9uYXJ5ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkRlZmF1bHRDb25maWcgLUVycm9yQWN0aW9uIFN0b3ANCiAgICAgICAgICAgIHJldHVybiAkZmFsc2UgIyBJbmRpY2F0ZSBmYWlsdXJlIHRvIHJlYWQgb3JpZ2luYWwsIGJ1dCBkZWZhdWx0cyBsb2FkZWQNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaA0KICAgICAgICB7DQogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEVycm9yIEhhbmRsaW5nIC0gQ3JpdGljYWwgRmFpbHVyZSB0byBMb2FkIERlZmF1bHRzDQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKFJlYWQtQ29uZmlnKTogQ1JJVElDQUwgRVJST1IgLSBGYWlsZWQgZXZlbiB0byBsb2FkIGRlZmF1bHQgY29uZmlndXJhdGlvbiEgRXJyb3I6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICAgICAgIyBFbnN1cmUgQ29uZmlnIGlzIGF0IGxlYXN0IGFuIGVtcHR5IGRpY3Rpb25hcnkgdG8gcHJldmVudCBsYXRlciBlcnJvcnMNCiAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZyA9IFtvcmRlcmVkXUB7fQ0KICAgICAgICAgICAgcmV0dXJuICRmYWxzZSAjIEluZGljYXRlIGNyaXRpY2FsIGZhaWx1cmUNCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogRXJyb3IgSGFuZGxpbmcgLSBDcml0aWNhbCBGYWlsdXJlIHRvIExvYWQgRGVmYXVsdHMNCiAgICAgICAgfQ0KICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IExvZyBXYXJuaW5nIGFuZCBBdHRlbXB0IHRvIExvYWQgRGVmYXVsdHMNCiAgICB9DQogICAgI2VuZHJlZ2lvbiBGdW5jdGlvbjogTG9hZERlZmF1bHRDb25maWdPbkVycm9yDQoNCiNlbmRyZWdpb24gSGVscGVyIEZ1bmN0aW9ucw0KDQojcmVnaW9uIENvcmUgQ29uZmlndXJhdGlvbiBGdW5jdGlvbnMNCg0KICAgICNyZWdpb24gRnVuY3Rpb246IEluaXRpYWxpemUtSW5pQ29uZmlnDQogICAgZnVuY3Rpb24gSW5pdGlhbGl6ZS1JbmlDb25maWcNCiAgICB7DQogICAgICAgIDwjDQogICAgICAgIC5TWU5PUFNJUw0KICAgICAgICAgICAgSW5pdGlhbGl6ZXMgdGhlIGdsb2JhbCBkYXNoYm9hcmQgY29uZmlndXJhdGlvbiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnKS4NCiAgICAgICAgLkRFU0NSSVBUSU9ODQogICAgICAgICAgICBUaGlzIGZ1bmN0aW9uIGVuc3VyZXMgdGhlIGRhc2hib2FyZCdzIGNvbmZpZ3VyYXRpb24gaXMgcmVhZHkgZm9yIHVzZS4gSXQgcGVyZm9ybXMgdGhlIGZvbGxvd2luZyBzdGVwczoNCiAgICAgICAgICAgIDEuIENoZWNrcyBpZiB0aGUgY29uZmlndXJhdGlvbiBJTkkgZmlsZSAoZGVmaW5lZCBpbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5QYXRocy5JbmkpIGV4aXN0cy4NCiAgICAgICAgICAgIDIuIElmIHRoZSBmaWxlIGRvZXNuJ3QgZXhpc3QsIGl0IGNyZWF0ZXMgYSBuZXcgb25lIGJ5IGNvcHlpbmcgdGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuRGVmYXVsdENvbmZpZykgYW5kIHdyaXRpbmcgaXQgdXNpbmcgV3JpdGUtQ29uZmlnLg0KICAgICAgICAgICAgMy4gSWYgdGhlIGZpbGUgZXhpc3RzLCBpdCByZWFkcyB0aGUgY29uZmlndXJhdGlvbiB1c2luZyBSZWFkLUNvbmZpZy4NCiAgICAgICAgICAgIDQuIEl0IHRoZW4gdmVyaWZpZXMgdGhhdCBhbGwgc2VjdGlvbnMgYW5kIGtleXMgZGVmaW5lZCBpbiB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uIGFyZSBwcmVzZW50IGluIHRoZSBsb2FkZWQgY29uZmlndXJhdGlvbi4gTWlzc2luZyBzZWN0aW9ucyBvciBrZXlzIGFyZSBhZGRlZCBmcm9tIHRoZSBkZWZhdWx0cy4NCiAgICAgICAgICAgIDUuIElmIGFueSBkZWZhdWx0cyB3ZXJlIGFkZGVkLCB0aGUgdXBkYXRlZCBjb25maWd1cmF0aW9uIGlzIHdyaXR0ZW4gYmFjayB0byB0aGUgZmlsZSB1c2luZyBXcml0ZS1Db25maWcuDQogICAgICAgIC5PVVRQVVRTDQogICAgICAgICAgICBbYm9vbF0gUmV0dXJucyAkdHJ1ZSBpZiBpbml0aWFsaXphdGlvbiAoaW5jbHVkaW5nIHJlYWRpbmcvd3JpdGluZyB0aGUgY29uZmlnIGZpbGUgYW5kIHZlcmlmeWluZyBzdHJ1Y3R1cmUpIGNvbXBsZXRlcyBzdWNjZXNzZnVsbHkuDQogICAgICAgICAgICBSZXR1cm5zICRmYWxzZSBpZiBhbnkgY3JpdGljYWwgc3RlcCBmYWlscyAoZS5nLiwgY2Fubm90IHdyaXRlIGluaXRpYWwgY29uZmlnLCBjYW5ub3QgcmVhZCBleGlzdGluZyBjb25maWcsIGNhbm5vdCB3cml0ZSB1cGRhdGVkIGNvbmZpZykuDQogICAgICAgIC5OT1RFUw0KICAgICAgICAgICAgLSBNb2RpZmllcyB0aGUgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnIHZhcmlhYmxlLg0KICAgICAgICAgICAgLSBSZWxpZXMgaGVhdmlseSBvbiB0aGUgc3RydWN0dXJlIG9mICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnIChzcGVjaWZpY2FsbHkgLlBhdGhzLkluaSwgLkNvbmZpZywgLkRlZmF1bHRDb25maWcpLg0KICAgICAgICAgICAgLSBEZXBlbmRzIG9uIGhlbHBlciBmdW5jdGlvbnM6IENvcHktT3JkZXJlZERpY3Rpb25hcnksIFJlYWQtQ29uZmlnLCBXcml0ZS1Db25maWcuDQogICAgICAgICAgICAtIExvZ3MgcHJvZ3Jlc3MgYW5kIG91dGNvbWVzIHRvIHRoZSBob3N0IHN0cmVhbS4NCiAgICAgICAgIz4NCiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0NCiAgICAgICAgW091dHB1dFR5cGUoW2Jvb2xdKV0NCiAgICAgICAgcGFyYW0oKQ0KDQogICAgICAgICNyZWdpb24gU3RlcDogTG9nIEluaXRpYWxpemF0aW9uIFN0YXJ0DQogICAgICAgIFdyaXRlLVZlcmJvc2UgJyAgSU5JOiAoSW5pdGlhbGl6ZS1JbmlDb25maWcpOiBJbml0aWFsaXppbmcgZGFzaGJvYXJkIGNvbmZpZ3VyYXRpb24uLi4nIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IExvZyBJbml0aWFsaXphdGlvbiBTdGFydA0KDQogICAgICAgICNyZWdpb24gU3RlcDogRGVmaW5lIENvbmZpZyBQYXRoDQogICAgICAgICMgJGNvbmZpZ1BhdGg6IFRoZSBmdWxsIHBhdGggdG8gdGhlIG1haW4gSU5JIGNvbmZpZ3VyYXRpb24gZmlsZS4NCiAgICAgICAgJGNvbmZpZ1BhdGggPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5QYXRocy5JbmkNCiAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPcldoaXRlU3BhY2UoJGNvbmZpZ1BhdGgpKSB7DQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogQ29uZmlndXJhdGlvbiBwYXRoIChcJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUGF0aHMuSW5pKSBpcyBub3QgZGVmaW5lZC4iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBEZWZpbmUgQ29uZmlnIFBhdGgNCg0KICAgICAgICAjcmVnaW9uIFN0ZXA6IENoZWNrIGlmIENvbmZpZyBGaWxlIEV4aXN0cw0KICAgICAgICBpZiAoLW5vdCAoVGVzdC1QYXRoIC1QYXRoICRjb25maWdQYXRoIC1QYXRoVHlwZSBMZWFmKSkgIyBVc2UgTGVhZiB0byBlbnN1cmUgaXQncyBhIGZpbGUsIG5vdCBhIGRpcmVjdG9yeQ0KICAgICAgICB7DQogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IENvbmZpZyBGaWxlIE5vdCBGb3VuZCAtIENyZWF0ZSBmcm9tIERlZmF1bHRzDQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogQ29uZmlnIGZpbGUgbm90IGZvdW5kIGF0ICckY29uZmlnUGF0aCcuIENyZWF0aW5nIGZyb20gZGVmYXVsdHMuIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDb3B5IERlZmF1bHQgQ29uZmlnIHRvIEdsb2JhbCBWYXJpYWJsZQ0KICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZyA9IENvcHktT3JkZXJlZERpY3Rpb25hcnkgLURpY3Rpb25hcnkgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuRGVmYXVsdENvbmZpZyAtRXJyb3JBY3Rpb24gU3RvcA0KICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogQ29weSBEZWZhdWx0IENvbmZpZyB0byBHbG9iYWwgVmFyaWFibGUNCg0KICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogV3JpdGUgSW5pdGlhbCBDb25maWcgRmlsZQ0KICAgICAgICAgICAgICAgICR3cml0ZVN1Y2Nlc3MgPSBXcml0ZS1Db25maWcgLUNvbmZpZ1BhdGggJGNvbmZpZ1BhdGggLUNvbmZpZyAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcNCiAgICAgICAgICAgICAgICBpZiAoLW5vdCAkd3JpdGVTdWNjZXNzKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChJbml0aWFsaXplLUluaUNvbmZpZyk6IEZhaWxlZCB0byB3cml0ZSBpbml0aWFsIGRlZmF1bHQgY29uZmlndXJhdGlvbiB0byAnJGNvbmZpZ1BhdGgnLiIgLUZvcmVncm91bmRDb2xvciBSZWQNCiAgICAgICAgICAgICAgICAgICAgIyBFbnN1cmUgY29uZmlnIGlzIHJlc2V0IG9yIG51bGxlZCBpZiB3cml0ZSBmYWlscz8gRm9yIG5vdywgbGVhdmUgaXQgYXMgY29waWVkIGRlZmF1bHRzLg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlICMgSW5kaWNhdGUgaW5pdGlhbGl6YXRpb24gZmFpbHVyZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogU3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgYW5kIHdyb3RlIGRlZmF1bHQgY29uZmlnIHRvICckY29uZmlnUGF0aCcuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBXcml0ZSBJbml0aWFsIENvbmZpZyBGaWxlDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogRXJyb3IgSGFuZGxpbmcgLSBGYWlsZWQgdG8gQ3JlYXRlIERlZmF1bHQgQ29uZmlnDQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChJbml0aWFsaXplLUluaUNvbmZpZyk6IEVycm9yIGNyZWF0aW5nIGRlZmF1bHQgY29uZmlndXJhdGlvbi4gRXJyb3I6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICAgICAgICAgICMgRW5zdXJlIGNvbmZpZyBpcyBhdCBsZWFzdCBhbiBlbXB0eSBkaWN0aW9uYXJ5IG9uIGNhdGFzdHJvcGhpYyBmYWlsdXJlDQogICAgICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnID0gW29yZGVyZWRdQHt9DQogICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZSAjIEluZGljYXRlIGluaXRpYWxpemF0aW9uIGZhaWx1cmUNCiAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEVycm9yIEhhbmRsaW5nIC0gRmFpbGVkIHRvIENyZWF0ZSBEZWZhdWx0IENvbmZpZw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBDb25maWcgRmlsZSBOb3QgRm91bmQgLSBDcmVhdGUgZnJvbSBEZWZhdWx0cw0KICAgICAgICB9DQogICAgICAgICNlbmRyZWdpb24gU3RlcDogQ2hlY2sgaWYgQ29uZmlnIEZpbGUgRXhpc3RzDQogICAgICAgICNyZWdpb24gU3RlcDogQ29uZmlnIEZpbGUgRXhpc3RzIC0gUmVhZCBhbmQgVmVyaWZ5DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBSZWFkIEV4aXN0aW5nIENvbmZpZyBGaWxlDQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogRXhpc3RpbmcgY29uZmlnIGZpbGUgZm91bmQgYXQgJyRjb25maWdQYXRoJy4gUmVhZGluZy4uLiIgLUZvcmVncm91bmRDb2xvciBDeWFuDQogICAgICAgICAgICAkcmVhZFN1Y2Nlc3MgPSBSZWFkLUNvbmZpZyAtQ29uZmlnUGF0aCAkY29uZmlnUGF0aCAjIFBhc3MgcGF0aCBleHBsaWNpdGx5DQogICAgICAgICAgICBpZiAoLW5vdCAkcmVhZFN1Y2Nlc3MpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgIyBSZWFkLUNvbmZpZyBsb2dzIGVycm9ycyBhbmQgYXR0ZW1wdHMgdG8gbG9hZCBkZWZhdWx0cyBvbiBmYWlsdXJlLg0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoSW5pdGlhbGl6ZS1JbmlDb25maWcpOiBGYWlsZWQgdG8gcmVhZCBleGlzdGluZyBjb25maWd1cmF0aW9uIGZpbGUgJyRjb25maWdQYXRoJy4gQ2hlY2sgcHJldmlvdXMgZXJyb3JzLiBJbml0aWFsaXphdGlvbiBjYW5ub3QgY29udGludWUgcmVsaWFibHkuIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICAgICAgICAgICMgSWYgUmVhZC1Db25maWcgZmFpbGVkIGJ1dCBsb2FkZWQgZGVmYXVsdHMsIHNob3VsZCB3ZSBwcm9jZWVkPyBBc3N1bWluZyBmYWlsdXJlIGlzIGNyaXRpY2FsIGhlcmUuDQogICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZSAjIEluZGljYXRlIGluaXRpYWxpemF0aW9uIGZhaWx1cmUNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoSW5pdGlhbGl6ZS1JbmlDb25maWcpOiBTdWNjZXNzZnVsbHkgcmVhZCBleGlzdGluZyBjb25maWcuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFJlYWQgRXhpc3RpbmcgQ29uZmlnIEZpbGUNCg0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBWZXJpZnkgQ29uZmlnIFN0cnVjdHVyZSBBZ2FpbnN0IERlZmF1bHRzDQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogVmVyaWZ5aW5nIGNvbmZpZyBzdHJ1Y3R1cmUgYWdhaW5zdCBkZWZhdWx0cy4uLiIgLUZvcmVncm91bmRDb2xvciBDeWFuDQogICAgICAgICAgICAjICRuZWVkc1VwZGF0ZTogRmxhZyBpbmRpY2F0aW5nIGlmIHRoZSBjb25maWcgZmlsZSBuZWVkcyB0byBiZSByZXdyaXR0ZW4gd2l0aCBhZGRlZCBkZWZhdWx0cy4NCiAgICAgICAgICAgICRuZWVkc1VwZGF0ZSA9ICRmYWxzZQ0KICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBJdGVyYXRlIERlZmF1bHQgU2VjdGlvbnMNCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkc2VjdGlvbiBpbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5EZWZhdWx0Q29uZmlnLktleXMpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHNlY3Rpb24gZXhpc3RzIGluIGxvYWRlZCBjb25maWcNCiAgICAgICAgICAgICAgICAgICAgaWYgKC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnLkNvbnRhaW5zKCRzZWN0aW9uKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBBZGQgTWlzc2luZyBTZWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogQWRkaW5nIG1pc3Npbmcgc2VjdGlvbiAnWyRzZWN0aW9uXScgZnJvbSBkZWZhdWx0cy4iIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ29weSB0aGUgZW50aXJlIGRlZmF1bHQgc2VjdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWyRzZWN0aW9uXSA9IENvcHktT3JkZXJlZERpY3Rpb25hcnkgLURpY3Rpb25hcnkgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuRGVmYXVsdENvbmZpZ1skc2VjdGlvbl0gLUVycm9yQWN0aW9uIFN0b3ANCiAgICAgICAgICAgICAgICAgICAgICAgICRuZWVkc1VwZGF0ZSA9ICR0cnVlDQogICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEFkZCBNaXNzaW5nIFNlY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICMgU2VjdGlvbiBleGlzdHMsIGNoZWNrIGtleXMgd2l0aGluIHRoZSBzZWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEl0ZXJhdGUgRGVmYXVsdCBLZXlzIGluIFNlY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRrZXkgaW4gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuRGVmYXVsdENvbmZpZ1skc2VjdGlvbl0uS2V5cykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIGtleSBleGlzdHMgaW4gdGhlIGxvYWRlZCBjb25maWcncyBzZWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWyRzZWN0aW9uXS5Db250YWlucygka2V5KSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogQWRkIE1pc3NpbmcgS2V5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoSW5pdGlhbGl6ZS1JbmlDb25maWcpOiBBZGRpbmcgbWlzc2luZyBrZXkgJyRrZXknIGluIHNlY3Rpb24gJ1skc2VjdGlvbl0nIGZyb20gZGVmYXVsdHMuIiAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1skc2VjdGlvbl1bJGtleV0gPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5EZWZhdWx0Q29uZmlnWyRzZWN0aW9uXVska2V5XQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbmVlZHNVcGRhdGUgPSAkdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEFkZCBNaXNzaW5nIEtleQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogSXRlcmF0ZSBEZWZhdWx0IEtleXMgaW4gU2VjdGlvbg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogSXRlcmF0ZSBEZWZhdWx0IFNlY3Rpb25zDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogRXJyb3IgSGFuZGxpbmcgLSBGYWlsZWQgU3RydWN0dXJlIFZlcmlmaWNhdGlvbg0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoSW5pdGlhbGl6ZS1JbmlDb25maWcpOiBFcnJvciB2ZXJpZnlpbmcgY29uZmlnIHN0cnVjdHVyZSBhZ2FpbnN0IGRlZmF1bHRzLiBFcnJvcjogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZSAjIEluZGljYXRlIGluaXRpYWxpemF0aW9uIGZhaWx1cmUNCiAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEVycm9yIEhhbmRsaW5nIC0gRmFpbGVkIFN0cnVjdHVyZSBWZXJpZmljYXRpb24NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVmVyaWZ5IENvbmZpZyBTdHJ1Y3R1cmUgQWdhaW5zdCBEZWZhdWx0cw0KDQogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFdyaXRlIFVwZGF0ZWQgQ29uZmlnIGlmIE5lY2Vzc2FyeQ0KICAgICAgICAgICAgaWYgKCRuZWVkc1VwZGF0ZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFdyaXRlIFVwZGF0ZWQgQ29uZmlnIEZpbGUNCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICcgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogQ29uZmlndXJhdGlvbiB1cGRhdGVkIHdpdGggbWlzc2luZyBkZWZhdWx0cy4gV3JpdGluZyBjaGFuZ2VzLi4uJyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQogICAgICAgICAgICAgICAgJHdyaXRlU3VjY2VzcyA9IFdyaXRlLUNvbmZpZyAtQ29uZmlnUGF0aCAkY29uZmlnUGF0aCAtQ29uZmlnICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZw0KICAgICAgICAgICAgICAgIGlmICgtbm90ICR3cml0ZVN1Y2Nlc3MpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKEluaXRpYWxpemUtSW5pQ29uZmlnKTogRmFpbGVkIHRvIHdyaXRlIHVwZGF0ZWQgY29uZmlndXJhdGlvbiB0byAnJGNvbmZpZ1BhdGgnLiIgLUZvcmVncm91bmRDb2xvciBSZWQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZSAjIEluZGljYXRlIGluaXRpYWxpemF0aW9uIGZhaWx1cmUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChJbml0aWFsaXplLUluaUNvbmZpZyk6IFN1Y2Nlc3NmdWxseSB3cm90ZSB1cGRhdGVkIGNvbmZpZyB0byAnJGNvbmZpZ1BhdGgnLiIgLUZvcmVncm91bmRDb2xvciBHcmVlbg0KICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogV3JpdGUgVXBkYXRlZCBDb25maWcgRmlsZQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogTG9nIE5vIFVwZGF0ZXMgTmVlZGVkDQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChJbml0aWFsaXplLUluaUNvbmZpZyk6IENvbmZpZyBzdHJ1Y3R1cmUgdmVyaWZpZWQuIE5vIHVwZGF0ZXMgbmVlZGVkLiIgLUZvcmVncm91bmRDb2xvciBHcmVlbg0KICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogTG9nIE5vIFVwZGF0ZXMgTmVlZGVkDQogICAgICAgICAgICB9DQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFdyaXRlIFVwZGF0ZWQgQ29uZmlnIGlmIE5lY2Vzc2FyeQ0KICAgICAgICB9DQogICAgICAgICNlbmRyZWdpb24gU3RlcDogQ29uZmlnIEZpbGUgRXhpc3RzIC0gUmVhZCBhbmQgVmVyaWZ5DQoNCiAgICAgICAgI3JlZ2lvbiBTdGVwOiBGaW5hbCBTdWNjZXNzDQogICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoSW5pdGlhbGl6ZS1JbmlDb25maWcpOiBDb25maWd1cmF0aW9uIGluaXRpYWxpemF0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgIHJldHVybiAkdHJ1ZSAjIEluZGljYXRlIHN1Y2Nlc3NmdWwgaW5pdGlhbGl6YXRpb24NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBGaW5hbCBTdWNjZXNzDQogICAgfQ0KICAgICNlbmRyZWdpb24gRnVuY3Rpb246IEluaXRpYWxpemUtSW5pQ29uZmlnDQoNCiAgICAjcmVnaW9uIEZ1bmN0aW9uOiBSZWFkLUNvbmZpZw0KICAgIGZ1bmN0aW9uIFJlYWQtQ29uZmlnDQogICAgew0KICAgICAgICA8Iw0KICAgICAgICAuU1lOT1BTSVMNCiAgICAgICAgICAgIFJlYWRzIHRoZSBjb25maWd1cmF0aW9uIGZyb20gdGhlIHNwZWNpZmllZCBJTkkgZmlsZSBpbnRvIHRoZSBnbG9iYWwgY29uZmlnIHZhcmlhYmxlLg0KICAgICAgICAuREVTQ1JJUFRJT04NCiAgICAgICAgICAgIFVzZXMgdGhlIEMjICdJbmlGaWxlJyBjbGFzcyB0byByZWFkIHRoZSBJTkkgZmlsZSBzcGVjaWZpZWQgYnkgdGhlIENvbmZpZ1BhdGggcGFyYW1ldGVyDQogICAgICAgICAgICAob3IgZGVmYXVsdHMgdG8gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUGF0aHMuSW5pKS4NCiAgICAgICAgICAgIFBvcHVsYXRlcyB0aGUgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnIG9yZGVyZWQgZGljdGlvbmFyeSB3aXRoIHRoZSBjb250ZW50IHJlYWQgZnJvbSB0aGUgZmlsZS4NCiAgICAgICAgICAgIElmIHJlYWRpbmcgZmFpbHMgKGUuZy4sIGZpbGUgbm90IGZvdW5kLCBwYXJzaW5nIGVycm9yKSwgaXQgbG9ncyBhbiBlcnJvciBhbmQgYXR0ZW1wdHMgdG8gcG9wdWxhdGUNCiAgICAgICAgICAgIHRoZSBnbG9iYWwgY29uZmlnIHdpdGggZGVmYXVsdCB2YWx1ZXMgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkRlZmF1bHRDb25maWcpIGFzIGEgZmFsbGJhY2ssDQogICAgICAgICAgICB1c2luZyB0aGUgTG9hZERlZmF1bHRDb25maWdPbkVycm9yIGhlbHBlciBmdW5jdGlvbi4NCiAgICAgICAgLlBBUkFNRVRFUiBDb25maWdQYXRoDQogICAgICAgICAgICBbc3RyaW5nXSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBJTkkgY29uZmlndXJhdGlvbiBmaWxlIHRvIHJlYWQuIERlZmF1bHRzIHRvICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkluaSBpZiBub3QgcHJvdmlkZWQuDQogICAgICAgIC5PVVRQVVRTDQogICAgICAgICAgICBbYm9vbF0gUmV0dXJucyAkdHJ1ZSBpZiB0aGUgY29uZmlnIGZpbGUgd2FzIHJlYWQgc3VjY2Vzc2Z1bGx5IGFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcgd2FzIHBvcHVsYXRlZCBmcm9tIHRoZSBmaWxlLg0KICAgICAgICAgICAgUmV0dXJucyAkZmFsc2UgaWYgcmVhZGluZyBmYWlsZWQgYW5kIGRlZmF1bHRzIHdlcmUgbG9hZGVkIGluc3RlYWQgKG9yIGlmIGxvYWRpbmcgZGVmYXVsdHMgYWxzbyBmYWlsZWQpLg0KICAgICAgICAuTk9URVMNCiAgICAgICAgICAgIC0gTW9kaWZpZXMgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnLg0KICAgICAgICAgICAgLSBSZXF1aXJlcyB0aGUgJ0luaUZpbGUnIGNsYXNzIChmcm9tIGNsYXNzZXMucHNtMSkuDQogICAgICAgICAgICAtIFJlbGllcyBvbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZyBzdHJ1Y3R1cmUgKC5QYXRocy5JbmksIC5EZWZhdWx0Q29uZmlnKS4NCiAgICAgICAgICAgIC0gVXNlcyB0aGUgaW50ZXJuYWwgTG9hZERlZmF1bHRDb25maWdPbkVycm9yIGZ1bmN0aW9uIGZvciBmYWxsYmFjay4NCiAgICAgICAgICAgIC0gTG9ncyBvdXRjb21lcyBhbmQgZXJyb3JzIHRvIHRoZSBob3N0IHN0cmVhbS4NCiAgICAgICAgIz4NCiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0NCiAgICAgICAgW091dHB1dFR5cGUoW2Jvb2xdKV0NCiAgICAgICAgcGFyYW0oDQogICAgICAgICAgICBbUGFyYW1ldGVyKCldDQogICAgICAgICAgICBbc3RyaW5nXSRDb25maWdQYXRoID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUGF0aHMuSW5pDQogICAgICAgICkNCg0KICAgICAgICAjcmVnaW9uIFN0ZXA6IFZhbGlkYXRlIENvbmZpZyBQYXRoDQogICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRDb25maWdQYXRoKSkgew0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChSZWFkLUNvbmZpZyk6IENvbmZpZ3VyYXRpb24gcGF0aCBpcyBub3QgZGVmaW5lZC4iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICAjIEF0dGVtcHQgdG8gbG9hZCBkZWZhdWx0cyBhcyBwZXIgb3JpZ2luYWwgY2F0Y2ggbG9naWMNCiAgICAgICAgICAgIFJldHVybiAoTG9hZERlZmF1bHRDb25maWdPbkVycm9yIC1SZWFzb24gIkNvbmZpZ3VyYXRpb24gcGF0aCBub3QgZGVmaW5lZCIpDQogICAgICAgIH0NCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChSZWFkLUNvbmZpZyk6IFJlYWRpbmcgY29uZmlnIGZyb20gJyRDb25maWdQYXRoJyIgLUZvcmVncm91bmRDb2xvciBDeWFuDQogICAgICAgICNlbmRyZWdpb24gU3RlcDogVmFsaWRhdGUgQ29uZmlnIFBhdGgNCg0KICAgICAgICAjcmVnaW9uIFN0ZXA6IFJlYWQgSU5JIEZpbGUNCiAgICAgICAgdHJ5DQogICAgICAgIHsNCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogQ2hlY2sgRmlsZSBFeGlzdGVuY2UvVHlwZQ0KICAgICAgICAgICAgaWYgKC1ub3QgKFRlc3QtUGF0aCAtUGF0aCAkQ29uZmlnUGF0aCAtUGF0aFR5cGUgTGVhZikpIHsNCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKFJlYWQtQ29uZmlnKTogQ29uZmlnIGZpbGUgbm90IGZvdW5kIG9yIGlzIGEgZGlyZWN0b3J5IGF0ICckQ29uZmlnUGF0aCcuIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KICAgICAgICAgICAgICAgICMgUG9wdWxhdGUgd2l0aCBkZWZhdWx0cyBhcyBwZXIgb3JpZ2luYWwgbG9naWMNCiAgICAgICAgICAgICAgICBSZXR1cm4gKExvYWREZWZhdWx0Q29uZmlnT25FcnJvciAtUmVhc29uICJDb25maWcgZmlsZSBub3QgZm91bmQgYXQgJyRDb25maWdQYXRoJyIpDQogICAgICAgICAgICB9DQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENoZWNrIEZpbGUgRXhpc3RlbmNlL1R5cGUNCg0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBVc2UgSW5pRmlsZSBDbGFzcyB0byBSZWFkDQogICAgICAgICAgICAjIEFzc3VtaW5nIEluaUZpbGUgY2xhc3MgaXMgbG9hZGVkDQogICAgICAgICAgICAjICRpbmlIYW5kbGVyOiBJbnN0YW5jZSBvZiB0aGUgQyMgY2xhc3MgdXNlZCB0byBpbnRlcmFjdCB3aXRoIHRoZSBJTkkgZmlsZS4NCiAgICAgICAgICAgICRpbmlIYW5kbGVyID0gW0N1c3RvbS5JbmlGaWxlXTo6bmV3KCRDb25maWdQYXRoKQ0KICAgICAgICAgICAgIyAkcmVhZENvbmZpZzogVGhlIHJhdyBjb250ZW50IHJlYWQgZnJvbSB0aGUgSU5JIGZpbGUgYXMgYSAuTkVUIE9yZGVyZWREaWN0aW9uYXJ5Lg0KICAgICAgICAgICAgJHJlYWRDb25maWcgPSAkaW5pSGFuZGxlci5SZWFkSW5pRmlsZSgpDQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFVzZSBJbmlGaWxlIENsYXNzIHRvIFJlYWQNCg0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDb252ZXJ0IHRvIFBvd2VyU2hlbGwgT3JkZXJlZERpY3Rpb25hcnkgJiBTdG9yZSBHbG9iYWxseQ0KICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnID0gW29yZGVyZWRdQHt9DQogICAgICAgICAgICBpZiAoJG51bGwgLW5lICRyZWFkQ29uZmlnKSB7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHNlY3Rpb24gaW4gJHJlYWRDb25maWcuS2V5cykNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1skc2VjdGlvbl0gPSBbb3JkZXJlZF1Ae30NCiAgICAgICAgICAgICAgICAgICAgIyBFbnN1cmUgdGhlIHZhbHVlIGFzc29jaWF0ZWQgd2l0aCB0aGUgc2VjdGlvbiBrZXkgaXMgZGljdGlvbmFyeS1saWtlIGJlZm9yZSBpdGVyYXRpbmcga2V5cw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHJlYWRDb25maWdbJHNlY3Rpb25dIC1pcyBbU3lzdGVtLkNvbGxlY3Rpb25zLklEaWN0aW9uYXJ5XSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGtleSBpbiAkcmVhZENvbmZpZ1skc2VjdGlvbl0uS2V5cykNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJHNlY3Rpb25dWyRrZXldID0gJHJlYWRDb25maWdbJHNlY3Rpb25dWyRrZXldDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKFJlYWQtQ29uZmlnKTogU2VjdGlvbiAnWyRzZWN0aW9uXScgaW4gSU5JIGZpbGUgJyRDb25maWdQYXRoJyBkb2VzIG5vdCBjb250YWluIGtleS12YWx1ZSBwYWlycy4iIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoUmVhZC1Db25maWcpOiBSZWFkaW5nICckQ29uZmlnUGF0aCcgcmV0dXJuZWQgbnVsbC4iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICAgICAgIyBJZiBudWxsLCB0cmVhdCBhcyBlcnJvciBhbmQgbG9hZCBkZWZhdWx0cw0KICAgICAgICAgICAgICAgIFJldHVybiAoTG9hZERlZmF1bHRDb25maWdPbkVycm9yIC1SZWFzb24gIlJlYWRpbmcgY29uZmlnIGZpbGUgJyRDb25maWdQYXRoJyByZXR1cm5lZCBudWxsIikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogQ29udmVydCB0byBQb3dlclNoZWxsIE9yZGVyZWREaWN0aW9uYXJ5ICYgU3RvcmUgR2xvYmFsbHkNCg0KICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBTdWNjZXNzDQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKFJlYWQtQ29uZmlnKTogQ29uZmlnIGxvYWRlZCBzdWNjZXNzZnVsbHkgZnJvbSAnJENvbmZpZ1BhdGgnLiIgLUZvcmVncm91bmRDb2xvciBHcmVlbg0KICAgICAgICAgICAgcmV0dXJuICR0cnVlDQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFN1Y2Nlc3MNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaA0KICAgICAgICB7DQogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEVycm9yIEhhbmRsaW5nIC0gRmFpbGVkIHRvIFJlYWQvUHJvY2Vzcw0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChSZWFkLUNvbmZpZyk6IEZhaWxlZCB0byByZWFkL3Byb2Nlc3MgY29uZmlnIGZpbGUgJyRDb25maWdQYXRoJy4gRXJyb3I6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICAgICAgIyBBdHRlbXB0IHRvIGxvYWQgZGVmYXVsdHMgYXMgYSBmYWxsYmFjaw0KICAgICAgICAgICAgUmV0dXJuIChMb2FkRGVmYXVsdENvbmZpZ09uRXJyb3IgLVJlYXNvbiAiRXJyb3IgcmVhZGluZy9wcm9jZXNzaW5nICckQ29uZmlnUGF0aCc6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIikNCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogRXJyb3IgSGFuZGxpbmcgLSBGYWlsZWQgdG8gUmVhZC9Qcm9jZXNzDQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBSZWFkIElOSSBGaWxlDQogICAgfQ0KICAgICNlbmRyZWdpb24gRnVuY3Rpb246IFJlYWQtQ29uZmlnDQoNCiAgICAjcmVnaW9uIEZ1bmN0aW9uOiBXcml0ZS1Db25maWcNCiAgICBmdW5jdGlvbiBXcml0ZS1Db25maWcNCiAgICB7DQogICAgICAgIDwjDQogICAgICAgIC5TWU5PUFNJUw0KICAgICAgICAgICAgV3JpdGVzIGEgY29uZmlndXJhdGlvbiBkaWN0aW9uYXJ5IHRvIGFuIElOSSBmaWxlLg0KICAgICAgICAuREVTQ1JJUFRJT04NCiAgICAgICAgICAgIFRha2VzIGEgUG93ZXJTaGVsbCBvcmRlcmVkIGRpY3Rpb25hcnkgKHR5cGljYWxseSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcpIGFuZCB3cml0ZXMgaXQNCiAgICAgICAgICAgIHRvIHRoZSBzcGVjaWZpZWQgSU5JIGZpbGUgcGF0aCB1c2luZyB0aGUgQyMgJ0luaUZpbGUnIGNsYXNzLg0KICAgICAgICAgICAgSXQgaGFuZGxlcyBjb252ZXJ0aW5nIGFycmF5IHZhbHVlcyB3aXRoaW4gdGhlIGRpY3Rpb25hcnkgdG8gY29tbWEtc2VwYXJhdGVkIHN0cmluZ3MsDQogICAgICAgICAgICBhcyBJTkkgZmlsZXMgZG8gbm90IG5hdGl2ZWx5IHN1cHBvcnQgYXJyYXlzLg0KICAgICAgICAgICAgSXQgYWxzbyBlbnN1cmVzIHRoZSB0YXJnZXQgZGlyZWN0b3J5IGZvciB0aGUgSU5JIGZpbGUgZXhpc3RzLCBjcmVhdGluZyBpdCBpZiBuZWNlc3NhcnkuDQogICAgICAgIC5QQVJBTUVURVIgQ29uZmlnDQogICAgICAgICAgICBbU3lzdGVtLkNvbGxlY3Rpb25zLklEaWN0aW9uYXJ5XSBUaGUgY29uZmlndXJhdGlvbiBkYXRhIChbb3JkZXJlZF0gZGljdGlvbmFyeSkgdG8gd3JpdGUuIERlZmF1bHRzIHRvICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZyBpZiBub3QgcHJvdmlkZWQuDQogICAgICAgIC5QQVJBTUVURVIgQ29uZmlnUGF0aA0KICAgICAgICAgICAgW3N0cmluZ10gVGhlIGZ1bGwgcGF0aCB0byB0aGUgSU5JIGZpbGUgdG8gd3JpdGUuIERlZmF1bHRzIHRvICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkluaSBpZiBub3QgcHJvdmlkZWQuDQogICAgICAgIC5PVVRQVVRTDQogICAgICAgICAgICBbYm9vbF0gUmV0dXJucyAkdHJ1ZSBpZiB0aGUgY29uZmlndXJhdGlvbiB3YXMgd3JpdHRlbiBzdWNjZXNzZnVsbHkgdG8gdGhlIGZpbGUuDQogICAgICAgICAgICBSZXR1cm5zICRmYWxzZSBpZiBhbnkgZXJyb3Igb2NjdXJyZWQgZHVyaW5nIGRpcmVjdG9yeSBjcmVhdGlvbiwgZGF0YSBwcmVwYXJhdGlvbiwgb3IgZmlsZSB3cml0aW5nLg0KICAgICAgICAuTk9URVMNCiAgICAgICAgICAgIC0gUmVxdWlyZXMgdGhlICdJbmlGaWxlJyBjbGFzcyAoZnJvbSBjbGFzc2VzLnBzbTEpLg0KICAgICAgICAgICAgLSBDcmVhdGVzIHRoZSBkZXN0aW5hdGlvbiBkaXJlY3RvcnkgaWYgaXQgZG9lc24ndCBleGlzdC4NCiAgICAgICAgICAgIC0gQ29udmVydHMgYXJyYXkgdmFsdWVzIHRvIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmdzLiBPdGhlciBjb21wbGV4IHR5cGVzIG1pZ2h0IG5vdCBiZSBoYW5kbGVkIGNvcnJlY3RseS4NCiAgICAgICAgICAgIC0gU3VwcG9ydHMgLVdoYXRJZiBhbmQgLUNvbmZpcm0gdGhyb3VnaCBbQ21kbGV0QmluZGluZyhTdXBwb3J0c1Nob3VsZFByb2Nlc3M9JHRydWUpXS4NCiAgICAgICAgICAgIC0gTG9ncyBwcm9ncmVzcyBhbmQgZXJyb3JzIHRvIHRoZSBob3N0IHN0cmVhbS4NCiAgICAgICAgIz4NCiAgICAgICAgW0NtZGxldEJpbmRpbmcoU3VwcG9ydHNTaG91bGRQcm9jZXNzPSR0cnVlKV0gIyBBZGRlZCBTaG91bGRQcm9jZXNzIHN1cHBvcnQNCiAgICAgICAgW091dHB1dFR5cGUoW2Jvb2xdKV0NCiAgICAgICAgcGFyYW0oDQogICAgICAgICAgICBbUGFyYW1ldGVyKCldDQogICAgICAgICAgICBbU3lzdGVtLkNvbGxlY3Rpb25zLklEaWN0aW9uYXJ5XSRDb25maWcgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcsICMgQWNjZXB0IFBTIFtvcmRlcmVkXSBvciAuTkVUDQoNCiAgICAgICAgICAgIFtQYXJhbWV0ZXIoKV0NCiAgICAgICAgICAgIFtzdHJpbmddJENvbmZpZ1BhdGggPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5QYXRocy5JbmkNCiAgICAgICAgKQ0KDQogICAgICAgICNyZWdpb24gU3RlcDogVmFsaWRhdGUgSW5wdXRzDQogICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRDb25maWdQYXRoKSkgew0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChXcml0ZS1Db25maWcpOiBDb25maWd1cmF0aW9uIHBhdGggaXMgbm90IGRlZmluZWQuIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICAgICAgcmV0dXJuICRmYWxzZQ0KICAgICAgICB9DQogICAgICAgIGlmICgkbnVsbCAtZXEgJENvbmZpZykgew0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChXcml0ZS1Db25maWcpOiBDb25maWd1cmF0aW9uIGRhdGEgdG8gd3JpdGUgaXMgbnVsbC4iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChXcml0ZS1Db25maWcpOiBQcmVwYXJpbmcgdG8gd3JpdGUgY29uZmlnIHRvICckQ29uZmlnUGF0aCciIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KDQogICAgICAgIGlmICgtbm90ICRwc2NtZGxldC5TaG91bGRQcm9jZXNzKCRDb25maWdQYXRoLCAiV3JpdGUgQ29uZmlndXJhdGlvbiIpKSB7DQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKFdyaXRlLUNvbmZpZyk6IFdyaXRlIG9wZXJhdGlvbiBjYW5jZWxsZWQgYnkgU2hvdWxkUHJvY2Vzcy4iIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBWYWxpZGF0ZSBJbnB1dHMNCg0KICAgICAgICAjcmVnaW9uIFN0ZXA6IEVuc3VyZSBEaXJlY3RvcnkgRXhpc3RzDQogICAgICAgIHRyeQ0KICAgICAgICB7DQogICAgICAgICAgICAkY29uZmlnRGlyID0gU3BsaXQtUGF0aCAtUGF0aCAkQ29uZmlnUGF0aCAtUGFyZW50DQogICAgICAgICAgICBpZiAoLW5vdCAoVGVzdC1QYXRoIC1QYXRoICRjb25maWdEaXIgLVBhdGhUeXBlIENvbnRhaW5lcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiICBJTkk6IChXcml0ZS1Db25maWcpOiBDcmVhdGluZyBkaXJlY3RvcnkgJyRjb25maWdEaXInLiIgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KICAgICAgICAgICAgICAgIE5ldy1JdGVtIC1JdGVtVHlwZSBEaXJlY3RvcnkgLVBhdGggJGNvbmZpZ0RpciAtRm9yY2UgLUVycm9yQWN0aW9uIFN0b3AgfCBPdXQtTnVsbA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoDQogICAgICAgIHsNCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoV3JpdGUtQ29uZmlnKTogRmFpbGVkIHRvIGNyZWF0ZSBkaXJlY3RvcnkgJyRjb25maWdEaXInLiBFcnJvcjogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBFbnN1cmUgRGlyZWN0b3J5IEV4aXN0cw0KDQogICAgICAgICNyZWdpb24gU3RlcDogUHJlcGFyZSBEYXRhIGZvciBXcml0aW5nIChIYW5kbGUgQXJyYXlzLCBDb252ZXJ0IHRvIC5ORVQgRGljdGlvbmFyeSkNCiAgICAgICAgIyBOZWVkIHRvIGNvbnZlcnQgUFMgW29yZGVyZWRdIHRvIC5ORVQgT3JkZXJlZERpY3Rpb25hcnkgZm9yIHRoZSBDIyBjbGFzcw0KICAgICAgICAjICRjb25maWdUb1dyaXRlOiBUaGUgLk5FVCBPcmRlcmVkRGljdGlvbmFyeSBwcmVwYXJlZCBmb3IgdGhlIEMjIEluaUZpbGUgY2xhc3MuDQogICAgICAgICRjb25maWdUb1dyaXRlID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuU3BlY2lhbGl6ZWQuT3JkZXJlZERpY3Rpb25hcnkNCg0KICAgICAgICB0cnkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAoJHNlY3Rpb25LZXkgaW4gJENvbmZpZy5LZXlzKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICRzZWN0aW9uTmFtZSA9ICRzZWN0aW9uS2V5LlRvU3RyaW5nKCkgIyBFbnN1cmUgc3RyaW5nIGtleQ0KICAgICAgICAgICAgICAgICMgRW5zdXJlIHNlY3Rpb24gdmFsdWUgaXMgYSBkaWN0aW9uYXJ5IGJlZm9yZSBwcm9jZWVkaW5nDQogICAgICAgICAgICAgICAgaWYgKCRDb25maWdbJHNlY3Rpb25LZXldIC1pcyBbU3lzdGVtLkNvbGxlY3Rpb25zLklEaWN0aW9uYXJ5XSkgew0KICAgICAgICAgICAgICAgICAgICAkc2VjdGlvbkRhdGEgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5TcGVjaWFsaXplZC5PcmRlcmVkRGljdGlvbmFyeQ0KICAgICAgICAgICAgICAgICAgICAkc291cmNlU2VjdGlvbiA9ICRDb25maWdbJHNlY3Rpb25LZXldDQoNCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGl0ZW1LZXkgaW4gJHNvdXJjZVNlY3Rpb24uS2V5cykNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW1OYW1lID0gJGl0ZW1LZXkuVG9TdHJpbmcoKSAjIEVuc3VyZSBzdHJpbmcga2V5DQogICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSAkc291cmNlU2VjdGlvblskaXRlbUtleV0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgIyBQcm9jZXNzIGFycmF5czogQ29udmVydCB0aGVtIHRvIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmdzDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlIC1pcyBbQXJyYXldKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRmlsdGVyIG91dCBwb3RlbnRpYWwgJG51bGwgZWxlbWVudHMgYmVmb3JlIGpvaW5pbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RyaW5nRWxlbWVudHMgPSAkdmFsdWUgfCBXaGVyZS1PYmplY3QgeyAkXyAtbmUgJG51bGwgfSB8IEZvckVhY2gtT2JqZWN0IHsgJF8uVG9TdHJpbmcoKSB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByZXBhcmVkVmFsdWUgPSAkc3RyaW5nRWxlbWVudHMgLWpvaW4gJywnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBVc2UgVmVyYm9zZSBzdHJlYW0gZm9yIHRoaXMgZGV0YWlsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiSU5JOiAoV3JpdGUtQ29uZmlnKTogQ29udmVydGVkIGFycmF5IGZvciBbJHNlY3Rpb25OYW1lXSRpdGVtTmFtZSB0byAnJHByZXBhcmVkVmFsdWUnIg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmICgkbnVsbCAtbmUgJHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ29udmVydCBvdGhlciBub24tbnVsbCB2YWx1ZXMgdG8gc3RyaW5nIGp1c3QgaW4gY2FzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwcmVwYXJlZFZhbHVlID0gJHZhbHVlLlRvU3RyaW5nKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEhhbmRsZSBudWxsIHZhbHVlICh3cml0ZSBhcyBlbXB0eSBzdHJpbmcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByZXBhcmVkVmFsdWUgPSAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJHNlY3Rpb25EYXRhLkFkZCgkaXRlbU5hbWUsICRwcmVwYXJlZFZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRjb25maWdUb1dyaXRlLkFkZCgkc2VjdGlvbk5hbWUsICRzZWN0aW9uRGF0YSkNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKFdyaXRlLUNvbmZpZyk6IFNlY3Rpb24gJyRzZWN0aW9uTmFtZScgaXMgbm90IGEgZGljdGlvbmFyeSwgc2tpcHBpbmcgd3JpdGUgZm9yIHRoaXMgc2VjdGlvbi4iIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoV3JpdGUtQ29uZmlnKTogRmFpbGVkIHRvIHByZXBhcmUgY29uZmlndXJhdGlvbiBkYXRhIGZvciB3cml0aW5nLiBFcnJvcjogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBQcmVwYXJlIERhdGEgZm9yIFdyaXRpbmcgKEhhbmRsZSBBcnJheXMsIENvbnZlcnQgdG8gLk5FVCBEaWN0aW9uYXJ5KQ0KDQogICAgICAgICNyZWdpb24gU3RlcDogV3JpdGUgdXNpbmcgSW5pRmlsZSBDbGFzcw0KICAgICAgICB0cnkNCiAgICAgICAgew0KICAgICAgICAgICAgIyBBc3N1bWluZyBJbmlGaWxlIGNsYXNzIGlzIGxvYWRlZA0KICAgICAgICAgICAgIyAkaW5pRmlsZTogSW5zdGFuY2Ugb2YgdGhlIEMjIGNsYXNzIHVzZWQgdG8gd3JpdGUgdGhlIElOSSBmaWxlLg0KICAgICAgICAgICAgJGluaUZpbGUgPSBbQ3VzdG9tLkluaUZpbGVdOjpuZXcoJENvbmZpZ1BhdGgpDQogICAgICAgICAgICAjIFBhc3MgdGhlIHByZXBhcmVkIC5ORVQgT3JkZXJlZERpY3Rpb25hcnkgdG8gdGhlIHdyaXRpbmcgbWV0aG9kDQogICAgICAgICAgICAkaW5pRmlsZS5Xcml0ZUluaUZpbGUoJGNvbmZpZ1RvV3JpdGUpICMgQXNzdW1lcyBXcml0ZUluaUZpbGUgaGFuZGxlcyBwb3RlbnRpYWwgSU9FeGNlcHRpb25zDQoNCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgSU5JOiAoV3JpdGUtQ29uZmlnKTogQ29uZmlnIHdyaXR0ZW4gc3VjY2Vzc2Z1bGx5IHRvICckQ29uZmlnUGF0aCcuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgICAgICByZXR1cm4gJHRydWUNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAjIENhdGNoIGVycm9ycyBzcGVjaWZpY2FsbHkgZnJvbSB0aGUgV3JpdGVJbmlGaWxlIGNhbGwgb3IgaW5zdGFudGlhdGlvbg0KICAgICAgICB7DQogICAgICAgICAgICBXcml0ZS1WZXJib3NlICIgIElOSTogKFdyaXRlLUNvbmZpZyk6IEZhaWxlZCB0byB3cml0ZSBjb25maWcgdXNpbmcgSW5pRmlsZSBjbGFzcyB0byAnJENvbmZpZ1BhdGgnLiBFcnJvcjogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBXcml0ZSB1c2luZyBJbmlGaWxlIENsYXNzDQogICAgfQ0KICAgICNlbmRyZWdpb24gRnVuY3Rpb246IFdyaXRlLUNvbmZpZw0KDQojZW5kcmVnaW9uIENvcmUgQ29uZmlndXJhdGlvbiBGdW5jdGlvbnMNCg0KI3JlZ2lvbiBNb2R1bGUgRXhwb3J0cw0KDQogICAgI3JlZ2lvbiBTdGVwOiBFeHBvcnQgUHVibGljIEZ1bmN0aW9ucw0KICAgICMgRXhwb3J0IGZ1bmN0aW9ucyBpbnRlbmRlZCBmb3IgZXh0ZXJuYWwgdXNlIGJ5IG90aGVyIG1vZHVsZXMgb3Igc2NyaXB0cy4NCiAgICBFeHBvcnQtTW9kdWxlTWVtYmVyIC1GdW5jdGlvbiBJbml0aWFsaXplLUluaUNvbmZpZywgUmVhZC1Db25maWcsIFdyaXRlLUNvbmZpZywgR2V0LUluaUZpbGVDb250ZW50LCBDb3B5LU9yZGVyZWREaWN0aW9uYXJ5LCBMb2FkRGVmYXVsdENvbmZpZ09uRXJyb3INCiAgICAjZW5kcmVnaW9uIFN0ZXA6IEV4cG9ydCBQdWJsaWMgRnVuY3Rpb25zDQoNCiNlbmRyZWdpb24gTW9kdWxlIEV4cG9ydHM=
			'
		}
		'ui.psm1'       = @{ 
			Priority = 'Critical';  
			Order = 5; 
			Dependencies = @('classes.psm1', 'ini.psm1');
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'ui.psm1');
			Base64Content = '
PCMgdWkucHNtMQ0KICAgIC5TWU5PUFNJUw0KICAgICAgICBDb25zdHJ1Y3RzLCBtYW5hZ2VzLCBhbmQgZGVmaW5lcyB0aGUgbG9naWMgZm9yIHRoZSBlbnRpcmUgZ3JhcGhpY2FsIHVzZXIgaW50ZXJmYWNlIChHVUkpIG9mIHRoZSBFbnRyb3BpYSBEYXNoYm9hcmQgZXhjZXB0IGZvciB0aGUgRnRvb2wuIA0KCQlJdCB1c2VzIFdpbmRvd3MgRm9ybXMgYW5kIGN1c3RvbS1kcmF3biBjb250cm9scyB0byBjcmVhdGUgYSBkYXJrLXRoZW1lZCwgaW50ZXJhY3RpdmUgZnJvbnRlbmQgZm9yIHRoZSBhcHBsaWNhdGlvbidzIGZlYXR1cmVzLg0KDQogICAgLkRFU0NSSVBUSU9ODQogICAgICAgIFRoaXMgUG93ZXJTaGVsbCBtb2R1bGUgaXMgZXhjbHVzaXZlbHkgcmVzcG9uc2libGUgZm9yIHRoZSBhcHBsaWNhdGlvbidzIHVzZXIgaW50ZXJmYWNlLiBJdCBkeW5hbWljYWxseSBidWlsZHMgYWxsIHZpc3VhbCBjb21wb25lbnRzLCByZWdpc3RlcnMgZXZlbnQgaGFuZGxlcnMgZm9yIHVzZXIgaW50ZXJhY3Rpb25zLCBhbmQgbWFuYWdlcyB0aGUgc3luY2hyb25pemF0aW9uIG9mIHNldHRpbmdzIGJldHdlZW4gdGhlIFVJIGFuZCB0aGUgYXBwbGljYXRpb24ncyBjb25maWd1cmF0aW9uIHN0YXRlLiBUaGUgVUkgaXMgYnVpbHQgdXNpbmcgV2luZG93cyBGb3JtcywgYnV0IGhlYXZpbHkgY3VzdG9taXplZCB3aXRoIG93bmVyLWRyYXduIGNvbnRyb2xzIGZyb20gYGNsYXNzZXMucHNtMWAgdG8gY3JlYXRlIGEgY29uc2lzdGVudCBkYXJrLW1vZGUgYWVzdGhldGljLg0KDQogICAgICAgIFRoZSBtb2R1bGUncyBhcmNoaXRlY3R1cmUgYW5kIGtleSBmdW5jdGlvbnMgaW5jbHVkZToNCg0KICAgICAgICAxLiAgKipVSSBDb25zdHJ1Y3Rpb24gKGBJbml0aWFsaXplLVVJYCAmIGBTZXQtVUlFbGVtZW50YCk6KioNCiAgICAgICAgICAgICogICAqKmBJbml0aWFsaXplLVVJYDoqKiBUaGUgbWFpbiBmdW5jdGlvbiB0aGF0IG9yY2hlc3RyYXRlcyB0aGUgY3JlYXRpb24gb2YgYWxsIHdpbmRvd3MgYW5kIGNvbnRyb2xzLiBJdCBidWlsZHMgdGhlIGBNYWluRm9ybWAgKHRoZSBwcmltYXJ5IGRhc2hib2FyZCkgYW5kIGEgYFNldHRpbmdzRm9ybWAgZm9yIGNvbmZpZ3VyYXRpb24uDQogICAgICAgICAgICAqICAgKipgU2V0LVVJRWxlbWVudGA6KiogQSBjZW50cmFsaXplZCBmYWN0b3J5IGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhbmQgYXBwbGllcyBhIHN0YW5kYXJkIGRhcmsgdGhlbWUgdG8gYWxsIFVJIGNvbXBvbmVudHMsIGZyb20gYmFzaWMgYnV0dG9ucyBhbmQgbGFiZWxzIHRvIGNvbXBsZXggYERhdGFHcmlkVmlld3NgIGFuZCB0aGUgY3VzdG9tIGNvbnRyb2xzIChgRGFya1RhYkNvbnRyb2xgLCBgVG9nZ2xlYCwgZXRjLikuIFRoaXMgZW5zdXJlcyBhIGNvbnNpc3RlbnQgbG9vayBhbmQgZmVlbC4NCiAgICAgICAgICAgICogICBBbGwgY3JlYXRlZCBVSSBlbGVtZW50cyBhcmUgc3RvcmVkIGluIHRoZSBgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUlgIG9iamVjdCBmb3IgZWFzeSBhY2Nlc3MgZnJvbSBvdGhlciBtb2R1bGVzLg0KDQogICAgICAgIDIuICAqKkV2ZW50IGFuZCBJbnRlcmFjdGlvbiBMb2dpYyAoYFJlZ2lzdGVyLVVJRXZlbnRIYW5kbGVyc2ApOioqDQogICAgICAgICAgICAqICAgVGhpcyBmdW5jdGlvbiBicmluZ3MgdGhlIFVJIHRvIGxpZmUgYnkgYXR0YWNoaW5nIHNjcmlwdCBibG9ja3MgdG8gdXNlciBldmVudHMgKGUuZy4sIGNsaWNrcywgZG91YmxlLWNsaWNrcywgZm9ybSBsb2FkaW5nKS4NCiAgICAgICAgICAgICogICBJdCB3aXJlcyB1cCB0aGUgbWFpbiBkYXNoYm9hcmQgYnV0dG9ucyAoYExhdW5jaGAsIGBMb2dpbmAsIGBGdG9vbGAsIGBUZXJtaW5hdGVgKSB0byB0cmlnZ2VyIGNvcmUgYXBwbGljYXRpb24gbG9naWMgZGVmaW5lZCBpbiBvdGhlciBtb2R1bGVzIChlLmcuLCBgbGF1bmNoLnBzbTFgLCBgbG9naW4ucHNtMWApLg0KICAgICAgICAgICAgKiAgIEl0IGltcGxlbWVudHMgdGhlIGN1c3RvbSBkcmFnZ2FibGUgdGl0bGUgYmFyIGFuZCB0aGUgbG9naWMgZm9yIHRoZSBjb29yZGluYXRlIHBpY2tlciB0b29scyBpbiB0aGUgc2V0dGluZ3MgbWVudS4NCg0KICAgICAgICAzLiAgKipDb25maWd1cmF0aW9uIGFuZCBEYXRhIEJpbmRpbmcgKGBTeW5jLVVJVG9Db25maWdgICYgYFN5bmMtQ29uZmlnVG9VSWApOioqDQogICAgICAgICAgICAqICAgVGhlc2UgdHdvIGZ1bmN0aW9ucyBwcm92aWRlIHR3by13YXkgZGF0YSBiaW5kaW5nIGJldHdlZW4gdGhlIFVJIGNvbnRyb2xzIGFuZCB0aGUgaW4tbWVtb3J5IGNvbmZpZ3VyYXRpb24gKGAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdgKS4NCiAgICAgICAgICAgICogICBgU3luYy1Db25maWdUb1VJYCBwb3B1bGF0ZXMgdGhlIGZvcm0gd2l0aCBzYXZlZCBzZXR0aW5ncyB3aGVuIGl0IGlzIGRpc3BsYXllZC4NCiAgICAgICAgICAgICogICBgU3luYy1VSVRvQ29uZmlnYCBnYXRoZXJzIHRoZSB1c2VyJ3MgY2hhbmdlcyBmcm9tIHRoZSBmb3JtIGZpZWxkcyBiZWZvcmUgdGhleSBhcmUgc2F2ZWQgdG8gdGhlIGBjb25maWcuaW5pYCBmaWxlLg0KDQogICAgICAgIDQuICAqKkFuaW1hdGVkIFRyYW5zaXRpb25zIChgU2hvdy1TZXR0aW5nc0Zvcm1gICYgYEhpZGUtU2V0dGluZ3NGb3JtYCk6KioNCiAgICAgICAgICAgICogICBUaGVzZSBmdW5jdGlvbnMgZW5oYW5jZSB0aGUgdXNlciBleHBlcmllbmNlIGJ5IHByb3ZpZGluZyBhIHNpbXBsZSBmYWRlLWluL2ZhZGUtb3V0IGFuaW1hdGlvbiBmb3IgdGhlIHNldHRpbmdzIGRpYWxvZywgd2hpY2ggaXMgYWNoaWV2ZWQgYnkgbWFuaXB1bGF0aW5nIHRoZSBmb3JtJ3Mgb3BhY2l0eSB3aXRoIGEgdGltZXIuDQojPg0KDQojcmVnaW9uIEhlbHBlciBGdW5jdGlvbnMNCiNyZWdpb24gRnVuY3Rpb246IFN5bmMtVUlUb0NvbmZpZw0KZnVuY3Rpb24gU3luYy1VSVRvQ29uZmlnDQp7DQogICAgW0NtZGxldEJpbmRpbmcoKV0NCiAgICBbT3V0cHV0VHlwZShbYm9vbF0pXQ0KICAgIHBhcmFtKCkNCg0KICAgIHRyeQ0KICAgIHsNCiAgICAgICAgV3JpdGUtVmVyYm9zZSAnICBVSTogU3luY2luZyBVSSB0byBjb25maWcnIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KICAgICAgICAkVUkgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSQ0KICAgICAgICBpZiAoLW5vdCAoJFVJIC1hbmQgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnKSkgeyByZXR1cm4gJGZhbHNlIH0NCg0KICAgICAgICAjIEVuc3VyZSBTZWN0aW9ucw0KICAgICAgICBAKCdMYXVuY2hlclBhdGgnLCAnUHJvY2Vzc05hbWUnLCAnTWF4Q2xpZW50cycsICdMb2dpbicsICdMb2dpbkNvbmZpZycpIHwgRm9yRWFjaC1PYmplY3Qgew0KICAgICAgICAgICAgaWYgKC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnLkNvbnRhaW5zKCRfKSkgew0KICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1skX10gPSBbb3JkZXJlZF1Ae30NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgICMgR2VuZXJhbA0KICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0xhdW5jaGVyUGF0aCddWydMYXVuY2hlclBhdGgnXSA9ICRVSS5JbnB1dExhdW5jaGVyLlRleHQNCiAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydQcm9jZXNzTmFtZSddWydQcm9jZXNzTmFtZSddID0gJFVJLklucHV0UHJvY2Vzcy5UZXh0DQogICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTWF4Q2xpZW50cyddWydNYXhDbGllbnRzJ10gPSAkVUkuSW5wdXRNYXguVGV4dA0KICAgICAgICANCiAgICAgICAgIyBDaGVja2JveGVzDQogICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW4nXVsnTmV2ZXJSZXN0YXJ0aW5nQ29sbGVjdG9yTG9naW4nXSA9IGlmICgkVUkuTmV2ZXJSZXN0YXJ0aW5nQ29sbGVjdG9yTG9naW4uQ2hlY2tlZCkgeyAnMScgfSBlbHNlIHsgJzAnIH0NCiAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydPcHRpb25zJ11bJ0hpZGVNaW5pbWl6ZWRXaW5kb3dzJ10gPSBpZiAoJFVJLkhpZGVNaW5pbWl6ZWRXaW5kb3dzLkNoZWNrZWQpIHsgJzAnIH0gZWxzZSB7ICcwJyB9DQoNCiAgICAgICAgIyBMb2dpbiBDb25maWcgKENvb3JkcykNCiAgICAgICAgZm9yZWFjaCAoJGtleSBpbiAkVUkuTG9naW5QaWNrZXJzLktleXMpIHsNCiAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW5Db25maWcnXVsiJHtrZXl9Q29vcmRzIl0gPSAkVUkuTG9naW5QaWNrZXJzWyRrZXldLlRleHQuVGV4dA0KICAgICAgICB9DQogICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW5Db25maWcnXVsnUG9zdExvZ2luRGVsYXknXSA9ICRVSS5JbnB1dFBvc3RMb2dpbkRlbGF5LlRleHQNCiAgICAgICAgDQogICAgICAgICMgTG9naW4gQ29uZmlnIChHcmlkKSAtIENSSVRJQ0FMIEZJWDogRW5zdXJlIHZhbHVlcyBhcmUgc3RyaW5ncw0KICAgICAgICAkZ3JpZCA9ICRVSS5Mb2dpbkNvbmZpZ0dyaWQNCiAgICAgICAgZm9yZWFjaCAoJHJvdyBpbiAkZ3JpZC5Sb3dzKSB7DQogICAgICAgICAgICAkY2xpZW50TnVtID0gJHJvdy5DZWxsc1swXS5WYWx1ZQ0KICAgICAgICAgICAgJHMgPSBpZiAoJHJvdy5DZWxsc1sxXS5WYWx1ZSkgeyAkcm93LkNlbGxzWzFdLlZhbHVlLlRvU3RyaW5nKCkgfSBlbHNlIHsgIjEiIH0NCiAgICAgICAgICAgICRjID0gaWYgKCRyb3cuQ2VsbHNbMl0uVmFsdWUpIHsgJHJvdy5DZWxsc1syXS5WYWx1ZS5Ub1N0cmluZygpIH0gZWxzZSB7ICIxIiB9DQogICAgICAgICAgICAkY2hhciA9IGlmICgkcm93LkNlbGxzWzNdLlZhbHVlKSB7ICRyb3cuQ2VsbHNbM10uVmFsdWUuVG9TdHJpbmcoKSB9IGVsc2UgeyAiMSIgfQ0KICAgICAgICAgICAgJGNvbGwgPSBpZiAoJHJvdy5DZWxsc1s0XS5WYWx1ZSkgeyAkcm93LkNlbGxzWzRdLlZhbHVlLlRvU3RyaW5nKCkgfSBlbHNlIHsgIk5vIiB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICR2YWwgPSAiJHMsJGMsJGNoYXIsJGNvbGwiDQogICAgICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0xvZ2luQ29uZmlnJ11bIkNsaWVudCR7Y2xpZW50TnVtfV9TZXR0aW5ncyJdID0gJHZhbA0KICAgICAgICB9DQoNCiAgICAgICAgV3JpdGUtVmVyYm9zZSAnICBVSTogVUkgc3luY2VkIHRvIGNvbmZpZycgLUZvcmVncm91bmRDb2xvciBHcmVlbg0KICAgICAgICByZXR1cm4gJHRydWUNCiAgICB9DQogICAgY2F0Y2gNCiAgICB7DQogICAgICAgIFdyaXRlLVZlcmJvc2UgIiAgVUk6IEZhaWxlZCB0byBzeW5jIFVJIHRvIGNvbmZpZzogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgIHJldHVybiAkZmFsc2UNCiAgICB9DQp9DQoNCg0KI2VuZHJlZ2lvbiBGdW5jdGlvbjogU3luYy1VSVRvQ29uZmlnDQoNCiNyZWdpb24gRnVuY3Rpb246IFN5bmMtQ29uZmlnVG9VSQ0KZnVuY3Rpb24gU3luYy1Db25maWdUb1VJDQp7DQogICAgW0NtZGxldEJpbmRpbmcoKV0NCiAgICBbT3V0cHV0VHlwZShbYm9vbF0pXQ0KICAgIHBhcmFtKCkNCg0KICAgIHRyeQ0KICAgIHsNCiAgICAgICAgV3JpdGUtVmVyYm9zZSAnICBVSTogU3luY2luZyBjb25maWcgdG8gVUknIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KICAgICAgICAkVUkgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSQ0KICAgICAgICBpZiAoLW5vdCAoJFVJIC1hbmQgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnKSkgeyByZXR1cm4gJGZhbHNlIH0NCg0KICAgICAgICAjIEdlbmVyYWwNCiAgICAgICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTGF1bmNoZXJQYXRoJ11bJ0xhdW5jaGVyUGF0aCddKSB7ICRVSS5JbnB1dExhdW5jaGVyLlRleHQgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0xhdW5jaGVyUGF0aCddWydMYXVuY2hlclBhdGgnXSB9DQogICAgICAgIGlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ1Byb2Nlc3NOYW1lJ11bJ1Byb2Nlc3NOYW1lJ10pIHsgJFVJLklucHV0UHJvY2Vzcy5UZXh0ID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydQcm9jZXNzTmFtZSddWydQcm9jZXNzTmFtZSddIH0NCiAgICAgICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTWF4Q2xpZW50cyddWydNYXhDbGllbnRzJ10pIHsgJFVJLklucHV0TWF4LlRleHQgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ01heENsaWVudHMnXVsnTWF4Q2xpZW50cyddIH0NCg0KICAgICAgICAjIENoZWNrYm94ZXMNCiAgICAgICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW4nXVsnTmV2ZXJSZXN0YXJ0aW5nQ29sbGVjdG9yTG9naW4nXSkgeyAkVUkuTmV2ZXJSZXN0YXJ0aW5nQ29sbGVjdG9yTG9naW4uQ2hlY2tlZCA9IChbaW50XSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW4nXVsnTmV2ZXJSZXN0YXJ0aW5nQ29sbGVjdG9yTG9naW4nXSkgLWVxIDEgfQ0KICAgICAgICBpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydPcHRpb25zJ11bJ0hpZGVNaW5pbWl6ZWRXaW5kb3dzJ10pIHsgJFVJLkhpZGVNaW5pbWl6ZWRXaW5kb3dzLkNoZWNrZWQgPSAoW2ludF0kZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ09wdGlvbnMnXVsnSGlkZU1pbmltaXplZFdpbmRvd3MnXSkgLWVxIDEgfQ0KDQogICAgICAgICMgTG9naW4gQ29uZmlnDQogICAgICAgIGlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0xvZ2luQ29uZmlnJ10pIHsNCiAgICAgICAgICAgICRsYyA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW5Db25maWcnXQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENvb3Jkcw0KICAgICAgICAgICAgZm9yZWFjaCAoJGtleSBpbiAkVUkuTG9naW5QaWNrZXJzLktleXMpIHsNCiAgICAgICAgICAgICAgICAkY29vcmRLZXkgPSAiJHtrZXl9Q29vcmRzIg0KICAgICAgICAgICAgICAgIGlmICgkbGNbJGNvb3JkS2V5XSkgew0KICAgICAgICAgICAgICAgICAgICAkVUkuTG9naW5QaWNrZXJzWyRrZXldLlRleHQuVGV4dCA9ICRsY1skY29vcmRLZXldDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRsY1snUG9zdExvZ2luRGVsYXknXSkgeyAkVUkuSW5wdXRQb3N0TG9naW5EZWxheS5UZXh0ID0gJGxjWydQb3N0TG9naW5EZWxheSddIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBHcmlkIC0gQ1JJVElDQUwgRklYOiBSb2J1c3QgcGFyc2luZw0KICAgICAgICAgICAgJGdyaWQgPSAkVUkuTG9naW5Db25maWdHcmlkDQogICAgICAgICAgICBmb3JlYWNoICgkcm93IGluICRncmlkLlJvd3MpIHsNCiAgICAgICAgICAgICAgICAkY2xpZW50TnVtID0gJHJvdy5DZWxsc1swXS5WYWx1ZQ0KICAgICAgICAgICAgICAgICRzZXR0aW5nS2V5ID0gIkNsaWVudCR7Y2xpZW50TnVtfV9TZXR0aW5ncyINCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkcz0iMSI7ICRjPSIxIjsgJGNoYXI9IjEiOyAkY29sbD0iTm8iDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCRsY1skc2V0dGluZ0tleV0pIHsNCiAgICAgICAgICAgICAgICAgICAgJHBhcnRzID0gJGxjWyRzZXR0aW5nS2V5XSAtc3BsaXQgJywnDQogICAgICAgICAgICAgICAgICAgIGlmICgkcGFydHMuQ291bnQgLWVxIDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcGFydHNbMF0gLWluIEAoIjEiLCIyIikpIHsgJHMgPSAkcGFydHNbMF0gfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRwYXJ0c1sxXSAtaW4gQCgiMSIsIjIiKSkgeyAkYyA9ICRwYXJ0c1sxXSB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHBhcnRzWzJdIC1pbiBAKCIxIiwiMiIsIjMiKSkgeyAkY2hhciA9ICRwYXJ0c1syXSB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHBhcnRzWzNdIC1pbiBAKCJZZXMiLCJObyIpKSB7ICRjb2xsID0gJHBhcnRzWzNdIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkcm93LkNlbGxzWzFdLlZhbHVlID0gJHMNCiAgICAgICAgICAgICAgICAkcm93LkNlbGxzWzJdLlZhbHVlID0gJGMNCiAgICAgICAgICAgICAgICAkcm93LkNlbGxzWzNdLlZhbHVlID0gJGNoYXINCiAgICAgICAgICAgICAgICAkcm93LkNlbGxzWzRdLlZhbHVlID0gJGNvbGwNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIFdyaXRlLVZlcmJvc2UgJyAgVUk6IENvbmZpZyBzeW5jZWQgdG8gVUknIC1Gb3JlZ3JvdW5kQ29sb3IgR3JlZW4NCiAgICAgICAgcmV0dXJuICR0cnVlDQogICAgfQ0KICAgIGNhdGNoDQogICAgew0KICAgICAgICBXcml0ZS1WZXJib3NlICIgIFVJOiBGYWlsZWQgdG8gc3luYyBjb25maWcgdG8gVUk6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICByZXR1cm4gJGZhbHNlDQogICAgfQ0KfQ0KI2VuZHJlZ2lvbiBGdW5jdGlvbjogU3luYy1Db25maWdUb1VJDQojZW5kcmVnaW9uIEhlbHBlciBGdW5jdGlvbnMNCg0KI3JlZ2lvbiBDb3JlIFVJIEZ1bmN0aW9ucw0KDQojcmVnaW9uIEZ1bmN0aW9uOiBJbml0aWFsaXplLVVJDQpmdW5jdGlvbiBJbml0aWFsaXplLVVJDQp7DQogICAgW0NtZGxldEJpbmRpbmcoKV0NCiAgICBwYXJhbSgpDQoNCiAgICBXcml0ZS1WZXJib3NlICcgIFVJOiBJbml0aWFsaXppbmcgVUkuLi4nIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KDQogICAgI3JlZ2lvbiBTdGVwOiBDcmVhdGUgTWFpbiBVSSBFbGVtZW50cw0KICAgICRwID0gQHsgdHlwZT0nRm9ybSc7IHZpc2libGU9JGZhbHNlOyB3aWR0aD00NzA7IGhlaWdodD00NDA7IGJnPUAoMzAsIDMwLCAzMCk7IGlkPSdNYWluRm9ybSc7IHRleHQ9J0VudHJvcGlhIERhc2hib2FyZCc7IHN0YXJ0UG9zaXRpb249J0NlbnRlclNjcmVlbic7IGZvcm1Cb3JkZXJTdHlsZT1bU3lzdGVtLldpbmRvd3MuRm9ybXMuRm9ybUJvcmRlclN0eWxlXTo6Tm9uZSB9DQogICAgJG1haW5Gb3JtID0gU2V0LVVJRWxlbWVudCBAcA0KDQogICAgJHAgPSBAeyB0eXBlPSdGb3JtJzsgdmlzaWJsZT0kZmFsc2U7IHdpZHRoPTYwMDsgaGVpZ2h0PTU1MDsgYmc9QCgzMCwgMzAsIDMwKTsgaWQ9J1NldHRpbmdzRm9ybSc7IHRleHQ9J1NldHRpbmdzJzsgc3RhcnRQb3NpdGlvbj0nTWFudWFsJzsgZm9ybUJvcmRlclN0eWxlPVtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5Gb3JtQm9yZGVyU3R5bGVdOjpOb25lOyBvcGFjaXR5PTA7IHRvcE1vc3Q9JHRydWUgfQ0KICAgICRzZXR0aW5nc0Zvcm0gPSBTZXQtVUlFbGVtZW50IEBwDQoNCiAgICBpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUGF0aHMuSWNvbiAtYW5kIChUZXN0LVBhdGggJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUGF0aHMuSWNvbikpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICRpY29uID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5JY29uKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkljb24pDQogICAgICAgICAgICAkbWFpbkZvcm0uSWNvbiA9ICRpY29uDQogICAgICAgICAgICAkc2V0dGluZ3NGb3JtLkljb24gPSAkaWNvbg0KICAgICAgICB9IGNhdGNoIHt9DQogICAgfQ0KDQogICAgJHAgPSBAeyB0eXBlPSdQYW5lbCc7IHdpZHRoPTQ3MDsgaGVpZ2h0PTMwOyBiZz1AKDIwLCAyMCwgMjApOyBpZD0nVG9wQmFyJyB9DQogICAgJHRvcEJhciA9IFNldC1VSUVsZW1lbnQgQHANCiAgICAkcCA9IEB7IHR5cGU9J0xhYmVsJzsgd2lkdGg9MTQwOyBoZWlnaHQ9MTI7IHRvcD01OyBsZWZ0PTEwOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0nVGl0bGVMYWJlbCc7IHRleHQ9J0VudHJvcGlhIERhc2hib2FyZCc7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA4LCBbU3lzdGVtLkRyYXdpbmcuRm9udFN0eWxlXTo6Qm9sZCkpIH0NCiAgICAkdGl0bGVMYWJlbEZvcm0gPSBTZXQtVUlFbGVtZW50IEBwDQogICAgJHAgPSBAeyB0eXBlPSdMYWJlbCc7IHdpZHRoPTE0MDsgaGVpZ2h0PTEwOyB0b3A9MTY7IGxlZnQ9MTA7IGZnPUAoMjMwLCAyMzAsIDIzMCk7IGlkPSdDb3B5cmlnaHRMYWJlbCc7IHRleHQ9W2NoYXJdMHgwMEE5ICsgJyBJbW1vcnRhbCAvIERpdmluZSAyMDI1IC0gdjEuMyc7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA2LCBbU3lzdGVtLkRyYXdpbmcuRm9udFN0eWxlXTo6SXRhbGljKSkgfQ0KICAgICRjb3B5cmlnaHRMYWJlbEZvcm0gPSBTZXQtVUlFbGVtZW50IEBwDQogICAgJHAgPSBAeyB0eXBlPSdCdXR0b24nOyB3aWR0aD0zMDsgaGVpZ2h0PTMwOyBsZWZ0PTQxMDsgYmc9QCg0MCwgNDAsIDQwKTsgZmc9QCgyNDAsIDI0MCwgMjQwKTsgaWQ9J01pbkZvcm0nOyB0ZXh0PSdfJzsgZnM9J0ZsYXQnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgMTEsIFtTeXN0ZW0uRHJhd2luZy5Gb250U3R5bGVdOjpCb2xkKSkgfQ0KICAgICRidG5NaW5pbWl6ZUZvcm0gPSBTZXQtVUlFbGVtZW50IEBwDQogICAgJHAgPSBAeyB0eXBlPSdCdXR0b24nOyB3aWR0aD0zMDsgaGVpZ2h0PTMwOyBsZWZ0PTQ0MDsgYmc9QCgxNTAsIDIwLCAyMCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdDbG9zZUZvcm0nOyB0ZXh0PVtjaGFyXTB4MTY2RDsgZnM9J0ZsYXQnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgMTEsIFtTeXN0ZW0uRHJhd2luZy5Gb250U3R5bGVdOjpCb2xkKSkgfQ0KICAgICRidG5DbG9zZUZvcm0gPSBTZXQtVUlFbGVtZW50IEBwDQogICAgI2VuZHJlZ2lvbg0KDQogICAgI3JlZ2lvbiBTdGVwOiBNYWluIEZvcm0gQnV0dG9ucyAmIEdyaWRzDQogICAgJHAgPSBAeyB0eXBlPSdCdXR0b24nOyB3aWR0aD0xMjU7IGhlaWdodD0zMDsgdG9wPTQwOyBsZWZ0PTE1OyBiZz1AKDQwLCA0MCwgNDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0nTGF1bmNoJzsgdGV4dD0nTGF1bmNoJzsgZnM9J0ZsYXQnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpIH0NCiAgICAkYnRuTGF1bmNoID0gU2V0LVVJRWxlbWVudCBAcA0KICAgICRwID0gQHsgdHlwZT0nQnV0dG9uJzsgd2lkdGg9MTI1OyBoZWlnaHQ9MzA7IHRvcD00MDsgbGVmdD0xNTA7IGJnPUAoNDAsIDQwLCA0MCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdMb2dpbic7IHRleHQ9J0xvZ2luJzsgZnM9J0ZsYXQnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpIH0NCiAgICAkYnRuTG9naW4gPSBTZXQtVUlFbGVtZW50IEBwDQogICAgJHAgPSBAeyB0eXBlPSdCdXR0b24nOyB3aWR0aD04MDsgaGVpZ2h0PTMwOyB0b3A9NDA7IGxlZnQ9Mjg1OyBiZz1AKDQwLCA0MCwgNDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0nU2V0dGluZ3MnOyB0ZXh0PSdTZXR0aW5ncyc7IGZzPSdGbGF0JzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJGJ0blNldHRpbmdzID0gU2V0LVVJRWxlbWVudCBAcA0KICAgICRwID0gQHsgdHlwZT0nQnV0dG9uJzsgd2lkdGg9ODA7IGhlaWdodD0zMDsgdG9wPTQwOyBsZWZ0PTM3NTsgYmc9QCgxNTAsIDIwLCAyMCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdUZXJtaW5hdGUnOyB0ZXh0PSdUZXJtaW5hdGUnOyBmcz0nRmxhdCc7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkgfQ0KICAgICRidG5TdG9wID0gU2V0LVVJRWxlbWVudCBAcA0KICAgICRwID0gQHsgdHlwZT0nQnV0dG9uJzsgd2lkdGg9NDQwOyBoZWlnaHQ9MzA7IHRvcD03NTsgbGVmdD0xNTsgYmc9QCg0MCwgNDAsIDQwKTsgZmc9QCgyNDAsIDI0MCwgMjQwKTsgaWQ9J0Z0b29sJzsgdGV4dD0nRnRvb2wnOyBmcz0nRmxhdCc7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkgfQ0KICAgICRidG5GdG9vbCA9IFNldC1VSUVsZW1lbnQgQHANCiAgICANCiAgICAkcCA9IEB7IHR5cGU9J0RhdGFHcmlkVmlldyc7IHZpc2libGU9JGZhbHNlOyB3aWR0aD0xNTU7IGhlaWdodD0zMjA7IHRvcD0xMTU7IGxlZnQ9NTsgYmc9QCg0MCwgNDAsIDQwKTsgZmc9QCgyNDAsIDI0MCwgMjQwKTsgaWQ9J0RhdGFHcmlkTWFpbic7IHRleHQ9Jyc7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkgfQ0KICAgICREYXRhR3JpZE1haW4gPSBTZXQtVUlFbGVtZW50IEBwDQogICAgDQogICAgJHAgPSBAeyB0eXBlPSdEYXRhR3JpZFZpZXcnOyB3aWR0aD00NTA7IGhlaWdodD0zMDA7IHRvcD0xMTU7IGxlZnQ9MTA7IGJnPUAoNDAsIDQwLCA0MCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdEYXRhR3JpZEZpbGxlcic7IHRleHQ9Jyc7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkgfQ0KICAgICREYXRhR3JpZEZpbGxlciA9IFNldC1VSUVsZW1lbnQgQHANCiAgICANCiAgICAjIC0tLSBBREQgTUFJTiBHUklEIENPTFVNTlMgLS0tDQogICAgJG1haW5HcmlkQ29scyA9IEAoDQogICAgICAgIChOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld1RleHRCb3hDb2x1bW4gLVByb3BlcnR5IEB7IE5hbWUgPSAnSW5kZXgnOyBIZWFkZXJUZXh0ID0gJyMnOyBGaWxsV2VpZ2h0ID0gODsgU29ydE1vZGUgPSAnTm90U29ydGFibGUnO30pLA0KICAgICAgICAoTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXdUZXh0Qm94Q29sdW1uIC1Qcm9wZXJ0eSBAeyBOYW1lID0gJ1RpdGVsJzsgSGVhZGVyVGV4dCA9ICdUaXRlbCc7IFNvcnRNb2RlID0gJ05vdFNvcnRhYmxlJzt9KSwNCiAgICAgICAgKE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3VGV4dEJveENvbHVtbiAtUHJvcGVydHkgQHsgTmFtZSA9ICdJRCc7IEhlYWRlclRleHQgPSAnSUQnOyBGaWxsV2VpZ2h0ID0gMjA7IFNvcnRNb2RlID0gJ05vdFNvcnRhYmxlJzt9KSwNCiAgICAgICAgKE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3VGV4dEJveENvbHVtbiAtUHJvcGVydHkgQHsgTmFtZSA9ICdTdGF0ZSc7IEhlYWRlclRleHQgPSAnU3RhdGUnOyBGaWxsV2VpZ2h0ID0gNDA7IFNvcnRNb2RlID0gJ05vdFNvcnRhYmxlJzt9KQ0KICAgICkNCiAgICAkRGF0YUdyaWRGaWxsZXIuQ29sdW1ucy5BZGRSYW5nZShbU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3Q29sdW1uW11dJG1haW5HcmlkQ29scykNCiAgICANCiAgICAjIFVTRSBDVVNUT00gVEVYVCBQUk9HUkVTUyBCQVINCiAgICAkcCA9IEB7IHR5cGU9J1RleHRQcm9ncmVzc0Jhcic7IHdpZHRoPTQ1MDsgaGVpZ2h0PTE4OyB0b3A9NDE1OyBsZWZ0PTEwOyBpZD0nR2xvYmFsUHJvZ3Jlc3NCYXInOyBzdHlsZT0nQ29udGludW91cyc7IHZpc2libGU9JGZhbHNlIH0NCiAgICAkR2xvYmFsUHJvZ3Jlc3NCYXIgPSBTZXQtVUlFbGVtZW50IEBwDQogICAgI2VuZHJlZ2lvbg0KDQogICAgI3JlZ2lvbiBTdGVwOiBTZXR0aW5ncyBGb3JtIHdpdGggVGFicw0KICAgICMgVVNFIENVU1RPTSBEQVJLIFRBQiBDT05UUk9MDQogICAgJHNldHRpbmdzVGFicyA9IE5ldy1PYmplY3QgQ3VzdG9tLkRhcmtUYWJDb250cm9sDQogICAgJHNldHRpbmdzVGFicy5Eb2NrID0gJ1RvcCcNCiAgICAkc2V0dGluZ3NUYWJzLkhlaWdodCA9IDQ4MA0KICAgICMgQ3VzdG9tIGNsYXNzIGhhbmRsZXMgYXBwZWFyYW5jZQ0KICAgIA0KICAgICR0YWJHZW5lcmFsID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5UYWJQYWdlICJHZW5lcmFsIg0KICAgICR0YWJHZW5lcmFsLkJhY2tDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDMwLCAzMCwgMzApDQogICAgDQogICAgJHRhYkxvZ2luU2V0dGluZ3MgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLlRhYlBhZ2UgIkxvZ2luIFNldHRpbmdzIg0KICAgICR0YWJMb2dpblNldHRpbmdzLkJhY2tDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDMwLCAzMCwgMzApDQogICAgJHRhYkxvZ2luU2V0dGluZ3MuQXV0b1Njcm9sbCA9ICR0cnVlIA0KICAgIA0KICAgICRzZXR0aW5nc1RhYnMuVGFiUGFnZXMuQWRkKCR0YWJHZW5lcmFsKQ0KICAgICRzZXR0aW5nc1RhYnMuVGFiUGFnZXMuQWRkKCR0YWJMb2dpblNldHRpbmdzKQ0KICAgICRzZXR0aW5nc0Zvcm0uQ29udHJvbHMuQWRkKCRzZXR0aW5nc1RhYnMpDQoNCiAgICAjIC0tLSBHRU5FUkFMIFRBQiBDT05UUk9MUyAtLS0NCiAgICAkcCA9IEB7IHR5cGU9J0xhYmVsJzsgd2lkdGg9ODU7IGhlaWdodD0yMDsgdG9wPTI1OyBsZWZ0PTIwOyBiZz1AKDMwLCAzMCwgMzAsIDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0nTGFiZWxMYXVuY2hlcic7IHRleHQ9J0xhdW5jaGVyIFBhdGg6JzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJGxibExhdW5jaGVyID0gU2V0LVVJRWxlbWVudCBAcA0KICAgICRwID0gQHsgdHlwZT0nVGV4dEJveCc7IHdpZHRoPTI1MDsgaGVpZ2h0PTMwOyB0b3A9NTA7IGxlZnQ9MjA7IGJnPUAoNDAsIDQwLCA0MCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdJbnB1dExhdW5jaGVyJzsgdGV4dD0nJzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJHR4dExhdW5jaGVyID0gU2V0LVVJRWxlbWVudCBAcA0KICAgICRwID0gQHsgdHlwZT0nQnV0dG9uJzsgd2lkdGg9NTU7IGhlaWdodD0yNTsgdG9wPTIwOyBsZWZ0PTExMDsgYmc9QCg0MCwgNDAsIDQwKTsgZmc9QCgyNDAsIDI0MCwgMjQwKTsgaWQ9J0Jyb3dzZSc7IHRleHQ9J0Jyb3dzZSc7IGZzPSdGbGF0JzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJGJ0bkJyb3dzZUxhdW5jaGVyID0gU2V0LVVJRWxlbWVudCBAcA0KICAgIA0KICAgICRwID0gQHsgdHlwZT0nTGFiZWwnOyB3aWR0aD04NTsgaGVpZ2h0PTIwOyB0b3A9OTU7IGxlZnQ9MjA7IGJnPUAoMzAsIDMwLCAzMCwgMCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdMYWJlbFByb2Nlc3MnOyB0ZXh0PSdQcm9jZXNzIE5hbWU6JzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJGxibFByb2Nlc3NOYW1lID0gU2V0LVVJRWxlbWVudCBAcA0KICAgICRwID0gQHsgdHlwZT0nVGV4dEJveCc7IHdpZHRoPTI1MDsgaGVpZ2h0PTMwOyB0b3A9MTIwOyBsZWZ0PTIwOyBiZz1AKDQwLCA0MCwgNDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0nSW5wdXRQcm9jZXNzJzsgdGV4dD0nJzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJHR4dFByb2Nlc3NOYW1lID0gU2V0LVVJRWxlbWVudCBAcA0KICAgIA0KICAgICRwID0gQHsgdHlwZT0nTGFiZWwnOyB3aWR0aD04NTsgaGVpZ2h0PTIwOyB0b3A9MTY1OyBsZWZ0PTIwOyBiZz1AKDMwLCAzMCwgMzAsIDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0nTGFiZWxNYXgnOyB0ZXh0PSdNYXggQ2xpZW50czonOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpIH0NCiAgICAkbGJsTWF4Q2xpZW50cyA9IFNldC1VSUVsZW1lbnQgQHANCiAgICAkcCA9IEB7IHR5cGU9J1RleHRCb3gnOyB3aWR0aD0yNTA7IGhlaWdodD0zMDsgdG9wPTE5MDsgbGVmdD0yMDsgYmc9QCg0MCwgNDAsIDQwKTsgZmc9QCgyNDAsIDI0MCwgMjQwKTsgaWQ9J0lucHV0TWF4JzsgdGV4dD0nJzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJHR4dE1heENsaWVudHMgPSBTZXQtVUlFbGVtZW50IEBwDQoNCiAgICAkcCA9IEB7IHR5cGU9J0NoZWNrQm94Jzsgd2lkdGg9MDsgaGVpZ2h0PTA7IHRvcD0yMzA7IGxlZnQ9MjA7IGJnPUAoMzAsIDMwLCAzMCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdIaWRlTWluaW1pemVkV2luZG93cyc7IHRleHQ9J0hpZGUgbWluaW1pemVkIGNsaWVudHMgZnJvbSBUYXNrYmFyIGFuZCBUYWIgVmlldyc7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkgfQ0KICAgICRjaGtIaWRlTWluaW1pemVkV2luZG93cyA9IFNldC1VSUVsZW1lbnQgQHANCiAgICAkcCA9IEB7IHR5cGU9J0NoZWNrQm94Jzsgd2lkdGg9MjAwOyBoZWlnaHQ9MjA7IHRvcD0yNTU7IGxlZnQ9MjA7IGJnPUAoMzAsIDMwLCAzMCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdOZXZlclJlc3RhcnRpbmdDb2xsZWN0b3JMb2dpbic7IHRleHQ9J0NvbGxlY3RvciBEb3VibGUgQ2xpY2snOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpIH0NCiAgICAkY2hrTmV2ZXJSZXN0YXJ0aW5nTG9naW4gPSBTZXQtVUlFbGVtZW50IEBwDQogICAgDQogICAgJHRhYkdlbmVyYWwuQ29udHJvbHMuQWRkUmFuZ2UoQCgkbGJsTGF1bmNoZXIsICR0eHRMYXVuY2hlciwgJGJ0bkJyb3dzZUxhdW5jaGVyLCAkbGJsUHJvY2Vzc05hbWUsICR0eHRQcm9jZXNzTmFtZSwgJGxibE1heENsaWVudHMsICR0eHRNYXhDbGllbnRzLCAkY2hrSGlkZU1pbmltaXplZFdpbmRvd3MsICRjaGtOZXZlclJlc3RhcnRpbmdMb2dpbikpDQoNCiAgICAjIC0tLSBMT0dJTiBTRVRUSU5HUyBUQUIgQ09OVFJPTFMgLS0tDQogICAgJFBpY2tlcnMgPSBAe30NCiAgICAkcm93WSA9IDEwDQogICAgDQogICAgJEFkZFBpY2tlclJvdyA9IHsNCiAgICAgICAgcGFyYW0oJExhYmVsVGV4dCwgJEtleU5hbWUsICRUb3AsICRDb2wpDQogICAgICAgICRsZWZ0T2Zmc2V0ID0gaWYoJENvbCAtZXEgMikgeyAzMDAgfSBlbHNlIHsgMTAgfQ0KICAgICAgICANCiAgICAgICAgJHAgPSBAeyB0eXBlPSdMYWJlbCc7IHdpZHRoPTEwMDsgaGVpZ2h0PTIwOyB0b3A9JFRvcDsgbGVmdD0kbGVmdE9mZnNldDsgYmc9QCgzMCwgMzAsIDMwLCAwKTsgZmc9QCgyNDAsIDI0MCwgMjQwKTsgdGV4dD0kTGFiZWxUZXh0OyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOCkpIH0NCiAgICAgICAgJGwgPSBTZXQtVUlFbGVtZW50IEBwDQogICAgICAgICRwID0gQHsgdHlwZT0nVGV4dEJveCc7IHdpZHRoPTgwOyBoZWlnaHQ9MjA7IHRvcD0kVG9wOyBsZWZ0PSgkbGVmdE9mZnNldCsxMDApOyBiZz1AKDQwLCA0MCwgNDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0idHh0JEtleU5hbWUiOyB0ZXh0PScwLDAnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOCkpIH0NCiAgICAgICAgJHQgPSBTZXQtVUlFbGVtZW50IEBwDQogICAgICAgICRwID0gQHsgdHlwZT0nQnV0dG9uJzsgd2lkdGg9NDA7IGhlaWdodD0yMDsgdG9wPSRUb3A7IGxlZnQ9KCRsZWZ0T2Zmc2V0KzE4NSk7IGJnPUAoNjAsIDYwLCAxMDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0iYnRuUGljayRLZXlOYW1lIjsgdGV4dD0nU2V0JzsgZnM9J0ZsYXQnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgNykpIH0NCiAgICAgICAgJGIgPSBTZXQtVUlFbGVtZW50IEBwDQogICAgICAgIHJldHVybiBAeyBMYWJlbD0kbDsgVGV4dD0kdDsgQnV0dG9uPSRiIH0NCiAgICB9DQoNCiAgICAjIExlZnQgQ29sdW1uOiBTZXJ2ZXJzICYgQ2hhbm5lbHMNCiAgICAkcCA9ICYkQWRkUGlja2VyUm93ICJTZXJ2ZXIgMToiICJTZXJ2ZXIxIiAkcm93WSAxOyAkdGFiTG9naW5TZXR0aW5ncy5Db250cm9scy5BZGRSYW5nZShAKCRwLkxhYmVsLCAkcC5UZXh0LCAkcC5CdXR0b24pKTsgJFBpY2tlcnNbIlNlcnZlcjEiXSA9ICRwDQogICAgJHAgPSAmJEFkZFBpY2tlclJvdyAiU2VydmVyIDI6IiAiU2VydmVyMiIgKCRyb3dZKzI1KSAxOyAkdGFiTG9naW5TZXR0aW5ncy5Db250cm9scy5BZGRSYW5nZShAKCRwLkxhYmVsLCAkcC5UZXh0LCAkcC5CdXR0b24pKTsgJFBpY2tlcnNbIlNlcnZlcjIiXSA9ICRwDQogICAgJHAgPSAmJEFkZFBpY2tlclJvdyAiQ2hhbm5lbCAxOiIgIkNoYW5uZWwxIiAoJHJvd1krNTApIDE7ICR0YWJMb2dpblNldHRpbmdzLkNvbnRyb2xzLkFkZFJhbmdlKEAoJHAuTGFiZWwsICRwLlRleHQsICRwLkJ1dHRvbikpOyAkUGlja2Vyc1siQ2hhbm5lbDEiXSA9ICRwDQogICAgJHAgPSAmJEFkZFBpY2tlclJvdyAiQ2hhbm5lbCAyOiIgIkNoYW5uZWwyIiAoJHJvd1krNzUpIDE7ICR0YWJMb2dpblNldHRpbmdzLkNvbnRyb2xzLkFkZFJhbmdlKEAoJHAuTGFiZWwsICRwLlRleHQsICRwLkJ1dHRvbikpOyAkUGlja2Vyc1siQ2hhbm5lbDIiXSA9ICRwDQogICAgDQogICAgIyBSaWdodCBDb2x1bW46IENoYXJhY3RlciBTbG90cw0KICAgICRwID0gJiRBZGRQaWNrZXJSb3cgIkNoYXIgU2xvdCAxOiIgIkNoYXIxIiAkcm93WSAyOyAkdGFiTG9naW5TZXR0aW5ncy5Db250cm9scy5BZGRSYW5nZShAKCRwLkxhYmVsLCAkcC5UZXh0LCAkcC5CdXR0b24pKTsgJFBpY2tlcnNbIkNoYXIxIl0gPSAkcA0KICAgICRwID0gJiRBZGRQaWNrZXJSb3cgIkNoYXIgU2xvdCAyOiIgIkNoYXIyIiAoJHJvd1krMjUpIDI7ICR0YWJMb2dpblNldHRpbmdzLkNvbnRyb2xzLkFkZFJhbmdlKEAoJHAuTGFiZWwsICRwLlRleHQsICRwLkJ1dHRvbikpOyAkUGlja2Vyc1siQ2hhcjIiXSA9ICRwDQogICAgJHAgPSAmJEFkZFBpY2tlclJvdyAiQ2hhciBTbG90IDM6IiAiQ2hhcjMiICgkcm93WSs1MCkgMjsgJHRhYkxvZ2luU2V0dGluZ3MuQ29udHJvbHMuQWRkUmFuZ2UoQCgkcC5MYWJlbCwgJHAuVGV4dCwgJHAuQnV0dG9uKSk7ICRQaWNrZXJzWyJDaGFyMyJdID0gJHANCg0KICAgICMgQ29sbGVjdG9yIFN0YXJ0IChSaWdodCBDb2x1bW4pDQogICAgJHAgPSAmJEFkZFBpY2tlclJvdyAiQ29sbGVjdG9yIFN0YXJ0OiIgIkNvbGxlY3RvclN0YXJ0IiAoJHJvd1krNzUpIDI7ICR0YWJMb2dpblNldHRpbmdzLkNvbnRyb2xzLkFkZFJhbmdlKEAoJHAuTGFiZWwsICRwLlRleHQsICRwLkJ1dHRvbikpOyAkUGlja2Vyc1siQ29sbGVjdG9yU3RhcnQiXSA9ICRwDQogICAgDQogICAgIyBQb3N0LUxvZ2luIERlbGF5IElucHV0DQogICAgJHAgPSBAeyB0eXBlPSdMYWJlbCc7IHdpZHRoPTE1MDsgaGVpZ2h0PTIwOyB0b3A9KCRyb3dZKzExMCk7IGxlZnQ9MjA7IGJnPUAoMzAsIDMwLCAzMCwgMCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IHRleHQ9IlBvc3QtTG9naW4gRGVsYXkgKHMpOiI7IGZvbnQ9KE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkgfQ0KICAgICRsYmxEZWxheSA9IFNldC1VSUVsZW1lbnQgQHANCiAgICAkcCA9IEB7IHR5cGU9J1RleHRCb3gnOyB3aWR0aD02MDsgaGVpZ2h0PTI1OyB0b3A9KCRyb3dZKzExMCk7IGxlZnQ9MTgwOyBiZz1AKDQwLCA0MCwgNDApOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0iSW5wdXRQb3N0TG9naW5EZWxheSI7IHRleHQ9JzEnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpIH0NCiAgICAkdHh0RGVsYXkgPSBTZXQtVUlFbGVtZW50IEBwDQogICAgJHRhYkxvZ2luU2V0dGluZ3MuQ29udHJvbHMuQWRkUmFuZ2UoQCgkbGJsRGVsYXksICR0eHREZWxheSkpDQoNCiAgICAjIDIuIENsaWVudCBDb25maWd1cmF0aW9uIEdyaWQNCiAgICAkZ3JpZFRvcCA9ICRyb3dZICsgMTQwDQogICAgJGdyaWRIZWlnaHQgPSAyOTANCiAgICANCiAgICAkcCA9IEB7IHR5cGU9J0RhdGFHcmlkVmlldyc7IHdpZHRoPTU2MDsgaGVpZ2h0PSRncmlkSGVpZ2h0OyB0b3A9JGdyaWRUb3A7IGxlZnQ9MTA7IGJnPUAoNDAsIDQwLCA0MCk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdMb2dpbkNvbmZpZ0dyaWQnOyB0ZXh0PScnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpIH0NCiAgICAkTG9naW5Db25maWdHcmlkID0gU2V0LVVJRWxlbWVudCBAcA0KICAgICRMb2dpbkNvbmZpZ0dyaWQuQWxsb3dVc2VyVG9BZGRSb3dzID0gJGZhbHNlDQogICAgJExvZ2luQ29uZmlnR3JpZC5Sb3dIZWFkZXJzVmlzaWJsZSA9ICRmYWxzZQ0KICAgICRMb2dpbkNvbmZpZ0dyaWQuRWRpdE1vZGUgPSAnRWRpdFByb2dyYW1tYXRpY2FsbHknDQogICAgJExvZ2luQ29uZmlnR3JpZC5TZWxlY3Rpb25Nb2RlID0gJ0NlbGxTZWxlY3QnDQogICAgJExvZ2luQ29uZmlnR3JpZC5BdXRvU2l6ZUNvbHVtbnNNb2RlID0gJ0ZpbGwnDQogICAgJExvZ2luQ29uZmlnR3JpZC5Db2x1bW5IZWFkZXJzSGVpZ2h0ID0gMzANCiAgICAkTG9naW5Db25maWdHcmlkLlJvd1RlbXBsYXRlLkhlaWdodCA9IDI1DQogICAgDQogICAgIyBEZWZpbmUgQ29sdW1ucw0KICAgICRjb2xDbGllbnQgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld1RleHRCb3hDb2x1bW4NCiAgICAkY29sQ2xpZW50LkhlYWRlclRleHQgPSAiQ2xpZW50ICMiOyAkY29sQ2xpZW50LkZpbGxXZWlnaHQgPSAxNTsgJGNvbENsaWVudC5SZWFkT25seSA9ICR0cnVlDQogICAgDQogICAgJGNvbFNydiA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3VGV4dEJveENvbHVtbg0KICAgICRjb2xTcnYuSGVhZGVyVGV4dCA9ICJTZXJ2ZXIiOyAkY29sU3J2LkZpbGxXZWlnaHQgPSAyMDsgJGNvbFNydi5SZWFkT25seSA9ICR0cnVlDQogICAgDQogICAgJGNvbENoID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXdUZXh0Qm94Q29sdW1uDQogICAgJGNvbENoLkhlYWRlclRleHQgPSAiQ2hhbm5lbCI7ICRjb2xDaC5GaWxsV2VpZ2h0ID0gMjA7ICRjb2xDaC5SZWFkT25seSA9ICR0cnVlDQoNCiAgICAkY29sQ2hhciA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3VGV4dEJveENvbHVtbg0KICAgICRjb2xDaGFyLkhlYWRlclRleHQgPSAiQ2hhcmFjdGVyIjsgJGNvbENoYXIuRmlsbFdlaWdodCA9IDI1OyAkY29sQ2hhci5SZWFkT25seSA9ICR0cnVlDQogICAgDQogICAgJGNvbENvbGwgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld1RleHRCb3hDb2x1bW4NCiAgICAkY29sQ29sbC5IZWFkZXJUZXh0ID0gIkNvbGxlY3RpbmciOyAkY29sQ29sbC5GaWxsV2VpZ2h0ID0gMjA7ICRjb2xDb2xsLlJlYWRPbmx5ID0gJHRydWUNCiAgICANCiAgICAkY29scyA9IEAoJGNvbENsaWVudCwgJGNvbFNydiwgJGNvbENoLCAkY29sQ2hhciwgJGNvbENvbGwpDQogICAgJExvZ2luQ29uZmlnR3JpZC5Db2x1bW5zLkFkZFJhbmdlKFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXdDb2x1bW5bXV0kY29scykNCiAgICANCiAgICAjIFBvcHVsYXRlIFJvd3MgKDEtMTApIHdpdGggZGVmYXVsdHMNCiAgICBmb3IgKCRpPTE7ICRpIC1sZSAxMDsgJGkrKykgew0KICAgICAgICAkTG9naW5Db25maWdHcmlkLlJvd3MuQWRkKCRpLCAiMSIsICIxIiwgIjEiLCAiTm8iKSB8IE91dC1OdWxsDQogICAgfQ0KICAgIA0KICAgICR0YWJMb2dpblNldHRpbmdzLkNvbnRyb2xzLkFkZCgkTG9naW5Db25maWdHcmlkKQ0KDQogICAgIyAtLS0gQk9UVE9NIEJVVFRPTlMgKE91dHNpZGUgVGFicykgLS0tDQogICAgJHAgPSBAeyB0eXBlPSdCdXR0b24nOyB3aWR0aD0xMjA7IGhlaWdodD00MDsgdG9wPTQ4MDsgbGVmdD0yMDsgYmc9QCgzNSwgMTc1LCA3NSk7IGZnPUAoMjQwLCAyNDAsIDI0MCk7IGlkPSdTYXZlJzsgdGV4dD0nU2F2ZSc7IGZzPSdGbGF0JzsgZm9udD0oTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKSB9DQogICAgJGJ0blNhdmUgPSBTZXQtVUlFbGVtZW50IEBwDQogICAgDQogICAgJHAgPSBAeyB0eXBlPSdCdXR0b24nOyB3aWR0aD0xMjA7IGhlaWdodD00MDsgdG9wPTQ4MDsgbGVmdD0xNTA7IGJnPUAoMjEwLCA0NSwgNDUpOyBmZz1AKDI0MCwgMjQwLCAyNDApOyBpZD0nQ2FuY2VsJzsgdGV4dD0nQ2FuY2VsJzsgZnM9J0ZsYXQnOyBmb250PShOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpIH0NCiAgICAkYnRuQ2FuY2VsID0gU2V0LVVJRWxlbWVudCBAcA0KICAgIA0KICAgICRzZXR0aW5nc0Zvcm0uQ29udHJvbHMuQWRkUmFuZ2UoQCgkYnRuU2F2ZSwgJGJ0bkNhbmNlbCkpDQogICAgI2VuZHJlZ2lvbg0KDQogICAgI3JlZ2lvbiBTdGVwOiBTZXQgVXAgQ29udHJvbCBIaWVyYXJjaHkNCiAgICAkbWFpbkZvcm0uQ29udHJvbHMuQWRkUmFuZ2UoQCgkdG9wQmFyLCAkYnRuTG9naW4sICRidG5GdG9vbCwgJGJ0bkxhdW5jaCwgJGJ0blNldHRpbmdzLCAkYnRuU3RvcCwgJERhdGFHcmlkTWFpbiwgJERhdGFHcmlkRmlsbGVyLCAkR2xvYmFsUHJvZ3Jlc3NCYXIpKQ0KICAgICR0b3BCYXIuQ29udHJvbHMuQWRkUmFuZ2UoQCgkdGl0bGVMYWJlbEZvcm0sICRjb3B5cmlnaHRMYWJlbEZvcm0sICRidG5NaW5pbWl6ZUZvcm0sICRidG5DbG9zZUZvcm0pKQ0KICAgIA0KICAgICMgR3JpZCBDb250ZXh0IE1lbnUNCiAgICAkY3R4TWVudSA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuQ29udGV4dE1lbnVTdHJpcA0KICAgICRpdG1Gcm9udCA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuVG9vbFN0cmlwTWVudUl0ZW0oJ1Nob3cnKQ0KICAgICRpdG1CYWNrID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5Ub29sU3RyaXBNZW51SXRlbSgnTWluaW1pemUnKQ0KICAgICRpdG1SZXNpemVDZW50ZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLlRvb2xTdHJpcE1lbnVJdGVtKCdSZXNpemUnKQ0KICAgICRjdHhNZW51Lkl0ZW1zLkFkZFJhbmdlKEAoJGl0bUZyb250LCAkaXRtQmFjaywgJGl0bVJlc2l6ZUNlbnRlcikpDQogICAgJERhdGFHcmlkTWFpbi5Db250ZXh0TWVudVN0cmlwID0gJGN0eE1lbnUNCiAgICAkRGF0YUdyaWRGaWxsZXIuQ29udGV4dE1lbnVTdHJpcCA9ICRjdHhNZW51DQoNCiAgICAjZW5kcmVnaW9uDQoNCiAgICAjcmVnaW9uIFN0ZXA6IEdsb2JhbCBVSSBPYmplY3QNCiAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSSA9IFtQU0N1c3RvbU9iamVjdF1Aew0KICAgICAgICBNYWluRm9ybSA9ICRtYWluRm9ybQ0KICAgICAgICBTZXR0aW5nc0Zvcm0gPSAkc2V0dGluZ3NGb3JtDQogICAgICAgIFRvcEJhciA9ICR0b3BCYXINCiAgICAgICAgQ2xvc2VGb3JtID0gJGJ0bkNsb3NlRm9ybQ0KICAgICAgICBNaW5Gb3JtID0gJGJ0bk1pbmltaXplRm9ybQ0KICAgICAgICBEYXRhR3JpZE1haW4gPSAkRGF0YUdyaWRNYWluDQogICAgICAgIERhdGFHcmlkRmlsbGVyID0gJERhdGFHcmlkRmlsbGVyDQogICAgICAgIEdsb2JhbFByb2dyZXNzQmFyID0gJEdsb2JhbFByb2dyZXNzQmFyDQogICAgICAgIExvZ2luQnV0dG9uID0gJGJ0bkxvZ2luDQogICAgICAgIEZ0b29sID0gJGJ0bkZ0b29sDQogICAgICAgIFNldHRpbmdzID0gJGJ0blNldHRpbmdzDQogICAgICAgIEV4aXQgPSAkYnRuU3RvcA0KICAgICAgICBMYXVuY2ggPSAkYnRuTGF1bmNoDQogICAgICAgIA0KICAgICAgICAjIEdlbmVyYWwgVGFiIElucHV0cw0KICAgICAgICBJbnB1dExhdW5jaGVyID0gJHR4dExhdW5jaGVyDQogICAgICAgIElucHV0UHJvY2VzcyA9ICR0eHRQcm9jZXNzTmFtZQ0KICAgICAgICBJbnB1dE1heCA9ICR0eHRNYXhDbGllbnRzDQogICAgICAgIEJyb3dzZSA9ICRidG5Ccm93c2VMYXVuY2hlcg0KICAgICAgICBOZXZlclJlc3RhcnRpbmdDb2xsZWN0b3JMb2dpbiA9ICRjaGtOZXZlclJlc3RhcnRpbmdMb2dpbg0KICAgICAgICBIaWRlTWluaW1pemVkV2luZG93cyA9ICRjaGtIaWRlTWluaW1pemVkV2luZG93cw0KICAgICAgICANCiAgICAgICAgIyBMb2dpbiBTZXR0aW5ncyBUYWIgSW5wdXRzDQogICAgICAgIExvZ2luQ29uZmlnR3JpZCA9ICRMb2dpbkNvbmZpZ0dyaWQNCiAgICAgICAgTG9naW5QaWNrZXJzID0gJFBpY2tlcnMNCiAgICAgICAgSW5wdXRQb3N0TG9naW5EZWxheSA9ICR0eHREZWxheQ0KICAgICAgICANCiAgICAgICAgU2F2ZSA9ICRidG5TYXZlDQogICAgICAgIENhbmNlbCA9ICRidG5DYW5jZWwNCiAgICAgICAgQ29udGV4dE1lbnVGcm9udCA9ICRpdG1Gcm9udA0KICAgICAgICBDb250ZXh0TWVudUJhY2sgPSAkaXRtQmFjaw0KICAgICAgICBDb250ZXh0TWVudVJlc2l6ZUFuZENlbnRlciA9ICRpdG1SZXNpemVDZW50ZXINCiAgICB9DQogICAgI2VuZHJlZ2lvbg0KDQogICAgUmVnaXN0ZXItVUlFdmVudEhhbmRsZXJzDQogICAgcmV0dXJuICR0cnVlDQp9DQoNCg0KI2VuZHJlZ2lvbiBGdW5jdGlvbjogSW5pdGlhbGl6ZS1VSQ0KDQojcmVnaW9uIEZ1bmN0aW9uOiBSZWdpc3Rlci1VSUV2ZW50SGFuZGxlcnMNCmZ1bmN0aW9uIFJlZ2lzdGVyLVVJRXZlbnRIYW5kbGVycw0KCXsNCgkJW0NtZGxldEJpbmRpbmcoKV0NCgkJcGFyYW0oKQ0KDQoJCWlmICgkbnVsbCAtZXEgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkpIHsgcmV0dXJuIH0NCg0KCQkkZXZlbnRNYXBwaW5ncyA9IEB7DQoJCQlNYWluRm9ybSA9IEB7DQoJCQkJTG9hZCA9IHsNCgkJCQkJCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUGF0aHMuSW5pKQ0KCQkJCQkJCXsNCgkJCQkJCQkJJGluaUV4aXN0cyA9IFRlc3QtUGF0aCAtUGF0aCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5QYXRocy5JbmkNCgkJCQkJCQkJaWYgKCRpbmlFeGlzdHMpDQoJCQkJCQkJCXsNCgkJCQkJCQkJCSRpbmlTZXR0aW5ncyA9IEdldC1JbmlGaWxlQ29udGVudCAtSW5pICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkluaQ0KCQkJCQkJCQkJaWYgKCRpbmlTZXR0aW5ncy5Db3VudCAtZ3QgMCkNCgkJCQkJCQkJCXsNCgkJCQkJCQkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcgPSAkaW5pU2V0dGluZ3MNCgkJCQkJCQkJCX0NCgkJCQkJCQkJfQ0KCQkJCQkJCQlTeW5jLUNvbmZpZ1RvVUkNCgkJCQkJCQl9DQoNCgkJCQkJCQkkc2NyaXB0OmluaXRpYWxDb250cm9sUHJvcHMgPSBAe30NCgkJCQkJCQkkc2NyaXB0OmluaXRpYWxGb3JtV2lkdGggPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5NYWluRm9ybS5XaWR0aA0KCQkJCQkJCSRzY3JpcHQ6aW5pdGlhbEZvcm1IZWlnaHQgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5NYWluRm9ybS5IZWlnaHQNCg0KCQkJCQkJCSRjb250cm9sc1RvU2NhbGUgPSBAKCdUb3BCYXInLCAnTG9naW4nLCAnRnRvb2wnLCAnU2V0dGluZ3MnLCAnRXhpdCcsICdMYXVuY2gnLCAnRGF0YUdyaWRNYWluJywgJ0RhdGFHcmlkRmlsbGVyJywgJ01pbkZvcm0nLCAnQ2xvc2VGb3JtJykNCg0KCQkJCQkJCWZvcmVhY2ggKCRjb250cm9sTmFtZSBpbiAkY29udHJvbHNUb1NjYWxlKQ0KCQkJCQkJCXsNCgkJCQkJCQkJJGNvbnRyb2wgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS4kY29udHJvbE5hbWUNCgkJCQkJCQkJaWYgKCRjb250cm9sKQ0KCQkJCQkJCQl7DQoJCQkJCQkJCQkkc2NyaXB0OmluaXRpYWxDb250cm9sUHJvcHNbJGNvbnRyb2xOYW1lXSA9IEB7DQoJCQkJCQkJCQkJTGVmdCAgICAgICAgICAgICA9ICRjb250cm9sLkxlZnQNCgkJCQkJCQkJCQlUb3AgICAgICAgICAgICAgID0gJGNvbnRyb2wuVG9wDQoJCQkJCQkJCQkJV2lkdGggICAgICAgICAgICA9ICRjb250cm9sLldpZHRoDQoJCQkJCQkJCQkJSGVpZ2h0ICAgICAgICAgICA9ICRjb250cm9sLkhlaWdodA0KCQkJCQkJCQkJCUlzU2NhbGFibGVCb3R0b20gPSAoJGNvbnRyb2xOYW1lIC1lcSAnRGF0YUdyaWRGaWxsZXInIC1vciAkY29udHJvbE5hbWUgLWVxICdEYXRhR3JpZE1haW4nKSANCgkJCQkJCQkJCX0NCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJU2hvd24gICAgICAgPSB7DQoJCQkJCQkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkRhdGFHcmlkRmlsbGVyKQ0KCQkJCQkJCXsNCgkJCQkJCQkJdHJ5IHsgU3RhcnQtRGF0YUdyaWRVcGRhdGVUaW1lciB9IGNhdGNoIHt9DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQlGb3JtQ2xvc2luZyA9IHsNCgkJCQkJCQlwYXJhbSgkc3JjLCAkZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFJlc3RvcmUgd2luZG93IHN0eWxlcyBiZWZvcmUgY2xvc2luZyB0byBwcmV2ZW50IG9ycGhhbmVkIHdpbmRvd3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoR2V0LUNvbW1hbmQgUmVzdG9yZS1XaW5kb3dTdHlsZXMgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpIHsgUmVzdG9yZS1XaW5kb3dTdHlsZXMgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChHZXQtQ29tbWFuZCBTdG9wLURhc2hib2FyZCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgeyBTdG9wLURhc2hib2FyZCB9DQoJCQkJCQl9DQoJCQkJCVJlc2l6ZSAgICAgID0gew0KCQkJCQkJCWlmICgtbm90ICRzY3JpcHQ6aW5pdGlhbENvbnRyb2xQcm9wcyAtb3IgLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSSkgeyByZXR1cm4gfQ0KDQoJCQkJCQkJJGN1cnJlbnRGb3JtV2lkdGggPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5NYWluRm9ybS5DbGllbnRTaXplLldpZHRoDQoJCQkJCQkJJGN1cnJlbnRGb3JtSGVpZ2h0ID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuTWFpbkZvcm0uQ2xpZW50U2l6ZS5IZWlnaHQNCgkJCQkJCQkkc2NhbGVXID0gJGN1cnJlbnRGb3JtV2lkdGggLyAkc2NyaXB0OmluaXRpYWxGb3JtV2lkdGgNCg0KCQkJCQkJCSRmaXhlZFRvcEhlaWdodCA9IDEyNQ0KCQkJCQkJCSRib3R0b21NYXJnaW4gPSAxMA0KDQoJCQkJCQkJZm9yZWFjaCAoJGNvbnRyb2xOYW1lIGluICRzY3JpcHQ6aW5pdGlhbENvbnRyb2xQcm9wcy5LZXlzKQ0KCQkJCQkJCXsNCgkJCQkJCQkJJGNvbnRyb2wgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS4kY29udHJvbE5hbWUNCgkJCQkJCQkJaWYgKCRjb250cm9sKQ0KCQkJCQkJCQl7DQoJCQkJCQkJCQkkaW5pdGlhbFByb3BzID0gJHNjcmlwdDppbml0aWFsQ29udHJvbFByb3BzWyRjb250cm9sTmFtZV0NCgkJCQkJCQkJCSRuZXdMZWZ0ID0gW2ludF0oJGluaXRpYWxQcm9wcy5MZWZ0ICogJHNjYWxlVykNCgkJCQkJCQkJCSRuZXdXaWR0aCA9IFtpbnRdKCRpbml0aWFsUHJvcHMuV2lkdGggKiAkc2NhbGVXKQ0KDQoJCQkJCQkJCQlpZiAoJGluaXRpYWxQcm9wcy5Jc1NjYWxhYmxlQm90dG9tKQ0KCQkJCQkJCQkJew0KCQkJCQkJCQkJCSRjb250cm9sLlRvcCA9ICRmaXhlZFRvcEhlaWdodA0KCQkJCQkJCQkJCSRjb250cm9sLkhlaWdodCA9IFtNYXRoXTo6TWF4KDEwMCwgJGN1cnJlbnRGb3JtSGVpZ2h0IC0gJGZpeGVkVG9wSGVpZ2h0IC0gJGJvdHRvbU1hcmdpbikNCgkJCQkJCQkJCX0NCgkJCQkJCQkJCWVsc2UNCgkJCQkJCQkJCXsNCgkJCQkJCQkJCQkkY29udHJvbC5Ub3AgPSAkaW5pdGlhbFByb3BzLlRvcA0KCQkJCQkJCQkJCSRjb250cm9sLkhlaWdodCA9ICRpbml0aWFsUHJvcHMuSGVpZ2h0DQoJCQkJCQkJCQl9DQoJCQkJCQkJCQkkY29udHJvbC5MZWZ0ID0gJG5ld0xlZnQNCgkJCQkJCQkJCSRjb250cm9sLldpZHRoID0gJG5ld1dpZHRoDQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJfQ0KICAgICAgICAgICAgICAgICMgQ0xJQ0sgSEFORExFUiBGT1IgU0VUVElOR1MgR1JJRA0KICAgICAgICAgICAgICAgIExvZ2luQ29uZmlnR3JpZCA9IEB7DQogICAgICAgICAgICAgICAgICAgIENlbGxDbGljayA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtKCRzLCAkZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZS5Sb3dJbmRleCAtbHQgMCkgeyByZXR1cm4gfQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAkcm93ID0gJHMuUm93c1skZS5Sb3dJbmRleF0NCiAgICAgICAgICAgICAgICAgICAgICAgICRjb2xJbmRleCA9ICRlLkNvbHVtbkluZGV4DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ29sIDE6IFNlcnZlcg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRjb2xJbmRleCAtZXEgMSkgeyAkcm93LkNlbGxzWzFdLlZhbHVlID0gaWYgKCRyb3cuQ2VsbHNbMV0uVmFsdWUgLWVxICIxIikgeyAiMiIgfSBlbHNlIHsgIjEiIH0gfQ0KICAgICAgICAgICAgICAgICAgICAgICAgIyBDb2wgMjogQ2hhbm5lbA0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmICgkY29sSW5kZXggLWVxIDIpIHsgJHJvdy5DZWxsc1syXS5WYWx1ZSA9IGlmICgkcm93LkNlbGxzWzJdLlZhbHVlIC1lcSAiMSIpIHsgIjIiIH0gZWxzZSB7ICIxIiB9IH0NCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ29sIDM6IENoYXINCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJGNvbEluZGV4IC1lcSAzKSB7ICRyb3cuQ2VsbHNbM10uVmFsdWUgPSBzd2l0Y2ggKCRyb3cuQ2VsbHNbM10uVmFsdWUpIHsgIjEiIHsiMiJ9OyAiMiIgeyIzIn07ICIzIiB7IjEifTsgZGVmYXVsdCB7IjEifSB9IH0NCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ29sIDQ6IENvbGxlY3Rvcj8gKFllcy9ObykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJGNvbEluZGV4IC1lcSA0KSB7ICRyb3cuQ2VsbHNbNF0uVmFsdWUgPSBpZiAoJHJvdy5DZWxsc1s0XS5WYWx1ZSAtZXEgIlllcyIpIHsgIk5vIiB9IGVsc2UgeyAiWWVzIiB9IH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIFNldHRpbmdzRm9ybSA9IEB7IExvYWQgPSB7IFN5bmMtQ29uZmlnVG9VSSB9IH0NCgkJCQlNaW5Gb3JtID0gQHsgQ2xpY2sgPSB7ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLk1haW5Gb3JtLldpbmRvd1N0YXRlID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkZvcm1XaW5kb3dTdGF0ZV06Ok1pbmltaXplZCB9IH0NCgkJCQlDbG9zZUZvcm0gPSBAeyBDbGljayA9IHsgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuTWFpbkZvcm0uQ2xvc2UoKSB9IH0NCgkJCQlUb3BCYXIgPSBAeyBNb3VzZURvd24gPSB7IHBhcmFtKCRzcmMsICRlKTsgW0N1c3RvbS5OYXRpdmVdOjpSZWxlYXNlQ2FwdHVyZSgpOyBbQ3VzdG9tLk5hdGl2ZV06OlNlbmRNZXNzYWdlKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLk1haW5Gb3JtLkhhbmRsZSwgMHhBMSwgMHgyLCAwKSB9IH0NCgkJCQlTZXR0aW5ncyA9IEB7IENsaWNrID0geyBTaG93LVNldHRpbmdzRm9ybSB9IH0NCgkJCQlTYXZlID0gQHsgQ2xpY2sgPSB7IFN5bmMtVUlUb0NvbmZpZzsgV3JpdGUtQ29uZmlnOyBIaWRlLVNldHRpbmdzRm9ybSB9IH0NCgkJCQlDYW5jZWwgPSBAeyBDbGljayA9IHsgSGlkZS1TZXR0aW5nc0Zvcm0gfSB9DQoJCQkJQnJvd3NlID0gQHsgQ2xpY2sgPSB7ICRkID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5PcGVuRmlsZURpYWxvZzsgJGQuRmlsdGVyID0gJ0V4ZWN1dGFibGUgRmlsZXMgKCouZXhlKXwqLmV4ZXxBbGwgRmlsZXMgKCouKil8Ki4qJzsgaWYgKCRkLlNob3dEaWFsb2coKSAtZXEgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRpYWxvZ1Jlc3VsdF06Ok9LKSB7ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLklucHV0TGF1bmNoZXIuVGV4dCA9ICRkLkZpbGVOYW1lIH0gfSB9DQogICAgICAgICAgICAgICAgRGF0YUdyaWRGaWxsZXIgPSBAew0KICAgICAgICAgICAgICAgICAgICBEb3VibGVDbGljayA9IHsgcGFyYW0oJHMsJGUpOyAkaD0kcy5IaXRUZXN0KCRlLlgsJGUuWSk7IGlmKCRoLlJvd0luZGV4IC1nZSAwIC1hbmQgJHMuUm93c1skaC5Sb3dJbmRleF0uVGFnKSB7IFtDdXN0b20uTmF0aXZlXTo6QnJpbmdUb0Zyb250KCRzLlJvd3NbJGguUm93SW5kZXhdLlRhZy5NYWluV2luZG93SGFuZGxlKSB9IH0NCiAgICAgICAgICAgICAgICAgICAgTW91c2VEb3duID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0oJHMsJGUpDQogICAgICAgICAgICAgICAgICAgICAgICAkaD0kcy5IaXRUZXN0KCRlLlgsJGUuWSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZS5CdXR0b24gLWVxICdSaWdodCcgLWFuZCAkaC5Sb3dJbmRleCAtZ2UgMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjbGlja2VkUm93ID0gJHMuUm93c1skaC5Sb3dJbmRleF0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE9ubHkgY2xlYXIgc2VsZWN0aW9uIGFuZCBzZWxlY3QgdGhlIGNsaWNrZWQgcm93IGlmIGl0J3MgTk9UIGFscmVhZHkgcGFydCBvZiB0aGUgc2VsZWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC1ub3QgJGNsaWNrZWRSb3cuU2VsZWN0ZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHMuQ2xlYXJTZWxlY3Rpb24oKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2xpY2tlZFJvdy5TZWxlY3RlZD0kdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBDb250ZXh0TWVudUZyb250ID0gQHsgQ2xpY2sgPSB7ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkRhdGFHcmlkRmlsbGVyLlNlbGVjdGVkUm93cyB8IEZvckVhY2gtT2JqZWN0IHsgW0N1c3RvbS5OYXRpdmVdOjpCcmluZ1RvRnJvbnQoJF8uVGFnLk1haW5XaW5kb3dIYW5kbGUpIH0gfSB9DQogICAgICAgICAgICAgICAgQ29udGV4dE1lbnVCYWNrID0gQHsgQ2xpY2sgPSB7ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkRhdGFHcmlkRmlsbGVyLlNlbGVjdGVkUm93cyB8IEZvckVhY2gtT2JqZWN0IHsgW0N1c3RvbS5OYXRpdmVdOjpTZW5kVG9CYWNrKCRfLlRhZy5NYWluV2luZG93SGFuZGxlKSB9IH0gfQ0KICAgICAgICAgICAgICAgIENvbnRleHRNZW51UmVzaXplQW5kQ2VudGVyID0gQHsgQ2xpY2sgPSB7ICRzY3I9W1N5c3RlbS5XaW5kb3dzLkZvcm1zLlNjcmVlbl06OlByaW1hcnlTY3JlZW4uV29ya2luZ0FyZWE7ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkRhdGFHcmlkRmlsbGVyLlNlbGVjdGVkUm93cyB8IEZvckVhY2gtT2JqZWN0IHsgW0N1c3RvbS5OYXRpdmVdOjpQb3NpdGlvbldpbmRvdygkXy5UYWcuTWFpbldpbmRvd0hhbmRsZSwgW0N1c3RvbS5OYXRpdmVdOjpUb3BXaW5kb3dIYW5kbGUsIFtpbnRdKCgkc2NyLldpZHRoLTEwNDApLzIpLCBbaW50XSgoJHNjci5IZWlnaHQtODA3KS8yKSwgMTA0MCwgODA3LCAweDAwMTApIH0gfSB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBMQVVOQ0ggQlVUVE9OIExPR0lDDQogICAgICAgICAgICAgICAgTGF1bmNoID0gQHsgDQogICAgICAgICAgICAgICAgICAgIENsaWNrID0geyANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5TdGF0ZS5MYXVuY2hBY3RpdmUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEFib3J0IGxvZ2ljDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsgU3RvcC1DbGllbnRMYXVuY2ggfSBjYXRjaCB7IFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94XTo6U2hvdygkXy5FeGNlcHRpb24uTWVzc2FnZSkgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFN0YXJ0IGxvZ2ljDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsgU3RhcnQtQ2xpZW50TGF1bmNoIH0gY2F0Y2ggeyBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIH0gDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICMgTE9HSU4gQlVUVE9OIExPR0lDDQogICAgICAgICAgICAgICAgTG9naW5CdXR0b24gPSBAew0KICAgICAgICAgICAgICAgICAgICBDbGljayA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBEeW5hbWljYWxseSBmaW5kIHRoZSBjb21tYW5kIHRvIGVuc3VyZSBpdCdzIGF2YWlsYWJsZSBiZWZvcmUgY2FsbGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2dpbkNvbW1hbmQgPSBHZXQtQ29tbWFuZCBMb2dpblNlbGVjdGVkUm93IC1FcnJvckFjdGlvbiBTdG9wDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDb25zdHJ1Y3QgdGhlIGxvZyBmaWxlIHBhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9nRmlsZVBhdGggPSAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydMYXVuY2hlclBhdGgnXVsnTGF1bmNoZXJQYXRoJ10gLXJlcGxhY2UgJ1xcTGF1bmNoZXJcLmV4ZSQnLCcnKSArICJcTG9nXG5ldHdvcmtfJChHZXQtRGF0ZSAtZiAneXl5eU1NZGQnKS5sb2ciDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBFeGVjdXRlIHRoZSBsb2dpbiBjb21tYW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiAkbG9naW5Db21tYW5kIC1Mb2dGaWxlUGF0aCAkbG9nRmlsZVBhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFByb3ZpZGUgZGV0YWlsZWQgZmVlZGJhY2sgaWYgdGhlIGNvbW1hbmQgZmFpbHMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXJyb3JNZXNzYWdlID0gIkxvZ2luIGFjdGlvbiBmYWlsZWQuYG5gbkNvdWxkIG5vdCBmaW5kIG9yIGV4ZWN1dGUgdGhlICdMb2dpblNlbGVjdGVkUm93JyBmdW5jdGlvbi4gVGhlICdsb2dpbi5wc20xJyBtb2R1bGUgbWF5IGhhdmUgZmFpbGVkIHRvIGxvYWQgY29ycmVjdGx5LmBuYG5UZWNobmljYWwgRGV0YWlsczogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBBdHRlbXB0IHRvIHVzZSB0aGUgYXBwbGljYXRpb24ncyBzdGFuZGFyZCBlcnJvciBkaWFsb2cNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93LUVycm9yRGlhbG9nIC1NZXNzYWdlICRlcnJvck1lc3NhZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjayB0byBhIHN0YW5kYXJkIFdpbmRvd3MgRm9ybXMgTWVzc2FnZUJveCBpZiB0aGUgY3VzdG9tIGRpYWxvZyBpcyBhbHNvIHVuYXZhaWxhYmxlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coJGVycm9yTWVzc2FnZSwgJ0xvZ2luIEVycm9yJywgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hCdXR0b25zXTo6T0ssIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94SWNvbl06OkVycm9yKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgCUZ0b29sID0gQHsgQ2xpY2sgPSB7IGlmKEdldC1Db21tYW5kIEZ0b29sU2VsZWN0ZWRSb3cgLUVBIDApeyAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5EYXRhR3JpZEZpbGxlci5TZWxlY3RlZFJvd3MgfCBGb3JFYWNoLU9iamVjdCB7IEZ0b29sU2VsZWN0ZWRSb3cgJF8gfSB9IH0gfQ0KICAgICAgICAgICAgRXhpdCA9IEB7IENsaWNrID0geyBpZihbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coIlRlcm1pbmF0ZSBzZWxlY3RlZD8iLCJDb25maXJtIixbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveEJ1dHRvbnNdOjpZZXNObykgLWVxICdZZXMnKXsgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuRGF0YUdyaWRGaWxsZXIuU2VsZWN0ZWRSb3dzIHwgRm9yRWFjaC1PYmplY3QgeyBTdG9wLVByb2Nlc3MgLUlkICRfLlRhZy5JZCAtRm9yY2UgLUVBIDAgfSB9IH0gfQ0KCQl9DQoNCiAgICAgICAgIyBEWU5BTUlDIEVWRU5UIFJFR0lTVFJBVElPTiBGT1IgUElDS0VSUw0KICAgICAgICAkcGlja2VycyA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkxvZ2luUGlja2Vycw0KICAgICAgICBpZiAoJHBpY2tlcnMpIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKCRrZXkgaW4gJHBpY2tlcnMuS2V5cykgew0KICAgICAgICAgICAgICAgICRidG4gPSAkcGlja2Vyc1ska2V5XS5CdXR0b24NCiAgICAgICAgICAgICAgICAkdHh0ID0gJHBpY2tlcnNbJGtleV0uVGV4dA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRhY3Rpb24gPSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmFtKCRzLCAkZSkNCiAgICAgICAgICAgICAgICAgICAgJHRhcmdldFR4dCA9ICRzLlRhZyANCiAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuU2V0dGluZ3NGb3JtLlZpc2libGUgPSAkZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hdOjpTaG93KCIxLiBGb2N1cyBjbGllbnQuYG4yLiBIb3ZlciB0YXJnZXQuYG4zLiBXYWl0IDNzLmBuYG5DbGljayBPSy4iLCAiUGlja2VyIikNCiAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMw0KICAgICAgICAgICAgICAgICAgICAkY3Vyc29yUG9zID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkN1cnNvcl06OlBvc2l0aW9uDQogICAgICAgICAgICAgICAgICAgICRoV25kID0gW0N1c3RvbS5OYXRpdmVdOjpHZXRGb3JlZ3JvdW5kV2luZG93KCkNCiAgICAgICAgICAgICAgICAgICAgJHJlY3QgPSBOZXctT2JqZWN0IEN1c3RvbS5OYXRpdmUrUkVDVA0KICAgICAgICAgICAgICAgICAgICBpZiAoW0N1c3RvbS5OYXRpdmVdOjpHZXRXaW5kb3dSZWN0KCRoV25kLCBbcmVmXSRyZWN0KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJHJlbFggPSAkY3Vyc29yUG9zLlggLSAkcmVjdC5MZWZ0DQogICAgICAgICAgICAgICAgICAgICAgICAkcmVsWSA9ICRjdXJzb3JQb3MuWSAtICRyZWN0LlRvcA0KICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFR4dC5UZXh0ID0gIiRyZWxYLCRyZWxZIg0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFR4dC5UZXh0ID0gIkVycm9yIg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLlNldHRpbmdzRm9ybS5WaXNpYmxlID0gJHRydWUNCiAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuU2V0dGluZ3NGb3JtLkJyaW5nVG9Gcm9udCgpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRidG4uVGFnID0gJHR4dA0KICAgICAgICAgICAgICAgICRzb3VyY2VJZGVudGlmaWVyID0gIkVudHJvcGlhRGFzaGJvYXJkLlBpY2tlci4ka2V5Ig0KICAgICAgICAgICAgICAgIEdldC1FdmVudFN1YnNjcmliZXIgLVNvdXJjZUlkZW50aWZpZXIgJHNvdXJjZUlkZW50aWZpZXIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgfCBVbnJlZ2lzdGVyLUV2ZW50DQogICAgICAgICAgICAgICAgUmVnaXN0ZXItT2JqZWN0RXZlbnQgLUlucHV0T2JqZWN0ICRidG4gLUV2ZW50TmFtZSBDbGljayAtQWN0aW9uICRhY3Rpb24gLVNvdXJjZUlkZW50aWZpZXIgJHNvdXJjZUlkZW50aWZpZXIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoJCWZvcmVhY2ggKCRlbGVtZW50TmFtZSBpbiAkZXZlbnRNYXBwaW5ncy5LZXlzKQ0KCQl7DQoJCQkkZWxlbWVudCA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLiRlbGVtZW50TmFtZQ0KCQkJaWYgKCRlbGVtZW50KQ0KCQkJew0KCQkJCWZvcmVhY2ggKCRlIGluICRldmVudE1hcHBpbmdzWyRlbGVtZW50TmFtZV0uS2V5cykNCgkJCQl7DQoJCQkJCSRzb3VyY2VJZGVudGlmaWVyID0gIkVudHJvcGlhRGFzaGJvYXJkLiRlbGVtZW50TmFtZS4kZSINCgkJCQkJR2V0LUV2ZW50U3Vic2NyaWJlciAtU291cmNlSWRlbnRpZmllciAkc291cmNlSWRlbnRpZmllciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IFVucmVnaXN0ZXItRXZlbnQNCgkJCQkJUmVnaXN0ZXItT2JqZWN0RXZlbnQgLUlucHV0T2JqZWN0ICRlbGVtZW50IC1FdmVudE5hbWUgJGUgLUFjdGlvbiAkZXZlbnRNYXBwaW5nc1skZWxlbWVudE5hbWVdWyRlXSAtU291cmNlSWRlbnRpZmllciAkc291cmNlSWRlbnRpZmllciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlN0YXRlLlVJSW5pdGlhbGl6ZWQgPSAkdHJ1ZQ0KCX0NCg0KDQoNCiNlbmRyZWdpb24gRnVuY3Rpb246IFJlZ2lzdGVyLVVJRXZlbnRIYW5kbGVycw0KDQojcmVnaW9uIEZ1bmN0aW9uOiBTaG93LVNldHRpbmdzRm9ybQ0KCWZ1bmN0aW9uIFNob3ctU2V0dGluZ3NGb3JtDQoJew0KCQk8Iw0KCQkuU1lOT1BTSVMNCgkJCVNob3dzIHRoZSBzZXR0aW5ncyBmb3JtIHdpdGggYSBmYWRlLWluIGFuaW1hdGlvbiBlZmZlY3QuDQoJCSM+DQoJCVtDbWRsZXRCaW5kaW5nKCldDQoJCXBhcmFtKCkNCg0KCQkjcmVnaW9uIFN0ZXA6IFByZXZlbnQgQ29uY3VycmVudCBBbmltYXRpb25zDQoJCQlpZiAoKCRzY3JpcHQ6ZmFkZUluVGltZXIgLWFuZCAkc2NyaXB0OmZhZGVJblRpbWVyLkVuYWJsZWQpIC1vcg0KCQkJCSgkZ2xvYmFsOmZhZGVPdXRUaW1lciAtYW5kICRnbG9iYWw6ZmFkZU91dFRpbWVyLkVuYWJsZWQpKQ0KCQkJew0KCQkJCXJldHVybiAjIEV4aXQgaWYgYW4gYW5pbWF0aW9uIGlzIGFjdGl2ZQ0KCQkJfQ0KCQkjZW5kcmVnaW9uIFN0ZXA6IFByZXZlbnQgQ29uY3VycmVudCBBbmltYXRpb25zDQoNCgkJI3JlZ2lvbiBTdGVwOiBWYWxpZGF0ZSBVSSBPYmplY3RzDQoJCQlpZiAoLW5vdCAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5TZXR0aW5nc0Zvcm0gLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5NYWluRm9ybSkpDQoJCQl7DQoJCQkJcmV0dXJuDQoJCQl9DQoJCSNlbmRyZWdpb24gU3RlcDogVmFsaWRhdGUgVUkgT2JqZWN0cw0KDQoJCSRzZXR0aW5nc0Zvcm0gPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5TZXR0aW5nc0Zvcm0NCg0KCQkjcmVnaW9uIFN0ZXA6IFBvc2l0aW9uIGFuZCBTaG93IFNldHRpbmdzIEZvcm0NCgkJCWlmICgkc2V0dGluZ3NGb3JtLk9wYWNpdHkgLWx0IDAuOTUpDQoJCQl7DQoJCQkJJHNldHRpbmdzRm9ybS5WaXNpYmxlID0gJHRydWUNCgkJCQkkbWFpbkZvcm1Mb2NhdGlvbiA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLk1haW5Gb3JtLkxvY2F0aW9uDQoJCQkJJHNldHRpbmdzRm9ybVdpZHRoID0gJHNldHRpbmdzRm9ybS5XaWR0aA0KCQkJCSRzZXR0aW5nc0Zvcm1IZWlnaHQgPSAkc2V0dGluZ3NGb3JtLkhlaWdodA0KCQkJCSRzY3JlZW5XaWR0aCA9IFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5TY3JlZW5dOjpQcmltYXJ5U2NyZWVuLldvcmtpbmdBcmVhLldpZHRoDQoJCQkJJHNjcmVlbkhlaWdodCA9IFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5TY3JlZW5dOjpQcmltYXJ5U2NyZWVuLldvcmtpbmdBcmVhLkhlaWdodA0KDQoJCQkJJHggPSAkbWFpbkZvcm1Mb2NhdGlvbi5YICsgKCgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5NYWluRm9ybS5XaWR0aCAtICRzZXR0aW5nc0Zvcm1XaWR0aCkgLyAyKQ0KCQkJCSR5ID0gJG1haW5Gb3JtTG9jYXRpb24uWSArICgoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuTWFpbkZvcm0uSGVpZ2h0IC0gJHNldHRpbmdzRm9ybUhlaWdodCkgLyAyKQ0KDQoJCQkJJG1hcmdpbiA9IDANCgkJCQkkeCA9IFtNYXRoXTo6TWF4KCRtYXJnaW4sIFtNYXRoXTo6TWluKCR4LCAkc2NyZWVuV2lkdGggLSAkc2V0dGluZ3NGb3JtV2lkdGggLSAkbWFyZ2luKSkNCgkJCQkkeSA9IFtNYXRoXTo6TWF4KCRtYXJnaW4sIFtNYXRoXTo6TWluKCR5LCAkc2NyZWVuSGVpZ2h0IC0gJHNldHRpbmdzRm9ybUhlaWdodCAtICRtYXJnaW4pKQ0KDQoJCQkJJHNldHRpbmdzRm9ybS5Mb2NhdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuUG9pbnQoJHgsICR5KQ0KCQkJCSRzZXR0aW5nc0Zvcm0uQnJpbmdUb0Zyb250KCkNCgkJCQkkc2V0dGluZ3NGb3JtLkFjdGl2YXRlKCkNCgkJCX0NCgkJI2VuZHJlZ2lvbiBTdGVwOiBQb3NpdGlvbiBhbmQgU2hvdyBTZXR0aW5ncyBGb3JtDQoNCgkJI3JlZ2lvbiBTdGVwOiBDcmVhdGUgYW5kIFN0YXJ0IEZhZGUtSW4gQW5pbWF0aW9uIFRpbWVyDQoJCQlpZiAoJHNjcmlwdDpmYWRlSW5UaW1lcikgeyAkc2NyaXB0OmZhZGVJblRpbWVyLkRpc3Bvc2UoKSB9DQoJCQkkc2NyaXB0OmZhZGVJblRpbWVyID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5UaW1lcg0KCQkJJHNjcmlwdDpmYWRlSW5UaW1lci5JbnRlcnZhbCA9IDE1IA0KCQkJJHNjcmlwdDpmYWRlSW5UaW1lci5BZGRfVGljayh7DQoJCQkJCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLlNldHRpbmdzRm9ybSAtb3IgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuU2V0dGluZ3NGb3JtLklzRGlzcG9zZWQpDQoJCQkJCXsNCgkJCQkJCSRzY3JpcHQ6ZmFkZUluVGltZXIuU3RvcCgpDQoJCQkJCQkkc2NyaXB0OmZhZGVJblRpbWVyLkRpc3Bvc2UoKQ0KCQkJCQkJJHNjcmlwdDpmYWRlSW5UaW1lciA9ICRudWxsDQoJCQkJCQlyZXR1cm4NCgkJCQkJfQ0KCQkJCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuU2V0dGluZ3NGb3JtLk9wYWNpdHkgLWx0IDEpDQoJCQkJCXsNCgkJCQkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLlNldHRpbmdzRm9ybS5PcGFjaXR5ICs9IDAuMQ0KCQkJCQl9DQoJCQkJCWVsc2UNCgkJCQkJew0KCQkJCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuU2V0dGluZ3NGb3JtLk9wYWNpdHkgPSAxIA0KCQkJCQkJJHNjcmlwdDpmYWRlSW5UaW1lci5TdG9wKCkNCgkJCQkJCSRzY3JpcHQ6ZmFkZUluVGltZXIuRGlzcG9zZSgpDQoJCQkJCQkkc2NyaXB0OmZhZGVJblRpbWVyID0gJG51bGwNCgkJCQkJfQ0KCQkJCX0pDQoJCQkkc2NyaXB0OmZhZGVJblRpbWVyLlN0YXJ0KCkNCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnNbJ2ZhZGVJblRpbWVyJ10gPSAkc2NyaXB0OmZhZGVJblRpbWVyDQoJCSNlbmRyZWdpb24gU3RlcDogQ3JlYXRlIGFuZCBTdGFydCBGYWRlLUluIEFuaW1hdGlvbiBUaW1lcg0KCX0NCiNlbmRyZWdpb24gRnVuY3Rpb246IFNob3ctU2V0dGluZ3NGb3JtDQoNCiNyZWdpb24gRnVuY3Rpb246IEhpZGUtU2V0dGluZ3NGb3JtDQoJZnVuY3Rpb24gSGlkZS1TZXR0aW5nc0Zvcm0NCgl7DQoJCTwjDQoJCS5TWU5PUFNJUw0KCQkJSGlkZXMgdGhlIHNldHRpbmdzIGZvcm0gd2l0aCBhIGZhZGUtb3V0IGFuaW1hdGlvbiBlZmZlY3QuDQoJCSM+DQoJCVtDbWRsZXRCaW5kaW5nKCldDQoJCXBhcmFtKCkNCg0KCQkjcmVnaW9uIFN0ZXA6IFByZXZlbnQgQ29uY3VycmVudCBBbmltYXRpb25zDQoJCQlpZiAoKCRzY3JpcHQ6ZmFkZUluVGltZXIgLWFuZCAkc2NyaXB0OmZhZGVJblRpbWVyLkVuYWJsZWQpIC1vcg0KCQkJCSgkZ2xvYmFsOmZhZGVPdXRUaW1lciAtYW5kICRnbG9iYWw6ZmFkZU91dFRpbWVyLkVuYWJsZWQpKQ0KCQkJew0KCQkJCXJldHVybiANCgkJCX0NCgkJI2VuZHJlZ2lvbiBTdGVwOiBQcmV2ZW50IENvbmN1cnJlbnQgQW5pbWF0aW9ucw0KDQoJCSNyZWdpb24gU3RlcDogVmFsaWRhdGUgVUkgT2JqZWN0cw0KCQkJaWYgKC1ub3QgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJIC1hbmQgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuU2V0dGluZ3NGb3JtKSkNCgkJCXsNCgkJCQlyZXR1cm4NCgkJCX0NCgkJI2VuZHJlZ2lvbiBTdGVwOiBWYWxpZGF0ZSBVSSBPYmplY3RzDQoNCgkJI3JlZ2lvbiBTdGVwOiBDcmVhdGUgYW5kIFN0YXJ0IEZhZGUtT3V0IEFuaW1hdGlvbiBUaW1lcg0KCQkJaWYgKCRnbG9iYWw6ZmFkZU91dFRpbWVyKSB7ICRnbG9iYWw6ZmFkZU91dFRpbWVyLkRpc3Bvc2UoKSB9DQoJCQkkZ2xvYmFsOmZhZGVPdXRUaW1lciA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuVGltZXINCgkJCSRnbG9iYWw6ZmFkZU91dFRpbWVyLkludGVydmFsID0gMTUNCgkJCSRnbG9iYWw6ZmFkZU91dFRpbWVyLkFkZF9UaWNrKHsNCgkJCQkJaWYgKC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuU2V0dGluZ3NGb3JtIC1vciAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5TZXR0aW5nc0Zvcm0uSXNEaXNwb3NlZCkNCgkJCQkJew0KCQkJCQkJJGdsb2JhbDpmYWRlT3V0VGltZXIuU3RvcCgpDQoJCQkJCQkkZ2xvYmFsOmZhZGVPdXRUaW1lci5EaXNwb3NlKCkNCgkJCQkJCSRnbG9iYWw6ZmFkZU91dFRpbWVyID0gJG51bGwNCgkJCQkJCXJldHVybg0KCQkJCQl9DQoNCgkJCQkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLlNldHRpbmdzRm9ybS5PcGFjaXR5IC1ndCAwKQ0KCQkJCQl7DQoJCQkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5TZXR0aW5nc0Zvcm0uT3BhY2l0eSAtPSAwLjENCgkJCQkJfQ0KCQkJCQllbHNlDQoJCQkJCXsNCgkJCQkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLlNldHRpbmdzRm9ybS5PcGFjaXR5ID0gMCANCgkJCQkJCSRnbG9iYWw6ZmFkZU91dFRpbWVyLlN0b3AoKQ0KCQkJCQkJJGdsb2JhbDpmYWRlT3V0VGltZXIuRGlzcG9zZSgpDQoJCQkJCQkkZ2xvYmFsOmZhZGVPdXRUaW1lciA9ICRudWxsDQoJCQkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5TZXR0aW5nc0Zvcm0uSGlkZSgpDQoJCQkJCX0NCgkJCQl9KQ0KCQkJJGdsb2JhbDpmYWRlT3V0VGltZXIuU3RhcnQoKQ0KCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVyc1snZmFkZU91dFRpbWVyJ10gPSAkZ2xvYmFsOmZhZGVPdXRUaW1lcg0KCQkjZW5kcmVnaW9uIFN0ZXA6IENyZWF0ZSBhbmQgU3RhcnQgRmFkZS1PdXQgQW5pbWF0aW9uIFRpbWVyDQoJfQ0KI2VuZHJlZ2lvbiBGdW5jdGlvbjogSGlkZS1TZXR0aW5nc0Zvcm0NCg0KI3JlZ2lvbiBGdW5jdGlvbjogU2V0LVVJRWxlbWVudA0KZnVuY3Rpb24gU2V0LVVJRWxlbWVudA0KCXsNCgkJW0NtZGxldEJpbmRpbmcoKV0NCgkJcGFyYW0oDQoJCQlbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldDQoJCQlbVmFsaWRhdGVTZXQoJ0Zvcm0nLCAnUGFuZWwnLCAnQnV0dG9uJywgJ0xhYmVsJywgJ0RhdGFHcmlkVmlldycsICdUZXh0Qm94JywgJ0NvbWJvQm94JywgJ0NoZWNrQm94JywgJ1RvZ2dsZScsICdQcm9ncmVzc0JhcicsICdUZXh0UHJvZ3Jlc3NCYXInKV0NCgkJCVtzdHJpbmddJHR5cGUsDQoJCQlbYm9vbF0kdmlzaWJsZSwNCgkJCVtpbnRdJHdpZHRoLA0KCQkJW2ludF0kaGVpZ2h0LA0KCQkJW2ludF0kdG9wLA0KCQkJW2ludF0kbGVmdCwNCgkJCVthcnJheV0kYmcsDQoJCQlbYXJyYXldJGZnLA0KCQkJW3N0cmluZ10kaWQsDQoJCQlbc3RyaW5nXSR0ZXh0LA0KCQkJW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkZsYXRTdHlsZV0kZnMsDQoJCQlbU3lzdGVtLkRyYXdpbmcuRm9udF0kZm9udCwNCgkJCVtzdHJpbmddJHN0YXJ0UG9zaXRpb24sDQoJCQlbaW50XSRmb3JtQm9yZGVyU3R5bGUgPSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRm9ybUJvcmRlclN0eWxlXTo6Tm9uZSwNCgkJCVtkb3VibGVdJG9wYWNpdHkgPSAxLjAsDQoJCQlbYm9vbF0kdG9wTW9zdCwNCiAgICAgICAgICAgIFtib29sXSRjaGVja2VkLA0KCQkJW3N3aXRjaF0kbXVsdGlsaW5lLA0KCQkJW3N3aXRjaF0kcmVhZE9ubHksDQoJCQlbc3dpdGNoXSRzY3JvbGxCYXJzLA0KCQkJW1ZhbGlkYXRlU2V0KCdTaW1wbGUnLCAnRHJvcERvd24nLCAnRHJvcERvd25MaXN0JyldDQoJCQlbc3RyaW5nXSRkcm9wRG93blN0eWxlID0gJ0Ryb3BEb3duTGlzdCcsDQogICAgICAgICAgICBbVmFsaWRhdGVTZXQoJ0Jsb2NrcycsICdDb250aW51b3VzJywgJ01hcnF1ZWUnKV0NCiAgICAgICAgICAgIFtzdHJpbmddJHN0eWxlID0gJ0NvbnRpbnVvdXMnDQoJCSkNCg0KCQkjcmVnaW9uIFN0ZXA6IENyZWF0ZSBVSSBFbGVtZW50IEJhc2VkIG9uIFR5cGUNCgkJCSRlbCA9IHN3aXRjaCAoJHR5cGUpDQoJCQl7DQoJCQkJJ0Zvcm0nICAgICAgICAgICAgeyBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkZvcm0gfQ0KCQkJCSdQYW5lbCcgICAgICAgICAgIHsgTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5QYW5lbCB9DQoJCQkJJ0J1dHRvbicgICAgICAgICAgeyBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkJ1dHRvbiB9DQoJCQkJJ0xhYmVsJyAgICAgICAgICAgeyBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkxhYmVsIH0NCgkJCQknRGF0YUdyaWRWaWV3JyAgICB7IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3IH0NCgkJCQknVGV4dEJveCcgICAgICAgICB7IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuVGV4dEJveCB9DQoJCQkJJ0NvbWJvQm94JyAgICAgICAgeyBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkNvbWJvQm94IH0NCgkJCQknQ2hlY2tCb3gnICAgICAgICB7IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuQ2hlY2tCb3ggfQ0KCQkJCSdUb2dnbGUnICAgICAgICAgIHsgTmV3LU9iamVjdCBDdXN0b20uVG9nZ2xlIH0NCiAgICAgICAgICAgICAgICAnUHJvZ3Jlc3NCYXInICAgICB7IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuUHJvZ3Jlc3NCYXIgfQ0KICAgICAgICAgICAgICAgICdUZXh0UHJvZ3Jlc3NCYXInIHsgTmV3LU9iamVjdCBDdXN0b20uVGV4dFByb2dyZXNzQmFyIH0NCgkJCQlkZWZhdWx0ICAgICAgICAgICB7IHRocm93ICJJbnZhbGlkIGVsZW1lbnQgdHlwZSBzcGVjaWZpZWQ6ICR0eXBlIiB9DQoJCQl9DQoJCSNlbmRyZWdpb24gU3RlcDogQ3JlYXRlIFVJIEVsZW1lbnQgQmFzZWQgb24gVHlwZQ0KDQoJCSNyZWdpb24gU3RlcDogQ29uZmlndXJlIERhdGFHcmlkVmlldyBTcGVjaWZpYyBQcm9wZXJ0aWVzDQoJCQlpZiAoJHR5cGUgLWVxICdEYXRhR3JpZFZpZXcnKQ0KCQkJew0KCQkJCSRlbC5BbGxvd1VzZXJUb0FkZFJvd3MgPSAkZmFsc2UNCgkJCQkkZWwuUmVhZE9ubHkgPSAkZmFsc2UNCgkJCQkkZWwuQWxsb3dVc2VyVG9PcmRlckNvbHVtbnMgPSAkdHJ1ZQ0KCQkJCSRlbC5BbGxvd1VzZXJUb1Jlc2l6ZUNvbHVtbnMgID0gJGZhbHNlDQoJCQkJJGVsLkFsbG93VXNlclRvUmVzaXplUm93cyA9ICRmYWxzZQ0KCQkJCSRlbC5Sb3dIZWFkZXJzVmlzaWJsZSA9ICRmYWxzZQ0KCQkJCSRlbC5NdWx0aVNlbGVjdCA9ICR0cnVlDQoJCQkJJGVsLlNlbGVjdGlvbk1vZGUgPSAnRnVsbFJvd1NlbGVjdCcNCgkJCQkkZWwuQXV0b1NpemVDb2x1bW5zTW9kZSA9ICdGaWxsJw0KCQkJCSRlbC5Cb3JkZXJTdHlsZSA9ICdGaXhlZFNpbmdsZScNCgkJCQkkZWwuRW5hYmxlSGVhZGVyc1Zpc3VhbFN0eWxlcyA9ICRmYWxzZQ0KCQkJCSRlbC5DZWxsQm9yZGVyU3R5bGUgPSAnU2luZ2xlSG9yaXpvbnRhbCcNCgkJCQkkZWwuQ29sdW1uSGVhZGVyc0JvcmRlclN0eWxlID0gJ1NpbmdsZScNCgkJCQkkZWwuRWRpdE1vZGUgPSAnRWRpdFByb2dyYW1tYXRpY2FsbHknDQoJCQkJJGVsLkNvbHVtbkhlYWRlcnNIZWlnaHRTaXplTW9kZSA9ICdEaXNhYmxlUmVzaXppbmcnDQoJCQkJJGVsLlJvd0hlYWRlcnNXaWR0aFNpemVNb2RlID0gJ0Rpc2FibGVSZXNpemluZycNCgkJCQkkZWwuRGVmYXVsdENlbGxTdHlsZS5BbGlnbm1lbnQgPSAnTWlkZGxlQ2VudGVyJw0KCQkJCSRlbC5Db2x1bW5IZWFkZXJzRGVmYXVsdENlbGxTdHlsZS5BbGlnbm1lbnQgPSAnTWlkZGxlQ2VudGVyJw0KDQoJCQkJJGVsLkRlZmF1bHRDZWxsU3R5bGUuQmFja0NvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoNDAsIDQwLCA0MCkNCgkJCQkkZWwuQWx0ZXJuYXRpbmdSb3dzRGVmYXVsdENlbGxTdHlsZS5CYWNrQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYigzNywgMzcsIDM3KQ0KCQkJCSRlbC5EZWZhdWx0Q2VsbFN0eWxlLkZvcmVDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDIzMCwgMjMwLCAyMzApDQoJCQkJJGVsLkNvbHVtbkhlYWRlcnNEZWZhdWx0Q2VsbFN0eWxlLkJhY2tDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDUwLCA1MCwgNTApDQoJCQkJJGVsLkNvbHVtbkhlYWRlcnNEZWZhdWx0Q2VsbFN0eWxlLkZvcmVDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDI0MCwgMjQwLCAyNDApDQoJCQkJJGVsLkdyaWRDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDcwLCA3MCwgNzApDQoJCQkJJGVsLkJhY2tncm91bmRDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDQwLCA0MCwgNDApDQoJCQkJJGVsLkRlZmF1bHRDZWxsU3R5bGUuU2VsZWN0aW9uQmFja0NvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoNjAsIDgwLCAxODApDQoJCQkJJGVsLkRlZmF1bHRDZWxsU3R5bGUuU2VsZWN0aW9uRm9yZUNvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoMjQwLCAyNDAsIDI0MCkNCgkJCX0NCgkJI2VuZHJlZ2lvbg0KDQoJCSNyZWdpb24gU3RlcDogQXBwbHkgQ29tbW9uIENvbnRyb2wgUHJvcGVydGllcw0KCQkJaWYgKCRlbCAtaXMgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkNvbnRyb2xdKQ0KCQkJew0KCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ3Zpc2libGUnKSkgeyAkZWwuVmlzaWJsZSA9ICR2aXNpYmxlIH0NCgkJCQlpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCd3aWR0aCcpKSAgIHsgJGVsLldpZHRoID0gJHdpZHRoIH0NCgkJCQlpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdoZWlnaHQnKSkgIHsgJGVsLkhlaWdodCA9ICRoZWlnaHQgfQ0KCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ3RvcCcpKSAgICAgeyAkZWwuVG9wID0gJHRvcCB9DQoJCQkJaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnbGVmdCcpKSAgICB7ICRlbC5MZWZ0ID0gJGxlZnQgfQ0KDQoJCQkJaWYgKCRiZyAtaXMgW2FycmF5XSAtYW5kICRiZy5Db3VudCAtZ2UgMykNCgkJCQl7DQoJCQkJCSRlbC5CYWNrQ29sb3IgPSBpZiAoJGJnLkNvdW50IC1lcSA0KSB7IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKCRiZ1swXSwgJGJnWzFdLCAkYmdbMl0sICRiZ1szXSkgfQ0KCQkJCQkJCQkJZWxzZSAgICAgICAgICAgICAgICAgeyBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYigkYmdbMF0sICRiZ1sxXSwgJGJnWzJdKSB9DQoJCQkJfQ0KDQoJCQkJaWYgKCRmZyAtaXMgW2FycmF5XSAtYW5kICRmZy5Db3VudCAtZ2UgMykNCgkJCQl7DQoJCQkJCSRlbC5Gb3JlQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYigkZmdbMF0sICRmZ1sxXSwgJGZnWzJdKQ0KCQkJCX0NCg0KCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ2ZvbnQnKSkgeyAkZWwuRm9udCA9ICRmb250IH0NCgkJCX0NCgkJI2VuZHJlZ2lvbg0KDQoJCSNyZWdpb24gU3RlcDogQXBwbHkgVHlwZS1TcGVjaWZpYyBQcm9wZXJ0aWVzDQoJCQlzd2l0Y2ggKCR0eXBlKQ0KCQkJew0KCQkJCSdGb3JtJyB7DQoJCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ3RleHQnKSkgeyAkZWwuVGV4dCA9ICR0ZXh0IH0NCgkJCQkJaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnc3RhcnRQb3NpdGlvbicpKSB7IHRyeSB7ICRlbC5TdGFydFBvc2l0aW9uID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkZvcm1TdGFydFBvc2l0aW9uXTo6JHN0YXJ0UG9zaXRpb24gfSBjYXRjaCB7fSB9DQoJCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ2Zvcm1Cb3JkZXJTdHlsZScpKSB7IHRyeSB7ICRlbC5Gb3JtQm9yZGVyU3R5bGUgPSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRm9ybUJvcmRlclN0eWxlXSRmb3JtQm9yZGVyU3R5bGUgfSBjYXRjaCB7fSB9DQoJCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ29wYWNpdHknKSkgeyAkZWwuT3BhY2l0eSA9IFtkb3VibGVdJG9wYWNpdHkgfQ0KCQkJCQlpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCd0b3BNb3N0JykpIHsgJGVsLlRvcE1vc3QgPSAkdG9wTW9zdCB9DQoJCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ2ljb24nKSkgeyAkZWwuSWNvbiA9IFtTeXN0ZW0uRHJhd2luZy5JY29uXTo6RXh0cmFjdEFzc29jaWF0ZWRJY29uKCRQU0NvbW1hbmRQYXRoKSB9DQoJCQkJfQ0KCQkJCSdCdXR0b24nIHsNCgkJCQkJaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgndGV4dCcpKSB7ICRlbC5UZXh0ID0gJHRleHQgfQ0KCQkJCQlpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdmcycpKSB7DQoJCQkJCQkkZWwuRmxhdFN0eWxlID0gJGZzDQoJCQkJCQkkZWwuRmxhdEFwcGVhcmFuY2UuQm9yZGVyQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYig2MCwgNjAsIDYwKQ0KCQkJCQkJJGVsLkZsYXRBcHBlYXJhbmNlLkJvcmRlclNpemUgPSAxDQoJCQkJCQkkZWwuRmxhdEFwcGVhcmFuY2UuTW91c2VPdmVyQmFja0NvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoNzAsIDcwLCA3MCkNCgkJCQkJCSRlbC5GbGF0QXBwZWFyYW5jZS5Nb3VzZURvd25CYWNrQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYig5MCwgOTAsIDkwKQ0KDQoJCQkJCQkkZWwuQWRkX1BhaW50KHsNCgkJCQkJCQlwYXJhbSgkc3JjLCAkZSkNCgkJCQkJCQlpZiAoJHNyYy5GbGF0U3R5bGUgLWVxIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5GbGF0U3R5bGVdOjpGbGF0KQ0KCQkJCQkJCXsNCgkJCQkJCQkJJGJnQnJ1c2ggPSBbU3lzdGVtLkRyYXdpbmcuU29saWRCcnVzaF06Om5ldygkc3JjLkJhY2tDb2xvcikNCgkJCQkJCQkJJGUuR3JhcGhpY3MuRmlsbFJlY3RhbmdsZSgkYmdCcnVzaCwgMCwgMCwgJHNyYy5XaWR0aCwgJHNyYy5IZWlnaHQpDQoJCQkJCQkJCSR0ZXh0QnJ1c2ggPSBbU3lzdGVtLkRyYXdpbmcuU29saWRCcnVzaF06Om5ldyhbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYigyNDAsIDI0MCwgMjQwKSkNCgkJCQkJCQkJJHRleHRGb3JtYXQgPSBbU3lzdGVtLkRyYXdpbmcuU3RyaW5nRm9ybWF0XTo6bmV3KCkNCgkJCQkJCQkJJHRleHRGb3JtYXQuQWxpZ25tZW50ID0gW1N5c3RlbS5EcmF3aW5nLlN0cmluZ0FsaWdubWVudF06OkNlbnRlcg0KCQkJCQkJCQkkdGV4dEZvcm1hdC5MaW5lQWxpZ25tZW50ID0gW1N5c3RlbS5EcmF3aW5nLlN0cmluZ0FsaWdubWVudF06OkNlbnRlcg0KCQkJCQkJCQkkZS5HcmFwaGljcy5EcmF3U3RyaW5nKCRzcmMuVGV4dCwgJHNyYy5Gb250LCAkdGV4dEJydXNoLCBbU3lzdGVtLkRyYXdpbmcuUmVjdGFuZ2xlRl06Om5ldygwLCAwLCAkc3JjLldpZHRoLCAkc3JjLkhlaWdodCksICR0ZXh0Rm9ybWF0KQ0KCQkJCQkJCQkkYm9yZGVyUGVuID0gW1N5c3RlbS5EcmF3aW5nLlBlbl06Om5ldyhbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYig2MCwgNjAsIDYwKSkNCgkJCQkJCQkJJGUuR3JhcGhpY3MuRHJhd1JlY3RhbmdsZSgkYm9yZGVyUGVuLCAwLCAwLCAkc3JjLldpZHRoLCAkc3JjLkhlaWdodCkNCgkJCQkJCQkJJGJnQnJ1c2guRGlzcG9zZSgpOyAkdGV4dEJydXNoLkRpc3Bvc2UoKTsgJGJvcmRlclBlbi5EaXNwb3NlKCk7ICR0ZXh0Rm9ybWF0LkRpc3Bvc2UoKQ0KCQkJCQkJCX0NCgkJCQkJCX0pDQoJCQkJCX0NCgkJCQl9DQoJCQkJJ0xhYmVsJyB7DQoJCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ3RleHQnKSkgeyAkZWwuVGV4dCA9ICR0ZXh0IH0NCgkJCQl9DQoJCQkJJ1RleHRCb3gnIHsNCgkJCQkJaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgndGV4dCcpKSB7ICRlbC5UZXh0ID0gJHRleHQgfQ0KCQkJCQlpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdtdWx0aWxpbmUnKSkgeyAkZWwuTXVsdGlsaW5lID0gJG11bHRpbGluZSB9DQoJCQkJCWlmICgkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ3JlYWRPbmx5JykpIHsgJGVsLlJlYWRPbmx5ID0gJHJlYWRPbmx5IH0NCgkJCQkJaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnc2Nyb2xsQmFycycpKSB7ICRlbC5TY3JvbGxCYXJzID0gaWYgKCRzY3JvbGxCYXJzIC1hbmQgJG11bHRpbGluZSkgeyBbU3lzdGVtLldpbmRvd3MuRm9ybXMuU2Nyb2xsQmFyc106OlZlcnRpY2FsIH0gZWxzZSB7IFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5TY3JvbGxCYXJzXTo6Tm9uZSB9IH0NCgkJCQkJJGVsLkJvcmRlclN0eWxlID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkJvcmRlclN0eWxlXTo6Rml4ZWRTaW5nbGUNCgkJCQkJJGVsLlRleHRBbGlnbiA9ICJDZW50ZXIiDQoJCQkJCSRlbC5CYWNrQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYig1MCwgNTAsIDUwKQ0KCQkJCQkkZWwuRm9yZUNvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoMjMwLCAyMzAsIDIzMCkNCgkJCQl9DQoJCQkJJ0NvbWJvQm94JyB7DQoJCQkJCWlmICgkbnVsbCAtbmUgJGRyb3BEb3duU3R5bGUpIHsgdHJ5IHsgJGVsLkRyb3BEb3duU3R5bGUgPSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuQ29tYm9Cb3hTdHlsZV06OiRkcm9wRG93blN0eWxlIH0gY2F0Y2gge30gfQ0KCQkJCQlpZiAoJG51bGwgLW5lICRmcykgew0KCQkJCQkJJGVsLkZsYXRTdHlsZSA9ICRmczsgJGVsLkRyYXdNb2RlID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRyYXdNb2RlXTo6T3duZXJEcmF3Rml4ZWQ7ICRlbC5JbnRlZ3JhbEhlaWdodCA9ICRmYWxzZQ0KCQkJCQkJJGN1c3RvbUNvbWJvQm94ID0gTmV3LU9iamVjdCBDdXN0b20uRGFya0NvbWJvQm94DQoJCQkJCQkkY3VzdG9tQ29tYm9Cb3guTG9jYXRpb24gPSAkZWwuTG9jYXRpb247ICRjdXN0b21Db21ib0JveC5TaXplID0gJGVsLlNpemU7ICRjdXN0b21Db21ib0JveC5XaWR0aCA9ICRlbC5XaWR0aCAtIDIwDQoJCQkJCQkkY3VzdG9tQ29tYm9Cb3guRHJvcERvd25TdHlsZSA9ICRlbC5Ecm9wRG93blN0eWxlOyAkY3VzdG9tQ29tYm9Cb3guRmxhdFN0eWxlID0gJGVsLkZsYXRTdHlsZQ0KCQkJCQkJJGN1c3RvbUNvbWJvQm94LkRyYXdNb2RlID0gJGVsLkRyYXdNb2RlOyAkY3VzdG9tQ29tYm9Cb3guQmFja0NvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoNDAsIDQwLCA0MCkNCgkJCQkJCSRjdXN0b21Db21ib0JveC5Gb3JlQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYigyNDAsIDI0MCwgMjQwKTsgJGN1c3RvbUNvbWJvQm94LkZvbnQgPSAkZWwuRm9udA0KCQkJCQkJJGN1c3RvbUNvbWJvQm94LkludGVncmFsSGVpZ2h0ID0gJGZhbHNlOyAkY3VzdG9tQ29tYm9Cb3guVGFiSW5kZXggPSAkZWwuVGFiSW5kZXg7ICRjdXN0b21Db21ib0JveC5OYW1lID0gJGVsLk5hbWUNCgkJCQkJCWZvcmVhY2ggKCRpdGVtIGluICRlbC5JdGVtcykgeyAkY3VzdG9tQ29tYm9Cb3guSXRlbXMuQWRkKCRpdGVtKSB9DQoJCQkJCQkkZWwgPSAkY3VzdG9tQ29tYm9Cb3gNCgkJCQkJfQ0KCQkJCX0NCiAgICAgICAgICAgICAgICAnQ2hlY2tCb3gnIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgndGV4dCcpKSB7ICRlbC5UZXh0ID0gJHRleHQgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdjaGVja2VkJykpIHsgJGVsLkNoZWNrZWQgPSAkY2hlY2tlZCB9DQogICAgICAgICAgICAgICAgICAgICRlbC5GbGF0U3R5bGUgPSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRmxhdFN0eWxlXTo6RmxhdA0KICAgICAgICAgICAgICAgICAgICAkZWwuRmxhdEFwcGVhcmFuY2UuQm9yZGVyQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYig2MCwgNjAsIDYwKTsgJGVsLkZsYXRBcHBlYXJhbmNlLkJvcmRlclNpemUgPSAxDQogICAgICAgICAgICAgICAgICAgICRlbC5GbGF0QXBwZWFyYW5jZS5DaGVja2VkQmFja0NvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoMCwgMTIwLCAyMTUpDQogICAgICAgICAgICAgICAgICAgICRlbC5GbGF0QXBwZWFyYW5jZS5Nb3VzZU92ZXJCYWNrQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYig1MCwgNTAsIDUwKQ0KICAgICAgICAgICAgICAgICAgICAkZWwuVXNlVmlzdWFsU3R5bGVCYWNrQ29sb3IgPSAkZmFsc2U7ICRlbC5DaGVja0FsaWduID0gW1N5c3RlbS5EcmF3aW5nLkNvbnRlbnRBbGlnbm1lbnRdOjpNaWRkbGVMZWZ0DQogICAgICAgICAgICAgICAgICAgICRlbC5UZXh0QWxpZ24gPSBbU3lzdGVtLkRyYXdpbmcuQ29udGVudEFsaWdubWVudF06Ok1pZGRsZUxlZnQ7ICRlbC5QYWRkaW5nID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLlBhZGRpbmddOjpuZXcoMjAsIDAsIDAsIDApDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICdUb2dnbGUnIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgndGV4dCcpKSB7ICRlbC5UZXh0ID0gJHRleHQgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdjaGVja2VkJykpIHsgJGVsLkNoZWNrZWQgPSAkY2hlY2tlZCB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICdQcm9ncmVzc0Jhcicgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdzdHlsZScpKSB7ICRlbC5TdHlsZSA9ICRzdHlsZSB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICdUZXh0UHJvZ3Jlc3NCYXInIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnc3R5bGUnKSkgeyAkZWwuU3R5bGUgPSAkc3R5bGUgfQ0KICAgICAgICAgICAgICAgIH0NCgkJCX0NCgkJI2VuZHJlZ2lvbg0KDQoJCXJldHVybiAkZWwNCgl9DQoNCiNlbmRyZWdpb24gRnVuY3Rpb246IFNldC1VSUVsZW1lbnQNCg0KI2VuZHJlZ2lvbiBDb3JlIFVJIEZ1bmN0aW9ucw0KDQojcmVnaW9uIE1vZHVsZSBFeHBvcnRzDQojcmVnaW9uIFN0ZXA6IEV4cG9ydCBQdWJsaWMgRnVuY3Rpb25zDQoJIyBFeHBvcnQgdGhlIGZ1bmN0aW9ucyBpbnRlbmRlZCBmb3IgdXNlIGJ5IG90aGVyIG1vZHVsZXMgb3IgdGhlIG1haW4gc2NyaXB0Lg0KCUV4cG9ydC1Nb2R1bGVNZW1iZXIgLUZ1bmN0aW9uIEluaXRpYWxpemUtVUksIFNldC1VSUVsZW1lbnQsIFNob3ctU2V0dGluZ3NGb3JtLCBIaWRlLVNldHRpbmdzRm9ybSwgU3luYy1Db25maWdUb1VJLCBTeW5jLVVJVG9Db25maWcsIFJlZ2lzdGVyLVVJRXZlbnRIYW5kbGVycw0KI2VuZHJlZ2lvbiBTdGVwOiBFeHBvcnQgUHVibGljIEZ1bmN0aW9ucw0KI2VuZHJlZ2lvbiBNb2R1bGUgRXhwb3J0cw==
			'
		}
		
		# Important modules: Add major features. Failure might limit things, but the app can still start.
		'datagrid.psm1' = @{ 
			Priority = 'Important'; 
			Order = 6; 
			Dependencies = @('classes.psm1', 'ui.psm1', 'ini.psm1');
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'datagrid.psm1');
			Base64Content = '
PCMgZGF0YWdyaWQucHNtMQogICAgLlNZTk9QU0lTCiAgICAgICAgTWFuYWdlcyB0aGUgcmVhbC10aW1lIHByb2Nlc3MgbW9uaXRvcmluZyBncmlkIGluIHRoZSBtYWluIGRhc2hib2FyZCBVSS4gCgkJSXQgdHJhY2tzIGFuZCBkaXNwbGF5cyB0aGUgc3RhdGUgb2YgdGFyZ2V0IGFwcGxpY2F0aW9uIGluc3RhbmNlcyB1c2luZyBhIHRpbWVyLWRyaXZlbiwgYXN5bmNocm9ub3VzIHVwZGF0ZSBsb29wLgoKICAgIC5ERVNDUklQVElPTgogICAgICAgIFRoaXMgIkltcG9ydGFudCIgbW9kdWxlIGlzIHRoZSBlbmdpbmUgYmVoaW5kIHRoZSBkYXNoYm9hcmQncyBtYWluIHByb2Nlc3MgZ3JpZC4gSXRzIHNvbGUgcmVzcG9uc2liaWxpdHkgaXMgdG8ga2VlcCB0aGUgYERhdGFHcmlkVmlld2AgcGVyZmVjdGx5IHN5bmNocm9uaXplZCB3aXRoIHRoZSBzdGF0ZSBvZiBhbGwgcnVubmluZyB0YXJnZXQgYXBwbGljYXRpb24gaW5zdGFuY2VzIChlLmcuLCBnYW1lIGNsaWVudHMpLiBJdCB1c2VzIGEgY29tYmluYXRpb24gb2YgZWZmaWNpZW50IGRhdGEgc3RydWN0dXJlcywgYXN5bmNocm9ub3VzIG9wZXJhdGlvbnMsIGFuZCBkaXJlY3QgV2luZG93cyBBUEkgY2FsbHMgdG8gcHJvdmlkZSByZWFsLXRpbWUgaW5mb3JtYXRpb24gd2l0aG91dCBmcmVlemluZyB0aGUgVUkuCgogICAgICAgIFRoZSBtb2R1bGUncyBrZXkgcmVzcG9uc2liaWxpdGllcyBhcmU6CgogICAgICAgIDEuICAqKkNvbnRpbnVvdXMgUHJvY2VzcyBNb25pdG9yaW5nIChgVXBkYXRlLURhdGFHcmlkYCk6KioKICAgICAgICAgICAgKiAgIFRoZSBtb2R1bGUgaXMgZHJpdmVuIGJ5IGEgaGlnaC1mcmVxdWVuY3kgdGltZXIgKGBTdGFydC1EYXRhR3JpZFVwZGF0ZVRpbWVyYCkgdGhhdCByZXBlYXRlZGx5IGNhbGxzIHRoZSBgVXBkYXRlLURhdGFHcmlkYCBmdW5jdGlvbi4KICAgICAgICAgICAgKiAgIFRoaXMgY2VudHJhbCBmdW5jdGlvbiBvcmNoZXN0cmF0ZXMgdGhlIGVudGlyZSByZWZyZXNoIGN5Y2xlOiBpdCBnZXRzIHRoZSBsYXRlc3QgcHJvY2VzcyBsaXN0LCByZW1vdmVzIHRlcm1pbmF0ZWQgcHJvY2Vzc2VzIGZyb20gdGhlIGdyaWQsIHVwZGF0ZXMgZXhpc3RpbmcgZW50cmllcywgYW5kIGFkZHMgbmV3IG9uZXMuCgogICAgICAgIDIuICAqKkludGVsbGlnZW50IFByb2Nlc3MgVHJhY2tpbmc6KioKICAgICAgICAgICAgKiAgIEl0IHVzZXMgYSBwcm9jZXNzIGNhY2hlIHRvIHRyYWNrIHNlZW4gcHJvY2Vzc2VzLCBldmVuIHRob3NlIHRoYXQgbWlnaHQgdGVtcG9yYXJpbHkgbGFjayBhIG1haW4gd2luZG93IGR1cmluZyBzdGFydHVwLiBUaGlzIHByZXZlbnRzIHZpc3VhbCBmbGlja2VyaW5nIGFuZCBlbnN1cmVzIHByb2Nlc3NlcyBhcmUgYWRkZWQgdG8gdGhlIGdyaWQgcmVsaWFibHkuCiAgICAgICAgICAgICogICBHcmlkIHVwZGF0ZXMgYXJlIG9wdGltaXplZCB1c2luZyBhIGxvb2t1cCBkaWN0aW9uYXJ5IChoYXNodGFibGUpIHRvIGZpbmQgcm93cyBieSBQcm9jZXNzIElEIGluc3RhbnRseSwgYXZvaWRpbmcgc2xvdywgaXRlcmF0aXZlIHNlYXJjaGVzLgoKICAgICAgICAzLiAgKipBc3luY2hyb25vdXMgU3RhdGUgQ2hlY2tpbmcgKGBTdGFydC1XaW5kb3dTdGF0ZUNoZWNrYCk6KioKICAgICAgICAgICAgKiAgIFRvIGRldGVybWluZSBpZiBhIGNsaWVudCB3aW5kb3cgaXMgYE5vcm1hbGAsIGBNaW5pbWl6ZWRgLCBvciBgTG9hZGluZ2AgKHVucmVzcG9uc2l2ZSksIGl0IGluaXRpYXRlcyBhIG5vbi1ibG9ja2luZywgYXN5bmNocm9ub3VzIGNoZWNrIGZvciBlYWNoIHByb2Nlc3MuCiAgICAgICAgICAgICogICBUaGlzIHByZXZlbnRzIHRoZSBlbnRpcmUgZGFzaGJvYXJkIGZyb20gZnJlZXppbmcgd2hpbGUgd2FpdGluZyBmb3IgYSBwb3RlbnRpYWxseSBodW5nIGFwcGxpY2F0aW9uIHdpbmRvdyB0byByZXNwb25kLgogICAgICAgICAgICAqICAgT25jZSB0aGUgY2hlY2sgY29tcGxldGVzIG9uIGEgYmFja2dyb3VuZCB0aHJlYWQsIHRoZSByZXN1bHQgaXMgc2FmZWx5IHBhc3NlZCBiYWNrIHRvIHRoZSBVSSB0aHJlYWQgdG8gdXBkYXRlIHRoZSBncmlkJ3MgJ1N0YXRlJyBjb2x1bW4uCgogICAgICAgIDQuICAqKldpbmRvdyBTdHlsZSBNYW5hZ2VtZW50IChgU2V0LVdpbmRvd1Rvb2xTdHlsZWApOioqCiAgICAgICAgICAgICogICBJZiB0aGUgdXNlciBlbmFibGVzIHRoZSAiSGlkZSBtaW5pbWl6ZWQgY2xpZW50cyIgb3B0aW9uLCB0aGlzIG1vZHVsZSBpcyByZXNwb25zaWJsZSBmb3IgbW9kaWZ5aW5nIHRoZSB3aW5kb3cgc3R5bGUgb2YgbWluaW1pemVkIGNsaWVudHMuCiAgICAgICAgICAgICogICBJdCBhcHBsaWVzIHRoZSBgV1NfRVhfVE9PTFdJTkRPV2Agc3R5bGUgdG8gaGlkZSB0aGUgY2xpZW50IGZyb20gdGhlIFdpbmRvd3MgdGFza2JhciBhbmQgQWx0K1RhYiBzd2l0Y2hlciwgcmVkdWNpbmcgY2x1dHRlci4KICAgICAgICAgICAgKiAgIEEgY29ycmVzcG9uZGluZyBgUmVzdG9yZS1XaW5kb3dTdHlsZXNgIGZ1bmN0aW9uIGVuc3VyZXMgYWxsIHdpbmRvdyBzdHlsZXMgYXJlIHJldHVybmVkIHRvIG5vcm1hbCB3aGVuIHRoZSBkYXNoYm9hcmQgYXBwbGljYXRpb24gZXhpdHMuCiM+CgojcmVnaW9uIEdsb2JhbCBDb25maWd1cmF0aW9uCiAgICAjcmVnaW9uIFN0ZXA6IERlZmluZSBVcGRhdGUgSW50ZXJ2YWwKICAgICAgICAjICRzY3JpcHQ6VXBkYXRlSW50ZXJ2YWw6IEludGVydmFsIGluIG1pbGxpc2Vjb25kcyBmb3IgcmVmcmVzaGluZyB0aGUgcHJvY2VzcyBncmlkLgogICAgICAgICRzY3JpcHQ6VXBkYXRlSW50ZXJ2YWwgPSAxMDAKICAgICNlbmRyZWdpb24gU3RlcDogRGVmaW5lIFVwZGF0ZSBJbnRlcnZhbAoKICAgICNyZWdpb24gU3RlcDogRGVmaW5lIFByb2Nlc3MgV2luZG93IFN0YXRlcwogICAgICAgICMgJHNjcmlwdDpTdGF0ZXM6IEhhc2h0YWJsZSBtYXBwaW5nIGludGVybmFsIHN0YXRlIGtleXMgdG8gZGlzcGxheSBzdHJpbmdzIHVzZWQgaW4gdGhlIGdyaWQuCiAgICAgICAgJHNjcmlwdDpTdGF0ZXMgPSBAewogICAgICAgICAgICBDaGVja2luZyAgPSAnQ2hlY2tpbmcuLi4nCiAgICAgICAgICAgIExvYWRpbmcgICA9ICdMb2FkaW5nLi4uJwogICAgICAgICAgICBNaW5pbWl6ZWQgPSAnTWluJwogICAgICAgICAgICBOb3JtYWwgICAgPSAnTm9ybWFsJwogICAgICAgIH0KICAgICNlbmRyZWdpb24gU3RlcDogRGVmaW5lIFByb2Nlc3MgV2luZG93IFN0YXRlcwoKICAgICNyZWdpb24gU3RlcDogSW5pdGlhbGl6ZSBQcm9jZXNzIENhY2hlCiAgICAgICAgIyAkc2NyaXB0OlByb2Nlc3NDYWNoZTogSGFzaHRhYmxlIHRvIHRyYWNrIHNlZW4gcHJvY2Vzc2VzIChLZXk6IFByb2Nlc3NJRCwgVmFsdWU6IEB7TGFzdFNlZW49W0RhdGVUaW1lXTsgSGFzV2luZG93PVtib29sXX0pCiAgICAgICAgIyBVc2VkIHRvIHByZXZlbnQgZHVwbGljYXRlIGVudHJpZXMgYW5kIG1hbmFnZSBzdGF0ZSB1cGRhdGVzIGludGVsbGlnZW50bHkuCiAgICAgICAgJHNjcmlwdDpQcm9jZXNzQ2FjaGUgPSBAe30KICAgICNlbmRyZWdpb24gU3RlcDogSW5pdGlhbGl6ZSBQcm9jZXNzIENhY2hlCgogICAgI3JlZ2lvbiBTdGVwOiBJbml0aWFsaXplIExhc3QgTG9nIE1lc3NhZ2UgQ2FjaGUKICAgICAgICAjICRzY3JpcHQ6TGFzdExvZ01lc3NhZ2VzOiBIYXNodGFibGUgdG8gc3RvcmUgdGhlIGxhc3QgbG9nZ2VkIG1lc3NhZ2UgZm9yIHNwZWNpZmljIGtleXMgdG8gYXZvaWQgcmVkdW5kYW50IGxvZ2dpbmcuCiAgICAgICAgIyBDdXJyZW50bHkgdW51c2VkIGluIHRoaXMgdmVyc2lvbiBidXQga2VwdCBmb3IgcG90ZW50aWFsIGZ1dHVyZSB1c2UuCiAgICAgICAgJHNjcmlwdDpMYXN0TG9nTWVzc2FnZXMgPSBAe30KICAgICNlbmRyZWdpb24gU3RlcDogSW5pdGlhbGl6ZSBMYXN0IExvZyBNZXNzYWdlIENhY2hlCiNlbmRyZWdpb24gR2xvYmFsIENvbmZpZ3VyYXRpb24KCiNyZWdpb24gSGVscGVyIEZ1bmN0aW9ucwogICAgI3JlZ2lvbiBGdW5jdGlvbjogVGVzdC1WYWxpZFBhcmFtZXRlcnMKICAgICAgICBmdW5jdGlvbiBUZXN0LVZhbGlkUGFyYW1ldGVycwogICAgICAgIHsKICAgICAgICAgICAgPCMKICAgICAgICAgICAgLlNZTk9QU0lTCiAgICAgICAgICAgICAgICBWYWxpZGF0ZXMgaW5wdXQgcGFyYW1ldGVycyBhbmQgZ2xvYmFsIGNvbmZpZ3VyYXRpb24gcmVxdWlyZWQgZm9yIERhdGFHcmlkIG9wZXJhdGlvbnMuCiAgICAgICAgICAgIC5QQVJBTUVURVIgR3JpZAogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld10gVGhlIERhdGFHcmlkVmlldyBjb250cm9sIHRvIHZhbGlkYXRlLiAoTWFuZGF0b3J5KQogICAgICAgICAgICAuT1VUUFVUUwogICAgICAgICAgICAgICAgW2Jvb2xdIFJldHVybnMgJHRydWUgaWYgdGhlIGdyaWQgZXhpc3RzIGFuZCByZXF1aXJlZCBnbG9iYWwgY29uZmlndXJhdGlvbiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcpIGlzIHByZXNlbnQgYW5kIGNvcnJlY3RseSBwb3B1bGF0ZWQsICRmYWxzZSBvdGhlcndpc2UuCiAgICAgICAgICAgIC5OT1RFUwogICAgICAgICAgICAgICAgQ2hlY2tzIGZvciB0aGUgZXhpc3RlbmNlIG9mIHRoZSBHcmlkIG9iamVjdCBhbmQgZXNzZW50aWFsIGtleXMgd2l0aGluIHRoZSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZyBoYXNodGFibGUuCiAgICAgICAgICAgICAgICBMb2dzIGFuIGVycm9yIG1lc3NhZ2UgaWYgdmFsaWRhdGlvbiBmYWlscy4KICAgICAgICAgICAgIz4KICAgICAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICAgICAgW091dHB1dFR5cGUoW2Jvb2xdKV0KICAgICAgICAgICAgcGFyYW0oCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXddJEdyaWQKICAgICAgICAgICAgKQoKICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBWYWxpZGF0ZSBHcmlkIFBhcmFtZXRlcgogICAgICAgICAgICAgICAgaWYgKC1ub3QgJEdyaWQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFZhbGlkYXRlIEdyaWQgUGFyYW1ldGVyCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFZhbGlkYXRlIEdsb2JhbCBDb25maWd1cmF0aW9uIEV4aXN0ZW5jZSBhbmQgU3RydWN0dXJlCiAgICAgICAgICAgICAgICBpZiAoLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZyAtb3IgLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcgLW9yIC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnLkNvbnRhaW5zKCdQcm9jZXNzTmFtZScpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJ0RBVEFHUklEOiBHbG9iYWwgc2V0dGluZ3MgbWlzc2luZy4gRGVmaW5lIERhc2hib2FyZENvbmZpZyBiZWZvcmUgaW1wb3J0aW5nLicgLUZvcmVncm91bmRDb2xvciBSZWQKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVmFsaWRhdGUgR2xvYmFsIENvbmZpZ3VyYXRpb24gRXhpc3RlbmNlIGFuZCBTdHJ1Y3R1cmUKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogVmFsaWRhdGUgUHJvY2VzcyBOYW1lIENvbmZpZ3VyYXRpb24KICAgICAgICAgICAgICAgICRwcm9jZXNzTmFtZSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snUHJvY2Vzc05hbWUnXVsnUHJvY2Vzc05hbWUnXQogICAgICAgICAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRwcm9jZXNzTmFtZSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFZhbGlkYXRlIFByb2Nlc3MgTmFtZSBDb25maWd1cmF0aW9uCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFJldHVybiBWYWxpZGF0aW9uIFN1Y2Nlc3MKICAgICAgICAgICAgICAgIHJldHVybiAkdHJ1ZQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFJldHVybiBWYWxpZGF0aW9uIFN1Y2Nlc3MKICAgICAgICB9CiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBUZXN0LVZhbGlkUGFyYW1ldGVycwoKICAgICNyZWdpb24gRnVuY3Rpb246IEdldC1Qcm9jZXNzTGlzdAogICAgICAgIGZ1bmN0aW9uIEdldC1Qcm9jZXNzTGlzdAogICAgICAgIHsKICAgICAgICAgICAgPCMKICAgICAgICAgICAgLlNZTk9QU0lTCiAgICAgICAgICAgICAgICBSZXRyaWV2ZXMgdGFyZ2V0IHByb2Nlc3NlcyBiYXNlZCBvbiBjb25maWd1cmF0aW9uLCBwcmlvcml0aXppbmcgdGhvc2Ugd2l0aCBhY3RpdmUgd2luZG93cy4KICAgICAgICAgICAgLk9VVFBVVFMKICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc1tdXSBBbiBhcnJheSBvZiBQcm9jZXNzIG9iamVjdHMgbWF0Y2hpbmcgdGhlIGNvbmZpZ3VyZWQgbmFtZS4KICAgICAgICAgICAgICAgIEZpbHRlcnMgb3V0IHRlcm1pbmF0ZWQgcHJvY2Vzc2VzIGFuZCBhdHRlbXB0cyB0byBzb3J0IGJ5IFN0YXJ0VGltZS4KICAgICAgICAgICAgICAgIFByaW9yaXRpemVzIHByb2Nlc3NlcyB3aXRoIE1haW5XaW5kb3dIYW5kbGVzLCBidXQgZmFsbHMgYmFjayB0byBhbGwgdmFsaWQgcHJvY2Vzc2VzIGlmIG5vbmUgaGF2ZSB3aW5kb3dzLgogICAgICAgICAgICAgICAgUmV0dXJucyBhbiBlbXB0eSBhcnJheSBvbiBlcnJvciBvciBpZiBubyBtYXRjaGluZyBwcm9jZXNzZXMgYXJlIGZvdW5kLgogICAgICAgICAgICAuTk9URVMKICAgICAgICAgICAgICAgIFVzZXMgR2V0LVByb2Nlc3Mgd2l0aCBlcnJvciBzdXBwcmVzc2lvbi4gSW5jbHVkZXMgcm9idXN0IGZpbHRlcmluZyBmb3IgdmFsaWQgKG5vbi1leGl0ZWQpIHByb2Nlc3NlcwogICAgICAgICAgICAgICAgYW5kIHNhZmUgc29ydGluZyBieSBTdGFydFRpbWUsIGhhbmRsaW5nIHBvdGVudGlhbCBhY2Nlc3MgZXJyb3JzLgogICAgICAgICAgICAjPgogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgICAgICBbT3V0cHV0VHlwZShbU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3NbXV0pXQogICAgICAgICAgICBwYXJhbSgpCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEdldCBDb25maWd1cmVkIFByb2Nlc3MgTmFtZQogICAgICAgICAgICAgICAgJHByb2Nlc3NOYW1lID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydQcm9jZXNzTmFtZSddWydQcm9jZXNzTmFtZSddCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogR2V0IENvbmZpZ3VyZWQgUHJvY2VzcyBOYW1lCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFJldHJpZXZlIGFuZCBGaWx0ZXIgUHJvY2Vzc2VzIFNhZmVseQogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBEZWZpbmUgUGFyYW1ldGVycyBmb3IgR2V0LVByb2Nlc3MKICAgICAgICAgICAgICAgICAgICAgICAgJGdldFByb2Nlc3NQYXJhbXMgPSBAewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgPSAkcHJvY2Vzc05hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yQWN0aW9uID0gJ1NpbGVudGx5Q29udGludWUnCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IERlZmluZSBQYXJhbWV0ZXJzIGZvciBHZXQtUHJvY2VzcwoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEdldCBBbGwgTWF0Y2hpbmcgUHJvY2Vzc2VzCiAgICAgICAgICAgICAgICAgICAgICAgICRhbGxQcm9jZXNzZXMgPSBHZXQtUHJvY2VzcyBAZ2V0UHJvY2Vzc1BhcmFtcwogICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogR2V0IEFsbCBNYXRjaGluZyBQcm9jZXNzZXMKCiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBGaWx0ZXIgZm9yIFZhbGlkIChOb24tRXhpdGVkKSBQcm9jZXNzZXMKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbGlkUHJvY2Vzc2VzID0gQCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRwcm9jIGluICRhbGxQcm9jZXNzZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgcHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nIGJ5IGFjY2Vzc2luZyBIYXNFeGl0ZWQgcHJvcGVydHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhpdGVkID0gJHByb2MuSGFzRXhpdGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC1ub3QgJGV4aXRlZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2YWxpZFByb2Nlc3NlcyArPSAkcHJvYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTa2lwIHRoaXMgcHJvY2VzcyBpZiB3ZSBjYW4ndCBhY2Nlc3MgaXRzIHByb3BlcnRpZXMgKGUuZy4sIGFjY2VzcyBkZW5pZWQsIGFscmVhZHkgZXhpdGVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEZpbHRlciBmb3IgVmFsaWQgKE5vbi1FeGl0ZWQpIFByb2Nlc3NlcwoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEZpbHRlciBmb3IgUHJvY2Vzc2VzIHdpdGggV2luZG93cyBhbmQgU29ydCBTYWZlbHkKICAgICAgICAgICAgICAgICAgICAgICAgJHByb2Nlc3NlcyA9IEAoKQogICAgICAgICAgICAgICAgICAgICAgICAkd2luZG93UHJvY2Vzc2VzID0gQCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEZpbHRlciBmb3IgcHJvY2Vzc2VzIHdpdGggd2luZG93cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvd1Byb2Nlc3NlcyA9IEAoJHZhbGlkUHJvY2Vzc2VzIHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdoZXJlLU9iamVjdCB7ICRfLk1haW5XaW5kb3dIYW5kbGUgLW5lIDAgLWFuZCAkXy5NYWluV2luZG93SGFuZGxlIC1uZSBbSW50UHRyXTo6WmVybyB9KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgU29ydCBieSBTdGFydFRpbWUgd2l0aCBlcnJvciBoYW5kbGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2Nlc3NlcyA9IEAoJHdpbmRvd1Byb2Nlc3NlcyB8IFNvcnQtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLlN0YXJ0VGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmV0dXJuIGEgZGVmYXVsdCBkYXRlIGZvciBwcm9jZXNzZXMgd2hlcmUgU3RhcnRUaW1lIGNhbid0IGJlIGFjY2Vzc2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbRGF0ZVRpbWVdOjpNaW5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIElmIG5vIHByb2Nlc3NlcyB3aXRoIHdpbmRvd3MgZm91bmQsIHRyeSB0byB1c2UgYWxsIHZhbGlkIHByb2Nlc3NlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRwcm9jZXNzZXMuQ291bnQgLWVxIDAgLWFuZCAkdmFsaWRQcm9jZXNzZXMuQ291bnQgLWd0IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTb3J0IHZhbGlkIHByb2Nlc3NlcyB3aXRoIGVycm9yIGhhbmRsaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2Nlc3NlcyA9IEAoJHZhbGlkUHJvY2Vzc2VzIHwgU29ydC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8uU3RhcnRUaW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtEYXRlVGltZV06Ok1pblZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBGYWxsIGJhY2sgdG8gdW5zb3J0ZWQgbGlzdCBpZiBzb3J0aW5nIGZhaWxzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvY2Vzc2VzID0gaWYgKCR3aW5kb3dQcm9jZXNzZXMuQ291bnQgLWd0IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvd1Byb2Nlc3NlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2YWxpZFByb2Nlc3NlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBGaWx0ZXIgZm9yIFByb2Nlc3NlcyB3aXRoIFdpbmRvd3MgYW5kIFNvcnQgU2FmZWx5CgogICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogUmV0dXJuIFByb2Nlc3MgTGlzdAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHByb2Nlc3NlcwogICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogUmV0dXJuIFByb2Nlc3MgTGlzdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEhhbmRsZSBQcm9jZXNzIFJldHJpZXZhbCBFcnJvcnMKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiREFTSEJPQVJEOiBFcnJvciBnZXR0aW5nIHByb2Nlc3MgbGlzdDogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBAKCkKICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEhhbmRsZSBQcm9jZXNzIFJldHJpZXZhbCBFcnJvcnMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBSZXRyaWV2ZSBhbmQgRmlsdGVyIFByb2Nlc3NlcyBTYWZlbHkKICAgICAgICB9CiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBHZXQtUHJvY2Vzc0xpc3QKCiAgICAjcmVnaW9uIEZ1bmN0aW9uOiBSZW1vdmUtVGVybWluYXRlZFByb2Nlc3NlcwogICAgICAgIGZ1bmN0aW9uIFJlbW92ZS1UZXJtaW5hdGVkUHJvY2Vzc2VzCiAgICAgICAgewogICAgICAgICAgICA8IwogICAgICAgICAgICAuU1lOT1BTSVMKICAgICAgICAgICAgICAgIFJlbW92ZXMgcm93cyBmcm9tIHRoZSBEYXRhR3JpZCBmb3IgcHJvY2Vzc2VzIHRoYXQgYXJlIG5vIGxvbmdlciBydW5uaW5nLgogICAgICAgICAgICAuUEFSQU1FVEVSIEdyaWQKICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXddIFRoZSBEYXRhR3JpZFZpZXcgY29udHJvbCBmcm9tIHdoaWNoIHRvIHJlbW92ZSByb3dzLiAoTWFuZGF0b3J5KQogICAgICAgICAgICAuUEFSQU1FVEVSIEN1cnJlbnRQcm9jZXNzZXMKICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc1tdXSBBbiBhcnJheSBvZiBjdXJyZW50bHkgcnVubmluZyBQcm9jZXNzIG9iamVjdHMuIFJvd3MgaW4gdGhlIGdyaWQgd2hvc2UgYXNzb2NpYXRlZCBQcm9jZXNzIElEIGlzIG5vdCBpbiB0aGlzIGxpc3Qgd2lsbCBiZSByZW1vdmVkLiAoT3B0aW9uYWwsIGRlZmF1bHRzIHRvIGVtcHR5IGFycmF5KQogICAgICAgICAgICAuT1VUUFVUUwogICAgICAgICAgICAgICAgW3ZvaWRdCiAgICAgICAgICAgIC5OT1RFUwogICAgICAgICAgICAgICAgVXNlcyBhbiBlZmZpY2llbnQgbG9va3VwIGRpY3Rpb25hcnkgYmFzZWQgb24gQ3VycmVudFByb2Nlc3NlcyBmb3IgcXVpY2sgY2hlY2tpbmcuCiAgICAgICAgICAgICAgICBSZW1vdmVzIGNvcnJlc3BvbmRpbmcgZW50cmllcyBmcm9tIHRoZSAkc2NyaXB0OlByb2Nlc3NDYWNoZSBhcyB3ZWxsLgogICAgICAgICAgICAgICAgSXRlcmF0ZXMgYmFja3dhcmRzIHdoZW4gcmVtb3Zpbmcgcm93cyB0byBhdm9pZCBpbmRleCBpc3N1ZXMuCiAgICAgICAgICAgICM+CiAgICAgICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgICAgIHBhcmFtKAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3XSRHcmlkLAoKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJGZhbHNlKV0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc1tdXSRDdXJyZW50UHJvY2Vzc2VzID0gQCgpCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogSGFuZGxlIEVtcHR5IEdyaWQKICAgICAgICAgICAgICAgIGlmICgkR3JpZC5Sb3dzLkNvdW50IC1lcSAwKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEhhbmRsZSBFbXB0eSBHcmlkCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEluaXRpYWxpemUgTGlzdCBmb3IgUm93cyB0byBSZW1vdmUKICAgICAgICAgICAgICAgICRyb3dzVG9SZW1vdmUgPSBbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXdSb3ddXTo6bmV3KCkKICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBJbml0aWFsaXplIExpc3QgZm9yIFJvd3MgdG8gUmVtb3ZlCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IENyZWF0ZSBQcm9jZXNzIElEIExvb2t1cCBmb3IgRWZmaWNpZW50IENoZWNrCiAgICAgICAgICAgICAgICAkcHJvY2Vzc0lkTG9va3VwID0gQHt9CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcHJvY2VzcyBpbiAkQ3VycmVudFByb2Nlc3NlcykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIEVuc3VyZSBwcm9jZXNzIG9iamVjdCBpcyB2YWxpZCBiZWZvcmUgYWNjZXNzaW5nIElkCiAgICAgICAgICAgICAgICAgICAgaWYgKCRudWxsIC1uZSAkcHJvY2VzcyAtYW5kICRudWxsIC1uZSAkcHJvY2Vzcy5JZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcHJvY2Vzc0lkTG9va3VwWyRwcm9jZXNzLklkXSA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENyZWF0ZSBQcm9jZXNzIElEIExvb2t1cCBmb3IgRWZmaWNpZW50IENoZWNrCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IElkZW50aWZ5IFJvd3MgQ29ycmVzcG9uZGluZyB0byBUZXJtaW5hdGVkIFByb2Nlc3NlcwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJvdyBpbiAkR3JpZC5Sb3dzKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgU2tpcCByb3dzIHdpdGhvdXQgdmFsaWQgcHJvY2VzcyBkYXRhIGluIFRhZwogICAgICAgICAgICAgICAgICAgIGlmICgtbm90ICRyb3cuVGFnIC1vciAkbnVsbCAtZXEgJHJvdy5UYWcuSWQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiBwcm9jZXNzIHN0aWxsIGV4aXN0cyBpbiBjdXJyZW50IHByb2Nlc3MgbGlzdCB1c2luZyBsb29rdXAKICAgICAgICAgICAgICAgICAgICAkcHJvY2Vzc0V4aXN0cyA9ICRwcm9jZXNzSWRMb29rdXAuQ29udGFpbnNLZXkoJHJvdy5UYWcuSWQpCgogICAgICAgICAgICAgICAgICAgICMgSWYgcHJvY2VzcyBkb2Vzbid0IGV4aXN0LCBtYXJrIHJvdyBmb3IgcmVtb3ZhbCBhbmQgY2xlYXIgZnJvbSBjYWNoZQogICAgICAgICAgICAgICAgICAgIGlmICgtbm90ICRwcm9jZXNzRXhpc3RzKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJvd3NUb1JlbW92ZS5BZGQoJHJvdykKCiAgICAgICAgICAgICAgICAgICAgICAgICMgQWxzbyByZW1vdmUgZnJvbSBwcm9jZXNzIGNhY2hlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NyaXB0OlByb2Nlc3NDYWNoZS5Db250YWluc0tleSgkcm93LlRhZy5JZCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY3JpcHQ6UHJvY2Vzc0NhY2hlLlJlbW92ZSgkcm93LlRhZy5JZCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBJZGVudGlmeSBSb3dzIENvcnJlc3BvbmRpbmcgdG8gVGVybWluYXRlZCBQcm9jZXNzZXMKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogUmVtb3ZlIElkZW50aWZpZWQgUm93cyBmcm9tIEdyaWQKICAgICAgICAgICAgICAgICMgUmVtb3ZlIHJvd3MgaW4gcmV2ZXJzZSBvcmRlciB0byBhdm9pZCBpbmRleCBzaGlmdGluZyBpc3N1ZXMKICAgICAgICAgICAgICAgIGZvciAoJGkgPSAkcm93c1RvUmVtb3ZlLkNvdW50IC0gMTsgJGkgLWdlIDA7ICRpLS0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiByb3cgc3RpbGwgZXhpc3RzIGluIGdyaWQgYmVmb3JlIHJlbW92aW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3dzVG9SZW1vdmVbJGldLkluZGV4IC1nZSAwIC1hbmQgJHJvd3NUb1JlbW92ZVskaV0uSW5kZXggLWx0ICRHcmlkLlJvd3MuQ291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAkR3JpZC5Sb3dzLlJlbW92ZSgkcm93c1RvUmVtb3ZlWyRpXSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogUmVtb3ZlIElkZW50aWZpZWQgUm93cyBmcm9tIEdyaWQKICAgICAgICB9CiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBSZW1vdmUtVGVybWluYXRlZFByb2Nlc3NlcwoKICAgICNyZWdpb24gRnVuY3Rpb246IE5ldy1Sb3dMb29rdXBEaWN0aW9uYXJ5CiAgICAgICAgZnVuY3Rpb24gTmV3LVJvd0xvb2t1cERpY3Rpb25hcnkKICAgICAgICB7CiAgICAgICAgICAgIDwjCiAgICAgICAgICAgIC5TWU5PUFNJUwogICAgICAgICAgICAgICAgQ3JlYXRlcyBhIGZhc3QgbG9va3VwIGRpY3Rpb25hcnkgKGhhc2h0YWJsZSkgZm9yIGdyaWQgcm93cyBpbmRleGVkIGJ5IHByb2Nlc3MgSUQuCiAgICAgICAgICAgIC5QQVJBTUVURVIgR3JpZAogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld10gVGhlIERhdGFHcmlkVmlldyB3aG9zZSByb3dzIG5lZWQgdG8gYmUgaW5kZXhlZC4gKE1hbmRhdG9yeSkKICAgICAgICAgICAgLk9VVFBVVFMKICAgICAgICAgICAgICAgIFtoYXNodGFibGVdIEEgaGFzaHRhYmxlIHdoZXJlIGtleXMgYXJlIFByb2Nlc3MgSURzIChvYnRhaW5lZCBmcm9tIHRoZSByb3cncyBUYWcgcHJvcGVydHkpIGFuZCB2YWx1ZXMgYXJlIHRoZSBjb3JyZXNwb25kaW5nIERhdGFHcmlkVmlld1JvdyBvYmplY3RzLgogICAgICAgICAgICAuTk9URVMKICAgICAgICAgICAgICAgIFByb3ZpZGVzIE8oMSkgYXZlcmFnZSB0aW1lIGNvbXBsZXhpdHkgZm9yIGxvb2tpbmcgdXAgYSByb3cgYnkgcHJvY2VzcyBJRCwgaW1wcm92aW5nIHBlcmZvcm1hbmNlIGNvbXBhcmVkIHRvIGl0ZXJhdGluZyB0aHJvdWdoIHJvd3MuCiAgICAgICAgICAgICAgICBPbmx5IGluY2x1ZGVzIHJvd3Mgd2l0aCB2YWxpZCBwcm9jZXNzIGRhdGEgc3RvcmVkIGluIHRoZWlyIFRhZyBwcm9wZXJ0eS4KICAgICAgICAgICAgIz4KICAgICAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICAgICAgW091dHB1dFR5cGUoW2hhc2h0YWJsZV0pXQogICAgICAgICAgICBwYXJhbSgKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld10kR3JpZAogICAgICAgICAgICApCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEluaXRpYWxpemUgTG9va3VwIEhhc2h0YWJsZQogICAgICAgICAgICAgICAgJHJvd0xvb2t1cCA9IEB7fQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEluaXRpYWxpemUgTG9va3VwIEhhc2h0YWJsZQoKICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBQb3B1bGF0ZSBMb29rdXAgSGFzaHRhYmxlIGZyb20gR3JpZCBSb3dzCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcm93IGluICRHcmlkLlJvd3MpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIyBPbmx5IGFkZCByb3dzIHdpdGggdmFsaWQgcHJvY2VzcyBkYXRhIChUYWcgZXhpc3RzIGFuZCBoYXMgYW4gSWQpCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3cuVGFnIC1hbmQgJG51bGwgLW5lICRyb3cuVGFnLklkKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJvd0xvb2t1cFskcm93LlRhZy5JZF0gPSAkcm93CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFBvcHVsYXRlIExvb2t1cCBIYXNodGFibGUgZnJvbSBHcmlkIFJvd3MKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogUmV0dXJuIExvb2t1cCBIYXNodGFibGUKICAgICAgICAgICAgICAgIHJldHVybiAkcm93TG9va3VwCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogUmV0dXJuIExvb2t1cCBIYXNodGFibGUKICAgICAgICB9CiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBOZXctUm93TG9va3VwRGljdGlvbmFyeQoKICAgICNyZWdpb24gRnVuY3Rpb246IFVwZGF0ZS1FeGlzdGluZ1JvdwogICAgICAgIGZ1bmN0aW9uIFVwZGF0ZS1FeGlzdGluZ1JvdwoJCXsKCQkJPCMKICAgICAgICAgICAgLlNZTk9QU0lTCiAgICAgICAgICAgICAgICBVcGRhdGVzIHRoZSBjZWxsIHZhbHVlcyBhbmQgVGFnIHByb3BlcnR5IG9mIGFuIGV4aXN0aW5nIERhdGFHcmlkVmlld1JvdyB3aXRoIGN1cnJlbnQgcHJvY2VzcyBpbmZvcm1hdGlvbi4KICAgICAgICAgICAgLlBBUkFNRVRFUiBSb3cKICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXdSb3ddIFRoZSBzcGVjaWZpYyBncmlkIHJvdyB0byB1cGRhdGUuIChNYW5kYXRvcnkpCiAgICAgICAgICAgIC5QQVJBTUVURVIgSW5kZXgKICAgICAgICAgICAgICAgIFtpbnRdIFRoZSBzZXF1ZW50aWFsIGluZGV4IG51bWJlciAoc3RhcnRpbmcgZnJvbSAxKSB0byBkaXNwbGF5IGluIHRoZSBmaXJzdCBjb2x1bW4gKCcjJykuIChNYW5kYXRvcnkpCiAgICAgICAgICAgIC5QQVJBTUVURVIgUHJvY2Vzc1RpdGxlCiAgICAgICAgICAgICAgICBbc3RyaW5nXSBUaGUgY3VycmVudCB3aW5kb3cgdGl0bGUgKG9yIHByb2Nlc3MgbmFtZSBpZiB0aXRsZSBpcyBlbXB0eSkgdG8gZGlzcGxheS4gKE1hbmRhdG9yeSkKICAgICAgICAgICAgLlBBUkFNRVRFUiBQcm9jZXNzSWQKICAgICAgICAgICAgICAgIFtpbnRdIFRoZSBwcm9jZXNzIElEIHRvIGRpc3BsYXkuIChNYW5kYXRvcnkpCiAgICAgICAgICAgIC5QQVJBTUVURVIgUHJvY2VzcwogICAgICAgICAgICAgICAgW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzXSBUaGUgdXAtdG8tZGF0ZSBQcm9jZXNzIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhpcyByb3cuIFRoaXMgaXMgc3RvcmVkIGluIHRoZSByb3cncyBUYWcgcHJvcGVydHkuIChNYW5kYXRvcnkpCiAgICAgICAgICAgIC5PVVRQVVRTCiAgICAgICAgICAgICAgICBbdm9pZF0KICAgICAgICAgICAgLk5PVEVTCiAgICAgICAgICAgICAgICBVcGRhdGVzIGNlbGwgdmFsdWVzIG9ubHkgaWYgdGhleSBoYXZlIGFjdHVhbGx5IGNoYW5nZWQgdG8gbWluaW1pemUgdW5uZWNlc3NhcnkgVUkgcmVmcmVzaGVzLgogICAgICAgICAgICAgICAgVXBkYXRlcyB0aGUgcm93J3MgVGFnIHByb3BlcnR5IHdpdGggdGhlIGxhdGVzdCBQcm9jZXNzIG9iamVjdCByZWZlcmVuY2UuCiAgICAgICAgICAgICM+CiAgICAgICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgICAgIHBhcmFtKAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3Um93XSRSb3csCgogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgICAgICAgICBbaW50XSRJbmRleCwKCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgICAgIFtzdHJpbmddJFByb2Nlc3NUaXRsZSwKCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgICAgIFtpbnRdJFByb2Nlc3NJZCwKCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc10kUHJvY2VzcwogICAgICAgICAgICApCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFVwZGF0ZSBJbmRleCBDZWxsIChDb2x1bW4gMCkgaWYgQ2hhbmdlZAogICAgICAgICAgICAgICAgaWYgKCRSb3cuQ2VsbHNbMF0uVmFsdWUgLW5lICRJbmRleCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkUm93LkNlbGxzWzBdLlZhbHVlID0gJEluZGV4CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVXBkYXRlIEluZGV4IENlbGwgKENvbHVtbiAwKSBpZiBDaGFuZ2VkCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFVwZGF0ZSBUaXRsZSBDZWxsIChDb2x1bW4gMSkgaWYgQ2hhbmdlZAogICAgICAgICAgICAgICAgaWYgKCRSb3cuQ2VsbHNbMV0uVmFsdWUgLW5lICRQcm9jZXNzVGl0bGUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJFJvdy5DZWxsc1sxXS5WYWx1ZSA9ICRQcm9jZXNzVGl0bGUKICAgICAgICAgICAgICAgIH0KCQkJI2VuZHJlZ2lvbiBTdGVwOiBVcGRhdGUgSW5kZXggQ2VsbCAoQ29sdW1uIDApIGlmIENoYW5nZWQKCgkJCSNyZWdpb24gU3RlcDogVXBkYXRlIFBJRCBDZWxsIChDb2x1bW4gMikgaWYgQ2hhbmdlZAoJCQlpZiAoJFJvdy5DZWxsc1syXS5WYWx1ZSAtbmUgJFByb2Nlc3NJZCkKCQkJewoJCQkJJFJvdy5DZWxsc1syXS5WYWx1ZSA9ICRQcm9jZXNzSWQKCQkJfQoJCQkjZW5kcmVnaW9uIFN0ZXA6IFVwZGF0ZSBQSUQgQ2VsbCAoQ29sdW1uIDIpIGlmIENoYW5nZWQKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogVXBkYXRlIFJvdyBUYWcgd2l0aCBMYXRlc3QgUHJvY2VzcyBPYmplY3QKICAgICAgICAgICAgICAgICRSb3cuVGFnID0gJFByb2Nlc3MKICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBVcGRhdGUgUm93IFRhZyB3aXRoIExhdGVzdCBQcm9jZXNzIE9iamVjdAoJCX0KICAgICNlbmRyZWdpb24gRnVuY3Rpb246IFVwZGF0ZS1FeGlzdGluZ1JvdwoKICAgICNyZWdpb24gRnVuY3Rpb246IFVwZGF0ZVJvd0luZGljZXMKICAgICAgICBmdW5jdGlvbiBVcGRhdGVSb3dJbmRpY2VzCiAgICAgICAgewogICAgICAgICAgICA8IwogICAgICAgICAgICAuU1lOT1BTSVMKICAgICAgICAgICAgICAgIFVwZGF0ZXMgdGhlIGluZGV4IGNvbHVtbiAoJyMnLCBjb2x1bW4gMCkgZm9yIGFsbCByb3dzIGluIHRoZSBEYXRhR3JpZCB0byBlbnN1cmUgdGhleSBhcmUgc2VxdWVudGlhbCAoMSwgMiwgMywuLi4pLgogICAgICAgICAgICAuREVTQ1JJUFRJT04KICAgICAgICAgICAgICAgIEl0ZXJhdGVzIHRocm91Z2ggYWxsIHJvd3MgY3VycmVudGx5IGluIHRoZSBncmlkIGFuZCBzZXRzIHRoZSB2YWx1ZSBvZiB0aGUgZmlyc3QgY2VsbCAoaW5kZXggMCkKICAgICAgICAgICAgICAgIHRvIHRoZSByb3cncyBjdXJyZW50IHBvc2l0aW9uIHBsdXMgb25lICh0byBzdGFydCBudW1iZXJpbmcgZnJvbSAxKS4gVGhpcyBpcyBuZWNlc3NhcnkgYWZ0ZXIgcm93cwogICAgICAgICAgICAgICAgaGF2ZSBiZWVuIGFkZGVkIG9yIHJlbW92ZWQgdG8gbWFpbnRhaW4gY29ycmVjdCB2aXN1YWwgbnVtYmVyaW5nLgogICAgICAgICAgICAuUEFSQU1FVEVSIEdyaWQKICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXddIFRoZSBEYXRhR3JpZFZpZXcgd2hvc2Ugcm93IGluZGljZXMgbmVlZCB1cGRhdGluZy4gKE1hbmRhdG9yeSkKICAgICAgICAgICAgLk9VVFBVVFMKICAgICAgICAgICAgICAgIFt2b2lkXQogICAgICAgICAgICAuTk9URVMKICAgICAgICAgICAgICAgIEluY2x1ZGVzIGJhc2ljIGVycm9yIGhhbmRsaW5nIGZvciB0aGUgdXBkYXRlIHByb2Nlc3MuIE9ubHkgdXBkYXRlcyB0aGUgY2VsbCBpZiB0aGUgdmFsdWUgbmVlZHMgY2hhbmdpbmcuCiAgICAgICAgICAgICM+CiAgICAgICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgICAgIHBhcmFtKAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3XSRHcmlkCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogVXBkYXRlIFJvdyBJbmRpY2VzIFNhZmVseQogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBIYW5kbGUgRW1wdHkgR3JpZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJEdyaWQuUm93cy5Db3VudCAtZXEgMCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEhhbmRsZSBFbXB0eSBHcmlkCgogICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogSXRlcmF0ZSBUaHJvdWdoIFJvd3MgYW5kIFVwZGF0ZSBJbmRleCBDZWxsIChDb2x1bW4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIC1sdCAkR3JpZC5Sb3dzLkNvdW50OyAkaSsrKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93ID0gJEdyaWQuUm93c1skaV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXdJbmRleCA9ICRpICsgMSAgIyBTdGFydCBpbmRleCBudW1iZXJpbmcgZnJvbSAxCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBPbmx5IHVwZGF0ZSBpZiB0aGUgaW5kZXggaGFzIGNoYW5nZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcm93LkNlbGxzWzBdLlZhbHVlIC1uZSAkbmV3SW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvdy5DZWxsc1swXS5WYWx1ZSA9ICRuZXdJbmRleAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBJdGVyYXRlIFRocm91Z2ggUm93cyBhbmQgVXBkYXRlIEluZGV4IENlbGwgKENvbHVtbiAwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEhhbmRsZSBJbmRleCBVcGRhdGUgRXJyb3JzCiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRBVEFHUklEOiBGYWlsZWQgdG8gdXBkYXRlIHJvdyBpbmRpY2VzOiAkXyIgLUZvcmVncm91bmRDb2xvciBSZWQKICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEhhbmRsZSBJbmRleCBVcGRhdGUgRXJyb3JzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVXBkYXRlIFJvdyBJbmRpY2VzIFNhZmVseQogICAgICAgIH0KICAgICNlbmRyZWdpb24gRnVuY3Rpb246IFVwZGF0ZVJvd0luZGljZXMKCiAgICAjcmVnaW9uIEZ1bmN0aW9uOiBBZGQtTmV3UHJvY2Vzc1JvdwogICAgICAgIGZ1bmN0aW9uIEFkZC1OZXdQcm9jZXNzUm93CiAgICAgICAgewogICAgICAgICAgICA8IwogICAgICAgICAgICAuU1lOT1BTSVMKICAgICAgICAgICAgICAgIEFkZHMgYSBuZXcgcm93IHRvIHRoZSBEYXRhR3JpZCBmb3IgYSBuZXdseSBkZXRlY3RlZCBwcm9jZXNzLgogICAgICAgICAgICAuUEFSQU1FVEVSIEdyaWQKICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXddIFRoZSBEYXRhR3JpZFZpZXcgY29udHJvbCB0byBhZGQgdGhlIHJvdyB0by4gKE1hbmRhdG9yeSkKICAgICAgICAgICAgLlBBUkFNRVRFUiBQcm9jZXNzCiAgICAgICAgICAgICAgICBbU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3NdIFRoZSBQcm9jZXNzIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHByb2Nlc3MgdG8gYWRkLiAoTWFuZGF0b3J5KQogICAgICAgICAgICAuUEFSQU1FVEVSIEluZGV4CiAgICAgICAgICAgICAgICBbaW50XSBUaGUgc2VxdWVudGlhbCBpbmRleCBudW1iZXIgKHN0YXJ0aW5nIGZyb20gMSkgdG8gZGlzcGxheSBpbiB0aGUgZmlyc3QgY29sdW1uLiAoTWFuZGF0b3J5KQogICAgICAgICAgICAuUEFSQU1FVEVSIFByb2Nlc3NUaXRsZQogICAgICAgICAgICAgICAgW3N0cmluZ10gVGhlIHRpdGxlICh3aW5kb3cgdGl0bGUgb3IgcHJvY2VzcyBuYW1lKSB0byBkaXNwbGF5IGZvciB0aGUgcHJvY2Vzcy4gKE1hbmRhdG9yeSkKICAgICAgICAgICAgLk9VVFBVVFMKICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXdSb3ddIFRoZSBuZXdseSBhZGRlZCBEYXRhR3JpZFZpZXdSb3cgb2JqZWN0LCBvciAkbnVsbCBpZiBhbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgYWRkaXRpb24uCiAgICAgICAgICAgIC5OT1RFUwogICAgICAgICAgICAgICAgU2V0cyB0aGUgaW5pdGlhbCBzdGF0ZSBpbiB0aGUgJ1N0YXRlJyBjb2x1bW4gdG8gJ0NoZWNraW5nLi4uJy4KICAgICAgICAgICAgICAgIFN0b3JlcyB0aGUgUHJvY2VzcyBvYmplY3QgaW4gdGhlIG5ldyByb3cncyBUYWcgcHJvcGVydHkgZm9yIGxhdGVyIHJlZmVyZW5jZS4KICAgICAgICAgICAgICAgIEFkZHMgdGhlIHByb2Nlc3MgSUQgdG8gdGhlICRzY3JpcHQ6UHJvY2Vzc0NhY2hlLgogICAgICAgICAgICAgICAgSW5jbHVkZXMgZXJyb3IgaGFuZGxpbmcgZm9yIHRoZSByb3cgYWRkaXRpb24gcHJvY2Vzcy4KICAgICAgICAgICAgIz4KICAgICAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICAgICAgW091dHB1dFR5cGUoW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld1Jvd10pXQogICAgICAgICAgICBwYXJhbSgKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld10kR3JpZCwKCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc10kUHJvY2VzcywKCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgICAgIFtpbnRdJEluZGV4LAoKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICAgICAgW3N0cmluZ10kUHJvY2Vzc1RpdGxlCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogQWRkIFJvdyBhbmQgVXBkYXRlIENhY2hlIFNhZmVseQogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBBZGQgTmV3IFJvdyB0byBHcmlkIHdpdGggSW5pdGlhbCBEYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICMgQWRkcyBJbmRleCwgVGl0bGUsIFBJRCwgYW5kIGluaXRpYWwgU3RhdGUgKCdDaGVja2luZy4uLicpCiAgICAgICAgICAgICAgICAgICAgICAgICRyb3dJbmRleCA9ICRHcmlkLlJvd3MuQWRkKCRJbmRleCwgJFByb2Nlc3NUaXRsZSwgJFByb2Nlc3MuSWQsICRzY3JpcHQ6U3RhdGVzLkNoZWNraW5nKQogICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogQWRkIE5ldyBSb3cgdG8gR3JpZCB3aXRoIEluaXRpYWwgRGF0YQoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFN0b3JlIFByb2Nlc3MgT2JqZWN0IGluIFJvdyBUYWcKICAgICAgICAgICAgICAgICAgICAgICAgIyBTdG9yZSBwcm9jZXNzIG9iamVjdCBpbiByb3cncyBUYWcgcHJvcGVydHkgZm9yIGxhdGVyIHJlZmVyZW5jZSAoZS5nLiwgc3RhdGUgY2hlY2tzKQogICAgICAgICAgICAgICAgICAgICAgICAkR3JpZC5Sb3dzWyRyb3dJbmRleF0uVGFnID0gJFByb2Nlc3MKICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFN0b3JlIFByb2Nlc3MgT2JqZWN0IGluIFJvdyBUYWcKCiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBBZGQgUHJvY2VzcyB0byBDYWNoZQogICAgICAgICAgICAgICAgICAgICAgICAjIEFkZCB0byBwcm9jZXNzIGNhY2hlIHdpdGggY3VycmVudCB0aW1lc3RhbXAgYW5kIHdpbmRvdyBzdGF0dXMKICAgICAgICAgICAgICAgICAgICAgICAgJHNjcmlwdDpQcm9jZXNzQ2FjaGVbJFByb2Nlc3MuSWRdID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExhc3RTZWVuICA9IEdldC1EYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXNXaW5kb3cgPSAoJFByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSAtbmUgMCAtYW5kICRQcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUgLW5lIFtJbnRQdHJdOjpaZXJvKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBBZGQgUHJvY2VzcyB0byBDYWNoZQoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFJldHVybiBOZXdseSBBZGRlZCBSb3cKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRHcmlkLlJvd3NbJHJvd0luZGV4XQogICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogUmV0dXJuIE5ld2x5IEFkZGVkIFJvdwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEhhbmRsZSBSb3cgQWRkaXRpb24gRXJyb3JzCiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRBVEFHUklEOiBFcnJvciBhZGRpbmcgbmV3IHByb2Nlc3Mgcm93OiAkXyIgLUZvcmVncm91bmRDb2xvciBSZWQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRudWxsCiAgICAgICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBIYW5kbGUgUm93IEFkZGl0aW9uIEVycm9ycwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEFkZCBSb3cgYW5kIFVwZGF0ZSBDYWNoZSBTYWZlbHkKICAgICAgICB9CiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBBZGQtTmV3UHJvY2Vzc1JvdwoKICAgICNyZWdpb24gRnVuY3Rpb246IFN0YXJ0LVdpbmRvd1N0YXRlQ2hlY2sKICAgICAgICBmdW5jdGlvbiBTdGFydC1XaW5kb3dTdGF0ZUNoZWNrCiAgICAgICAgewogICAgICAgICAgICA8IwogICAgICAgICAgICAuU1lOT1BTSVMKICAgICAgICAgICAgICAgIEluaXRpYXRlcyBhbiBhc3luY2hyb25vdXMgY2hlY2sgZm9yIHRoZSB3aW5kb3cgc3RhdGUgKE5vcm1hbCwgTWluaW1pemVkLCBMb2FkaW5nL1VucmVzcG9uc2l2ZSkgb2YgYSBnaXZlbiBwcm9jZXNzLgogICAgICAgICAgICAuUEFSQU1FVEVSIFByb2Nlc3MKICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzc10gVGhlIHByb2Nlc3Mgd2hvc2Ugd2luZG93IHN0YXRlIG5lZWRzIGNoZWNraW5nLiAoTWFuZGF0b3J5KQogICAgICAgICAgICAuUEFSQU1FVEVSIFJvdwogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld1Jvd10gVGhlIGdyaWQgcm93IGFzc29jaWF0ZWQgd2l0aCB0aGUgcHJvY2Vzcywgd2hpY2ggd2lsbCBiZSB1cGRhdGVkIHdpdGggdGhlIHN0YXRlLiAoTWFuZGF0b3J5KQogICAgICAgICAgICAuUEFSQU1FVEVSIEdyaWQKICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXddIFRoZSBncmlkIGNvbnRhaW5pbmcgdGhlIHJvdyAodXNlZCBmb3IgY29udGV4dCBpbiB0aGUgY2FsbGJhY2spLiAoTWFuZGF0b3J5KQogICAgICAgICAgICAuT1VUUFVUUwogICAgICAgICAgICAgICAgW3ZvaWRdCiAgICAgICAgICAgIC5OT1RFUwogICAgICAgICAgICAgICAgVXNlcyB0aGUgY3VzdG9tIFtDdXN0b20uTmF0aXZlXTo6UmVzcG9uc2l2ZUFzeW5jIG1ldGhvZCBmb3IgYSBub24tYmxvY2tpbmcgcmVzcG9uc2l2ZW5lc3MgY2hlY2suCiAgICAgICAgICAgICAgICBJZiB0aGUgcHJvY2VzcyBoYXMgbm8gbWFpbiB3aW5kb3csIGl0IGRlZmF1bHRzIHRoZSBzdGF0ZSB0byAnTm9ybWFsJy4KICAgICAgICAgICAgICAgIFVzZXMgVGFzay5Db250aW51ZVdpdGggYW5kIFRhc2tTY2hlZHVsZXIuRnJvbUN1cnJlbnRTeW5jaHJvbml6YXRpb25Db250ZXh0KCkgdG8gZW5zdXJlIHRoZSBVSSB1cGRhdGUKICAgICAgICAgICAgICAgIChzZXR0aW5nIHRoZSByb3cncyBzdGF0ZSBjZWxsIHZhbHVlKSBoYXBwZW5zIHNhZmVseSBvbiB0aGUgVUkgdGhyZWFkIGFmdGVyIHRoZSBhc3luYyBjaGVjayBjb21wbGV0ZXMuCiAgICAgICAgICAgICAgICBJbmNsdWRlcyBlcnJvciBoYW5kbGluZyBmb3IgYm90aCB0aGUgYXN5bmMgdGFzayBpbml0aWF0aW9uIGFuZCB0aGUgVUkgdXBkYXRlIGNhbGxiYWNrLgogICAgICAgICAgICAjPgogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgICAgICBwYXJhbSgKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICAgICAgW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzXSRQcm9jZXNzLAoKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld1Jvd10kUm93LAoKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld10kR3JpZAogICAgICAgICAgICApCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEhhbmRsZSBQcm9jZXNzZXMgV2l0aG91dCBXaW5kb3dzCiAgICAgICAgICAgICAgICAjIElmIHRoZSBwcm9jZXNzIGhhcyBubyBtYWluIHdpbmRvdyBoYW5kbGUsIGFzc3VtZSAnTm9ybWFsJyBzdGF0ZSBhbmQgc2tpcCBhc3luYyBjaGVjay4KICAgICAgICAgICAgICAgIGlmICgkUHJvY2Vzcy5NYWluV2luZG93SGFuZGxlIC1lcSAwIC1vciAkUHJvY2Vzcy5NYWluV2luZG93SGFuZGxlIC1lcSBbSW50UHRyXTo6WmVybykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHJvdyBzdGlsbCBleGlzdHMgYW5kIHVwZGF0ZSBzdGF0ZSBpZiBuZWVkZWQKICAgICAgICAgICAgICAgICAgICBpZiAoJFJvdyAtbmUgJG51bGwgLWFuZCAkUm93LkluZGV4IC1nZSAwIC1hbmQgJFJvdy5DZWxsc1szXS5WYWx1ZSAtbmUgJHNjcmlwdDpTdGF0ZXMuTm9ybWFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgJFJvdy5DZWxsc1szXS5WYWx1ZSA9ICRzY3JpcHQ6U3RhdGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBIYW5kbGUgUHJvY2Vzc2VzIFdpdGhvdXQgV2luZG93cwoKICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBQZXJmb3JtIEFzeW5jaHJvbm91cyBXaW5kb3cgU3RhdGUgQ2hlY2sKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogU3RhcnQgQXN5bmNocm9ub3VzIFJlc3BvbnNpdmVuZXNzIENoZWNrCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2FsbCBuYXRpdmUgaGVscGVyIHRvIGNoZWNrIHJlc3BvbnNpdmVuZXNzIHdpdGhvdXQgYmxvY2tpbmcKICAgICAgICAgICAgICAgICAgICAgICAgJHRhc2sgPSBbQ3VzdG9tLk5hdGl2ZV06OlJlc3BvbnNpdmVBc3luYygkUHJvY2Vzcy5NYWluV2luZG93SGFuZGxlKQogICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogU3RhcnQgQXN5bmNocm9ub3VzIFJlc3BvbnNpdmVuZXNzIENoZWNrCgogICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogUHJlcGFyZSBTdGF0ZSBEYXRhIGZvciBDYWxsYmFjawogICAgICAgICAgICAgICAgICAgICAgICAjIFBhY2thZ2UgbmVjZXNzYXJ5IGRhdGEgdG8gcGFzcyB0byB0aGUgY29udGludWF0aW9uIChjYWxsYmFjaykKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlRGF0YSA9IEB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNzSWQgPSAkUHJvY2Vzcy5JZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUm93SW5kZXggID0gJFJvdy5JbmRleCAjIFN0b3JlIGluZGV4IGFzIHJvdyBvYmplY3QgbWlnaHQgYmVjb21lIGludmFsaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhXbmQgICAgICA9ICRQcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUgIyBVc2UgaGFuZGxlIGZyb20gcHJvY2VzcyBvYmplY3QgZGlyZWN0bHkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogUHJlcGFyZSBTdGF0ZSBEYXRhIGZvciBDYWxsYmFjawoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEdldCBVSSBUaHJlYWQgU2NoZWR1bGVyCiAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IHRoZSBzY2hlZHVsZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBjdXJyZW50IFVJIHRocmVhZCBmb3Igc2FmZSB1cGRhdGVzCiAgICAgICAgICAgICAgICAgICAgICAgICRzY2hlZHVsZXIgPSBbU3lzdGVtLlRocmVhZGluZy5UYXNrcy5UYXNrU2NoZWR1bGVyXTo6RnJvbUN1cnJlbnRTeW5jaHJvbml6YXRpb25Db250ZXh0KCkKICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEdldCBVSSBUaHJlYWQgU2NoZWR1bGVyCgogICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogRGVmaW5lIENvbnRpbnVhdGlvbiBBY3Rpb24gKENhbGxiYWNrIGZvciBVSSBVcGRhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICMgVGhpcyBhY3Rpb24gcnVucyBvbiB0aGUgVUkgdGhyZWFkIGFmdGVyIHRoZSBhc3luYyB0YXNrIGNvbXBsZXRlcwogICAgICAgICAgICAgICAgICAgICAgICAkY29udGludWF0aW9uQWN0aW9uID0gW1N5c3RlbS5BY3Rpb25bU3lzdGVtLlRocmVhZGluZy5UYXNrcy5UYXNrLCBPYmplY3RdXSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSgkY29tcGxldGVkVGFzaywgJHN0YXRlKSAjIFJlbmFtZWQgc3RhdGVEYXRhIHBhcmFtZXRlciB0byBzdGF0ZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogQ2FsbGJhY2sgLSBIYW5kbGUgVUkgVXBkYXRlIFNhZmVseQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDYWxsYmFjayAtIEdldCBDb250ZXh0IERhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmV0cmlldmUgZ3JpZCByZWZlcmVuY2UgYW5kIHN0YXRlIGRhdGEgd2l0aGluIHRoZSBjYWxsYmFjayBjb250ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3VycmVudEdyaWQgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5EYXRhR3JpZEZpbGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2Nlc3NJZCA9ICRzdGF0ZS5Qcm9jZXNzSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb3dJbmRleCA9ICRzdGF0ZS5Sb3dJbmRleAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhXbmQgPSAkc3RhdGUuaFduZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENhbGxiYWNrIC0gR2V0IENvbnRleHQgRGF0YQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDYWxsYmFjayAtIFZhbGlkYXRlIEdyaWQgYW5kIFJvdyBFeGlzdGVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRXhpdCBpZiBncmlkIGlzIGRpc3Bvc2VkIG9yIHJvdyBpbmRleCBpcyBpbnZhbGlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLW5vdCAkY3VycmVudEdyaWQgLW9yICRjdXJyZW50R3JpZC5Jc0Rpc3Bvc2VkIC1vciAkcm93SW5kZXggLWx0IDAgLW9yICRyb3dJbmRleCAtZ2UgJGN1cnJlbnRHcmlkLlJvd3MuQ291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEZpbmQgdGhlIHRhcmdldCByb3cgdXNpbmcgdGhlIHN0b3JlZCBpbmRleCwgdmVyaWZ5IGl0J3MgdGhlIGNvcnJlY3QgcHJvY2VzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFJvdyA9ICRjdXJyZW50R3JpZC5Sb3dzWyRyb3dJbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbnVsbCAtZXEgJHRhcmdldFJvdyAtb3IgJG51bGwgLWVxICR0YXJnZXRSb3cuVGFnIC1vciAkdGFyZ2V0Um93LlRhZy5JZCAtbmUgJHByb2Nlc3NJZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUm93IG1pZ2h0IGhhdmUgYmVlbiByZW1vdmVkIG9yIGNoYW5nZWQsIHRyeSBmaW5kaW5nIGJ5IElEIGFzIGZhbGxiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFJvdyA9IEZpbmQtVGFyZ2V0Um93IC1HcmlkICRjdXJyZW50R3JpZCAtUHJvY2Vzc0lkICRwcm9jZXNzSWQgLVJvd0luZGV4IC0xICMgVXNlIC0xIHRvIGZvcmNlIHNlYXJjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbnVsbCAtZXEgJHRhcmdldFJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIyBSb3cgbm90IGZvdW5kLCBjYW5ub3QgdXBkYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENhbGxiYWNrIC0gVmFsaWRhdGUgR3JpZCBhbmQgUm93IEV4aXN0ZW5jZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDYWxsYmFjayAtIERldGVybWluZSBXaW5kb3cgU3RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgbWluaW1pemVkIHN0YXRlIHVzaW5nIG5hdGl2ZSBoZWxwZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpc01pbmltaXplZCA9IFtDdXN0b20uTmF0aXZlXTo6SXNNaW5pbWl6ZWQoJGhXbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXNSZXNwb25zaXZlID0gJG51bGwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEdldCByZXNwb25zaXZlbmVzcyByZXN1bHQgZnJvbSB0aGUgY29tcGxldGVkIGFzeW5jIHRhc2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkY29tcGxldGVkVGFzay5TdGF0dXMgLWVxIFtTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzLlRhc2tTdGF0dXNdOjpSYW5Ub0NvbXBsZXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGlzUmVzcG9uc2l2ZSA9ICRjb21wbGV0ZWRUYXNrLlJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRGV0ZXJtaW5lIHRoZSBmaW5hbCBkaXNwbGF5IHN0YXRlIGJhc2VkIG9uIHJlc3BvbnNpdmVuZXNzIGFuZCBtaW5pbWl6ZWQgc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmluYWxTdGF0ZSA9IGlmICgtbm90ICRpc1Jlc3BvbnNpdmUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjcmlwdDpTdGF0ZXMuTG9hZGluZyAjIFVucmVzcG9uc2l2ZSBtYXBzIHRvIExvYWRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJGlzTWluaW1pemVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY3JpcHQ6U3RhdGVzLk1pbmltaXplZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY3JpcHQ6U3RhdGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEhpZGUgb3Igc2hvdyB0aGUgd2luZG93IGZyb20gQWx0K1RhYiBiYXNlZCBvbiBpdHMgbWluaW1pemVkIHN0YXRlIGFuZCB0aGUgc2V0dGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaFduZCAtbmUgMCAtYW5kICRoV25kIC1uZSBbSW50UHRyXTo6WmVybykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoaWRlTWluaW1pemVkT3B0aW9uID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydPcHRpb25zJ11bJ0hpZGVNaW5pbWl6ZWRXaW5kb3dzJ10gLWVxICcxJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGhpZGVNaW5pbWl6ZWRPcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgaGlkaW5nIGlzIGVuYWJsZWQgQU5EIHRoZSB3aW5kb3cgaXMgbWluaW1pemVkLCBhcHBseSB0b29sIHN0eWxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGlzTWluaW1pemVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI1NldC1XaW5kb3dUb29sU3R5bGUgLWhXbmQgJGhXbmQgLUhpZGUgJHRydWUKCQkJCQkJCQkJCQkJCSBTZXQtV2luZG93VG9vbFN0eWxlIC1oV25kICRoV25kIC1IaWRlICRmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiBoaWRpbmcgaXMgZW5hYmxlZCBidXQgd2luZG93IGlzIE5PVCBtaW5pbWl6ZWQsIGVuc3VyZSBpdCdzIHZpc2libGUgKHVzZXIgcmVzdG9yZWQgaXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0LVdpbmRvd1Rvb2xTdHlsZSAtaFduZCAkaFduZCAtSGlkZSAkZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgaGlkaW5nIGlzIE5PVCBlbmFibGVkLCBlbnN1cmUgaXQncyB2aXNpYmxlIHJlZ2FyZGxlc3Mgb2YgbWluaW1pemVkIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXQtV2luZG93VG9vbFN0eWxlIC1oV25kICRoV25kIC1IaWRlICRmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENhbGxiYWNrIC0gRGV0ZXJtaW5lIFdpbmRvdyBTdGF0ZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDYWxsYmFjayAtIFVwZGF0ZSBSb3cgU3RhdGUgQ2VsbCBpZiBDaGFuZ2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZSB0aGUgc3RhdGUgY2VsbCAoY29sdW1uIDMpIG9ubHkgaWYgdGhlIHN0YXRlIGhhcyBjaGFuZ2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3VycmVudFN0YXRlID0gJHRhcmdldFJvdy5DZWxsc1szXS5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRjdXJyZW50U3RhdGUgLW5lICRmaW5hbFN0YXRlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRSb3cuQ2VsbHNbM10uVmFsdWUgPSAkZmluYWxTdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENhbGxiYWNrIC0gVXBkYXRlIFJvdyBTdGF0ZSBDZWxsIGlmIENoYW5nZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgU2lsZW50IGVycm9yIGhhbmRsaW5nIGZvciBVSSB1cGRhdGUgY2FsbGJhY2sgdG8gcHJldmVudCBjcmFzaGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBDYWxsYmFjayAtIEhhbmRsZSBVSSBVcGRhdGUgU2FmZWx5CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IERlZmluZSBDb250aW51YXRpb24gQWN0aW9uIChDYWxsYmFjayBmb3IgVUkgVXBkYXRlKQoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFNjaGVkdWxlIENvbnRpbnVhdGlvbiBBY3Rpb24gdG8gUnVuIG9uIFVJIFRocmVhZAogICAgICAgICAgICAgICAgICAgICAgICAjIFNjaGVkdWxlIHRoZSBjb250aW51YXRpb24gYWN0aW9uIHRvIHJ1biB3aGVuIHRoZSBhc3luYyB0YXNrIGZpbmlzaGVzLAogICAgICAgICAgICAgICAgICAgICAgICAjIHBhc3NpbmcgdGhlIHN0YXRlIGRhdGEgYW5kIGVuc3VyaW5nIGl0IGV4ZWN1dGVzIG9uIHRoZSBVSSB0aHJlYWQgdmlhIHRoZSBzY2hlZHVsZXIuCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXNrLkNvbnRpbnVlV2l0aCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb250aW51YXRpb25BY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGVEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgW1N5c3RlbS5UaHJlYWRpbmcuQ2FuY2VsbGF0aW9uVG9rZW5dOjpOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgW1N5c3RlbS5UaHJlYWRpbmcuVGFza3MuVGFza0NvbnRpbnVhdGlvbk9wdGlvbnNdOjpOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjaGVkdWxlcgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBTY2hlZHVsZSBDb250aW51YXRpb24gQWN0aW9uIHRvIFJ1biBvbiBVSSBUaHJlYWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBIYW5kbGUgQXN5bmNocm9ub3VzIENoZWNrIEluaXRpYXRpb24gRXJyb3JzCiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgc3RhcnRpbmcgdGhlIGFzeW5jIGNoZWNrIGZhaWxzLCBkZWZhdWx0IHRoZSByb3cgc3RhdGUgdG8gJ05vcm1hbCcKICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUm93IC1uZSAkbnVsbCAtYW5kICRSb3cuSW5kZXggLWdlIDAgLWFuZCAkUm93LkNlbGxzWzNdLlZhbHVlIC1uZSAkc2NyaXB0OlN0YXRlcy5Ob3JtYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSb3cuQ2VsbHNbM10uVmFsdWUgPSAkc2NyaXB0OlN0YXRlcy5Ob3JtYWwKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEhhbmRsZSBBc3luY2hyb25vdXMgQ2hlY2sgSW5pdGlhdGlvbiBFcnJvcnMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBQZXJmb3JtIEFzeW5jaHJvbm91cyBXaW5kb3cgU3RhdGUgQ2hlY2sKICAgICAgICB9CiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBTdGFydC1XaW5kb3dTdGF0ZUNoZWNrCgogICAgI3JlZ2lvbiBGdW5jdGlvbjogRmluZC1UYXJnZXRSb3cKICAgICAgICBmdW5jdGlvbiBGaW5kLVRhcmdldFJvdwogICAgICAgIHsKICAgICAgICAgICAgPCMKICAgICAgICAgICAgLlNZTk9QU0lTCiAgICAgICAgICAgICAgICBFZmZpY2llbnRseSBmaW5kcyBhIHNwZWNpZmljIERhdGFHcmlkVmlld1JvdyBiYXNlZCBwcmltYXJpbHkgb24gUHJvY2VzcyBJRCwgdXNpbmcgdGhlIFJvd0luZGV4IGFzIGEgaGludC4KICAgICAgICAgICAgLlBBUkFNRVRFUiBHcmlkCiAgICAgICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3XSBUaGUgRGF0YUdyaWRWaWV3IGNvbnRyb2wgdG8gc2VhcmNoIHdpdGhpbi4gKE1hbmRhdG9yeSkKICAgICAgICAgICAgLlBBUkFNRVRFUiBQcm9jZXNzSWQKICAgICAgICAgICAgICAgIFtpbnRdIFRoZSBJRCBvZiB0aGUgcHJvY2VzcyB3aG9zZSBjb3JyZXNwb25kaW5nIHJvdyBpcyBiZWluZyBzb3VnaHQuIChNYW5kYXRvcnkpCiAgICAgICAgICAgIC5QQVJBTUVURVIgUm93SW5kZXgKICAgICAgICAgICAgICAgIFtpbnRdIFRoZSBleHBlY3RlZCBpbmRleCBvZiB0aGUgcm93LiBUaGlzIGlzIGNoZWNrZWQgZmlyc3QgZm9yIGVmZmljaWVuY3kuIElmIC0xLCBza2lwcyBkaXJlY3QgaW5kZXggY2hlY2suIChNYW5kYXRvcnkpCiAgICAgICAgICAgIC5QQVJBTUVURVIgV2luZG93SGFuZGxlCiAgICAgICAgICAgICAgICBbSW50UHRyXSBBbiBvcHRpb25hbCB3aW5kb3cgaGFuZGxlLiBJZiBwcm92aWRlZCwgdGhlIGZ1bmN0aW9uIHZlcmlmaWVzIHRoYXQgdGhlIGZvdW5kIHJvdydzIGFzc29jaWF0ZWQgcHJvY2VzcyBtYXRjaGVzIHRoaXMgaGFuZGxlLiAoT3B0aW9uYWwsIGRlZmF1bHRzIHRvIFplcm8pCiAgICAgICAgICAgIC5PVVRQVVRTCiAgICAgICAgICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3Um93XSBUaGUgZm91bmQgRGF0YUdyaWRWaWV3Um93IG9iamVjdCwgb3IgJG51bGwgaWYgbm8gbWF0Y2hpbmcgcm93IGlzIGZvdW5kIG9yIGlmIHRoZSBvcHRpb25hbCBXaW5kb3dIYW5kbGUgdmVyaWZpY2F0aW9uIGZhaWxzLgogICAgICAgICAgICAuTk9URVMKICAgICAgICAgICAgICAgIE9wdGltaXplZCBieSBmaXJzdCBjaGVja2luZyB0aGUgcHJvdmlkZWQgUm93SW5kZXguIElmIHRoYXQgZmFpbHMgb3IgaXMgc2tpcHBlZCwgaXQgZmFsbHMgYmFjayB0byBhIGxpbmVhciBzZWFyY2ggdGhyb3VnaCBhbGwgcm93cywgbWF0Y2hpbmcgYnkgUHJvY2Vzc0lkIHN0b3JlZCBpbiB0aGUgcm93J3MgVGFnIHByb3BlcnR5LgogICAgICAgICAgICAgICAgSW5jbHVkZXMgb3B0aW9uYWwgdmVyaWZpY2F0aW9uIGFnYWluc3QgYSBXaW5kb3dIYW5kbGUuCiAgICAgICAgICAgICM+CiAgICAgICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgICAgIFtPdXRwdXRUeXBlKFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXdSb3ddKV0KICAgICAgICAgICAgcGFyYW0oCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5EYXRhR3JpZFZpZXddJEdyaWQsCgogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgICAgICAgICBbaW50XSRQcm9jZXNzSWQsCgogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgICAgICAgICBbaW50XSRSb3dJbmRleCwKCiAgICAgICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRmYWxzZSldCiAgICAgICAgICAgICAgICBbSW50UHRyXSRXaW5kb3dIYW5kbGUgPSBbSW50UHRyXTo6WmVybwogICAgICAgICAgICApCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEF0dGVtcHQgRGlyZWN0IEluZGV4IEFjY2VzcyAoaWYgUm93SW5kZXggaXMgdmFsaWQpCiAgICAgICAgICAgICAgICAkcm93ID0gJG51bGwKICAgICAgICAgICAgICAgIGlmICgkUm93SW5kZXggLWdlIDAgLWFuZCAkUm93SW5kZXggLWx0ICRHcmlkLlJvd3MuQ291bnQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHBvdGVudGlhbFJvdyA9ICRHcmlkLlJvd3NbJFJvd0luZGV4XQoKICAgICAgICAgICAgICAgICAgICAjIFZlcmlmeSB0aGUgcm93IGF0IHRoZSBpbmRleCBjb250YWlucyB0aGUgY29ycmVjdCBwcm9jZXNzIElECiAgICAgICAgICAgICAgICAgICAgaWYgKCRwb3RlbnRpYWxSb3cuVGFnIC1hbmQgJHBvdGVudGlhbFJvdy5UYWcuSWQgLWVxICRQcm9jZXNzSWQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAjIE9wdGlvbmFsOiBWZXJpZnkgd2luZG93IGhhbmRsZSBpZiBwcm92aWRlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJFdpbmRvd0hhbmRsZSAtZXEgW0ludFB0cl06Olplcm8gLW9yICgkcG90ZW50aWFsUm93LlRhZy5NYWluV2luZG93SGFuZGxlIC1lcSAkV2luZG93SGFuZGxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93ID0gJHBvdGVudGlhbFJvdwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEF0dGVtcHQgRGlyZWN0IEluZGV4IEFjY2VzcyAoaWYgUm93SW5kZXggaXMgdmFsaWQpCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEZhbGxiYWNrIHRvIExpbmVhciBTZWFyY2ggaWYgRGlyZWN0IEFjY2VzcyBGYWlsZWQgb3IgU2tpcHBlZAogICAgICAgICAgICAgICAgaWYgKCRudWxsIC1lcSAkcm93KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyIGluICRHcmlkLlJvd3MpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHJvdyBoYXMgdGFnIGFuZCBtYXRjaGluZyBwcm9jZXNzIElECiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkci5UYWcgLWFuZCAkci5UYWcuSWQgLWVxICRQcm9jZXNzSWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgT3B0aW9uYWw6IFZlcmlmeSB3aW5kb3cgaGFuZGxlIGlmIHByb3ZpZGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJFdpbmRvd0hhbmRsZSAtZXEgW0ludFB0cl06Olplcm8gLW9yICgkci5UYWcuTWFpbldpbmRvd0hhbmRsZSAtZXEgJFdpbmRvd0hhbmRsZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvdyA9ICRyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgIyBGb3VuZCB0aGUgcm93LCBleGl0IGxvb3AKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBGYWxsYmFjayB0byBMaW5lYXIgU2VhcmNoIGlmIERpcmVjdCBBY2Nlc3MgRmFpbGVkIG9yIFNraXBwZWQKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogUmV0dXJuIEZvdW5kIFJvdyAob3IgbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAkcm93CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogUmV0dXJuIEZvdW5kIFJvdyAob3IgbnVsbCkKICAgICAgICB9CiAgICAjZW5kcmVnaW9uIEZ1bmN0aW9uOiBGaW5kLVRhcmdldFJvdwoKICAgICNyZWdpb24gRnVuY3Rpb246IENsZWFyLU9sZFByb2Nlc3NDYWNoZQogICAgICAgIGZ1bmN0aW9uIENsZWFyLU9sZFByb2Nlc3NDYWNoZQogICAgICAgIHsKICAgICAgICAgICAgPCMKICAgICAgICAgICAgLlNZTk9QU0lTCiAgICAgICAgICAgICAgICBDbGVhbnMgdXAgZW50cmllcyBmcm9tIHRoZSAkc2NyaXB0OlByb2Nlc3NDYWNoZSB0aGF0IGhhdmVuJ3QgYmVlbiBzZWVuIHJlY2VudGx5LgogICAgICAgICAgICAuT1VUUFVUUwogICAgICAgICAgICAgICAgW3ZvaWRdCiAgICAgICAgICAgIC5OT1RFUwogICAgICAgICAgICAgICAgSXRlcmF0ZXMgdGhyb3VnaCB0aGUgcHJvY2VzcyBjYWNoZSBhbmQgcmVtb3ZlcyBlbnRyaWVzIHdob3NlICdMYXN0U2VlbicgdGltZXN0YW1wCiAgICAgICAgICAgICAgICBpcyBvbGRlciB0aGFuIGEgcHJlZGVmaW5lZCB0aHJlc2hvbGQgKGN1cnJlbnRseSA1IG1pbnV0ZXMpLiBUaGlzIHByZXZlbnRzIHRoZSBjYWNoZQogICAgICAgICAgICAgICAgZnJvbSBncm93aW5nIGluZGVmaW5pdGVseSB3aXRoIHN0YWxlIGRhdGEgZnJvbSBwcm9jZXNzZXMgdGhhdCB0ZXJtaW5hdGVkIGxvbmcgYWdvLgogICAgICAgICAgICAjPgogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgICAgICBwYXJhbSgpCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IEluaXRpYWxpemUgVmFyaWFibGVzCiAgICAgICAgICAgICAgICAkbm93ID0gR2V0LURhdGUKICAgICAgICAgICAgICAgICRrZXlzVG9SZW1vdmUgPSBbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdFtvYmplY3RdXTo6bmV3KCkKICAgICAgICAgICAgICAgICR0aHJlc2hvbGRNaW51dGVzID0gNSAjIERlZmluZSBjbGVhbnVwIHRocmVzaG9sZAogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEluaXRpYWxpemUgVmFyaWFibGVzCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IElkZW50aWZ5IENhY2hlIEtleXMgT2xkZXIgVGhhbiBUaHJlc2hvbGQKICAgICAgICAgICAgICAgICMgSXRlcmF0ZSBzYWZlbHkgb3ZlciBhIGNvcHkgb2YgdGhlIGtleXMgaW4gY2FzZSB0aGUgY29sbGVjdGlvbiBpcyBtb2RpZmllZAogICAgICAgICAgICAgICAgJGNhY2hlS2V5cyA9IEAoJHNjcmlwdDpQcm9jZXNzQ2FjaGUuS2V5cykKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRrZXkgaW4gJGNhY2hlS2V5cykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIGtleSBzdGlsbCBleGlzdHMgYmVmb3JlIGFjY2Vzc2luZwogICAgICAgICAgICAgICAgICAgIGlmICgkc2NyaXB0OlByb2Nlc3NDYWNoZS5Db250YWluc0tleSgka2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZW50cnkgPSAkc2NyaXB0OlByb2Nlc3NDYWNoZVska2V5XQogICAgICAgICAgICAgICAgICAgICAgICAjIEVuc3VyZSBMYXN0U2VlbiBwcm9wZXJ0eSBleGlzdHMgYW5kIGlzIGEgRGF0ZVRpbWUgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZW50cnkgLWFuZCAkZW50cnkuQ29udGFpbnNLZXkoJ0xhc3RTZWVuJykgLWFuZCAkZW50cnkuTGFzdFNlZW4gLWlzIFtEYXRlVGltZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhZ2UgPSAoJG5vdyAtICRlbnRyeS5MYXN0U2VlbikuVG90YWxNaW51dGVzCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBNYXJrIGVudHJpZXMgb2xkZXIgdGhhbiB0aGUgdGhyZXNob2xkIGZvciByZW1vdmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGFnZSAtZ3QgJHRocmVzaG9sZE1pbnV0ZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGtleXNUb1JlbW92ZS5BZGQoJGtleSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE1hcmsgaW52YWxpZCBlbnRyaWVzIGZvciByZW1vdmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGtleXNUb1JlbW92ZS5BZGQoJGtleSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBJZGVudGlmeSBDYWNoZSBLZXlzIE9sZGVyIFRoYW4gVGhyZXNob2xkCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFJlbW92ZSBJZGVudGlmaWVkIEtleXMgZnJvbSBDYWNoZQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGtleSBpbiAka2V5c1RvUmVtb3ZlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgYWdhaW4gaWYga2V5IGV4aXN0cyBiZWZvcmUgcmVtb3ZpbmcKICAgICAgICAgICAgICAgICAgICBpZiAoJHNjcmlwdDpQcm9jZXNzQ2FjaGUuQ29udGFpbnNLZXkoJGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNjcmlwdDpQcm9jZXNzQ2FjaGUuUmVtb3ZlKCRrZXkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFJlbW92ZSBJZGVudGlmaWVkIEtleXMgZnJvbSBDYWNoZQogICAgICAgIH0KICAgICNlbmRyZWdpb24gRnVuY3Rpb246IENsZWFyLU9sZFByb2Nlc3NDYWNoZQoKICAgICNyZWdpb24gRnVuY3Rpb246IFNldC1XaW5kb3dUb29sU3R5bGUKICAgICAgICBmdW5jdGlvbiBTZXQtV2luZG93VG9vbFN0eWxlCiAgICAgICAgewogICAgICAgICAgICA8IwogICAgICAgICAgICAuU1lOT1BTSVMKICAgICAgICAgICAgICAgIEhpZGVzIG9yIHNob3dzIGEgd2luZG93IGZyb20gdGhlIEFMVCtUQUIgdGFzayBzd2l0Y2hlciBieSBhcHBseWluZyBvciByZW1vdmluZyB0aGUgV1NfRVhfVE9PTFdJTkRPVyBleHRlbmRlZCBzdHlsZS4KICAgICAgICAgICAgLk5PVEVTCiAgICAgICAgICAgICAgICBVcGRhdGVkIHRvIHVzZSA2NC1iaXQgc2FmZSBQL0ludm9rZSBjYWxscyBhbmQgZm9yY2UgYSBmcmFtZSByZWRyYXcuCiAgICAgICAgICAgICM+CiAgICAgICAgICAgIHBhcmFtKAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgICAgICAgICBbSW50UHRyXSRoV25kLAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkZmFsc2UpXQogICAgICAgICAgICAgICAgW2Jvb2xdJEhpZGUgPSAkdHJ1ZQogICAgICAgICAgICApCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IERlZmluZSBXaW5kb3cgU3R5bGUgQ29uc3RhbnRzCiAgICAgICAgICAgICAgICAkR1dMX0VYU1RZTEUgPSAtMjAKICAgICAgICAgICAgICAgICRXU19FWF9UT09MV0lORE9XID0gMHgwMDAwMDA4MAogICAgICAgICAgICAgICAgJFdTX0VYX0FQUFdJTkRPVyA9IDB4MDAwNDAwMDAKICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBEZWZpbmUgV2luZG93IFN0eWxlIENvbnN0YW50cwoKICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBBcHBseSBvciBSZW1vdmUgV1NfRVhfVE9PTFdJTkRPVyBTdHlsZQogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIyAxLiBHZXQgY3VycmVudCBzdHlsZSB1c2luZyA2NC1iaXQgc2FmZSBtZXRob2QKICAgICAgICAgICAgICAgICAgICBbSW50UHRyXSRjdXJyZW50RXhTdHlsZVB0ciA9IFtDdXN0b20uTmF0aXZlXTo6R2V0V2luZG93TG9uZ1B0cigkaFduZCwgJEdXTF9FWFNUWUxFKQogICAgICAgICAgICAgICAgICAgIFtsb25nXSRjdXJyZW50RXhTdHlsZSA9ICRjdXJyZW50RXhTdHlsZVB0ci5Ub0ludDY0KCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkbmV3RXhTdHlsZSA9IDAKCiAgICAgICAgICAgICAgICAgICAgJGhpZGVNaW5pbWl6ZWQgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ09wdGlvbnMnXVsnSGlkZU1pbmltaXplZFdpbmRvd3MnXSAtZXEgJzEnCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCRIaWRlIC1hbmQgJGhpZGVNaW5pbWl6ZWQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAjIEFkZCBXU19FWF9UT09MV0lORE9XIChIaWRlIGZyb20gQWx0LVRhYikKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZW1vdmUgV1NfRVhfQVBQV0lORE9XIChSZW1vdmUgZnJvbSBUYXNrYmFyKQogICAgICAgICAgICAgICAgICAgICAgICAjJG5ld0V4U3R5bGUgPSAoJGN1cnJlbnRFeFN0eWxlIC1ib3IgJFdTX0VYX1RPT0xXSU5ET1cpIC1iYW5kICgtYm5vdCAkV1NfRVhfQVBQV0lORE9XKQoJCQkJCQkkbmV3RXhTdHlsZSA9ICgkY3VycmVudEV4U3R5bGUgLWJhbmQgKC1ibm90ICRXU19FWF9UT09MV0lORE9XKSkgLWJvciAkV1NfRVhfQVBQV0lORE9XCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVtb3ZlIFdTX0VYX1RPT0xXSU5ET1cKICAgICAgICAgICAgICAgICAgICAgICAgIyBBZGQgV1NfRVhfQVBQV0lORE9XIChGb3JjZSBvbnRvIFRhc2tiYXIpCiAgICAgICAgICAgICAgICAgICAgICAgICRuZXdFeFN0eWxlID0gKCRjdXJyZW50RXhTdHlsZSAtYmFuZCAoLWJub3QgJFdTX0VYX1RPT0xXSU5ET1cpKSAtYm9yICRXU19FWF9BUFBXSU5ET1cKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgMi4gT25seSBhcHBseSBpZiBjaGFuZ2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKCRuZXdFeFN0eWxlIC1uZSAkY3VycmVudEV4U3R5bGUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAjIENvbnZlcnQgYmFjayB0byBJbnRQdHIgZm9yIHRoZSBBUEkgY2FsbAogICAgICAgICAgICAgICAgICAgICAgICBbSW50UHRyXSRuZXdFeFN0eWxlUHRyID0gW0ludFB0cl0kbmV3RXhTdHlsZQogICAgICAgICAgICAgICAgICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06OlNldFdpbmRvd0xvbmdQdHIoJGhXbmQsICRHV0xfRVhTVFlMRSwgJG5ld0V4U3R5bGVQdHIpIHwgT3V0LU51bGwKCiAgICAgICAgICAgICAgICAgICAgICAgICMgMy4gQ1JJVElDQUw6IEZvcmNlIFdpbmRvdyBNYW5hZ2VyIHRvIHJlZnJlc2ggdGhlIHN0eWxlCiAgICAgICAgICAgICAgICAgICAgICAgICMgU1dQX05PTU9WRSB8IFNXUF9OT1NJWkUgfCBTV1BfTk9aT1JERVIgfCBTV1BfRlJBTUVDSEFOR0VEIHwgU1dQX05PQUNUSVZBVEUKICAgICAgICAgICAgICAgICAgICAgICAgJGZsYWdzID0gW0N1c3RvbS5OYXRpdmVdOjpTV1BfTk9NT1ZFIC1ib3IgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06OlNXUF9OT1NJWkUgLWJvciBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtDdXN0b20uTmF0aXZlXTo6U1dQX05PWk9SREVSIC1ib3IgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06OlNXUF9GUkFNRUNIQU5HRUQgLWJvciBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtDdXN0b20uTmF0aXZlXTo6U1dQX05PQUNUSVZBVEUKCiAgICAgICAgICAgICAgICAgICAgICAgIFtDdXN0b20uTmF0aXZlXTo6UG9zaXRpb25XaW5kb3coJGhXbmQsIFtJbnRQdHJdOjpaZXJvLCAwLCAwLCAwLCAwLCAkZmxhZ3MpIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRBVEFHUklEOiBGYWlsZWQgdG8gc2V0IHdpbmRvdyB0b29sIHN0eWxlIGZvciBoYW5kbGUgJGhXbmQuICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEFwcGx5IG9yIFJlbW92ZSBXU19FWF9UT09MV0lORE9XIFN0eWxlCiAgICAgICAgfQogICAgI2VuZHJlZ2lvbiBGdW5jdGlvbjogU2V0LVdpbmRvd1Rvb2xTdHlsZQojZW5kcmVnaW9uIEhlbHBlciBGdW5jdGlvbnMKCiNyZWdpb24gQ29yZSBGdW5jdGlvbnMKICAgICNyZWdpb24gRnVuY3Rpb246IFVwZGF0ZS1EYXRhR3JpZAogICAgICAgIGZ1bmN0aW9uIFVwZGF0ZS1EYXRhR3JpZAogICAgICAgIHsKICAgICAgICAgICAgPCMKICAgICAgICAgICAgLlNZTk9QU0lTCiAgICAgICAgICAgICAgICBDb3JlIGZ1bmN0aW9uIHRvIHJlZnJlc2ggdGhlIERhdGFHcmlkIHdpdGggY3VycmVudCBwcm9jZXNzIGluZm9ybWF0aW9uLgogICAgICAgICAgICAuREVTQ1JJUFRJT04KICAgICAgICAgICAgICAgIE9yY2hlc3RyYXRlcyB0aGUgZW50aXJlIHVwZGF0ZSBjeWNsZSBmb3IgdGhlIHByb2Nlc3MgbW9uaXRvcmluZyBncmlkOgogICAgICAgICAgICAgICAgMS4gVmFsaWRhdGVzIHBhcmFtZXRlcnMgYW5kIGNvbmZpZ3VyYXRpb24uCiAgICAgICAgICAgICAgICAyLiBHZXRzIHRoZSBsaXN0IG9mIGN1cnJlbnRseSBydW5uaW5nIHRhcmdldCBwcm9jZXNzZXMuCiAgICAgICAgICAgICAgICAzLiBSZW1vdmVzIHJvd3MgY29ycmVzcG9uZGluZyB0byB0ZXJtaW5hdGVkIHByb2Nlc3Nlcy4KICAgICAgICAgICAgICAgIDQuIEl0ZXJhdGVzIHRocm91Z2ggY3VycmVudCBwcm9jZXNzZXM6CiAgICAgICAgICAgICAgICAgICAgLSBVcGRhdGVzIGV4aXN0aW5nIHJvd3MuCiAgICAgICAgICAgICAgICAgICAgLSBBZGRzIG5ldyByb3dzIGZvciBuZXdseSBkZXRlY3RlZCBwcm9jZXNzZXMgKHVzaW5nIGNhY2hlIGxvZ2ljKS4KICAgICAgICAgICAgICAgICAgICAtIEluaXRpYXRlcyBhc3luY2hyb25vdXMgd2luZG93IHN0YXRlIGNoZWNrcyBmb3IgZWFjaCBwcm9jZXNzIHJvdy4KICAgICAgICAgICAgICAgIDUuIFVwZGF0ZXMgYWxsIHJvdyBpbmRpY2VzIHRvIGVuc3VyZSBzZXF1ZW50aWFsIG51bWJlcmluZy4KICAgICAgICAgICAgICAgIDYuIFBlcmlvZGljYWxseSBjbGVhbnMgdXAgdGhlIG9sZCBwcm9jZXNzIGNhY2hlIGVudHJpZXMuCiAgICAgICAgICAgIC5QQVJBTUVURVIgR3JpZAogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld10gVGhlIERhdGFHcmlkVmlldyBjb250cm9sIHRvIGJlIHVwZGF0ZWQuIChNYW5kYXRvcnkpCiAgICAgICAgICAgIC5PVVRQVVRTCiAgICAgICAgICAgICAgICBbdm9pZF0KICAgICAgICAgICAgLk5PVEVTCiAgICAgICAgICAgICAgICBUaGlzIGZ1bmN0aW9uIGlzIHR5cGljYWxseSBjYWxsZWQgcmVwZWF0ZWRseSBieSBhIHRpbWVyLiBJdCByZWxpZXMgb24gaGVscGVyIGZ1bmN0aW9ucwogICAgICAgICAgICAgICAgZm9yIHNwZWNpZmljIHRhc2tzIGxpa2UgcHJvY2VzcyByZXRyaWV2YWwsIHJvdyBtYW5hZ2VtZW50LCBhbmQgc3RhdGUgY2hlY2tpbmcuCiAgICAgICAgICAgICAgICBVc2VzIGEgcHJvY2VzcyBjYWNoZSAoJHNjcmlwdDpQcm9jZXNzQ2FjaGUpIHRvIGF2b2lkIGFkZGluZyBkdXBsaWNhdGUgcm93cyBmb3IgcHJvY2Vzc2VzCiAgICAgICAgICAgICAgICB0aGF0IG1pZ2h0IHRlbXBvcmFyaWx5IGxvc2UgdGhlaXIgbWFpbiB3aW5kb3cgaGFuZGxlLgogICAgICAgICAgICAjPgogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgICAgICBwYXJhbSgKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkRhdGFHcmlkVmlld10kR3JpZAogICAgICAgICAgICApCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFZhbGlkYXRlIFBhcmFtZXRlcnMgYW5kIENvbmZpZ3VyYXRpb24KICAgICAgICAgICAgICAgIGlmICgtbm90IChUZXN0LVZhbGlkUGFyYW1ldGVycyAtR3JpZCAkR3JpZCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVmFsaWRhdGUgUGFyYW1ldGVycyBhbmQgQ29uZmlndXJhdGlvbgoKICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBHZXQgQ3VycmVudCBMaXN0IG9mIFRhcmdldCBQcm9jZXNzZXMKICAgICAgICAgICAgICAgICRjdXJyZW50UHJvY2Vzc2VzID0gR2V0LVByb2Nlc3NMaXN0CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogR2V0IEN1cnJlbnQgTGlzdCBvZiBUYXJnZXQgUHJvY2Vzc2VzCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFJlbW92ZSBSb3dzIGZvciBUZXJtaW5hdGVkIFByb2Nlc3NlcwogICAgICAgICAgICAgICAgUmVtb3ZlLVRlcm1pbmF0ZWRQcm9jZXNzZXMgLUdyaWQgJEdyaWQgLUN1cnJlbnRQcm9jZXNzZXMgJGN1cnJlbnRQcm9jZXNzZXMKICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBSZW1vdmUgUm93cyBmb3IgVGVybWluYXRlZCBQcm9jZXNzZXMKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogSGFuZGxlIENhc2Ugb2YgTm8gUnVubmluZyBUYXJnZXQgUHJvY2Vzc2VzCiAgICAgICAgICAgICAgICBpZiAoJGN1cnJlbnRQcm9jZXNzZXMuQ291bnQgLWVxIDApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogSGFuZGxlIENhc2Ugb2YgTm8gUnVubmluZyBUYXJnZXQgUHJvY2Vzc2VzCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IENyZWF0ZSBFZmZpY2llbnQgUm93IExvb2t1cCBEaWN0aW9uYXJ5CiAgICAgICAgICAgICAgICAjIEJ1aWxkIGEgaGFzaHRhYmxlIGZvciBmYXN0IGxvb2t1cCBvZiBleGlzdGluZyByb3dzIGJ5IFByb2Nlc3MgSUQKICAgICAgICAgICAgICAgICRyb3dMb29rdXAgPSBOZXctUm93TG9va3VwRGljdGlvbmFyeSAtR3JpZCAkR3JpZAogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENyZWF0ZSBFZmZpY2llbnQgUm93IExvb2t1cCBEaWN0aW9uYXJ5CgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFByb2Nlc3MgRWFjaCBSdW5uaW5nIFRhcmdldCBQcm9jZXNzCiAgICAgICAgICAgICAgICAkcHJvY2Vzc0luZGV4ID0gMAogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHByb2Nlc3MgaW4gJGN1cnJlbnRQcm9jZXNzZXMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBJbmNyZW1lbnQgUHJvY2VzcyBJbmRleCAoZm9yIGRpc3BsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9jZXNzSW5kZXgrKyAgIyBTdGFydCBkaXNwbGF5IGluZGV4IGZyb20gMQogICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogSW5jcmVtZW50IFByb2Nlc3MgSW5kZXggKGZvciBkaXNwbGF5KQoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IERldGVybWluZSBQcm9jZXNzIFRpdGxlIChXaW5kb3cgVGl0bGUgb3IgTmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgIyBVc2UgTWFpbldpbmRvd1RpdGxlIGlmIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0byBQcm9jZXNzTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkcHJvY2Vzc1RpdGxlID0gaWYgKC1ub3QgW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHByb2Nlc3MuTWFpbldpbmRvd1RpdGxlKSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2Nlc3MuTWFpbldpbmRvd1RpdGxlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvY2Vzcy5Qcm9jZXNzTmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBEZXRlcm1pbmUgUHJvY2VzcyBUaXRsZSAoV2luZG93IFRpdGxlIG9yIE5hbWUpCgogICAgICAgICAgICAgICAgICAgICNyZWdpb24gU3RlcDogQ2hlY2sgaWYgUHJvY2VzcyBSb3cgQWxyZWFkeSBFeGlzdHMgaW4gR3JpZAogICAgICAgICAgICAgICAgICAgICAgICAkZXhpc3RpbmdSb3cgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHJvd0xvb2t1cC5Db250YWluc0tleSgkcHJvY2Vzcy5JZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleGlzdGluZ1JvdyA9ICRyb3dMb29rdXBbJHByb2Nlc3MuSWRdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENoZWNrIGlmIFByb2Nlc3MgUm93IEFscmVhZHkgRXhpc3RzIGluIEdyaWQKCiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBVcGRhdGUgUHJvY2VzcyBDYWNoZSBFbnRyeSAoTGFzdFNlZW4sIEhhc1dpbmRvdykKICAgICAgICAgICAgICAgICAgICAgICAgIyBVcGRhdGUgdGhlIGNhY2hlIGVudHJ5IGZvciB0aGlzIHByb2Nlc3MgSUQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY3JpcHQ6UHJvY2Vzc0NhY2hlLkNvbnRhaW5zS2V5KCRwcm9jZXNzLklkKSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjcmlwdDpQcm9jZXNzQ2FjaGVbJHByb2Nlc3MuSWRdLkxhc3RTZWVuID0gR2V0LURhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY3JpcHQ6UHJvY2Vzc0NhY2hlWyRwcm9jZXNzLklkXS5IYXNXaW5kb3cgPSAoJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSAtbmUgMCAtYW5kICRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUgLW5lIFtJbnRQdHJdOjpaZXJvKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgbm90IGluIGNhY2hlLCBpdCB3aWxsIGJlIGFkZGVkIHdoZW4gdGhlIHJvdyBpcyBhZGRlZCAoaWYgYXBwbGljYWJsZSkKICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFVwZGF0ZSBQcm9jZXNzIENhY2hlIEVudHJ5IChMYXN0U2VlbiwgSGFzV2luZG93KQoKICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFVwZGF0ZSBFeGlzdGluZyBSb3cgb3IgQWRkIE5ldyBSb3cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRleGlzdGluZ1JvdykKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBVcGRhdGUgRXhpc3RpbmcgUm93IERhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGUtRXhpc3RpbmdSb3cgLVJvdyAkZXhpc3RpbmdSb3cgLUluZGV4ICRwcm9jZXNzSW5kZXggLVByb2Nlc3NUaXRsZSAkcHJvY2Vzc1RpdGxlIC1Qcm9jZXNzSWQgJHByb2Nlc3MuSWQgLVByb2Nlc3MgJHByb2Nlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVXBkYXRlIEV4aXN0aW5nIFJvdyBEYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IERldGVybWluZSBpZiBOZXcgUm93IFNob3VsZCBCZSBBZGRlZCAoQ2FjaGUgTG9naWMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBBZGQgaWYgbm90IGluIGNhY2hlLCBPUiBpZiBpdCdzIGluIGNhY2hlIGJ1dCBwcmV2aW91c2x5IGhhZCBubyB3aW5kb3cgYW5kIG5vdyBkb2VzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaG91bGRBZGQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NyaXB0OlByb2Nlc3NDYWNoZS5Db250YWluc0tleSgkcHJvY2Vzcy5JZCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIElmIHByb2Nlc3MgaXMgaW4gY2FjaGUgYnV0IGRpZG4ndCBoYXZlIGEgd2luZG93IGJlZm9yZSwgYW5kIHN0aWxsIGRvZXNuJ3QsIGRvbid0IGFkZCBhZ2Fpbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUaGlzIHByZXZlbnRzIGFkZGluZyBwcm9jZXNzZXMgZHVyaW5nIGJyaWVmIG1vbWVudHMgdGhleSBtaWdodCBsb3NlIHRoZWlyIHdpbmRvdyBoYW5kbGUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoYXNXaW5kb3dOb3cgPSAoJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSAtbmUgMCAtYW5kICRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUgLW5lIFtJbnRQdHJdOjpaZXJvKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLW5vdCAkc2NyaXB0OlByb2Nlc3NDYWNoZVskcHJvY2Vzcy5JZF0uSGFzV2luZG93IC1hbmQgLW5vdCAkaGFzV2luZG93Tm93KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hvdWxkQWRkID0gJGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IERldGVybWluZSBpZiBOZXcgUm93IFNob3VsZCBCZSBBZGRlZCAoQ2FjaGUgTG9naWMpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBBZGQgTmV3IFJvdyBpZiBSZXF1aXJlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2hvdWxkQWRkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5ld1JvdyA9IEFkZC1OZXdQcm9jZXNzUm93IC1HcmlkICRHcmlkIC1Qcm9jZXNzICRwcm9jZXNzIC1JbmRleCAkcHJvY2Vzc0luZGV4IC1Qcm9jZXNzVGl0bGUgJHByb2Nlc3NUaXRsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFVzZSB0aGUgbmV3bHkgYWRkZWQgcm93IGZvciB0aGUgc3RhdGUgY2hlY2sgYmVsb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4aXN0aW5nUm93ID0gJG5ld1JvdwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEFkZCB0aGUgbmV3IHJvdyB0byB0aGUgbG9va3VwIGlmIGl0IHdhcyBjcmVhdGVkIHN1Y2Nlc3NmdWxseQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG5ld1JvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvd0xvb2t1cFskcHJvY2Vzcy5JZF0gPSAkbmV3Um93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IEFkZCBOZXcgUm93IGlmIFJlcXVpcmVkCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFVwZGF0ZSBFeGlzdGluZyBSb3cgb3IgQWRkIE5ldyBSb3cKCiAgICAgICAgICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBTdGFydCBBc3luY2hyb25vdXMgV2luZG93IFN0YXRlIENoZWNrIGZvciB0aGUgUm93CiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgYSByb3cgZXhpc3RzIGZvciB0aGlzIHByb2Nlc3MgKGVpdGhlciB1cGRhdGVkIG9yIG5ld2x5IGFkZGVkKSwgc3RhcnQgdGhlIHN0YXRlIGNoZWNrLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGV4aXN0aW5nUm93KQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1XaW5kb3dTdGF0ZUNoZWNrIC1Qcm9jZXNzICRwcm9jZXNzIC1Sb3cgJGV4aXN0aW5nUm93IC1HcmlkICRHcmlkCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFN0YXJ0IEFzeW5jaHJvbm91cyBXaW5kb3cgU3RhdGUgQ2hlY2sgZm9yIHRoZSBSb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFByb2Nlc3MgRWFjaCBSdW5uaW5nIFRhcmdldCBQcm9jZXNzCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFVwZGF0ZSBBbGwgUm93IEluZGljZXMgZm9yIFNlcXVlbnRpYWwgTnVtYmVyaW5nCiAgICAgICAgICAgICAgICAjIEVuc3VyZSB0aGUgJyMnIGNvbHVtbiBpcyBjb3JyZWN0bHkgbnVtYmVyZWQgYWZ0ZXIgYWRkaXRpb25zL3JlbW92YWxzCiAgICAgICAgICAgICAgICBVcGRhdGVSb3dJbmRpY2VzIC1HcmlkICRHcmlkCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogVXBkYXRlIEFsbCBSb3cgSW5kaWNlcyBmb3IgU2VxdWVudGlhbCBOdW1iZXJpbmcKCiAgICAgICAgICAgICNyZWdpb24gU3RlcDogQ2xlYW4gVXAgT2xkIFByb2Nlc3MgQ2FjaGUgRW50cmllcyBQZXJpb2RpY2FsbHkKICAgICAgICAgICAgICAgICMgUmVtb3ZlIHN0YWxlIGVudHJpZXMgZnJvbSB0aGUgY2FjaGUKICAgICAgICAgICAgICAgIENsZWFyLU9sZFByb2Nlc3NDYWNoZQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IENsZWFuIFVwIE9sZCBQcm9jZXNzIENhY2hlIEVudHJpZXMgUGVyaW9kaWNhbGx5CiAgICAgICAgfQogICAgI2VuZHJlZ2lvbiBGdW5jdGlvbjogVXBkYXRlLURhdGFHcmlkCgogICAgI3JlZ2lvbiBGdW5jdGlvbjogU3RhcnQtRGF0YUdyaWRVcGRhdGVUaW1lcgogICAgICAgIGZ1bmN0aW9uIFN0YXJ0LURhdGFHcmlkVXBkYXRlVGltZXIKICAgICAgICB7CiAgICAgICAgICAgIDwjCiAgICAgICAgICAgIC5TWU5PUFNJUwogICAgICAgICAgICAgICAgQ3JlYXRlcyBhbmQgc3RhcnRzIGEgU3lzdGVtLldpbmRvd3MuRm9ybXMuVGltZXIgdG8gcGVyaW9kaWNhbGx5IHVwZGF0ZSB0aGUgRGF0YUdyaWQuCiAgICAgICAgICAgIC5ERVNDUklQVElPTgogICAgICAgICAgICAgICAgSW5pdGlhbGl6ZXMgb3IgcmVwbGFjZXMgYSB0aW1lciByZXNwb25zaWJsZSBmb3IgYXV0b21hdGljYWxseSBjYWxsaW5nIHRoZSBVcGRhdGUtRGF0YUdyaWQgZnVuY3Rpb24KICAgICAgICAgICAgICAgIGF0IHRoZSBpbnRlcnZhbCBzcGVjaWZpZWQgYnkgJHNjcmlwdDpVcGRhdGVJbnRlcnZhbC4gRW5zdXJlcyB0aGF0IHVwZGF0ZXMgYXJlIHBlcmZvcm1lZAogICAgICAgICAgICAgICAgYXN5bmNocm9ub3VzbHkgb24gdGhlIFVJIHRocmVhZCB1c2luZyBCZWdpbkludm9rZSB0byBwcmV2ZW50IGZyZWV6aW5nLgogICAgICAgICAgICAuT1VUUFVUUwogICAgICAgICAgICAgICAgW3ZvaWRdCiAgICAgICAgICAgIC5OT1RFUwogICAgICAgICAgICAgICAgU3RvcHMgYW5kIGRpc3Bvc2VzIGFueSBleGlzdGluZyB0aW1lciB3aXRoIHRoZSBzYW1lIG5hbWUgKCdkYXRhR3JpZFVwZGF0ZVRpbWVyJykgYmVmb3JlIGNyZWF0aW5nIGEgbmV3IG9uZS4KICAgICAgICAgICAgICAgIFN0b3JlcyB0aGUgdGltZXIgb2JqZWN0IGluIHRoZSBnbG9iYWwgY29uZmlndXJhdGlvbiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVycykgZm9yIHBvdGVudGlhbCBtYW5hZ2VtZW50IGVsc2V3aGVyZS4KICAgICAgICAgICAgICAgIEluY2x1ZGVzIGNoZWNrcyB0byBlbnN1cmUgdGhlIFVJIGFuZCBEYXRhR3JpZCBleGlzdCBhbmQgYXJlIG5vdCBkaXNwb3NlZCBiZWZvcmUgYXR0ZW1wdGluZyBhbiB1cGRhdGUuCiAgICAgICAgICAgICAgICBVc2VzIEJlZ2luSW52b2tlIGZvciB0aHJlYWQgc2FmZXR5IHdoZW4gY2FsbGluZyBVcGRhdGUtRGF0YUdyaWQgZnJvbSB0aGUgdGltZXIncyBUaWNrIGV2ZW50LgogICAgICAgICAgICAjPgogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgICAgICBwYXJhbSgpCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IENsZWFuIFVwIEV4aXN0aW5nIFRpbWVyIChpZiBhbnkpCiAgICAgICAgICAgICAgICAjIEVuc3VyZSB0aGUgcGF0aCB0byB0aGUgdGltZXIgZXhpc3RzIGJlZm9yZSB0cnlpbmcgdG8gYWNjZXNzIGl0CiAgICAgICAgICAgICAgICBpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzIC1hbmQgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVyc1snZGF0YUdyaWRVcGRhdGVUaW1lciddKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnNbJ2RhdGFHcmlkVXBkYXRlVGltZXInXS5TdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVyc1snZGF0YUdyaWRVcGRhdGVUaW1lciddLkRpc3Bvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzLlJlbW92ZSgnZGF0YUdyaWRVcGRhdGVUaW1lcicpICMgUmVtb3ZlIHJlZmVyZW5jZQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJEQVRBR1JJRDogRXJyb3IgY2xlYW5pbmcgdXAgZXhpc3RpbmcgdGltZXI6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBDbGVhbiBVcCBFeGlzdGluZyBUaW1lciAoaWYgYW55KQoKICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBDcmVhdGUgYW5kIENvbmZpZ3VyZSBOZXcgVGltZXIKICAgICAgICAgICAgICAgICRkYXRhR3JpZFVwZGF0ZVRpbWVyID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5UaW1lcgogICAgICAgICAgICAgICAgJGRhdGFHcmlkVXBkYXRlVGltZXIuSW50ZXJ2YWwgPSAkc2NyaXB0OlVwZGF0ZUludGVydmFsCiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogQ3JlYXRlIGFuZCBDb25maWd1cmUgTmV3IFRpbWVyCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IERlZmluZSBUaW1lciBUaWNrIEV2ZW50IEhhbmRsZXIgKENhbGxzIFVwZGF0ZS1EYXRhR3JpZCkKICAgICAgICAgICAgICAgICR0aWNrQWN0aW9uID0gewogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgVUkgY29tcG9uZW50cyBhcmUgdmFsaWQgYmVmb3JlIGF0dGVtcHRpbmcgdXBkYXRlCiAgICAgICAgICAgICAgICAgICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnIC1hbmQgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5EYXRhR3JpZEZpbGxlciAtYW5kIC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuRGF0YUdyaWRGaWxsZXIuSXNEaXNwb3NlZCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFVzZSBCZWdpbkludm9rZSB0byBydW4gVXBkYXRlLURhdGFHcmlkIG9uIHRoZSBVSSB0aHJlYWQgYXN5bmNocm9ub3VzbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkRhdGFHcmlkRmlsbGVyLkJlZ2luSW52b2tlKFtBY3Rpb25dIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBOZXN0ZWQgdHJ5L2NhdGNoIGZvciB0aGUgYWN0aW9uIGl0c2VsZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlLURhdGFHcmlkIC1HcmlkICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkRhdGFHcmlkRmlsbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBMb2cgZXJyb3Igb2NjdXJyaW5nIHdpdGhpbiB0aGUgaW52b2tlZCBhY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRBVEFHUklEOiBFcnJvciBkdXJpbmcgaW52b2tlZCBVcGRhdGUtRGF0YUdyaWQ6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIExvZyBlcnJvciBvY2N1cnJpbmcgZHVyaW5nIEJlZ2luSW52b2tlIGNhbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRBVEFHUklEOiBFcnJvciBpbnZva2luZyBEYXRhR3JpZCB1cGRhdGU6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDb25zaWRlciBzdG9wcGluZyB0aGUgdGltZXIgaWYgQmVnaW5JbnZva2UgZmFpbHMgcmVwZWF0ZWRseQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAkdGhpcy5TdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAjIFVJIG5vIGxvbmdlciB2YWxpZCwgc3RvcCB0aGUgdGltZXIKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiREFUQUdSSUQ6IFVJIG9yIERhdGFHcmlkIGRpc3Bvc2VkLCBzdG9wcGluZyB1cGRhdGUgdGltZXIuIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5TdG9wKCkgIyAkdGhpcyByZWZlcnMgdG8gdGhlIHRpbWVyIG9iamVjdCBpbnNpZGUgdGhlIGV2ZW50IGhhbmRsZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZGF0YUdyaWRVcGRhdGVUaW1lci5BZGRfVGljaygkdGlja0FjdGlvbikKICAgICAgICAgICAgI2VuZHJlZ2lvbiBTdGVwOiBEZWZpbmUgVGltZXIgVGljayBFdmVudCBIYW5kbGVyIChDYWxscyBVcGRhdGUtRGF0YUdyaWQpCgogICAgICAgICAgICAjcmVnaW9uIFN0ZXA6IFN0YXJ0IHRoZSBUaW1lcgogICAgICAgICAgICAgICAgJGRhdGFHcmlkVXBkYXRlVGltZXIuU3RhcnQoKQogICAgICAgICAgICAjZW5kcmVnaW9uIFN0ZXA6IFN0YXJ0IHRoZSBUaW1lcgoKICAgICAgICAgICAgI3JlZ2lvbiBTdGVwOiBTdG9yZSBUaW1lciBSZWZlcmVuY2UgR2xvYmFsbHkKICAgICAgICAgICAgICAgICMgRW5zdXJlIHRoZSBUaW1lcnMgaGFzaHRhYmxlIGV4aXN0cwogICAgICAgICAgICAgICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnIC1hbmQgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzIC1hbmQgLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuQ29udGFpbnNLZXkoJ1RpbWVycycpKSB7CiAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzWydUaW1lcnMnXSA9IEB7fQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBTdG9yZSB0aGUgdGltZXIgcmVmZXJlbmNlCiAgICAgICAgICAgICAgICBpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMpIHsKICAgICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnNbJ2RhdGFHcmlkVXBkYXRlVGltZXInXSA9ICRkYXRhR3JpZFVwZGF0ZVRpbWVyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24gU3RlcDogU3RvcmUgVGltZXIgUmVmZXJlbmNlIEdsb2JhbGx5CiAgICAgICAgfQogICAgI2VuZHJlZ2lvbiBGdW5jdGlvbjogU3RhcnQtRGF0YUdyaWRVcGRhdGVUaW1lcgojZW5kcmVnaW9uIENvcmUgRnVuY3Rpb25zCgojcmVnaW9uIEZ1bmN0aW9uOiBSZXN0b3JlLVdpbmRvd1N0eWxlcwogICAgICAgIGZ1bmN0aW9uIFJlc3RvcmUtV2luZG93U3R5bGVzCiAgICAgICAgewogICAgICAgICAgICA8IwogICAgICAgICAgICAuU1lOT1BTSVMKICAgICAgICAgICAgICAgIFJlc3RvcmVzIHRoZSBkZWZhdWx0IHdpbmRvdyBzdHlsZSAoV1NfRVhfQVBQV0lORE9XKSBmb3IgYWxsIG1hbmFnZWQgY2xpZW50IHdpbmRvd3MuCiAgICAgICAgICAgIC5ERVNDUklQVElPTgogICAgICAgICAgICAgICAgSXRlcmF0ZXMgdGhyb3VnaCBhbGwgcHJvY2VzcyBJRHMgc3RvcmVkIGluIHRoZSAkc2NyaXB0OlByb2Nlc3NDYWNoZS4gRm9yIGVhY2ggcHJvY2VzcywKICAgICAgICAgICAgICAgIGl0IHJldHJpZXZlcyB0aGUgbWFpbiB3aW5kb3cgaGFuZGxlIGFuZCBjYWxscyBTZXQtV2luZG93VG9vbFN0eWxlIHdpdGggLUhpZGUgJGZhbHNlCiAgICAgICAgICAgICAgICB0byBlbnN1cmUgdGhlIHdpbmRvdyBpcyB2aXNpYmxlIGluIHRoZSB0YXNrYmFyIGFuZCBBbHQrVGFiIHN3aXRjaGVyLiBUaGlzIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICBpcyBpbnRlbmRlZCB0byBiZSBjYWxsZWQgZHVyaW5nIGRhc2hib2FyZCBzaHV0ZG93biB0byBjbGVhbiB1cCBhbnkgbW9kaWZpZWQgd2luZG93IHN0eWxlcy4KICAgICAgICAgICAgLk9VVFBVVFMKICAgICAgICAgICAgICAgIFt2b2lkXQogICAgICAgICAgICAuTk9URVMKICAgICAgICAgICAgICAgIFRoaXMgZnVuY3Rpb24gZG9lcyBub3QgaGFuZGxlIGNhc2VzIHdoZXJlIHRoZSBwcm9jZXNzIGl0c2VsZiBoYXMgdGVybWluYXRlZC4KICAgICAgICAgICAgICAgIEl0IHJlbGllcyBvbiB0aGUgY2FjaGVkIHByb2Nlc3MgSURzIGhhdmluZyB2YWxpZCBNYWluV2luZG93SGFuZGxlcy4KICAgICAgICAgICAgIz4KICAgICAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICAgICAgcGFyYW0oKQoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiREFUQUdSSUQ6IFJlc3RvcmluZyB3aW5kb3cgc3R5bGVzIGZvciBtYW5hZ2VkIGNsaWVudHMuLi4iIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93CgogICAgICAgICAgICAjIEl0ZXJhdGUgdGhyb3VnaCBhbGwgcHJvY2VzcyBJRHMgY3VycmVudGx5IGluIHRoZSBjYWNoZQogICAgICAgICAgICBmb3JlYWNoICgkcHJvY2Vzc0lkIGluICRzY3JpcHQ6UHJvY2Vzc0NhY2hlLktleXMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgQXR0ZW1wdCB0byBnZXQgdGhlIHByb2Nlc3MgYnkgSUQKICAgICAgICAgICAgICAgICAgICAkcHJvY2VzcyA9IEdldC1Qcm9jZXNzIC1JZCAkcHJvY2Vzc0lkIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCgogICAgICAgICAgICAgICAgICAgICMgSWYgcHJvY2VzcyBleGlzdHMgYW5kIGhhcyBhIG1haW4gd2luZG93IGhhbmRsZSwgcmVzdG9yZSBpdHMgc3R5bGUKICAgICAgICAgICAgICAgICAgICBpZiAoJHByb2Nlc3MgLWFuZCAkcHJvY2Vzcy5NYWluV2luZG93SGFuZGxlIC1uZSAwIC1hbmQgJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSAtbmUgW0ludFB0cl06Olplcm8pCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBTZXQtV2luZG93VG9vbFN0eWxlIC1oV25kICRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUgLUhpZGUgJGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRBVEFHUklEOiBSZXN0b3JlZCBzdHlsZSBmb3IgUElEICQoJHByb2Nlc3MuSWQpLiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRBVEFHUklEOiBFcnJvciByZXN0b3Jpbmcgd2luZG93IHN0eWxlIGZvciBQSUQgJCgkcHJvY2Vzc0lkKS4gJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiREFUQUdSSUQ6IEZpbmlzaGVkIHJlc3RvcmluZyB3aW5kb3cgc3R5bGVzLiIgLUZvcmVncm91bmRDb2xvciBZZWxsb3cKICAgICAgICB9CiNlbmRyZWdpb24gRnVuY3Rpb246IFJlc3RvcmUtV2luZG93U3R5bGVzCgojcmVnaW9uIE1vZHVsZSBFeHBvcnRzCiAgICAjcmVnaW9uIFN0ZXA6IEV4cG9ydCBQdWJsaWMgRnVuY3Rpb25zCiAgICAgICAgIyBFeHBvcnQgdGhlIGZ1bmN0aW9ucyBpbnRlbmRlZCBmb3IgcHVibGljIHVzZSBieSBvdGhlciBtb2R1bGVzIG9yIHNjcmlwdHMuCiAgICAgICAgRXhwb3J0LU1vZHVsZU1lbWJlciAtRnVuY3Rpb24gU3RhcnQtRGF0YUdyaWRVcGRhdGVUaW1lciwgVXBkYXRlLURhdGFHcmlkLCBSZXN0b3JlLVdpbmRvd1N0eWxlcwogICAgI2VuZHJlZ2lvbiBTdGVwOiBFeHBvcnQgUHVibGljIEZ1bmN0aW9ucwojZW5kcmVnaW9uIE1vZHVsZSBFeHBvcnRz
			'
		}
		
		# Optional modules: Add extra, non-essential features. Failure is logged, but the app still starts.
		'launch.psm1'   = @{ 
			Priority = 'Optional';  
			Order = 7; 
			Dependencies = @('classes.psm1', 'ui.psm1', 'ini.psm1', 'datagrid.psm1');
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'launch.psm1');
			Base64Content = '
PCMgbGF1bmNoLnBzbTEgDQogICAgLlNZTk9QU0lTDQogICAgICAgIFByb3ZpZGVzIGEgcm9idXN0LCBhc3luY2hyb25vdXMgcHJvY2VzcyBmb3IgbGF1bmNoaW5nIG11bHRpcGxlIGdhbWUgY2xpZW50cyBpbiBhIHN0YWdnZXJlZCBhbmQgbW9uaXRvcmVkIHNlcXVlbmNlLg0KDQogICAgLkRFU0NSSVBUSU9ODQogICAgICAgIFRoaXMgbW9kdWxlIGhhbmRsZXMgdGhlIGNvbXBsZXggdGFzayBvZiBsYXVuY2hpbmcgb25lIG9yIG1vcmUgZ2FtZSBjbGllbnRzIGJhc2VkIG9uIHVzZXIgY29uZmlndXJhdGlvbi4gVG8gcHJldmVudCB0aGUgbWFpbiBhcHBsaWNhdGlvbiBVSSBmcm9tIGZyZWV6aW5nLCB0aGUgZW50aXJlIGxhdW5jaCBvcGVyYXRpb24gaXMgZXhlY3V0ZWQgb24gYSBzZXBhcmF0ZSBiYWNrZ3JvdW5kIHRocmVhZCB1c2luZyBhIGRlZGljYXRlZCBQb3dlclNoZWxsIFJ1bnNwYWNlLiBUaGUgbW9kdWxlIGNhcmVmdWxseSBtb25pdG9ycyBlYWNoIHN0ZXAgb2YgdGhlIHByb2Nlc3MsIGZyb20gc3RhcnRpbmcgdGhlIGxhdW5jaGVyIHRvIGNvbmZpcm1pbmcgdGhlIGdhbWUgY2xpZW50IGlzIGZ1bGx5IGluaXRpYWxpemVkLCBhbmQgaW5jbHVkZXMgcm9idXN0IHRpbWVvdXQgYW5kIGNsZWFudXAgbWVjaGFuaXNtcy4NCg0KICAgICAgICBUaGUgbW9kdWxlJ3MgcHJpbWFyeSByZXNwb25zaWJpbGl0aWVzIGFuZCBmZWF0dXJlcyBhcmU6DQoNCiAgICAgICAgMS4gICoqQXN5bmNocm9ub3VzIGFuZCBOb24tQmxvY2tpbmcgT3BlcmF0aW9uOioqDQogICAgICAgICAgICAqICAgVGhlIGBTdGFydC1DbGllbnRMYXVuY2hgIGZ1bmN0aW9uIGluaXRpYXRlcyB0aGUgbGF1bmNoIHNlcXVlbmNlIGluIGEgYmFja2dyb3VuZCBydW5zcGFjZSwgaW1tZWRpYXRlbHkgcmV0dXJuaW5nIGNvbnRyb2wgdG8gdGhlIFVJLg0KICAgICAgICAgICAgKiAgIEl0IHVzZXMgUG93ZXJTaGVsbCBldmVudHMgKGBJbnZvY2F0aW9uU3RhdGVDaGFuZ2VkYCkgdG8gZGV0ZWN0IHdoZW4gdGhlIGJhY2tncm91bmQgdGFzayBpcyBjb21wbGV0ZSwgYXQgd2hpY2ggcG9pbnQgaXQgYXV0b21hdGljYWxseSB0cmlnZ2VycyB0aGUgYFN0b3AtQ2xpZW50TGF1bmNoYCBjbGVhbnVwIGZ1bmN0aW9uLg0KICAgICAgICAgICAgKiAgIFRoaXMgYXJjaGl0ZWN0dXJlIGVuc3VyZXMgdGhlIGRhc2hib2FyZCByZW1haW5zIGZ1bGx5IGludGVyYWN0aXZlIHdoaWxlIGNsaWVudHMgYXJlIGJlaW5nIGxhdW5jaGVkLg0KDQogICAgICAgIDIuICAqKlN0YWdnZXJlZCBhbmQgTW9uaXRvcmVkIExhdW5jaCBTZXF1ZW5jZToqKg0KICAgICAgICAgICAgKiAgIFRoZSBtb2R1bGUgbGF1bmNoZXMgY2xpZW50cyBvbmUgYnkgb25lLCB3YWl0aW5nIGZvciB0aGUgcHJldmlvdXMgb25lIHRvIGJlIGZ1bGx5IHJlYWR5IGJlZm9yZSBzdGFydGluZyB0aGUgbmV4dC4NCiAgICAgICAgICAgICogICAqKkxhdW5jaGVyIE1vbml0b3Jpbmc6KiogRm9yIGVhY2ggY2xpZW50LCBpdCBzdGFydHMgdGhlIG9mZmljaWFsIGxhdW5jaGVyIGV4ZWN1dGFibGUgYW5kIGFjdGl2ZWx5IG1vbml0b3JzIGl0LiBJZiB0aGUgbGF1bmNoZXIgaGFuZ3MsIGJlY29tZXMgdW5yZXNwb25zaXZlLCBvciB0YWtlcyB0b28gbG9uZyAoZS5nLiwgZHVyaW5nIGEgbGVuZ3RoeSBwYXRjaCksIGl0IGlzIGF1dG9tYXRpY2FsbHkgdGVybWluYXRlZCB0byBwcmV2ZW50IHRoZSBzZXF1ZW5jZSBmcm9tIGdldHRpbmcgc3R1Y2suDQogICAgICAgICAgICAqICAgKipDbGllbnQgVmVyaWZpY2F0aW9uOioqIEFmdGVyIHRoZSBsYXVuY2hlciBjbG9zZXMsIHRoZSBzY3JpcHQgd2FpdHMgZm9yIHRoZSBhY3R1YWwgZ2FtZSBjbGllbnQgcHJvY2VzcyB0byBhcHBlYXIuIEl0IHRoZW4gZnVydGhlciB3YWl0cyBmb3IgdGhlIGNsaWVudCdzIHdpbmRvdyB0byBiZSBjcmVhdGVkIGFuZCBiZWNvbWUgcmVzcG9uc2l2ZSBiZWZvcmUgY29uc2lkZXJpbmcgdGhlIGxhdW5jaCBzdWNjZXNzZnVsLg0KDQogICAgICAgIDMuICAqKlBvc3QtTGF1bmNoIE9wdGltaXphdGlvbjoqKg0KICAgICAgICAgICAgKiAgIE9uY2UgYSBuZXcgY2xpZW50IGlzIHZlcmlmaWVkIGFzIHJ1bm5pbmcgYW5kIHJlc3BvbnNpdmUsIHRoZSBtb2R1bGUgaW1tZWRpYXRlbHkgbWluaW1pemVzIGl0cyB3aW5kb3cgYW5kIGNhbGxzIHRoZSBgRW1wdHlXb3JraW5nU2V0YCBBUEkuIFRoaXMgc2lnbmlmaWNhbnRseSByZWR1Y2VzIHRoZSBtZW1vcnkgZm9vdHByaW50IG9mIGJhY2tncm91bmQgY2xpZW50cywgd2hpY2ggaXMgY3J1Y2lhbCBmb3IgcnVubmluZyBtdWx0aXBsZSBpbnN0YW5jZXMuDQoNCiAgICAgICAgNC4gICoqUmVzb3VyY2UgTWFuYWdlbWVudCBhbmQgU2FmZXR5OioqDQogICAgICAgICAgICAqICAgVGhlIGBTdG9wLUNsaWVudExhdW5jaGAgZnVuY3Rpb24gZW5zdXJlcyBhbGwgcmVzb3VyY2Vz4oCUaW5jbHVkaW5nIHRoZSBiYWNrZ3JvdW5kIHJ1bnNwYWNlLCBQb3dlclNoZWxsIGluc3RhbmNlLCBldmVudCBoYW5kbGVycywgYW5kIHRpbWVyc+KAlGFyZSBwcm9wZXJseSBkaXNwb3NlZCBvZiwgcHJldmVudGluZyBtZW1vcnkgYW5kIGhhbmRsZSBsZWFrcy4NCiAgICAgICAgICAgICogICBBIHNhZmV0eSB0aW1lciBpcyBpbXBsZW1lbnRlZCBhcyBhIGZhaWwtc2FmZSB0byBhdXRvbWF0aWNhbGx5IGNsZWFuIHVwIHJlc291cmNlcyBpZiB0aGUgbGF1bmNoIHByb2Nlc3MgaGFuZ3MgZm9yIGFuIHVuZXhwZWN0ZWRseSBsb25nIHRpbWUuDQojPg0KDQojcmVnaW9uIENvbmZpZ3VyYXRpb24gYW5kIENvbnN0YW50cw0KDQojIERlZmF1bHQgbGF1bmNoZXIgdGltZW91dCBpbiBzZWNvbmRzDQokc2NyaXB0OkxhdW5jaGVyVGltZW91dCA9IDMwDQoNCiMgRGVmYXVsdCBkZWxheSBiZXR3ZWVuIGNsaWVudCBsYXVuY2hlcyBpbiBzZWNvbmRzDQokc2NyaXB0OkxhdW5jaERlbGF5ID0gMw0KDQojIE1heGltdW0gcmV0cnkgYXR0ZW1wdHMNCiRzY3JpcHQ6TWF4UmV0cnlBdHRlbXB0cyA9IDMNCg0KJHNjcmlwdDpQcm9jZXNzQ29uZmlnID0gQHsNCglNYXhSZXRyaWVzID0gMw0KCVJldHJ5RGVsYXkgPSA1MDAgIyBtaWxsaXNlY29uZHMNCglUaW1lb3V0ICAgID0gNjAwMDAgIyBtaWxsaXNlY29uZHMNCn0NCg0KI2VuZHJlZ2lvbiBDb25maWd1cmF0aW9uIGFuZCBDb25zdGFudHMNCg0KI3JlZ2lvbiBMYXVuY2ggTWFuYWdlbWVudCBGdW5jdGlvbnMNCg0KZnVuY3Rpb24gU3RhcnQtQ2xpZW50TGF1bmNoDQp7DQoJPCMNCgkuU1lOT1BTSVMNCglJbml0aWFsaXplcyBhbmQgc3RhcnRzIHRoZSBjbGllbnQgbGF1bmNoIHByb2Nlc3MuDQoJDQoJLkRFU0NSSVBUSU9ODQoJUHJlcGFyZXMgYW5kIHN0YXJ0cyB0aGUgYXN5bmNocm9ub3VzIGxhdW5jaCBvcGVyYXRpb24gZm9yIEVudHJvcGlhIGNsaWVudHMuDQoJIz4NCglbQ21kbGV0QmluZGluZygpXQ0KCXBhcmFtKCkNCgkNCgkjIFByZXZlbnQgbXVsdGlwbGUgbGF1bmNoZXMNCglpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTGF1bmNoQWN0aXZlKQ0KCXsNCgkJW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hdOjpTaG93KCdMYXVuY2ggb3BlcmF0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3MnLCAnSW5mb3JtYXRpb24nLA0KCQkJW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hCdXR0b25zXTo6T0ssIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94SWNvbl06OkluZm9ybWF0aW9uKQ0KCQlyZXR1cm4NCgl9DQoJDQoJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTGF1bmNoQWN0aXZlID0gJHRydWUNCgkNCgkjIENyZWF0ZSBhIG5ldyBvcmRlcmVkIGRpY3Rpb25hcnkgZm9yIHNldHRpbmdzDQoJJHNldHRpbmdzRGljdCA9IFtvcmRlcmVkXUB7fQ0KCQ0KCSMgQ29weSBzZXR0aW5ncyBmcm9tIGdsb2JhbCBjb25maWcNCglmb3JlYWNoICgkc2VjdGlvbiBpbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcuS2V5cykNCgl7DQoJCSRzZXR0aW5nc0RpY3RbJHNlY3Rpb25dID0gW29yZGVyZWRdQHt9DQoJCWZvcmVhY2ggKCRrZXkgaW4gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWyRzZWN0aW9uXS5LZXlzKQ0KCQl7DQoJCQkkc2V0dGluZ3NEaWN0WyRzZWN0aW9uXVska2V5XSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1skc2VjdGlvbl1bJGtleV0NCgkJfQ0KCX0NCgkNCgkjIEVuc3VyZSBsYXRlc3QgY29uZmlnIGlzIGxvYWRlZA0KCVJlYWQtQ29uZmlnDQoJDQoJIyBHZXQgcmVxdWlyZWQgc2V0dGluZ3MNCgkkbmV1ek5hbWUgPSAkc2V0dGluZ3NEaWN0WydQcm9jZXNzTmFtZSddWydQcm9jZXNzTmFtZSddDQoJJGxhdW5jaGVyUGF0aCA9ICRzZXR0aW5nc0RpY3RbJ0xhdW5jaGVyUGF0aCddWydMYXVuY2hlclBhdGgnXQ0KCQ0KCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogVXNpbmcgUHJvY2Vzc05hbWU6ICRuZXV6TmFtZSIgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogVXNpbmcgTGF1bmNoZXJQYXRoOiAkbGF1bmNoZXJQYXRoIiAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJDQoJIyBWYWxpZGF0ZSBzZXR0aW5ncw0KCWlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkbmV1ek5hbWUpIC1vciBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkbGF1bmNoZXJQYXRoKSAtb3IgLW5vdCAoVGVzdC1QYXRoICRsYXVuY2hlclBhdGgpKQ0KCXsNCgkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBJbnZhbGlkIGxhdW5jaCBzZXR0aW5ncycgLUZvcmVncm91bmRDb2xvciBZZWxsb3cNCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTGF1bmNoQWN0aXZlID0gJGZhbHNlDQoJCXJldHVybg0KCX0NCgkNCgkjIEdldCBtYXggY2xpZW50cyBzZXR0aW5nDQoJJG1heENsaWVudHMgPSAxDQoJaWYgKCRzZXR0aW5nc0RpY3RbJ01heENsaWVudHMnXS5Db250YWlucygnTWF4Q2xpZW50cycpIC1hbmQgLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkc2V0dGluZ3NEaWN0WydNYXhDbGllbnRzJ11bJ01heENsaWVudHMnXSkpDQoJew0KCQkkbWF4Q2xpZW50cyA9IFtpbnRdKCRzZXR0aW5nc0RpY3RbJ01heENsaWVudHMnXVsnTWF4Q2xpZW50cyddKQ0KCX0NCgkNCgkjIFByZXBhcmUgcnVuc3BhY2UgZm9yIGJhY2tncm91bmQgcHJvY2Vzc2luZw0KCSRsb2NhbFJ1bnNwYWNlID0gJG51bGwNCgl0cnkNCgl7DQoJCSMgQ3JlYXRlIGEgcnVuc3BhY2Ugd2l0aCBBcGFydG1lbnRTdGF0ZS5TVEEgdG8gZW5zdXJlIHByb3BlciBVSSBpbnRlcmFjdGlvbg0KCQkkbG9jYWxSdW5zcGFjZSA9IFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlJ1bnNwYWNlcy5SdW5zcGFjZUZhY3RvcnldOjpDcmVhdGVSdW5zcGFjZVBvb2woMSwgMSkNCgkJJGxvY2FsUnVuc3BhY2UuQXBhcnRtZW50U3RhdGUgPSBbU3lzdGVtLlRocmVhZGluZy5BcGFydG1lbnRTdGF0ZV06OlNUQQ0KCQkkbG9jYWxSdW5zcGFjZS5UaHJlYWRPcHRpb25zID0gW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUnVuc3BhY2VzLlBTVGhyZWFkT3B0aW9uc106OlJldXNlVGhyZWFkDQoJCSRsb2NhbFJ1bnNwYWNlLk9wZW4oKQ0KCX0NCgljYXRjaA0KCXsNCgkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBFcnJvciBjcmVhdGluZyBydW5zcGFjZTogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlN0YXRlLkxhdW5jaEFjdGl2ZSA9ICRmYWxzZQ0KCQlyZXR1cm4NCgl9DQoJDQoJJGxhdW5jaFBTID0gW1Bvd2VyU2hlbGxdOjpDcmVhdGUoKQ0KCSRsYXVuY2hQUy5SdW5zcGFjZVBvb2wgPSAkbG9jYWxSdW5zcGFjZQ0KCQ0KCSMgU3RvcmUgcmVmZXJlbmNlcyBnbG9iYWxseSBmb3IgY2xlYW51cA0KCSRnbG9iYWw6TGF1bmNoUmVzb3VyY2VzID0gQHsNCgkJUG93ZXJTaGVsbEluc3RhbmNlICA9ICRsYXVuY2hQUw0KCQlSdW5zcGFjZSAgICAgICAgICAgID0gJGxvY2FsUnVuc3BhY2UNCgkJRXZlbnRTdWJzY3JpcHRpb25JZCA9ICRudWxsDQoJCUV2ZW50U3Vic2NyaWJlciAgICAgPSAkbnVsbA0KCQlBc3luY1Jlc3VsdCAgICAgICAgID0gJG51bGwNCgkJU3RhcnRUaW1lICAgICAgICAgICA9IFtEYXRlVGltZV06Ok5vdw0KCX0NCgkNCgkkbGF1bmNoUFMuQWRkU2NyaXB0KHsNCgkJCXBhcmFtKA0KCQkJCSRTZXR0aW5ncywNCgkJCQkkTGF1bmNoZXJQYXRoLA0KCQkJCSROZXV6TmFtZSwNCgkJCQkkTWF4Q2xpZW50cywNCgkJCQkkSW5pUGF0aA0KCQkJKQ0KCQkNCgkJCXRyeQ0KCQkJew0KCQkJCVNldC1FeGVjdXRpb25Qb2xpY3kgLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLVNjb3BlIFByb2Nlc3MgLUZvcmNlDQoJCQkNCgkJCQkkY2xhc3NlcyA9IEAnDQoJCQkJdXNpbmcgU3lzdGVtOw0KCQkJDQoJCQkJcHVibGljIGNsYXNzIENvbG9yV3JpdGVyDQoJCQkJew0KCQkJCQlwdWJsaWMgc3RhdGljIHZvaWQgV3JpdGVDb2xvcmVkKHN0cmluZyBtZXNzYWdlLCBzdHJpbmcgY29sb3IpDQoJCQkJCXsNCgkJCQkJCUNvbnNvbGVDb2xvciBvcmlnaW5hbENvbG9yID0gQ29uc29sZS5Gb3JlZ3JvdW5kQ29sb3I7DQoJCQkJCQkNCgkJCQkJCXN3aXRjaChjb2xvci5Ub0xvd2VyKCkpDQoJCQkJCQl7DQoJCQkJCQkJY2FzZSAiZGFya2dyYXkiOg0KCQkJCQkJCQlDb25zb2xlLkZvcmVncm91bmRDb2xvciA9IENvbnNvbGVDb2xvci5EYXJrR3JheTsNCgkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJY2FzZSAieWVsbG93IjoNCgkJCQkJCQkJQ29uc29sZS5Gb3JlZ3JvdW5kQ29sb3IgPSBDb25zb2xlQ29sb3IuWWVsbG93Ow0KCQkJCQkJCQlicmVhazsNCgkJCQkJCQljYXNlICJyZWQiOg0KCQkJCQkJCQlDb25zb2xlLkZvcmVncm91bmRDb2xvciA9IENvbnNvbGVDb2xvci5SZWQ7DQoJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCWNhc2UgImN5YW4iOg0KCQkJCQkJCQlDb25zb2xlLkZvcmVncm91bmRDb2xvciA9IENvbnNvbGVDb2xvci5DeWFuOw0KCQkJCQkJCQlicmVhazsNCgkJCQkJCQljYXNlICJncmVlbiI6DQoJCQkJCQkJCUNvbnNvbGUuRm9yZWdyb3VuZENvbG9yID0gQ29uc29sZUNvbG9yLkdyZWVuOw0KCQkJCQkJCQlicmVhazsNCgkJCQkJCQlkZWZhdWx0Og0KCQkJCQkJCQlDb25zb2xlLkZvcmVncm91bmRDb2xvciA9IENvbnNvbGVDb2xvci5EYXJrR3JheTsNCgkJCQkJCQkJYnJlYWs7DQoJCQkJCQl9DQoJCQkJCQkNCgkJCQkJCUNvbnNvbGUuV3JpdGVMaW5lKG1lc3NhZ2UpOw0KCQkJCQkJQ29uc29sZS5Gb3JlZ3JvdW5kQ29sb3IgPSBvcmlnaW5hbENvbG9yOw0KCQkJCQl9DQoJCQkJfQ0KJ0ANCgkJCQ0KCQkJCUFkZC1UeXBlIC1UeXBlRGVmaW5pdGlvbiAkY2xhc3NlcyAtTGFuZ3VhZ2UgJ0NTaGFycCcNCgkJCQ0KCQkJCSMgQ3JlYXRlIGEgZnVuY3Rpb24gdGhhdCBvdmVycmlkZXMgdGhlIGJ1aWx0LWluIFdyaXRlLVZlcmJvc2UNCgkJCQlmdW5jdGlvbiBXcml0ZS1WZXJib3NlDQoJCQkJew0KCQkJCQlbQ21kbGV0QmluZGluZygpXQ0KCQkJCQlwYXJhbSgNCgkJCQkJCVtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsIFBvc2l0aW9uID0gMCldDQoJCQkJCQlbc3RyaW5nXSRPYmplY3QsDQoJCQkJDQoJCQkJCQlbUGFyYW1ldGVyKCldDQoJCQkJCQlbVmFsaWRhdGVTZXQoJ2RhcmtncmF5JywgJ3llbGxvdycsICdyZWQnLCAnY3lhbicsICdncmVlbicpXQ0KCQkJCQkJW3N0cmluZ10kRm9yZWdyb3VuZENvbG9yID0gJ2RhcmtncmF5Jw0KCQkJCQkpDQoJCQkJDQoJCQkJCVtDb2xvcldyaXRlcl06OldyaXRlQ29sb3JlZCgkT2JqZWN0LCAkRm9yZWdyb3VuZENvbG9yKQ0KCQkJCX0NCgkJCQ0KCQkJCSRsYXVuY2hlckRpciA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldERpcmVjdG9yeU5hbWUoJExhdW5jaGVyUGF0aCkNCgkJCQkkbGF1bmNoZXJOYW1lID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0RmlsZU5hbWVXaXRob3V0RXh0ZW5zaW9uKCRMYXVuY2hlclBhdGgpDQoJCQkNCgkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IENoZWNraW5nIGNsaWVudHMuLi4nIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkkY3VycmVudENsaWVudHMgPSBAKEdldC1Qcm9jZXNzIC1OYW1lICROZXV6TmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkNCgkJCQkkcENvdW50ID0gJGN1cnJlbnRDbGllbnRzLkNvdW50DQoJCQkNCgkJCQlpZiAoJHBDb3VudCAtZ3QgMCkNCgkJCQl7DQoJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogRm91bmQgJHBDb3VudCBjbGllbnQocykiIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQl9DQoJCQkJZWxzZQ0KCQkJCXsNCgkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBObyBjbGllbnRzIGZvdW5kJyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJfQ0KCQkJDQoJCQkJaWYgKCRwQ291bnQgLWdlICRNYXhDbGllbnRzKQ0KCQkJCXsNCgkJCQkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBNYXggcmVhY2hlZDogJE1heENsaWVudHMiIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJcmV0dXJuDQoJCQkJfQ0KCQkJDQoJCQkJJGNsaWVudHNUb0xhdW5jaCA9ICRNYXhDbGllbnRzIC0gJHBDb3VudA0KCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogTGF1bmNoaW5nICRjbGllbnRzVG9MYXVuY2ggbW9yZSIgLUZvcmVncm91bmRDb2xvciBDeWFuDQoJCQkNCgkJCQkjIFN0b3JlIG9ubHkgdGhlIElEcywgbm90IHRoZSBwcm9jZXNzIG9iamVjdHMNCgkJCQkkZXhpc3RpbmdQSURzID0gJGN1cnJlbnRDbGllbnRzIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgSWQNCgkJCQlpZiAoJGV4aXN0aW5nUElEcy5Db3VudCAtZ3QgMCkNCgkJCQl7DQoJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogVHJhY2tpbmcgUElEczogJCgkZXhpc3RpbmdQSURzIC1qb2luICcsJykiIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQl9DQoJCQkNCgkJCQkjIENsZWFyIHByb2Nlc3Mgb2JqZWN0cyB0byBhdm9pZCBrZWVwaW5nIHJlZmVyZW5jZXMNCgkJCQkkY3VycmVudENsaWVudHMgPSAkbnVsbA0KCQkJDQoJCQkJZm9yICgkYXR0ZW1wdCA9IDE7ICRhdHRlbXB0IC1sZSAkY2xpZW50c1RvTGF1bmNoOyAkYXR0ZW1wdCsrKQ0KCQkJCXsNCgkJCQkNCgkJCQkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBDbGllbnQgJGF0dGVtcHQvJGNsaWVudHNUb0xhdW5jaCIgLUZvcmVncm91bmRDb2xvciBDeWFuDQoJCQkJDQoJCQkJCSMgQ2hlY2sgaWYgbGF1bmNoZXIgaXMgYWxyZWFkeSBydW5uaW5nDQoJCQkJCSRsYXVuY2hlclJ1bm5pbmcgPSAkbnVsbCAtbmUgKEdldC1Qcm9jZXNzIC1OYW1lICRsYXVuY2hlck5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpDQoJCQkJCWlmICgkbGF1bmNoZXJSdW5uaW5nKQ0KCQkJCQl7DQoJCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IExhdW5jaGVyIHJ1bm5pbmcnIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogV2FpdGluZyAoNjBzIHRpbWVvdXQpJyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJCQkkbGF1bmNoZXJUaW1lb3V0ID0gTmV3LVRpbWVTcGFuIC1TZWNvbmRzIDYwDQoJCQkJCQkkbGF1bmNoZXJTdG9wd2F0Y2ggPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkNCgkJCQkJCSRwcm9ncmVzc1JlcG9ydGVkID0gQCg1LCAxMCwgMTUsIDIwLCAyNSwgMzAsIDM1LCA0MCwgNDUsIDUwLCA1NSwgNjApDQoJCQkJCQ0KCQkJCQkJd2hpbGUgKCRudWxsIC1uZSAoR2V0LVByb2Nlc3MgLU5hbWUgJGxhdW5jaGVyTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpDQoJCQkJCQl7DQoJCQkJCQkJJGVsYXBzZWRTZWNvbmRzID0gW2ludF0kbGF1bmNoZXJTdG9wd2F0Y2guRWxhcHNlZC5Ub3RhbFNlY29uZHMNCgkJCQkJCQ0KCQkJCQkJCWlmICgkZWxhcHNlZFNlY29uZHMgLWluICRwcm9ncmVzc1JlcG9ydGVkKQ0KCQkJCQkJCXsNCgkJCQkJCQkJJHByb2dyZXNzUmVwb3J0ZWQgPSAkcHJvZ3Jlc3NSZXBvcnRlZCB8IFdoZXJlLU9iamVjdCB7ICRfIC1uZSAkZWxhcHNlZFNlY29uZHMgfQ0KCQkJCQkJCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6IFdhaXRpbmcuICgkZWxhcHNlZFNlY29uZHMgcyAvIDYwKSIgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJCQkJCX0NCgkJCQkJCQ0KCQkJCQkJCWlmICgkbGF1bmNoZXJTdG9wd2F0Y2guRWxhcHNlZCAtZ3QgJGxhdW5jaGVyVGltZW91dCkNCgkJCQkJCQl7DQoJCQkJCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogVGltZW91dCAtIGtpbGxpbmcnIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQoJCQkJCQkJCXRyeQ0KCQkJCQkJCQl7DQoJCQkJCQkJCQlTdG9wLVByb2Nlc3MgLU5hbWUgJGxhdW5jaGVyTmFtZSAtRm9yY2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCgkJCQkJCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogVGVybWluYXRlZCcgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJCQkJCQl9DQoJCQkJCQkJCWNhdGNoDQoJCQkJCQkJCXsNCgkJCQkJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQkJCQkJCX0NCgkJCQkJCQkJU3RhcnQtU2xlZXAgLVNlY29uZHMgMQ0KCQkJCQkJCQlicmVhaw0KCQkJCQkJCX0NCgkJCQkJCQlTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDUwMA0KCQkJCQkJfQ0KCQkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBMYXVuY2hlciBjbG9zZWQnIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJfQ0KCQkJCQ0KCQkJCQkjIFN0YXJ0IGxhdW5jaGVyDQoJCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogU3RhcnRpbmcgbGF1bmNoZXInIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJJGxhdW5jaGVyUHJvY2VzcyA9IFN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICRMYXVuY2hlclBhdGggLVdvcmtpbmdEaXJlY3RvcnkgJGxhdW5jaGVyRGlyIC1QYXNzVGhydQ0KCQkJCQkkbGF1bmNoZXJQSUQgPSAkbGF1bmNoZXJQcm9jZXNzLklkDQoJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogUElEOiAkbGF1bmNoZXJQSUQiIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkNCgkJCQkJIyBSZWxlYXNlIHRoZSBwcm9jZXNzIG9iamVjdCBpbW1lZGlhdGVseQ0KCQkJCQkkbGF1bmNoZXJQcm9jZXNzID0gJG51bGwNCgkJCQkNCgkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBJbml0aWFsaXppbmcuLi4nIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJU3RhcnQtU2xlZXAgLVNlY29uZHMgMQ0KCQkJCQ0KCQkJCQkjIE1vbml0b3IgbGF1bmNoZXIgcHJvY2Vzcw0KCQkJCQkkdGltZW91dCA9IE5ldy1UaW1lU3BhbiAtTWludXRlcyAyDQoJCQkJCSRzdG9wd2F0Y2ggPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkNCgkJCQkJJGxhdW5jaGVyQ2xvc2VkID0gJGZhbHNlDQoJCQkJCSRsYXVuY2hlckNsb3NlZE5vcm1hbGx5ID0gJGZhbHNlDQoJCQkJCSRwcm9ncmVzc1JlcG9ydGVkID0gQCgxLCA1LCAxNSwgMzAsIDYwLCA5MCwgMTIwKQ0KCQkJCQ0KCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IE1vbml0b3JpbmcgKDJtaW4pJyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJCXdoaWxlICgtbm90ICRsYXVuY2hlckNsb3NlZCAtYW5kICRzdG9wd2F0Y2guRWxhcHNlZCAtbHQgJHRpbWVvdXQpDQoJCQkJCXsNCgkJCQkJCSRlbGFwc2VkU2Vjb25kcyA9IFtpbnRdJHN0b3B3YXRjaC5FbGFwc2VkLlRvdGFsU2Vjb25kcw0KCQkJCQkJaWYgKCRlbGFwc2VkU2Vjb25kcyAtaW4gJHByb2dyZXNzUmVwb3J0ZWQpDQoJCQkJCQl7DQoJCQkJCQkJJHByb2dyZXNzUmVwb3J0ZWQgPSAkcHJvZ3Jlc3NSZXBvcnRlZCB8IFdoZXJlLU9iamVjdCB7ICRfIC1uZSAkZWxhcHNlZFNlY29uZHMgfQ0KCQkJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogQ2xvc2UgZGFzaGJvYXJkIGlmIHBhdGNoaW5nISBMb25nIFBhdGNoaW5nIG9wZXJhdGlvbnMgbWF5IGJlIGNhbmNlbGVkIGJ5IHRoZSBkYXNoYm9hcmQgKCRlbGFwc2VkU2Vjb25kcyBzIC8gMTIwKSIgLUZvcmVncm91bmRDb2xvciBZZWxsb3cNCgkJCQkJCX0NCgkJCQkJDQoJCQkJCQkjIEdldCBwcm9jZXNzIGluZm8gd2l0aG91dCBzdG9yaW5nIHRoZSBvYmplY3QNCgkJCQkJCSRsYXVuY2hlckV4aXN0cyA9ICRmYWxzZQ0KCQkJCQkJJGxhdW5jaGVyUmVzcG9uZGluZyA9ICR0cnVlDQoJCQkJCQ0KCQkJCQkJdHJ5DQoJCQkJCQl7DQoJCQkJCQkJJHRlbXBQcm9jZXNzID0gR2V0LVByb2Nlc3MgLUlkICRsYXVuY2hlclBJRCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KCQkJCQkJCWlmICgkdGVtcFByb2Nlc3MpDQoJCQkJCQkJew0KCQkJCQkJCQkkbGF1bmNoZXJFeGlzdHMgPSAkdHJ1ZQ0KCQkJCQkJCQkkbGF1bmNoZXJSZXNwb25kaW5nID0gJHRlbXBQcm9jZXNzLlJlc3BvbmRpbmcNCgkJCQkJCQkJIyBSZWxlYXNlIHRoZSByZWZlcmVuY2UgaW1tZWRpYXRlbHkNCgkJCQkJCQkJJHRlbXBQcm9jZXNzID0gJG51bGwNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQljYXRjaA0KCQkJCQkJew0KCQkJCQkJCSRsYXVuY2hlckV4aXN0cyA9ICRmYWxzZQ0KCQkJCQkJfQ0KCQkJCQkNCgkJCQkJCWlmICgtbm90ICRsYXVuY2hlckV4aXN0cykNCgkJCQkJCXsNCgkJCQkJCQkkbGF1bmNoZXJDbG9zZWQgPSAkdHJ1ZQ0KCQkJCQkJCSRsYXVuY2hlckNsb3NlZE5vcm1hbGx5ID0gJHRydWUNCgkJCQkJCX0NCgkJCQkJCWVsc2UNCgkJCQkJCXsNCgkJCQkJCQlpZiAoLW5vdCAkbGF1bmNoZXJSZXNwb25kaW5nKQ0KCQkJCQkJCXsNCgkJCQkJCQkJJGVsYXBzZWRUaW1lID0gW21hdGhdOjpSb3VuZCgkc3RvcHdhdGNoLkVsYXBzZWQuVG90YWxTZWNvbmRzLCAxKQ0KCQkJCQkJCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6IE5vdCByZXNwb25kaW5nICRlbGFwc2VkVGltZSIgLUZvcmVncm91bmRDb2xvciBZZWxsb3cNCgkJCQkJCQkJdHJ5DQoJCQkJCQkJCXsNCgkJCQkJCQkJCVN0b3AtUHJvY2VzcyAtSWQgJGxhdW5jaGVyUElEIC1Gb3JjZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KCQkJCQkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBUZXJtaW5hdGVkJyAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJCQkJCQl9DQoJCQkJCQkJCWNhdGNoDQoJCQkJCQkJCXsNCgkJCQkJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQkJCQkJCX0NCgkJCQkJCQkJJGxhdW5jaGVyQ2xvc2VkID0gJHRydWUNCgkJCQkJCQkJJGxhdW5jaGVyQ2xvc2VkTm9ybWFsbHkgPSAkZmFsc2UNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQ0KCQkJCQkJaWYgKC1ub3QgJGxhdW5jaGVyQ2xvc2VkKQ0KCQkJCQkJew0KCQkJCQkJCVN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgNTAwDQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkNCgkJCQkJaWYgKC1ub3QgJGxhdW5jaGVyQ2xvc2VkKQ0KCQkJCQl7DQoJCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IFRpbWVvdXQgLSBraWxsaW5nJyAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJCQkJdHJ5DQoJCQkJCQl7DQoJCQkJCQkJU3RvcC1Qcm9jZXNzIC1JZCAkbGF1bmNoZXJQSUQgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlDQoJCQkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBUZXJtaW5hdGVkJyAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJCQkJfQ0KCQkJCQkJY2F0Y2gNCgkJCQkJCXsNCgkJCQkJCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJCQkJfQ0KCQkJCQkJJGxhdW5jaGVyQ2xvc2VkTm9ybWFsbHkgPSAkZmFsc2UNCgkJCQkJfQ0KCQkJCQ0KCQkJCQkjIFdhaXQgZm9yIGNsaWVudCB0byBzdGFydA0KCQkJCQkkY2xpZW50U3RhcnRlZCA9ICRmYWxzZQ0KCQkJCQkkbmV3Q2xpZW50UElEID0gMA0KCQkJCQkkc3RvcHdhdGNoLlJlc3RhcnQoKQ0KCQkJCQkkY2xpZW50RGV0ZWN0aW9uVGltZW91dCA9IE5ldy1UaW1lU3BhbiAtU2Vjb25kcyAzMA0KCQkJCQkkcHJvZ3Jlc3NSZXBvcnRlZCA9IEAoNSwgMTAsIDE1LCAyMCwgMjUpDQoJCQkJDQoJCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogV2FpdGluZyBmb3IgY2xpZW50JyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJCXdoaWxlICgtbm90ICRjbGllbnRTdGFydGVkIC1hbmQgJHN0b3B3YXRjaC5FbGFwc2VkIC1sdCAkY2xpZW50RGV0ZWN0aW9uVGltZW91dCkNCgkJCQkJew0KCQkJCQkJJGVsYXBzZWRTZWNvbmRzID0gW2ludF0kc3RvcHdhdGNoLkVsYXBzZWQuVG90YWxTZWNvbmRzDQoJCQkJCQlpZiAoJGVsYXBzZWRTZWNvbmRzIC1pbiAkcHJvZ3Jlc3NSZXBvcnRlZCkNCgkJCQkJCXsNCgkJCQkJCQkkcHJvZ3Jlc3NSZXBvcnRlZCA9ICRwcm9ncmVzc1JlcG9ydGVkIHwgV2hlcmUtT2JqZWN0IHsgJF8gLW5lICRlbGFwc2VkU2Vjb25kcyB9DQoJCQkJCQkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBXYWl0aW5nLiAoJGVsYXBzZWRTZWNvbmRzIHMgLyA2MCkiIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJCX0NCgkJCQkJDQoJCQkJCQkjIEdldCBjdXJyZW50IGNsaWVudCBQSURzIHdpdGhvdXQga2VlcGluZyBwcm9jZXNzIG9iamVjdHMNCgkJCQkJCSRjdXJyZW50UElEcyA9IEAoR2V0LVByb2Nlc3MgLU5hbWUgJE5ldXpOYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgSWQpDQoJCQkJCQkkbmV3UElEcyA9ICRjdXJyZW50UElEcyB8IFdoZXJlLU9iamVjdCB7ICRfIC1ub3RpbiAkZXhpc3RpbmdQSURzIH0NCgkJCQkJDQoJCQkJCQlpZiAoJG5ld1BJRHMuQ291bnQgLWd0IDApDQoJCQkJCQl7DQoJCQkJCQkJdHJ5DQoJCQkJCQkJew0KCQkJCQkJCQkjIEdldCB0aGUgbmV3ZXN0IGNsaWVudCBieSBnZXR0aW5nIHByb2Nlc3MgaW5mbyBhbmQgc29ydGluZywgYnV0IGRvbiJ0IGtlZXAgcmVmZXJlbmNlcw0KCQkJCQkJCQkkdGVtcE5ld0NsaWVudHMgPSBAKEdldC1Qcm9jZXNzIC1JZCAkbmV3UElEcyAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkNCgkJCQkJCQkJJHRlbXBOZXdDbGllbnQgPSAkdGVtcE5ld0NsaWVudHMgfCBTb3J0LU9iamVjdCBTdGFydFRpbWUgLURlc2NlbmRpbmcgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxDQoJCQkJCQkJDQoJCQkJCQkJCWlmICgkdGVtcE5ld0NsaWVudCkNCgkJCQkJCQkJew0KCQkJCQkJCQkJJG5ld0NsaWVudFBJRCA9ICR0ZW1wTmV3Q2xpZW50LklkDQoJCQkJCQkJCQkkY2xpZW50U3RhcnRlZCA9ICR0cnVlDQoJCQkJCQkJCQkkZXhpc3RpbmdQSURzICs9ICRuZXdDbGllbnRQSUQNCgkJCQkJCQkJCSRlbGFwc2VkVGltZSA9IFttYXRoXTo6Um91bmQoJHN0b3B3YXRjaC5FbGFwc2VkLlRvdGFsU2Vjb25kcywgMSkNCgkJCQkJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogQ2xpZW50IHN0YXJ0ZWQgUElEOiAkbmV3Q2xpZW50UElEIiAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJCQkJCQ0KCQkJCQkJCQkJIyBSZWxlYXNlIHJlZmVyZW5jZXMNCgkJCQkJCQkJCSR0ZW1wTmV3Q2xpZW50ID0gJG51bGwNCgkJCQkJCQkJCSR0ZW1wTmV3Q2xpZW50cyA9ICRudWxsDQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQkJY2F0Y2gNCgkJCQkJCQl7DQoJCQkJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogRXJyb3Igc29ydGluZyBjbGllbnRzOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCQkJCQkJIyBUcnkgd2l0aG91dCBzb3J0aW5nDQoJCQkJCQkJCWlmICgkbmV3UElEcy5Db3VudCAtZ3QgMCkNCgkJCQkJCQkJew0KCQkJCQkJCQkJJG5ld0NsaWVudFBJRCA9ICRuZXdQSURzWzBdDQoJCQkJCQkJCQkkY2xpZW50U3RhcnRlZCA9ICR0cnVlDQoJCQkJCQkJCQkkZXhpc3RpbmdQSURzICs9ICRuZXdDbGllbnRQSUQNCgkJCQkJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogVXNpbmcgY2xpZW50IFBJRDogJG5ld0NsaWVudFBJRCAoZmFsbGJhY2spIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJDQoJCQkJCQkJaWYgKCRjbGllbnRTdGFydGVkKQ0KCQkJCQkJCXsNCgkJCQkJCQkJIyBXYWl0IGZvciB3aW5kb3cgdG8gYmUgcmVhZHkNCgkJCQkJCQkJJHdpbmRvd1JlYWR5ID0gJGZhbHNlDQoJCQkJCQkJCSRpbm5lclRpbWVvdXQgPSBOZXctVGltZVNwYW4gLVNlY29uZHMgMzANCgkJCQkJCQkJJGlubmVyU3RvcHdhdGNoID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpDQoJCQkJCQkJCSRpbm5lclByb2dyZXNzUmVwb3J0ZWQgPSBAKDUsIDEwLCAxNSwgMjAsIDI1KQ0KCQkJCQkJCQ0KCQkJCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IFdhaXRpbmcgZm9yIHdpbmRvdycgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJCQkJCQl3aGlsZSAoLW5vdCAkd2luZG93UmVhZHkgLWFuZCAkaW5uZXJTdG9wd2F0Y2guRWxhcHNlZCAtbHQgJGlubmVyVGltZW91dCkNCgkJCQkJCQkJew0KCQkJCQkJCQkJJGlubmVyRWxhcHNlZFNlY29uZHMgPSBbaW50XSRpbm5lclN0b3B3YXRjaC5FbGFwc2VkLlRvdGFsU2Vjb25kcw0KCQkJCQkJCQkJaWYgKCRpbm5lckVsYXBzZWRTZWNvbmRzIC1pbiAkaW5uZXJQcm9ncmVzc1JlcG9ydGVkKQ0KCQkJCQkJCQkJew0KCQkJCQkJCQkJCSRpbm5lclByb2dyZXNzUmVwb3J0ZWQgPSAkaW5uZXJQcm9ncmVzc1JlcG9ydGVkIHwgV2hlcmUtT2JqZWN0IHsgJF8gLW5lICRpbm5lckVsYXBzZWRTZWNvbmRzIH0NCgkJCQkJCQkJCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6IFdhaXRpbmcuICgkaW5uZXJFbGFwc2VkU2Vjb25kcyBzIC8gNjApIiAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJCQkJCQl9DQoJCQkJCQkJCQ0KCQkJCQkJCQkJIyBDaGVjayBjbGllbnQgd2l0aG91dCBrZWVwaW5nIHJlZmVyZW5jZXMNCgkJCQkJCQkJCSRjbGllbnRFeGlzdHMgPSAkZmFsc2UNCgkJCQkJCQkJCSRjbGllbnRSZXNwb25kaW5nID0gJGZhbHNlDQoJCQkJCQkJCQkkY2xpZW50V2luZG93SGFuZGxlID0gW0ludFB0cl06Olplcm8NCgkJCQkJCQkJCSRjbGllbnRIYW5kbGUgPSBbSW50UHRyXTo6WmVybw0KCQkJCQkJCQkNCgkJCQkJCQkJCXRyeQ0KCQkJCQkJCQkJew0KCQkJCQkJCQkJCSR0ZW1wQ2xpZW50ID0gR2V0LVByb2Nlc3MgLUlkICRuZXdDbGllbnRQSUQgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCgkJCQkJCQkJCQlpZiAoJHRlbXBDbGllbnQpDQoJCQkJCQkJCQkJew0KCQkJCQkJCQkJCQkkY2xpZW50RXhpc3RzID0gJHRydWUNCgkJCQkJCQkJCQkJJGNsaWVudFJlc3BvbmRpbmcgPSAkdGVtcENsaWVudC5SZXNwb25kaW5nDQoJCQkJCQkJCQkJCSRjbGllbnRXaW5kb3dIYW5kbGUgPSAkdGVtcENsaWVudC5NYWluV2luZG93SGFuZGxlDQoJCQkJCQkJCQkJCSRjbGllbnRIYW5kbGUgPSAkdGVtcENsaWVudC5IYW5kbGUNCgkJCQkJCQkJCQkNCgkJCQkJCQkJCQkJIyBTdG9yZSB3aW5kb3cgaGFuZGxlIGluIGEgc2VwYXJhdGUgdmFyaWFibGUgYW5kIHJlbGVhc2UgcHJvY2VzcyBvYmplY3QNCgkJCQkJCQkJCQkJJHRlbXBDbGllbnQgPSAkbnVsbA0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCX0NCgkJCQkJCQkJCWNhdGNoDQoJCQkJCQkJCQl7DQoJCQkJCQkJCQkJJGNsaWVudEV4aXN0cyA9ICRmYWxzZQ0KCQkJCQkJCQkJfQ0KCQkJCQkJCQkNCgkJCQkJCQkJCWlmICgtbm90ICRjbGllbnRFeGlzdHMpDQoJCQkJCQkJCQl7DQoJCQkJCQkJCQkJJGVsYXBzZWRUaW1lID0gW21hdGhdOjpSb3VuZCgkaW5uZXJTdG9wd2F0Y2guRWxhcHNlZC5Ub3RhbFNlY29uZHMsIDEpDQoJCQkJCQkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBDbGllbnQgdGVybWluYXRlZCcgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCQkJCQkJCQkkY2xpZW50U3RhcnRlZCA9ICRmYWxzZQ0KCQkJCQkJCQkJCSRjbGllbnRSZXNwb25kaW5nID0gJGZhbHNlDQoJCQkJCQkJCQkJJHdpbmRvd1JlYWR5ID0gJGZhbHNlDQoJCQkJCQkJCQkJYnJlYWsNCgkJCQkJCQkJCX0NCgkJCQkJCQkJDQoJCQkJCQkJCQlpZiAoJGNsaWVudFJlc3BvbmRpbmcgLWFuZCAkY2xpZW50V2luZG93SGFuZGxlIC1uZSBbSW50UHRyXTo6WmVybykNCgkJCQkJCQkJCXsNCgkJCQkJCQkJCQkkd2luZG93UmVhZHkgPSAkdHJ1ZQ0KCQkJCQkJCQkJCSRlbGFwc2VkVGltZSA9IFttYXRoXTo6Um91bmQoJGlubmVyU3RvcHdhdGNoLkVsYXBzZWQuVG90YWxTZWNvbmRzLCAxKQ0KCQkJCQkJCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogV2luZG93IHJlYWR5JyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJCQkJCQkNCgkJCQkJCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IE1pbmltaXppbmcuLi4nIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJCQkJCQlTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDUwMA0KCQkJCQkJCQkJCVtDdXN0b20uTmF0aXZlXTo6U2hvd1dpbmRvdygkY2xpZW50V2luZG93SGFuZGxlLCBbQ3VzdG9tLk5hdGl2ZV06OlNXX01JTklNSVpFKQ0KCQkJCQkJCQkJDQoJCQkJCQkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBPcHRpbWl6aW5nLi4uJyAtRm9yZWdyb3VuZENvbG9yIEN5YW4NCgkJCQkJCQkJCQl0cnkNCgkJCQkJCQkJCQl7DQoJCQkJCQkJCQkJCVtDdXN0b20uTmF0aXZlXTo6RW1wdHlXb3JraW5nU2V0KCRjbGllbnRIYW5kbGUpDQoJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJCWNhdGNoDQoJCQkJCQkJCQkJew0KCQkJCQkJCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IE9wdCBmYWlsZWQnIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJDQoJCQkJCQkJCQkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBDbGllbnQgcmVhZHk6ICRuZXdDbGllbnRQSUQiIC1Gb3JlZ3JvdW5kQ29sb3IgR3JlZW4NCgkJCQkJCQkJCX0NCgkJCQkJCQkJDQoJCQkJCQkJCQlTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDUwMA0KCQkJCQkJCQl9DQoJCQkJCQkJDQoJCQkJCQkJCWlmICgtbm90ICR3aW5kb3dSZWFkeSkNCgkJCQkJCQkJew0KCQkJCQkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBXaW5kb3cgbm90IHJlc3BvbnNpdmUnIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQkJCQkJCQkkY2xpZW50U3RhcnRlZCA9ICRmYWxzZQ0KCQkJCQkJCQkJYnJlYWsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJDQoJCQkJCQlTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDUwMA0KCQkJCQl9DQoJCQkJDQoJCQkJCWlmICgtbm90ICRjbGllbnRTdGFydGVkKQ0KCQkJCQl7DQoJCQkJCQlpZiAoLW5vdCAkbGF1bmNoZXJDbG9zZWROb3JtYWxseSkNCgkJCQkJCXsNCgkJCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IExhdW5jaGVyIGZhaWxlZCcgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCQkJCX0NCgkJCQkJCWVsc2UNCgkJCQkJCXsNCgkJCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IE5vIGNsaWVudCBkZXRlY3RlZCcgLUZvcmVncm91bmRDb2xvciBZZWxsb3cNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQ0KCQkJCQkjIENoZWNrIGNsaWVudCBjb3VudCB3aXRob3V0IGtlZXBpbmcgcmVmZXJlbmNlcw0KCQkJCQkkcENvdW50ID0gKEdldC1Qcm9jZXNzIC1OYW1lICROZXV6TmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE1lYXN1cmUtT2JqZWN0KS5Db3VudA0KCQkJCQlpZiAoJHBDb3VudCAtZ2UgJE1heENsaWVudHMpDQoJCQkJCXsNCgkJCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogTWF4IHJlYWNoZWQ6ICRNYXhDbGllbnRzIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KCQkJCQkJYnJlYWsNCgkJCQkJfQ0KCQkJCQ0KCQkJCQlTdGFydC1TbGVlcCAtU2Vjb25kcyAyDQoJCQkJfQ0KCQkJDQoJCQl9DQoJCQljYXRjaA0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQl9DQoJCQlmaW5hbGx5DQoJCQl7DQoJCQkNCgkJCQkjIENsZWFyIGFueSByZW1haW5pbmcgcmVmZXJlbmNlcyB0byBwcm9jZXNzZXMNCgkJCQkkZXhpc3RpbmdQSURzID0gJG51bGwNCgkJCQlbU3lzdGVtLkdDXTo6Q29sbGVjdCgpDQoJCQl9DQoJCX0pLkFkZEFyZ3VtZW50KCRzZXR0aW5nc0RpY3QpLkFkZEFyZ3VtZW50KCRsYXVuY2hlclBhdGgpLkFkZEFyZ3VtZW50KCRuZXV6TmFtZSkuQWRkQXJndW1lbnQoJG1heENsaWVudHMpLkFkZEFyZ3VtZW50KCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkluaSkNCgkNCgkjIEV2ZW50IHJlZ2lzdHJhdGlvbiBhbmQgY2xlYW51cCBzZWN0aW9uDQoJdHJ5DQoJew0KCQkjIEZpcnN0LCBkZWZpbmUgdGhlIGNvbXBsZXRpb24gYWN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgb3BlcmF0aW9uIGNvbXBsZXRlcw0KCQkkY29tcGxldGlvblNjcmlwdEJsb2NrID0gew0KCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBMYXVuY2ggb3BlcmF0aW9uIGNvbXBsZXRlZCwgcHJvY2Vzc2luZyBtZXNzYWdlcycgLUZvcmVncm91bmRDb2xvciBHcmVlbg0KCQkJDQoJCQkjIENhbGwgY2xlYW51cCBmdW5jdGlvbg0KCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBDYWxsaW5nIFN0b3AtQ2xpZW50TGF1bmNoJyAtRm9yZWdyb3VuZENvbG9yIEN5YW4NCgkJCVN0b3AtQ2xpZW50TGF1bmNoDQoJCX0NCgkJDQoJCSMgU3RvcmUgdGhlIGNvbXBsZXRpb24gYWN0aW9uIGluIGEgc2NyaXB0LWxldmVsIHZhcmlhYmxlDQoJCSRzY3JpcHQ6TGF1bmNoQ29tcGxldGlvbkFjdGlvbiA9ICRjb21wbGV0aW9uU2NyaXB0QmxvY2sNCgkJDQoJCSMgQ3JlYXRlIGEgdW5pcXVlIGV2ZW50IG5hbWUNCgkJJGV2ZW50TmFtZSA9ICdMYXVuY2hPcGVyYXRpb25fJyArIFtHdWlkXTo6TmV3R3VpZCgpLlRvU3RyaW5nKCdOJykNCgkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBDcmVhdGluZyBldmVudCB3aXRoIG5hbWU6ICRldmVudE5hbWUiIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJDQoJCSMgQ3JlYXRlIGEgc2ltcGxlIHNjcmlwdGJsb2NrIGZvciB0aGUgZXZlbnQgdGhhdCBkb2VzbiJ0IHJlZmVyZW5jZSBhbnkgdmFyaWFibGVzDQoJCSRzaW1wbGVFdmVudEFjdGlvbiA9IHsNCgkJCXBhcmFtKCRzcmMsICRlKQ0KCQkJDQoJCQkjIE9ubHkgcHJvY2VzcyBjb21wbGV0ZWQsIGZhaWxlZCwgb3Igc3RvcHBlZCBzdGF0ZXMNCgkJCSRzdGF0ZSA9ICRlLkludm9jYXRpb25TdGF0ZUluZm8uU3RhdGUNCgkJCWlmICgkc3RhdGUgLWVxICdDb21wbGV0ZWQnIC1vciAkc3RhdGUgLWVxICdGYWlsZWQnIC1vciAkc3RhdGUgLWVxICdTdG9wcGVkJykNCgkJCXsNCgkJCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6IFBvd2VyU2hlbGwgb3BlcmF0aW9uIHN0YXRlIGNoYW5nZWQgdG86ICRzdGF0ZSIgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJCQ0KCQkJCSMgQ2FsbCBjbGVhbnVwIGRpcmVjdGx5IC0gZG9uInQgcmVmZXJlbmNlIGFueSBnbG9iYWwgdmFyaWFibGVzDQoJCQkJaWYgKEdldC1Db21tYW5kIC1OYW1lIFN0b3AtQ2xpZW50TGF1bmNoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQ0KCQkJCXsNCgkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBDYWxsaW5nIFN0b3AtQ2xpZW50TGF1bmNoIGZyb20gZXZlbnQgaGFuZGxlcicgLUZvcmVncm91bmRDb2xvciBDeWFuDQoJCQkJCVN0b3AtQ2xpZW50TGF1bmNoDQoJCQkJfQ0KCQkJCWVsc2UNCgkJCQl7DQoJCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogU3RvcC1DbGllbnRMYXVuY2ggZnVuY3Rpb24gbm90IGZvdW5kJyAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkNCgkJIyBSZWdpc3RlciB0aGUgZXZlbnQgd2l0aCBtaW5pbWFsIGRlcGVuZGVuY2llcw0KCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IFJlZ2lzdGVyaW5nIGV2ZW50IGhhbmRsZXInIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KCQkkZXZlbnRTdWIgPSBSZWdpc3Rlci1PYmplY3RFdmVudCAtSW5wdXRPYmplY3QgJGxhdW5jaFBTIC1FdmVudE5hbWUgSW52b2NhdGlvblN0YXRlQ2hhbmdlZCAtU291cmNlSWRlbnRpZmllciAkZXZlbnROYW1lIC1BY3Rpb24gJHNpbXBsZUV2ZW50QWN0aW9uDQoJCQ0KCQkjIFZlcmlmeSBldmVudCByZWdpc3RyYXRpb24NCgkJaWYgKCRudWxsIC1lcSAkZXZlbnRTdWIpDQoJCXsNCgkJCXRocm93ICdGYWlsZWQgdG8gcmVnaXN0ZXIgZXZlbnQgc3Vic2NyaWJlcicNCgkJfQ0KCQkNCgkJIyBTdG9yZSBldmVudCBpbmZvcm1hdGlvbg0KCQkkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5FdmVudFN1YnNjcmlwdGlvbklkID0gJGV2ZW50TmFtZQ0KCQkkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5FdmVudFN1YnNjcmliZXIgPSAkZXZlbnRTdWINCgkJDQoJCSMgU2V0IHVwIGEgc2FmZXR5IHRpbWVyDQoJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogU2V0dGluZyB1cCBzYWZldHkgdGltZXInIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJJHNhZmV0eVRpbWVyID0gTmV3LU9iamVjdCBTeXN0ZW0uVGltZXJzLlRpbWVyDQoJCSRzYWZldHlUaW1lci5JbnRlcnZhbCA9IDMwMDAwMCAgIyA1IG1pbnV0ZXMNCgkJJHNhZmV0eVRpbWVyLkF1dG9SZXNldCA9ICRmYWxzZQ0KCQkNCgkJIyBDcmVhdGUgYSBzaW1wbGUgdGltZXIgZWxhcHNlZCBoYW5kbGVyDQoJCSRzYWZldHlUaW1lci5BZGRfRWxhcHNlZCh7DQoJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBTYWZldHkgdGltZXIgZWxhcHNlZCcgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJDQoJCQkJIyBDYWxsIGNsZWFudXAgZGlyZWN0bHkgLSBkb24idCByZWZlcmVuY2UgYW55IGdsb2JhbCB2YXJpYWJsZXMNCgkJCQlpZiAoR2V0LUNvbW1hbmQgLU5hbWUgU3RvcC1DbGllbnRMYXVuY2ggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpDQoJCQkJew0KCQkJCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IENhbGxpbmcgU3RvcC1DbGllbnRMYXVuY2ggZnJvbSBzYWZldHkgdGltZXInIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJCQkJU3RvcC1DbGllbnRMYXVuY2gNCgkJCQl9DQoJCQkJZWxzZQ0KCQkJCXsNCgkJCQkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBTdG9wLUNsaWVudExhdW5jaCBmdW5jdGlvbiBub3QgZm91bmQnIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQkJfQ0KCQkJfSkNCgkJDQoJCSMgU3RhcnQgdGhlIHRpbWVyDQoJCSRzYWZldHlUaW1lci5TdGFydCgpDQoJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnNbJ2xhdW5jaFNhZmV0eVRpbWVyJ10gPSAkc2FmZXR5VGltZXINCgkJDQoJCSMgU3RhcnQgdGhlIGFzeW5jIG9wZXJhdGlvbg0KCQlXcml0ZS1WZXJib3NlICdMQVVOQ0g6IFN0YXJ0aW5nIGFzeW5jIG9wZXJhdGlvbicgLUZvcmVncm91bmRDb2xvciBDeWFuDQoJCSRhc3luY1Jlc3VsdCA9ICRsYXVuY2hQUy5CZWdpbkludm9rZSgpDQoJCQ0KCQkjIFZlcmlmeSBhc3luYyBvcGVyYXRpb24NCgkJaWYgKCRudWxsIC1lcSAkYXN5bmNSZXN1bHQpDQoJCXsNCgkJCXRocm93ICdGYWlsZWQgdG8gc3RhcnQgYXN5bmMgb3BlcmF0aW9uJw0KCQl9DQoJCQ0KCQkjIFN0b3JlIHRoZSBhc3luYyByZXN1bHQNCgkJJGdsb2JhbDpMYXVuY2hSZXNvdXJjZXMuQXN5bmNSZXN1bHQgPSAkYXN5bmNSZXN1bHQNCg0KCQkjIFNpbXBsZSBwcm9wZXJ0eSBjaGFuZ2UgaGFuZGxlciB0aGF0IHVwZGF0ZXMgYnV0dG9uIGFwcGVhcmFuY2UNCgkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlN0YXRlLkxhdW5jaEFjdGl2ZSkgew0KCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuTGF1bmNoLkZsYXRTdHlsZSA9ICdQb3B1cCcNCgkJfSBlbHNlIHsNCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkxhdW5jaC5GbGF0U3R5bGUgPSAnRmxhdCcNCgkJfQ0KCQkNCgkJV3JpdGUtVmVyYm9zZSAnTEFVTkNIOiBMYXVuY2ggb3BlcmF0aW9uIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5JyAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQoJfQ0KCWNhdGNoDQoJew0KCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6IEVycm9yIGluIGxhdW5jaCBzZXR1cDogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQ0KCQkjIENhbGwgY2xlYW51cA0KCQlTdG9wLUNsaWVudExhdW5jaA0KCX0NCn0NCg0KZnVuY3Rpb24gU3RvcC1DbGllbnRMYXVuY2gNCnsNCgk8Iw0KCS5TWU5PUFNJUw0KCUNsZWFucyB1cCByZXNvdXJjZXMgdXNlZCBieSB0aGUgbGF1bmNoIG9wZXJhdGlvbi4NCgkNCgkuREVTQ1JJUFRJT04NCglFbnN1cmVzIHByb3BlciBjbGVhbnVwIG9mIGFsbCByZXNvdXJjZXMgdXNlZCBkdXJpbmcgdGhlIGxhdW5jaCBvcGVyYXRpb24uDQoJIz4NCglbQ21kbGV0QmluZGluZygpXQ0KCXBhcmFtKCkNCgkNCglXcml0ZS1WZXJib3NlICdMQVVOQ0g6IENsZWFuaW5nIHVwIGxhdW5jaCByZXNvdXJjZXMnIC1Gb3JlZ3JvdW5kQ29sb3IgQ3lhbg0KCQ0KCXRyeQ0KCXsNCgkJIyBTZXQgbGF1bmNoIGluIHByb2dyZXNzIGZsYWcgdG8gZmFsc2UNCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTGF1bmNoQWN0aXZlID0gJGZhbHNlDQoJCQ0KCQkjIENoZWNrIGlmIHdlIGhhdmUgcmVzb3VyY2VzIHRvIGNsZWFuIHVwDQoJCWlmICgkbnVsbCAtZXEgJGdsb2JhbDpMYXVuY2hSZXNvdXJjZXMpDQoJCXsNCgkJCVdyaXRlLVZlcmJvc2UgJyAgTEFVTkNIOiBObyBsYXVuY2ggcmVzb3VyY2VzIHRvIGNsZWFuIHVwJyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQlyZXR1cm4NCgkJfQ0KCQkNCgkJIyBVbnJlZ2lzdGVyIGV2ZW50IHN1YnNjcmlwdGlvbiBpZiBpdCBleGlzdHMNCgkJaWYgKCRudWxsIC1uZSAkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5FdmVudFN1YnNjcmlwdGlvbklkKQ0KCQl7DQoJCQl0cnkNCgkJCXsNCgkJCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6IFVucmVnaXN0ZXJpbmcgZXZlbnQgc3Vic2NyaXB0aW9uOiAkKCRnbG9iYWw6TGF1bmNoUmVzb3VyY2VzLkV2ZW50U3Vic2NyaXB0aW9uSWQpIiAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJVW5yZWdpc3Rlci1FdmVudCAtU291cmNlSWRlbnRpZmllciAkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5FdmVudFN1YnNjcmlwdGlvbklkIC1Gb3JjZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KCQkJfQ0KCQkJY2F0Y2gNCgkJCXsNCgkJCQlXcml0ZS1WZXJib3NlICJMQVVOQ0g6IEZhaWxlZCB0byB1bnJlZ2lzdGVyIGV2ZW50OiAkXyIgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCX0NCgkJfQ0KCQkNCgkJIyBSZW1vdmUgZXZlbnQgc3Vic2NyaWJlciBpZiBpdCBleGlzdHMNCgkJaWYgKCRudWxsIC1uZSAkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5FdmVudFN1YnNjcmliZXIpDQoJCXsNCgkJCXRyeQ0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogUmVtb3ZpbmcgZXZlbnQgc3Vic2NyaWJlcicgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJCSMgQWx0ZXJuYXRpdmUgYXBwcm9hY2g6IFVzZSBVbnJlZ2lzdGVyLUV2ZW50IHdpdGggdGhlIHN1YnNjcmlwdGlvbiBJRA0KCQkJCWlmICgkbnVsbCAtbmUgJGdsb2JhbDpMYXVuY2hSZXNvdXJjZXMuRXZlbnRTdWJzY3JpcHRpb25JZCkNCgkJCQl7DQoJCQkJCVVucmVnaXN0ZXItRXZlbnQgLVNvdXJjZUlkZW50aWZpZXIgJGdsb2JhbDpMYXVuY2hSZXNvdXJjZXMuRXZlbnRTdWJzY3JpcHRpb25JZCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KCQkJCX0NCgkJCX0NCgkJCWNhdGNoDQoJCQl7DQoJCQkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBGYWlsZWQgdG8gcmVtb3ZlIGV2ZW50IHN1YnNjcmliZXI6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJfQ0KCQl9DQoJCQ0KCQkjIFN0b3AgYW5kIGRpc3Bvc2UgUG93ZXJTaGVsbCBpbnN0YW5jZSBpZiBpdCBleGlzdHMNCgkJaWYgKCRudWxsIC1uZSAkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5Qb3dlclNoZWxsSW5zdGFuY2UpDQoJCXsNCgkJCXRyeQ0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogU3RvcHBpbmcgUG93ZXJTaGVsbCBpbnN0YW5jZScgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJCWlmICgkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5Qb3dlclNoZWxsSW5zdGFuY2UuSW52b2NhdGlvblN0YXRlSW5mby5TdGF0ZSAtZXEgJ1J1bm5pbmcnKQ0KCQkJCXsNCgkJCQkJJGdsb2JhbDpMYXVuY2hSZXNvdXJjZXMuUG93ZXJTaGVsbEluc3RhbmNlLlN0b3AoKQ0KCQkJCX0NCgkJCQkkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5Qb3dlclNoZWxsSW5zdGFuY2UuRGlzcG9zZSgpDQoJCQl9DQoJCQljYXRjaA0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogRmFpbGVkIHRvIHN0b3AgUG93ZXJTaGVsbCBpbnN0YW5jZTogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCQl9DQoJCX0NCgkJDQoJCSMgQ2xvc2UgcnVuc3BhY2UgaWYgaXQgZXhpc3RzDQoJCWlmICgkbnVsbCAtbmUgJGdsb2JhbDpMYXVuY2hSZXNvdXJjZXMuUnVuc3BhY2UpDQoJCXsNCgkJCXRyeQ0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogQ2xvc2luZyBydW5zcGFjZScgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCQkJCSRnbG9iYWw6TGF1bmNoUmVzb3VyY2VzLlJ1bnNwYWNlLkNsb3NlKCkNCgkJCQkkZ2xvYmFsOkxhdW5jaFJlc291cmNlcy5SdW5zcGFjZS5EaXNwb3NlKCkNCgkJCX0NCgkJCWNhdGNoDQoJCQl7DQoJCQkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBGYWlsZWQgdG8gY2xvc2UgcnVuc3BhY2U6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJfQ0KCQl9DQoJCQ0KCQkjIFN0b3AgdGhlIGxhdW5jaCB0aW1lciBpZiBpdCBleGlzdHMNCgkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnMuQ29udGFpbnMoJ2xhdW5jaFRpbWVyJykpDQoJCXsNCgkJCXRyeQ0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogU3RvcHBpbmcgbGF1bmNoIHRpbWVyJyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVyc1snbGF1bmNoVGltZXInXS5TdG9wKCkNCgkJCX0NCgkJCWNhdGNoDQoJCQl7DQoJCQkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBGYWlsZWQgdG8gc3RvcCBsYXVuY2ggdGltZXI6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJfQ0KCQl9DQoJCQ0KCQkjIFN0b3AgdGhlIHNhZmV0eSB0aW1lciBpZiBpdCBleGlzdHMNCgkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnMuQ29udGFpbnMoJ2xhdW5jaFNhZmV0eVRpbWVyJykpDQoJCXsNCgkJCXRyeQ0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogU3RvcHBpbmcgc2FmZXR5IHRpbWVyJyAtRm9yZWdyb3VuZENvbG9yIERhcmtHcmF5DQoJCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVyc1snbGF1bmNoU2FmZXR5VGltZXInXS5TdG9wKCkNCgkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzWydsYXVuY2hTYWZldHlUaW1lciddLkRpc3Bvc2UoKQ0KCQkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnMuUmVtb3ZlKCdsYXVuY2hTYWZldHlUaW1lcicpDQoJCQl9DQoJCQljYXRjaA0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgIkxBVU5DSDogRmFpbGVkIHRvIHN0b3Agc2FmZXR5IHRpbWVyOiAkXyIgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCX0NCgkJfQ0KCQkNCgkJIyBDbGVhciB0aGUgcmVzb3VyY2VzDQoJCSRnbG9iYWw6TGF1bmNoUmVzb3VyY2VzID0gJG51bGwNCgkJDQoJCSMgRm9yY2UgZ2FyYmFnZSBjb2xsZWN0aW9uDQoJCVtTeXN0ZW0uR0NdOjpDb2xsZWN0KCkNCgkJDQoJCVdyaXRlLVZlcmJvc2UgJ0xBVU5DSDogTGF1bmNoIGNsZWFudXAgY29tcGxldGVkJyAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQoJCSMgU2ltcGxlIHByb3BlcnR5IGNoYW5nZSBoYW5kbGVyIHRoYXQgdXBkYXRlcyBidXR0b24gYXBwZWFyYW5jZQ0KCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTGF1bmNoQWN0aXZlIC1lcSAkdHJ1ZSkgew0KCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuTGF1bmNoLkZsYXRTdHlsZSA9ICdQb3B1cCcNCgkJfSBlbHNlIHsNCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkxhdW5jaC5GbGF0U3R5bGUgPSAnRmxhdCcNCgkJfQ0KCX0NCgljYXRjaA0KCXsNCgkJV3JpdGUtVmVyYm9zZSAiTEFVTkNIOiBFcnJvciBkdXJpbmcgbGF1bmNoIGNsZWFudXA6ICRfIiAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkjIEVuc3VyZSB0aGUgZmxhZyBpcyByZXNldCBldmVuIGlmIGNsZWFudXAgZmFpbHMNCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTGF1bmNoQWN0aXZlID0gJGZhbHNlDQoJfQ0KfQ0KDQoNCiNlbmRyZWdpb24gTGF1bmNoIE1hbmFnZW1lbnQgRnVuY3Rpb25zDQoNCiNyZWdpb24gTW9kdWxlIEV4cG9ydHMNCg0KIyBFeHBvcnQgbW9kdWxlIGZ1bmN0aW9ucw0KRXhwb3J0LU1vZHVsZU1lbWJlciAtRnVuY3Rpb24gU3RhcnQtQ2xpZW50TGF1bmNoLCBTdG9wLUNsaWVudExhdW5jaA0KDQojZW5kcmVnaW9uIE1vZHVsZSBFeHBvcnRz
			'
		}
		'login.psm1'    = @{ 
			Priority = 'Optional';  
			Order = 8; 
			Dependencies = @('classes.psm1', 'ui.psm1', 'ini.psm1', 'datagrid.psm1');
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'login.psm1');
			Base64Content = '
PCMgbG9naW4ucHNtMSANCiAgICAuU1lOT1BTSVMNCiAgICAgICAgUHJvdmlkZXMgYSBtdWx0aS1jbGllbnQgYXV0b21hdGlvbiBlbmdpbmUgZm9yIGxvZ2dpbmcgaW50byB0aGUgZ2FtZS4gDQoJCUl0IHVzZXMgY29vcmRpbmF0ZS1iYXNlZCBtb3VzZSBzaW11bGF0aW9uLCBkaXJlY3Qga2V5IHByZXNzZXMsIGFuZCBhY3RpdmUgbG9nIGZpbGUgbW9uaXRvcmluZyB0byBuYXZpZ2F0ZSB0aGUgbG9naW4gc2VxdWVuY2UsIHdpdGggYSBidWlsdC1pbiBzYWZldHktY2FuY2VsbGF0aW9uIGZlYXR1cmUgdHJpZ2dlcmVkIGJ5IHVzZXIgbW91c2UgbW92ZW1lbnQuDQoNCiAgICAuREVTQ1JJUFRJT04NCiAgICAgICAgVGhpcyBtb2R1bGUgaW1wbGVtZW50cyB0aGUgY29yZSAiTG9naW4iIGZ1bmN0aW9uYWxpdHkgb2YgdGhlIGRhc2hib2FyZC4gSXQgaXMgYSBwb3dlcmZ1bCBhdXRvbWF0aW9uIHNjcmlwdCBkZXNpZ25lZCB0byBsb2cgaW4gbXVsdGlwbGUgZ2FtZSBjbGllbnRzIHNlcXVlbnRpYWxseSBiYXNlZCBvbiB1c2VyLWRlZmluZWQgc2V0dGluZ3MuIFRoZSBwcm9jZXNzIGlzIGZ1bGx5IGF1dG9tYXRlZCwgZnJvbSByZXN0b3JpbmcgdGhlIGNsaWVudCB3aW5kb3cgdG8gZW50ZXJpbmcgdGhlIGdhbWUgd29ybGQsIGFuZCBwcm92aWRlcyBkZXRhaWxlZCBwcm9ncmVzcyBmZWVkYmFjayB0byB0aGUgdXNlci4gQSBjcml0aWNhbCBzYWZldHkgZmVhdHVyZSBhbGxvd3MgdGhlIHVzZXIgdG8gaW1tZWRpYXRlbHkgY2FuY2VsIHRoZSBlbnRpcmUgb3BlcmF0aW9uIGF0IGFueSB0aW1lIGJ5IHNpbXBseSBtb3ZpbmcgdGhlaXIgbW91c2UuDQoNCiAgICAgICAgVGhlIG1vZHVsZSdzIGFyY2hpdGVjdHVyZSBhbmQga2V5IGZlYXR1cmVzIGluY2x1ZGU6DQoNCiAgICAgICAgMS4gICoqQXV0b21hdGVkIExvZ2luIFNlcXVlbmNlIChgUHJvY2Vzc1NpbmdsZUNsaWVudGApOioqDQogICAgICAgICAgICAqICAgRm9yIGVhY2ggc2VsZWN0ZWQgY2xpZW50LCB0aGUgbW9kdWxlIGV4ZWN1dGVzIGEgcHJlY2lzZSBzZXF1ZW5jZSBvZiBhY3Rpb25zIHRvIG5hdmlnYXRlIHRoZSBsb2dpbiBzY3JlZW4gYW5kIGNoYXJhY3RlciBzZWxlY3Rpb24uDQogICAgICAgICAgICAqICAgKipDb29yZGluYXRlLUJhc2VkIENsaWNrczoqKiBJdCB1c2VzIHByZS1jb25maWd1cmVkIHNjcmVlbiBjb29yZGluYXRlcyAoc2V0IGJ5IHRoZSB1c2VyIGluIHRoZSBTZXR0aW5ncyBVSSkgdG8gc2ltdWxhdGUgbW91c2UgY2xpY2tzIG9uIHNlcnZlciwgY2hhbm5lbCwgYW5kIGNoYXJhY3RlciBzZWxlY3Rpb24gYnV0dG9ucy4NCiAgICAgICAgICAgICogICAqKlNpbXVsYXRlZCBLZXkgUHJlc3NlczoqKiBJdCBwcm9ncmFtbWF0aWNhbGx5IHNlbmRzICJFbnRlciIga2V5IHByZXNzZXMgdG8gY29uZmlybSBzZWxlY3Rpb25zIGFuZCBlbnRlciB0aGUgZ2FtZS4NCiAgICAgICAgICAgICogICAqKlN0YXRlLURyaXZlbiBMb2dpYzoqKiBJbnN0ZWFkIG9mIHJlbHlpbmcgb24gZml4ZWQgZGVsYXlzLCB0aGUgYXV0b21hdGlvbiBhY3RpdmVseSB3YWl0cyBmb3IgY29uZmlybWF0aW9uIHRoYXQgdGhlIGdhbWUgaGFzIHJlYWNoZWQgdGhlIG5leHQgc3RhZ2UuIEl0IGRvZXMgdGhpcyBieSBtb25pdG9yaW5nIHRoZSBnYW1lJ3Mgb3duIG5ldHdvcmsgbG9nIGZpbGUgZm9yIHNwZWNpZmljIGVudHJpZXMgKGUuZy4sIGBDQUNIRV9BQ0tfSk9JTmApLCBlbnN1cmluZyB0aGUgcHJvY2VzcyBpcyByb2J1c3QgYW5kIHJlbGlhYmxlLg0KDQogICAgICAgIDIuICAqKlNhZmV0eSBhbmQgVXNlciBDb250cm9sIChgTG9naW5TZWxlY3RlZFJvd2ApOioqDQogICAgICAgICAgICAqICAgQmVmb3JlIHN0YXJ0aW5nLCB0aGUgc2NyaXB0IGluc3RhbGxzIGEgc3lzdGVtLXdpZGUgbW91c2UgaG9vay4gSWYgYW55IG1vdXNlIG1vdmVtZW50IGlzIGRldGVjdGVkIHRoYXQgd2FzIG5vdCBpbml0aWF0ZWQgYnkgdGhlIHNjcmlwdCBpdHNlbGYsIGEgY2FuY2VsbGF0aW9uIGZsYWcgaXMgdHJpZ2dlcmVkLg0KICAgICAgICAgICAgKiAgIFRoZSBlbnRpcmUgYXV0b21hdGlvbiBzZXF1ZW5jZSBpcyBpbnRlcnNwZXJzZWQgd2l0aCBjaGVja3MgZm9yIHRoaXMgZmxhZy4gSWYgZGV0ZWN0ZWQsIHRoZSBwcm9jZXNzIHRocm93cyBhbiBleGNlcHRpb24gYW5kIGhhbHRzIGltbWVkaWF0ZWx5LCBydW5uaW5nIGEgYGZpbmFsbHlgIGJsb2NrIHRvIGd1YXJhbnRlZSBhbGwgcmVzb3VyY2VzIChsaWtlIHRoZSBtb3VzZSBob29rKSBhcmUgY2xlYW5lZCB1cC4gVGhpcyBnaXZlcyB0aGUgdXNlciBpbnN0YW50IGFuZCByZWxpYWJsZSBjb250cm9sIHRvIGFib3J0IHRoZSBwcm9jZXNzLg0KDQogICAgICAgIDMuICAqKlByb2dyZXNzIGFuZCBVSSBGZWVkYmFjazoqKg0KICAgICAgICAgICAgKiAgIFRocm91Z2hvdXQgdGhlIG11bHRpLXN0ZXAgbG9naW4gcHJvY2VzcyBmb3IgZWFjaCBjbGllbnQsIHRoZSBtb2R1bGUgY29udGludW91c2x5IHVwZGF0ZXMgYSBwcm9ncmVzcyBiYXIgYW5kIHN0YXR1cyB0ZXh0IG9uIHRoZSBtYWluIGRhc2hib2FyZCBVSS4gVGhpcyBnaXZlcyB0aGUgdXNlciBjbGVhciwgcmVhbC10aW1lIGZlZWRiYWNrIG9uIHdoYXQgc3RhZ2UgdGhlIGF1dG9tYXRpb24gaXMgaW4gKGUuZy4sICJXYWl0aW5nIGZvciBXb3JsZCBMb2FkLi4uIikuDQoNCiAgICAgICAgNC4gICoqV2luZG93IE1hbmFnZW1lbnQgYW5kIE9wdGltaXphdGlvbjoqKg0KICAgICAgICAgICAgKiAgIFRoZSBtb2R1bGUgYXV0b21hdGljYWxseSByZXN0b3JlcyBhbmQgYnJpbmdzIHRoZSB0YXJnZXQgY2xpZW50IHdpbmRvdyB0byB0aGUgZm9yZWdyb3VuZCBiZWZvcmUgaW50ZXJhY3Rpbmcgd2l0aCBpdC4NCiAgICAgICAgICAgICogICBBZnRlciBhIHN1Y2Nlc3NmdWwgbG9naW4sIGl0IG1pbmltaXplcyB0aGUgY2xpZW50IHdpbmRvdyBhbmQgY2FsbHMgdGhlIGBFbXB0eVdvcmtpbmdTZXRgIEFQSSB0byByZWR1Y2UgaXRzIG1lbW9yeSBmb290cHJpbnQsIHdoaWNoIGlzIGVzc2VudGlhbCBmb3IgcnVubmluZyBtdWx0aXBsZSBjbGllbnRzLg0KIz4NCg0KI3JlZ2lvbiBDb25maWd1cmF0aW9uDQpjbGFzcyBDYW5jZWxsYXRpb25TdGF0ZSB7DQogICAgW2Jvb2xdJElzQ2FuY2VsbGVkID0gJGZhbHNlDQogICAgW3ZvaWRdQ2FuY2VsKCkgew0KICAgICAgICBpZiAoLW5vdCAkdGhpcy5Jc0NhbmNlbGxlZCkgew0KICAgICAgICAgICAgJHRoaXMuSXNDYW5jZWxsZWQgPSAkdHJ1ZQ0KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTE9HSU46IENhbmNlbGxhdGlvbiByZXF1ZXN0ZWQgYnkgdXNlciBtb3VzZSBtb3ZlbWVudC4iIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQogICAgICAgIH0NCiAgICB9DQogICAgW3ZvaWRdUmVzZXQoKSB7ICR0aGlzLklzQ2FuY2VsbGVkID0gJGZhbHNlIH0NCn0NCg0KJGdsb2JhbDpMb2dpbkNhbmNlbCA9IFtDYW5jZWxsYXRpb25TdGF0ZV06Om5ldygpDQoNCiRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UID0gMTMgDQoNCiMgRmxhZyB0byBpbmRpY2F0ZSBpZiBtb3VzZSBtb3ZlbWVudCBpcyBzY3JpcHQtaW5pdGlhdGVkLg0KJHNjcmlwdDpTY3JpcHRJbml0aWF0ZWRNb3ZlID0gJGZhbHNlDQoNCiNlbmRyZWdpb24gQ29uZmlndXJhdGlvbg0KDQojcmVnaW9uIEhlbHBlciBGdW5jdGlvbnMNCg0KZnVuY3Rpb24gTG9jay1Nb3VzZVBvc2l0aW9uIHsNCiAgICBwYXJhbShbaW50XSRYLCBbaW50XSRZKQ0KICAgICRyZWN0ID0gTmV3LU9iamVjdCBDdXN0b20uTmF0aXZlK1JFQ1QNCiAgICAkcmVjdC5MZWZ0ID0gJFg7ICRyZWN0LlRvcCA9ICRZOyAkcmVjdC5SaWdodCA9ICRYICsgMTsgJHJlY3QuQm90dG9tID0gJFkgKyAxDQogICAgaWYgKFtDdXN0b20uTmF0aXZlXS5HZXRNZXRob2QoIkNsaXBDdXJzb3IiLCBbdHlwZVtdXUAoW0N1c3RvbS5OYXRpdmUrUkVDVF0uTWFrZUJ5UmVmVHlwZSgpKSkpIHsNCiAgICAgICAgW0N1c3RvbS5OYXRpdmVdOjpDbGlwQ3Vyc29yKFtyZWZdJHJlY3QpDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBVbmxvY2stTW91c2VQb3NpdGlvbiB7DQogICAgaWYgKFtDdXN0b20uTmF0aXZlXS5HZXRNZXRob2QoIkNsaXBDdXJzb3IiLCBbdHlwZVtdXUAoW0ludFB0cl0pKSkgew0KICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06OkNsaXBDdXJzb3IoW0ludFB0cl06Olplcm8pDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBVcGRhdGUtUHJvZ3Jlc3Mgew0KICAgIHBhcmFtKA0KICAgICAgICBbc3RyaW5nXSRUZXh0LA0KICAgICAgICBbaW50XSRWYWx1ZSA9IC0xLCANCiAgICAgICAgW2ludF0kQ3VycmVudFN0ZXAgPSAtMSwgDQogICAgICAgIFtpbnRdJFRvdGFsU3RlcHMgPSAtMSANCiAgICApDQogICAgJHBiID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuR2xvYmFsUHJvZ3Jlc3NCYXINCiAgICBpZiAoJHBiKSB7DQogICAgICAgICRwYi5DdXN0b21UZXh0ID0gJFRleHQNCiAgICAgICAgaWYgKCRDdXJyZW50U3RlcCAtbmUgLTEgLWFuZCAkVG90YWxTdGVwcyAtZ3QgMCkgew0KICAgICAgICAgICAgJHBlcmNlbnQgPSBbaW50XSgoJEN1cnJlbnRTdGVwIC8gJFRvdGFsU3RlcHMpICogMTAwKQ0KICAgICAgICAgICAgaWYgKCRwZXJjZW50IC1nZSAwIC1hbmQgJHBlcmNlbnQgLWxlIDEwMCkgew0KICAgICAgICAgICAgICAgICRwYi5WYWx1ZSA9ICRwZXJjZW50DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZWlmICgkVmFsdWUgLW5lIC0xKSB7DQogICAgICAgICAgICAkcGIuVmFsdWUgPSAkVmFsdWUNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRwYi5WYWx1ZSA9IDANCiAgICAgICAgfQ0KICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuQXBwbGljYXRpb25dOjpEb0V2ZW50cygpDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBSZXN0b3JlLVdpbmRvdyB7DQogICAgcGFyYW0oW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzXSRQcm9jZXNzKQ0KICAgIENoZWNrQ2FuY2VsDQogICAgaWYgKCRQcm9jZXNzIC1hbmQgJFByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSAtbmUgW0ludFB0cl06Olplcm8pIHsNCiAgICAgICAgaWYgKFtDdXN0b20uTmF0aXZlXTo6SXNXaW5kb3dNaW5pbWl6ZWQoJFByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSkpIHsNCiAgICAgICAgICAgIFtDdXN0b20uTmF0aXZlXTo6QnJpbmdUb0Zyb250KCRQcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUpDQogICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDI1MA0KICAgICAgICB9DQogICAgfQ0KICAgIENoZWNrQ2FuY2VsDQp9DQoNCmZ1bmN0aW9uIENoZWNrQ2FuY2VsIHsNCiAgICBpZiAoJGdsb2JhbDpMb2dpbkNhbmNlbC5Jc0NhbmNlbGxlZCkgew0KICAgICAgICB0aHJvdyAiTG9naW4gY2FuY2VsbGVkIGJ5IHVzZXIgbW91c2UgbW92ZW1lbnQuIg0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBTZXQtV2luZG93Rm9yZWdyb3VuZCB7DQogICAgcGFyYW0oW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzXSRQcm9jZXNzKQ0KICAgIA0KICAgICMgQ2hlY2sgYmVmb3JlIGFjdGlvbg0KICAgIENoZWNrQ2FuY2VsDQoNCiAgICBpZiAoLW5vdCAkUHJvY2VzcyAtb3IgJFByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSAtZXEgW0ludFB0cl06Olplcm8pIHsgcmV0dXJuICRmYWxzZSB9DQogICAgDQogICAgJHNjcmlwdDpTY3JpcHRJbml0aWF0ZWRNb3ZlID0gJHRydWUNCiAgICB0cnkgew0KICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06OkJyaW5nVG9Gcm9udCgkUHJvY2Vzcy5NYWluV2luZG93SGFuZGxlKQ0KICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDEwMA0KICAgIH0gZmluYWxseSB7DQogICAgICAgICRzY3JpcHQ6U2NyaXB0SW5pdGlhdGVkTW92ZSA9ICRmYWxzZQ0KICAgICAgICAjIENoZWNrIGFmdGVyIGFjdGlvbiAoQnVmZmVyZWQgaW50ZXJ2ZW50aW9uKQ0KICAgICAgICBDaGVja0NhbmNlbA0KICAgIH0NCiAgICByZXR1cm4gJHRydWUNCn0NCg0KZnVuY3Rpb24gUGFyc2VDb29yZGluYXRlcyB7DQogICAgcGFyYW0oW3N0cmluZ10kQ29uZmlnU3RyaW5nKQ0KICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRDb25maWdTdHJpbmcpIC1vciAkQ29uZmlnU3RyaW5nIC1ub3RtYXRjaCAnLCcpIHsgcmV0dXJuICRudWxsIH0NCiAgICAkcGFydHMgPSAkQ29uZmlnU3RyaW5nLlNwbGl0KCcsJykNCiAgICBpZiAoJHBhcnRzLkNvdW50IC1lcSAyKSB7IHJldHVybiBAeyBYID0gW2ludF0kcGFydHNbMF0uVHJpbSgpOyBZID0gW2ludF0kcGFydHNbMV0uVHJpbSgpIH0gfQ0KICAgIHJldHVybiAkbnVsbA0KfQ0KDQpmdW5jdGlvbiBJbnZva2UtTW91c2VDbGljayB7DQogICAgcGFyYW0oW2ludF0kWCwgW2ludF0kWSkNCiAgICANCiAgICAjIENoZWNrIGJlZm9yZSBzdGFydGluZw0KICAgIENoZWNrQ2FuY2VsDQoNCiAgICAkc2NyaXB0OlNjcmlwdEluaXRpYXRlZE1vdmUgPSAkdHJ1ZQ0KICAgIA0KICAgIHRyeSB7DQogICAgICAgIFtDdXN0b20uTmF0aXZlXTo6U2V0Q3Vyc29yUG9zKCRYLCAkWSkNCiAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyAyMA0KICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06OlNldEN1cnNvclBvcygkWCwgJFkpDQogICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMzANCiAgICAgICAgDQogICAgICAgICRNT1VTRUVWRU5URl9MRUZURE9XTiA9IDB4MDAwMg0KICAgICAgICAkTU9VU0VFVkVOVEZfTEVGVFVQID0gMHgwMDA0DQogICAgICAgIA0KICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06Om1vdXNlX2V2ZW50KCRNT1VTRUVWRU5URl9MRUZURE9XTiwgMCwgMCwgMCwgMCkNCiAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyA1MA0KICAgICAgICBbQ3VzdG9tLk5hdGl2ZV06Om1vdXNlX2V2ZW50KCRNT1VTRUVWRU5URl9MRUZUVVAsIDAsIDAsIDAsIDApDQogICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgNTANCiAgICB9IGNhdGNoIHsNCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiTE9HSU46IE1vdXNlIGNsaWNrIGZhaWxlZDogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgfSBmaW5hbGx5IHsNCiAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyA1MA0KICAgICAgICAkc2NyaXB0OlNjcmlwdEluaXRpYXRlZE1vdmUgPSAkZmFsc2UNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgYWZ0ZXIgZmluaXNoaW5nIChCdWZmZXJlZCBpbnRlcnZlbnRpb24pDQogICAgICAgICMgSWYgdXNlciBtb3ZlZCBtb3VzZSAqZHVyaW5nKiB0aGUgc2xlZXBzIGFib3ZlLCB0aGlzIHRocm93cyBub3cuDQogICAgICAgIENoZWNrQ2FuY2VsDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBJbnZva2UtS2V5UHJlc3Mgew0KICAgIHBhcmFtKFtpbnRdJFZpcnR1YWxLZXlDb2RlKQ0KICAgIA0KICAgIENoZWNrQ2FuY2VsDQogICAgDQogICAgIyBLZXlQcmVzcyBkb2Vzbid0IG1vdmUgbW91c2UsIGJ1dCB3ZSBtYXJrIEluaXRpYXRlZE1vdmUgdHJ1ZSANCiAgICAjIHRvIHByZXZlbnQgcmFjZSBjb25kaXRpb25zIGluIHBhcmFsbGVsIGNoZWNrcyBpZiB0aGV5IGV4aXN0ZWQgKHNhZmVndWFyZCkNCiAgICAkc2NyaXB0OlNjcmlwdEluaXRpYXRlZE1vdmUgPSAkdHJ1ZSANCiAgICB0cnkgew0KICAgICAgICAkaFduZCA9IFtDdXN0b20uTmF0aXZlXTo6R2V0Rm9yZWdyb3VuZFdpbmRvdygpDQogICAgICAgIFtDdXN0b20uRnRvb2xdOjpmblBvc3RNZXNzYWdlKCRoV25kLCAweDAxMDAsICRWaXJ0dWFsS2V5Q29kZSwgMCkgIyBXTV9LRVlET1dODQogICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgNTANCiAgICAgICAgW0N1c3RvbS5GdG9vbF06OmZuUG9zdE1lc3NhZ2UoJGhXbmQsIDB4MDEwMSwgJFZpcnR1YWxLZXlDb2RlLCAwKSAjIFdNX0tFWVVQDQogICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMTAwDQogICAgfSBmaW5hbGx5IHsNCiAgICAgICAgJHNjcmlwdDpTY3JpcHRJbml0aWF0ZWRNb3ZlID0gJGZhbHNlDQogICAgICAgIENoZWNrQ2FuY2VsDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBXcml0ZS1Mb2dXaXRoUmV0cnkgew0KICAgIHBhcmFtKFtzdHJpbmddJEZpbGVQYXRoLCBbc3RyaW5nXSRWYWx1ZSkNCiAgICBmb3IgKCRpPTA7ICRpIC1sdCA1OyAkaSsrKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBTZXQtQ29udGVudCAtUGF0aCAkRmlsZVBhdGggLVZhbHVlICRWYWx1ZSAtRm9yY2UgLUVycm9yQWN0aW9uIFN0b3ANCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICB9IGNhdGNoIHsgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyA1MCB9DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBXYWl0LUZvckZpbGVBY2Nlc3Mgew0KICAgIHBhcmFtKFtzdHJpbmddJEZpbGVQYXRoKQ0KICAgIHJldHVybiAoVGVzdC1QYXRoICRGaWxlUGF0aCkNCn0NCg0KZnVuY3Rpb24gV2FpdC1VbnRpbENsaWVudE5vcm1hbFN0YXRlIHsNCiAgICBwYXJhbSgNCiAgICAgICAgJFJvdywNCiAgICAgICAgW2ludF0kY3VycmVudEdsb2JhbFN0ZXAsIA0KICAgICAgICBbaW50XSR0b3RhbEdsb2JhbFN0ZXBzDQogICAgKQ0KICAgIGlmICgtbm90ICRSb3cpIHsgcmV0dXJuIH0NCg0KICAgICRzdyA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuU3RvcHdhdGNoXTo6U3RhcnROZXcoKQ0KICAgIA0KICAgIHdoaWxlICgkdHJ1ZSkgew0KICAgICAgICAjIENvbnRpbnVvdXMgQ2hlY2sNCiAgICAgICAgQ2hlY2tDYW5jZWwNCg0KICAgICAgICAkc3RhdGUgPSAkUm93LkNlbGxzWzNdLlZhbHVlIA0KICAgICAgICBpZiAoJHN0YXRlIC1lcSAnTm9ybWFsJykgew0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmICgkc3cuRWxhcHNlZC5NaWxsaXNlY29uZHMgJSAyMDAwIC1sdCAxMDApIHsNCiAgICAgICAgICAgIFVwZGF0ZS1Qcm9ncmVzcyAtVGV4dCAiV2FpdGluZyBmb3IgQ2xpZW50IE5vcm1hbCBTdGF0ZS4uLiIgLUN1cnJlbnRTdGVwICRjdXJyZW50R2xvYmFsU3RlcCAtVG90YWxTdGVwcyAkdG90YWxHbG9iYWxTdGVwcw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuQXBwbGljYXRpb25dOjpEb0V2ZW50cygpDQogICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMjUwDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBXYWl0LUZvckxvZ0VudHJ5IHsNCiAgICBwYXJhbSgNCiAgICAgICAgW3N0cmluZ10kTG9nUGF0aCwNCiAgICAgICAgW3N0cmluZ1tdXSRTZWFyY2hTdHJpbmdzLA0KICAgICAgICBbaW50XSRUaW1lb3V0U2Vjb25kcyA9IDYwLA0KICAgICAgICBbaW50XSRjdXJyZW50R2xvYmFsU3RlcCwNCiAgICAgICAgW2ludF0kdG90YWxHbG9iYWxTdGVwcyANCiAgICApDQoNCiAgICAkc3cgPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkNCiAgICBVcGRhdGUtUHJvZ3Jlc3MgLVRleHQgIldhdGNoaW5nIGxvZyBmb3I6ICQoJFNlYXJjaFN0cmluZ3MgLWpvaW4gJywgJykuLi4iIC1DdXJyZW50U3RlcCAkY3VycmVudEdsb2JhbFN0ZXAgLVRvdGFsU3RlcHMgJHRvdGFsR2xvYmFsU3RlcHMNCg0KICAgIHdoaWxlICgkc3cuRWxhcHNlZC5Ub3RhbFNlY29uZHMgLWx0ICRUaW1lb3V0U2Vjb25kcykgew0KICAgICAgICAjIENvbnRpbnVvdXMgQ2hlY2sNCiAgICAgICAgQ2hlY2tDYW5jZWwNCiAgICAgICAgDQogICAgICAgIGlmIChUZXN0LVBhdGggJExvZ1BhdGgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgJGxpbmVzID0gR2V0LUNvbnRlbnQgJExvZ1BhdGggLVRhaWwgMjAgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3RyIGluICRTZWFyY2hTdHJpbmdzKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkbGluZXMgLW1hdGNoIFtyZWdleF06OkVzY2FwZSgkc3RyKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTG9nIE1hdGNoIEZvdW5kOiAkc3RyIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRydWUNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2gge30NCiAgICAgICAgfQ0KICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDI1MA0KICAgIH0NCiAgICByZXR1cm4gJGZhbHNlDQp9DQoNCmZ1bmN0aW9uIFdhaXQtVW50aWxXb3JsZExvYWRlZCB7DQogICAgcGFyYW0oDQogICAgICAgICRMb2dQYXRoLA0KICAgICAgICBbaW50XSRjdXJyZW50R2xvYmFsU3RlcCwgDQogICAgICAgIFtpbnRdJHRvdGFsR2xvYmFsU3RlcHMNCiAgICApDQogICAgDQogICAgJHRocmVzaG9sZCA9IDMNCiAgICAkc2VhcmNoU3RyID0gIjEzIC0gQ0FDSEVfQUNLX0pPSU4iDQogICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW5Db25maWcnXSkgew0KICAgICAgICAkY2ZnID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydMb2dpbkNvbmZpZyddDQogICAgICAgIGlmICgkY2ZnWydXb3JsZExvYWRMb2dUaHJlc2hvbGQnXSkgeyAkdGhyZXNob2xkID0gW2ludF0kY2ZnWydXb3JsZExvYWRMb2dUaHJlc2hvbGQnXSB9DQogICAgICAgIGlmICgkY2ZnWydXb3JsZExvYWRMb2dFbnRyeSddKSB7ICRzZWFyY2hTdHIgPSAkY2ZnWydXb3JsZExvYWRMb2dFbnRyeSddIH0NCiAgICB9DQogICAgDQogICAgJGZvdW5kQ291bnQgPSAwDQogICAgJHRpbWVvdXQgPSBOZXctVGltZVNwYW4gLU1pbnV0ZXMgMg0KICAgICRzdyA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuU3RvcHdhdGNoXTo6U3RhcnROZXcoKQ0KICAgIA0KICAgIFVwZGF0ZS1Qcm9ncmVzcyAtVGV4dCAiV2FpdGluZyBmb3IgV29ybGQgTG9hZC4uLiIgLUN1cnJlbnRTdGVwICRjdXJyZW50R2xvYmFsU3RlcCAtVG90YWxTdGVwcyAkdG90YWxHbG9iYWxTdGVwcw0KDQogICAgd2hpbGUgKCRmb3VuZENvdW50IC1sdCAkdGhyZXNob2xkKSB7DQogICAgICAgIGlmICgkc3cuRWxhcHNlZCAtZ3QgJHRpbWVvdXQpIHsgdGhyb3cgIldvcmxkIGxvYWQgdGltZW91dCIgfQ0KICAgICAgICANCiAgICAgICAgIyBDb250aW51b3VzIENoZWNrDQogICAgICAgIENoZWNrQ2FuY2VsDQoNCiAgICAgICAgaWYgKFRlc3QtUGF0aCAkTG9nUGF0aCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAkbGluZXMgPSBHZXQtQ29udGVudCAkTG9nUGF0aCAtVGFpbCA1MCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQ0KICAgICAgICAgICAgICAgIGlmICgkbGluZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgJGZvdW5kQ291bnQgPSAoJGxpbmVzIHwgU2VsZWN0LVN0cmluZyAtU2ltcGxlTWF0Y2ggJHNlYXJjaFN0cikuQ291bnQNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIHt9DQogICAgICAgIH0NCiAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gUHJvY2Vzc1NpbmdsZUNsaWVudCB7DQogICAgcGFyYW0oDQogICAgICAgICRSb3csDQogICAgICAgICRMb2dGaWxlUGF0aCwNCiAgICAgICAgJExvZ2luQ29uZmlnLA0KICAgICAgICBbaW50XSRjbGllbnRJbmRleCwNCiAgICAgICAgW2ludF0kdG90YWxDbGllbnRzDQogICAgKQ0KICAgICMgSW5pdGlhbCBDaGVjaw0KICAgIENoZWNrQ2FuY2VsDQogICAgJGNsaWVudFN0ZXBDb3VudGVyID0gMA0KICAgICRwcm9jZXNzID0gJFJvdy5UYWcNCiAgICBpZiAoLW5vdCAkcHJvY2VzcykgeyB0aHJvdyAiTm8gcHJvY2VzcyBhdHRhY2hlZCB0byByb3ciIH0NCiAgICAkZW50cnlOdW1iZXIgPSAkUm93LkNlbGxzWzBdLlZhbHVlDQogICAgJGNsaWVudFN0ZXBDb3VudGVyKys7IFVwZGF0ZS1Qcm9ncmVzcyAtVGV4dCAiU3RhcnRpbmcgbG9naW4gZm9yIENsaWVudCAkZW50cnlOdW1iZXIiIC1DdXJyZW50U3RlcCAoKCRjbGllbnRJbmRleCAtIDEpICogJFRPVEFMX1NURVBTX1BFUl9DTElFTlQgKyAkY2xpZW50U3RlcENvdW50ZXIpIC1Ub3RhbFN0ZXBzICgkdG90YWxDbGllbnRzICogJFRPVEFMX1NURVBTX1BFUl9DTElFTlQpDQogICAgIyAtLS0gUkVBRCBDT05GSUdVUkFUSU9OIC0tLQ0KICAgICRzZXJ2ZXJJRCA9ICIxIjsgJGNoYW5uZWxJRCA9ICIxIjsgJGNoYXJTbG90ID0gIjEiOyAkc3RhcnRDb2xsZWN0b3IgPSAiTm8iDQogICAgJHNldHRpbmdLZXkgPSAiQ2xpZW50JHtlbnRyeU51bWJlcn1fU2V0dGluZ3MiDQogICAgaWYgKCRMb2dpbkNvbmZpZ1skc2V0dGluZ0tleV0pIHsNCiAgICAgICAgJHBhcnRzID0gJExvZ2luQ29uZmlnWyRzZXR0aW5nS2V5XSAtc3BsaXQgJywnDQogICAgICAgIGlmICgkcGFydHMuQ291bnQgLWVxIDQpIHsNCiAgICAgICAgICAgICRzZXJ2ZXJJRCA9ICRwYXJ0c1swXQ0KICAgICAgICAgICAgJGNoYW5uZWxJRCA9ICRwYXJ0c1sxXQ0KICAgICAgICAgICAgJGNoYXJTbG90ID0gJHBhcnRzWzJdDQogICAgICAgICAgICAkc3RhcnRDb2xsZWN0b3IgPSAkcGFydHNbM10NCiAgICAgICAgfQ0KICAgIH0NCiAgICAjIDEuIENsZWFyIExvZ3MgJiBSZXN0b3JlDQogICAgV3JpdGUtTG9nV2l0aFJldHJ5IC1GaWxlUGF0aCAkTG9nRmlsZVBhdGggLVZhbHVlICIiDQogICAgUmVzdG9yZS1XaW5kb3cgLVByb2Nlc3MgJHByb2Nlc3MNCiAgICBDaGVja0NhbmNlbA0KICAgICMgMi4gV2FpdCBmb3IgUmVzcG9uc2l2ZSBXaW5kb3cNCiAgICAkY2xpZW50U3RlcENvdW50ZXIrKzsgDQogICAgJGNnc3dhaXQgPSAoKCRjbGllbnRJbmRleCAtIDEpICogJFRPVEFMX1NURVBTX1BFUl9DTElFTlQgKyAkY2xpZW50U3RlcENvdW50ZXIpDQogICAgJHRnc3dhaXQgPSAoJHRvdGFsQ2xpZW50cyAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UKQ0KICAgIFVwZGF0ZS1Qcm9ncmVzcyAtVGV4dCAiV2FpdGluZyBmb3IgUmVzcG9uc2l2ZSBXaW5kb3cuLi4iIC1DdXJyZW50U3RlcCAkY2dzd2FpdCAtVG90YWxTdGVwcyAkdGdzd2FpdA0KICAgIFdhaXQtVW50aWxDbGllbnROb3JtYWxTdGF0ZSAtUm93ICRSb3cgLWN1cnJlbnRHbG9iYWxTdGVwICRjZ3N3YWl0IC10b3RhbEdsb2JhbFN0ZXBzICR0Z3N3YWl0DQogICAgU2V0LVdpbmRvd0ZvcmVncm91bmQgLVByb2Nlc3MgJHByb2Nlc3MgfCBPdXQtTnVsbA0KICAgICMgTm90ZTogU2V0LVdpbmRvd0ZvcmVncm91bmQgZG9lcyBpbnRlcm5hbCBpbnRlcnZlbnRpb24gY2hlY2tzDQogICAgJHJlY3QgPSBOZXctT2JqZWN0IEN1c3RvbS5OYXRpdmUrUkVDVA0KICAgIFtDdXN0b20uTmF0aXZlXTo6R2V0V2luZG93UmVjdCgkcHJvY2Vzcy5NYWluV2luZG93SGFuZGxlLCBbcmVmXSRyZWN0KQ0KICAgICMgLS0tIFNURVAgMTogSU5JVElBTCBDTElDSyAtLS0NCiAgICAkY2xpZW50U3RlcENvdW50ZXIrKzsgVXBkYXRlLVByb2dyZXNzIC1UZXh0ICJTZWxlY3RpbmcgQ2xpZW50IEluZGV4Li4uIiAtQ3VycmVudFN0ZXAgKCgkY2xpZW50SW5kZXggLSAxKSAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UICsgJGNsaWVudFN0ZXBDb3VudGVyKSAtVG90YWxTdGVwcyAoJHRvdGFsQ2xpZW50cyAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UKQ0KICAgICRjZW50ZXJYID0gW2ludF0oKCRyZWN0LkxlZnQgKyAkcmVjdC5SaWdodCkgLyAyKSArIDI1DQogICAgJGNlbnRlclkgPSBbaW50XSgoJHJlY3QuVG9wICsgJHJlY3QuQm90dG9tKSAvIDIpICsgMTgNCiAgICAkYWRqdXN0ZWRZID0gJGNlbnRlclkNCiAgICBpZiAoJGVudHJ5TnVtYmVyIC1nZSA2IC1hbmQgJGVudHJ5TnVtYmVyIC1sZSAxMCkgew0KICAgICAgICAkeU9mZnNldCA9ICgkZW50cnlOdW1iZXIgLSA4KSAqIDE4DQogICAgICAgICRhZGp1c3RlZFkgPSAkY2VudGVyWSArICR5T2Zmc2V0DQogICAgICAgICRzY3JvbGxDZW50ZXJYID0gJGNlbnRlclggKyAxNDUNCiAgICAgICAgJHNjcm9sbENlbnRlclkgPSAkY2VudGVyWSArIDI4DQogICAgICAgIEludm9rZS1Nb3VzZUNsaWNrIC1YICRzY3JvbGxDZW50ZXJYIC1ZICRzY3JvbGxDZW50ZXJZDQogICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMjAwDQogICAgfSBlbHNlaWYgKCRlbnRyeU51bWJlciAtZ2UgMSAtYW5kICRlbnRyeU51bWJlciAtbGUgNSkgew0KICAgICAgICAkeU9mZnNldCA9ICgkZW50cnlOdW1iZXIgLSAzKSAqIDE4DQogICAgICAgICRhZGp1c3RlZFkgPSAkY2VudGVyWSArICR5T2Zmc2V0DQogICAgfQ0KICAgIEludm9rZS1Nb3VzZUNsaWNrIC1YICRjZW50ZXJYIC1ZICRhZGp1c3RlZFkNCiAgICBJbnZva2UtTW91c2VDbGljayAtWCAkY2VudGVyWCAtWSAkYWRqdXN0ZWRZDQogICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyAyMDANCiAgICBDaGVja0NhbmNlbA0KICAgICMgLS0tIFNURVAgMjogU0VSVkVSIFNFTEVDVElPTiAtLS0NCiAgICAkY29vcmRLZXkgPSAiU2VydmVyJHtzZXJ2ZXJJRH1Db29yZHMiDQogICAgaWYgKCRMb2dpbkNvbmZpZ1skY29vcmRLZXldKSB7DQogICAgICAgICRjb29yZHMgPSBQYXJzZUNvb3JkaW5hdGVzICRMb2dpbkNvbmZpZ1skY29vcmRLZXldDQogICAgICAgIGlmICgkY29vcmRzKSB7DQogICAgICAgICAgICAkY2xpZW50U3RlcENvdW50ZXIrKzsgVXBkYXRlLVByb2dyZXNzIC1UZXh0ICJDbGlja2luZyBTZXJ2ZXIgJHNlcnZlcklELi4uIiAtQ3VycmVudFN0ZXAgKCgkY2xpZW50SW5kZXggLSAxKSAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UICsgJGNsaWVudFN0ZXBDb3VudGVyKSAtVG90YWxTdGVwcyAoJHRvdGFsQ2xpZW50cyAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UKQ0KICAgICAgICAgICAgSW52b2tlLU1vdXNlQ2xpY2sgLVggKCRyZWN0LkxlZnQgKyAkY29vcmRzLlgpIC1ZICgkcmVjdC5Ub3AgKyAkY29vcmRzLlkpDQogICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDUwDQogICAgICAgIH0NCiAgICB9DQogICAgQ2hlY2tDYW5jZWwNCiAgICAjIC0tLSBTVEVQIDM6IENIQU5ORUwgU0VMRUNUSU9OIC0tLQ0KICAgICRjb29yZEtleSA9ICJDaGFubmVsJHtjaGFubmVsSUR9Q29vcmRzIg0KICAgIGlmICgkTG9naW5Db25maWdbJGNvb3JkS2V5XSkgew0KICAgICAgICAkY29vcmRzID0gUGFyc2VDb29yZGluYXRlcyAkTG9naW5Db25maWdbJGNvb3JkS2V5XQ0KICAgICAgICBpZiAoJGNvb3Jkcykgew0KICAgICAgICAgICAgJGNsaWVudFN0ZXBDb3VudGVyKys7IFVwZGF0ZS1Qcm9ncmVzcyAtVGV4dCAiQ2xpY2tpbmcgQ2hhbm5lbCAkY2hhbm5lbElELi4uIiAtQ3VycmVudFN0ZXAgKCgkY2xpZW50SW5kZXggLSAxKSAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UICsgJGNsaWVudFN0ZXBDb3VudGVyKSAtVG90YWxTdGVwcyAoJHRvdGFsQ2xpZW50cyAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UKQ0KICAgICAgICAgICAgSW52b2tlLU1vdXNlQ2xpY2sgLVggKCRyZWN0LkxlZnQgKyAkY29vcmRzLlgpIC1ZICgkcmVjdC5Ub3AgKyAkY29vcmRzLlkpDQogICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDUwDQogICAgICAgIH0NCiAgICB9DQogICAgQ2hlY2tDYW5jZWwNCiAgICAjIC0tLSBTVEVQIDQ6IENFUlQgTE9HSU4gLS0tDQogICAgSW52b2tlLUtleVByZXNzIC1WaXJ0dWFsS2V5Q29kZSAweDBEIA0KICAgICRjbGllbnRTdGVwQ291bnRlcisrOyANCiAgICAkY2dzY2VydCA9ICgoJGNsaWVudEluZGV4IC0gMSkgKiAkVE9UQUxfU1RFUFNfUEVSX0NMSUVOVCArICRjbGllbnRTdGVwQ291bnRlcikNCiAgICAkdGdzY2VydCA9ICgkdG90YWxDbGllbnRzICogJFRPVEFMX1NURVBTX1BFUl9DTElFTlQpDQogICAgVXBkYXRlLVByb2dyZXNzIC1UZXh0ICJXYWl0aW5nIGZvciBDZXJ0IExvZ2luLi4uIiAtQ3VycmVudFN0ZXAgJGNnc2NlcnQgLVRvdGFsU3RlcHMgJHRnc2NlcnQNCiAgICAkbG9naW5SZWFkeSA9IFdhaXQtRm9yTG9nRW50cnkgLUxvZ1BhdGggJExvZ0ZpbGVQYXRoIC1TZWFyY2hTdHJpbmdzIEAoIjYgLSBMT0dJTl9QTEFZRVJfTElTVCIpIC1UaW1lb3V0U2Vjb25kcyAyNSAtY3VycmVudEdsb2JhbFN0ZXAgJGNnc2NlcnQgLXRvdGFsR2xvYmFsU3RlcHMgJHRnc2NlcnQNCiAgICBpZiAoLW5vdCAkbG9naW5SZWFkeSkgeyB0aHJvdyAiQ0VSVCBMb2dpbiBUaW1lb3V0LiIgfQ0KICAgIENoZWNrQ2FuY2VsDQogICAgIyAtLS0gU1RFUCA1OiBDSEFSQUNURVIgU0VMRUNUSU9OIC0tLQ0KICAgICMgVGhpcyBtdXN0IGhhcHBlbiBCRUZPUkUgdGhlIG5leHQgRW50ZXIgcHJlc3MNCiAgICAkY29vcmRLZXkgPSAiQ2hhciR7Y2hhclNsb3R9Q29vcmRzIg0KICAgIGlmICgkTG9naW5Db25maWdbJGNvb3JkS2V5XSAtYW5kICRMb2dpbkNvbmZpZ1skY29vcmRLZXldIC1uZSAnMCwwJykgew0KICAgICAgICAkY29vcmRzID0gUGFyc2VDb29yZGluYXRlcyAkTG9naW5Db25maWdbJGNvb3JkS2V5XQ0KICAgICAgICBpZiAoJGNvb3Jkcykgew0KICAgICAgICAgICAgJGNsaWVudFN0ZXBDb3VudGVyKys7IFVwZGF0ZS1Qcm9ncmVzcyAtVGV4dCAiU2VsZWN0aW5nIENoYXJhY3RlciBTbG90ICRjaGFyU2xvdC4uLiIgLUN1cnJlbnRTdGVwICgoJGNsaWVudEluZGV4IC0gMSkgKiAkVE9UQUxfU1RFUFNfUEVSX0NMSUVOVCArICRjbGllbnRTdGVwQ291bnRlcikgLVRvdGFsU3RlcHMgKCR0b3RhbENsaWVudHMgKiAkVE9UQUxfU1RFUFNfUEVSX0NMSUVOVCkNCiAgICAgICAgICAgIEludm9rZS1Nb3VzZUNsaWNrIC1YICgkcmVjdC5MZWZ0ICsgJGNvb3Jkcy5YKSAtWSAoJHJlY3QuVG9wICsgJGNvb3Jkcy5ZKQ0KICAgICAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyA1MDAgIyBXYWl0IGZvciBzZWxlY3Rpb24gdG8gcmVnaXN0ZXINCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmICgkY2hhclNsb3QgLW5lICIxIikgew0KICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIldBUk5JTkc6IE5vIGNvb3JkaW5hdGVzIGZvciBDaGFyICRjaGFyU2xvdC4gRGVmYXVsdGluZyB0byBDaGFyIDEuIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KICAgICAgICB9DQogICAgfQ0KICAgIENoZWNrQ2FuY2VsDQogICAgIyAtLS0gU1RFUCA2OiBNQUlOIExPR0lOIChFbnRlciBXb3JsZCkgLS0tDQogICAgJGNsaWVudFN0ZXBDb3VudGVyKys7IA0KICAgICRjZ3NtYWluID0gKCgkY2xpZW50SW5kZXggLSAxKSAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UICsgJGNsaWVudFN0ZXBDb3VudGVyKQ0KICAgICR0Z3NtYWluID0gKCR0b3RhbENsaWVudHMgKiAkVE9UQUxfU1RFUFNfUEVSX0NMSUVOVCkNCiAgICBVcGRhdGUtUHJvZ3Jlc3MgLVRleHQgIkVudGVyaW5nIFdvcmxkLi4uIiAtQ3VycmVudFN0ZXAgJGNnc21haW4gLVRvdGFsU3RlcHMgJHRnc21haW4NCiAgICBJbnZva2UtS2V5UHJlc3MgLVZpcnR1YWxLZXlDb2RlIDB4MEQNCiAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDUwMA0KICAgIENoZWNrQ2FuY2VsDQogICAgJGNhY2hlSm9pbiA9IFdhaXQtRm9yTG9nRW50cnkgLUxvZ1BhdGggJExvZ0ZpbGVQYXRoIC1TZWFyY2hTdHJpbmdzIEAoIjEzIC0gQ0FDSEVfQUNLX0pPSU4iKSAtVGltZW91dFNlY29uZHMgNjAgLWN1cnJlbnRHbG9iYWxTdGVwICRjZ3NtYWluIC10b3RhbEdsb2JhbFN0ZXBzICR0Z3NtYWluDQogICAgaWYgKC1ub3QgJGNhY2hlSm9pbikgeyB0aHJvdyAiTWFpbiBMb2dpbiBUaW1lb3V0LiIgfQ0KICAgICMgLS0tIFNURVAgNzogV09STEQgTE9BRCAtLS0NCiAgICAkY2xpZW50U3RlcENvdW50ZXIrKzsgDQogICAgJGNnc3dvcmxkID0gKCgkY2xpZW50SW5kZXggLSAxKSAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UICsgJGNsaWVudFN0ZXBDb3VudGVyKQ0KICAgICR0Z3N3b3JsZCA9ICgkdG90YWxDbGllbnRzICogJFRPVEFMX1NURVBTX1BFUl9DTElFTlQpDQogICAgVXBkYXRlLVByb2dyZXNzIC1UZXh0ICJXYWl0aW5nIGZvciBXb3JsZCBMb2FkLi4uIiAtQ3VycmVudFN0ZXAgJGNnc3dvcmxkIC1Ub3RhbFN0ZXBzICR0Z3N3b3JsZA0KICAgIFdhaXQtVW50aWxXb3JsZExvYWRlZCAtTG9nUGF0aCAkTG9nRmlsZVBhdGggLWN1cnJlbnRHbG9iYWxTdGVwICRjZ3N3b3JsZCAtdG90YWxHbG9iYWxTdGVwcyAkdGdzd29ybGQNCiAgICAjIEZpbmFsaXphdGlvbg0KICAgICRkZWxheSA9IDEgDQogICAgaWYgKCRMb2dpbkNvbmZpZ1snUG9zdExvZ2luRGVsYXknXSkgeyAkZGVsYXkgPSBbaW50XSRMb2dpbkNvbmZpZ1snUG9zdExvZ2luRGVsYXknXSB9DQogICAgJGNsaWVudFN0ZXBDb3VudGVyKys7IFVwZGF0ZS1Qcm9ncmVzcyAtVGV4dCAiT3B0aW1pemF0aW9uIERlbGF5ICgkZGVsYXkgcykuLi4iIC1DdXJyZW50U3RlcCAoKCRjbGllbnRJbmRleCAtIDEpICogJFRPVEFMX1NURVBTX1BFUl9DTElFTlQgKyAkY2xpZW50U3RlcENvdW50ZXIpIC1Ub3RhbFN0ZXBzICgkdG90YWxDbGllbnRzICogJFRPVEFMX1NURVBTX1BFUl9DTElFTlQpDQogICAgIyBTbGVlcCB3aXRoIGNoZWNrDQogICAgJHN3RGVsYXkgPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkNCiAgICB3aGlsZSAoJHN3RGVsYXkuRWxhcHNlZC5Ub3RhbFNlY29uZHMgLWx0ICRkZWxheSkgew0KICAgICAgICBDaGVja0NhbmNlbA0KICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDI1MA0KICAgIH0NCiAgICAjIENvbGxlY3RvciBTdGFydA0KICAgIGlmICgkc3RhcnRDb2xsZWN0b3IgLWVxICJZZXMiIC1hbmQgJExvZ2luQ29uZmlnWydDb2xsZWN0b3JTdGFydENvb3JkcyddIC1hbmQgJExvZ2luQ29uZmlnWydDb2xsZWN0b3JTdGFydENvb3JkcyddIC1uZSAnMCwwJykgew0KICAgICAgICAkY29vcmRzID0gUGFyc2VDb29yZGluYXRlcyAkTG9naW5Db25maWdbJ0NvbGxlY3RvclN0YXJ0Q29vcmRzJ10NCiAgICAgICAgaWYgKCRjb29yZHMpIHsNCiAgICAgICAgICAgICRjbGllbnRTdGVwQ291bnRlcisrOyBVcGRhdGUtUHJvZ3Jlc3MgLVRleHQgIlN0YXJ0aW5nIENvbGxlY3Rvci4uLiIgLUN1cnJlbnRTdGVwICgoJGNsaWVudEluZGV4IC0gMSkgKiAkVE9UQUxfU1RFUFNfUEVSX0NMSUVOVCArICRjbGllbnRTdGVwQ291bnRlcikgLVRvdGFsU3RlcHMgKCR0b3RhbENsaWVudHMgKiAkVE9UQUxfU1RFUFNfUEVSX0NMSUVOVCkNCiAgICAgICAgICAgIEludm9rZS1Nb3VzZUNsaWNrIC1YICgkcmVjdC5MZWZ0ICsgJGNvb3Jkcy5YKSAtWSAoJHJlY3QuVG9wICsgJGNvb3Jkcy5ZKQ0KICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMQ0KICAgICAgICB9DQogICAgfQ0KICAgICMgTWluaW1pemUNCiAgICAkY2xpZW50U3RlcENvdW50ZXIrKzsgVXBkYXRlLVByb2dyZXNzIC1UZXh0ICJNaW5pbWl6aW5nLi4uIiAtQ3VycmVudFN0ZXAgKCgkY2xpZW50SW5kZXggLSAxKSAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UICsgJGNsaWVudFN0ZXBDb3VudGVyKSAtVG90YWxTdGVwcyAoJHRvdGFsQ2xpZW50cyAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UKQ0KICAgIENoZWNrQ2FuY2VsDQogICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snT3B0aW9ucyddWydIaWRlTWluaW1pemVkV2luZG93cyddIC1lcSAnMScpIHsNCiAgICAgICAgIyBIaWRlIHdpbmRvdyBjb21wbGV0ZWx5IChTV19ISURFID0gMCkNCiAgICAgICAgI1tDdXN0b20uTmF0aXZlXTo6U2hvd1dpbmRvdygkcHJvY2Vzcy5NYWluV2luZG93SGFuZGxlLCAwKQ0KCQlbQ3VzdG9tLk5hdGl2ZV06OlNlbmRNZXNzYWdlKCRwcm9jZXNzLk1haW5XaW5kb3dIYW5kbGUsIDB4MDExMiwgMHhGMDIwLCAwKQ0KICAgIH0gZWxzZSB7DQogICAgICAgICMgTWluaW1pemUgd2luZG93IGdyYWNlZnVsbHkgdXNpbmcgV01fU1lTQ09NTUFORCAoU0NfTUlOSU1JWkUgPSAweEYwMjApDQogICAgICAgIFtDdXN0b20uTmF0aXZlXTo6U2VuZE1lc3NhZ2UoJHByb2Nlc3MuTWFpbldpbmRvd0hhbmRsZSwgMHgwMTEyLCAweEYwMjAsIDApDQogICAgfQ0KICAgIFtDdXN0b20uTmF0aXZlXTo6RW1wdHlXb3JraW5nU2V0KCRwcm9jZXNzLkhhbmRsZSkNCn0NCiNlbmRyZWdpb24NCg0KI3JlZ2lvbiBDb3JlIEZ1bmN0aW9uDQoNCmZ1bmN0aW9uIExvZ2luU2VsZWN0ZWRSb3cgew0KICAgIHBhcmFtKA0KICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kZmFsc2UpXQ0KICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuRGF0YUdyaWRWaWV3Um93XSRSb3dJbnB1dCwNCiAgICAgICAgW3N0cmluZ10kTG9nRmlsZVBhdGgNCiAgICApDQogICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTG9naW5BY3RpdmUgPSAkdHJ1ZQ0KICAgICMgUmVzZXQgY2FuY2VsbGF0aW9uIHN0YXRlIGFuZCBob29rIGZvciB0aGlzIHJ1bg0KICAgICRnbG9iYWw6TG9naW5DYW5jZWwuUmVzZXQoKQ0KICAgICRzY3JpcHQ6U2NyaXB0SW5pdGlhdGVkTW92ZSA9ICRmYWxzZQ0KICAgICMgRGVmaW5lIGFuZCBzdGFydCB0aGUgbW91c2UgaG9vaw0KICAgICRob29rQ2FsbGJhY2sgPSBbQ3VzdG9tLk1vdXNlSG9va01hbmFnZXIrSG9va1Byb2NdIHsNCiAgICAgICAgcGFyYW0oJG5Db2RlLCAkd1BhcmFtLCAkbFBhcmFtKQ0KICAgICAgICAjIFdNX01PVVNFTU9WRSBpcyAweDAyMDANCiAgICAgICAgaWYgKCRuQ29kZSAtZ2UgMCAtYW5kICR3UGFyYW0gLWVxIDB4MDIwMCkgew0KICAgICAgICAgICAgIyBJZ25vcmUgbW91c2UgbW92ZXMgdGhhdCB0aGlzIHNjcmlwdCBpbml0aWF0ZWQNCiAgICAgICAgICAgIGlmICgtbm90ICRzY3JpcHQ6U2NyaXB0SW5pdGlhdGVkTW92ZSkgew0KICAgICAgICAgICAgICAgICRnbG9iYWw6TG9naW5DYW5jZWwuQ2FuY2VsKCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAjIEFsd2F5cyBwYXNzIHRoZSBldmVudCB0byB0aGUgbmV4dCBob29rIGluIHRoZSBjaGFpbg0KICAgICAgICByZXR1cm4gW0N1c3RvbS5Nb3VzZUhvb2tNYW5hZ2VyXTo6Q2FsbE5leHRIb29rRXgoW0N1c3RvbS5Nb3VzZUhvb2tNYW5hZ2VyXTo6SG9va0lkLCAkbkNvZGUsICR3UGFyYW0sICRsUGFyYW0pDQogICAgfQ0KICAgIFtDdXN0b20uTW91c2VIb29rTWFuYWdlcl06OlN0YXJ0KCRob29rQ2FsbGJhY2spDQogICAgIyBVSSBTRVRVUA0KICAgICRwYiA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkdsb2JhbFByb2dyZXNzQmFyDQogICAgaWYgKCRwYikgew0KICAgICAgICAkcGIuVmlzaWJsZSA9ICR0cnVlDQogICAgICAgICRwYi5WYWx1ZSA9IDANCiAgICAgICAgJHBiLkN1c3RvbVRleHQgPSAiU3RhcnRpbmcgTG9naW4gUHJvY2Vzcy4uLiINCiAgICB9DQogICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuVUkuTG9naW5CdXR0b24uQmFja0NvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoOTAsIDkwLCA5MCkNCiAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5Mb2dpbkJ1dHRvbi5UZXh0ID0gIlJ1bm5pbmcuLi4iDQogICAgJHJvd3NUb1Byb2Nlc3MgPSBAKCkNCiAgICBpZiAoJFJvd0lucHV0KSB7DQogICAgICAgICRyb3dzVG9Qcm9jZXNzICs9ICRSb3dJbnB1dA0KICAgIH0gZWxzZWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5EYXRhR3JpZEZpbGxlci5TZWxlY3RlZFJvd3MuQ291bnQgLWd0IDApIHsNCiAgICAgICAgJHJvd3NUb1Byb2Nlc3MgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5EYXRhR3JpZEZpbGxlci5TZWxlY3RlZFJvd3MgfCBTb3J0LU9iamVjdCB7ICRfLkNlbGxzWzBdLlZhbHVlIC1hcyBbaW50XSB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiTE9HSU46IE5vIHJvd3Mgc2VsZWN0ZWQuIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5TdGF0ZS5Mb2dpbkFjdGl2ZSA9ICRmYWxzZQ0KICAgICAgICAjIFJlc2V0IEJ1dHRvbiB0byBSZWFkeQ0KICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5Mb2dpbkJ1dHRvbi5CYWNrQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYig0MCwgNDAsIDQwKQ0KICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5VSS5Mb2dpbkJ1dHRvbi5UZXh0ID0gIkxvZ2luIg0KICAgICAgICByZXR1cm4NCiAgICB9DQogICAgJHRvdGFsID0gJHJvd3NUb1Byb2Nlc3MuQ291bnQNCiAgICAkdG90YWxHbG9iYWxTdGVwcyA9ICR0b3RhbCAqICRUT1RBTF9TVEVQU19QRVJfQ0xJRU5UDQogICAgVXBkYXRlLVByb2dyZXNzIC1UZXh0ICJTdGFydGluZyBMb2dpbiBQcm9jZXNzLi4uIiAtQ3VycmVudFN0ZXAgMCAtVG90YWxTdGVwcyAkdG90YWxHbG9iYWxTdGVwcw0KICAgICRjdXJyZW50ID0gMA0KICAgICRsb2dpbkNvbmZpZyA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snTG9naW5Db25maWcnXQ0KICAgIGlmICgtbm90ICRsb2dpbkNvbmZpZykgeyAkbG9naW5Db25maWcgPSBAe30gfQ0KICAgIHRyeSB7DQogICAgICAgIGZvcmVhY2ggKCRyb3cgaW4gJHJvd3NUb1Byb2Nlc3MpIHsNCiAgICAgICAgICAgIENoZWNrQ2FuY2VsDQogICAgICAgICAgICAkY3VycmVudCsrDQogICAgICAgICAgICAkZW50cnlOdW0gPSAkcm93LkNlbGxzWzBdLlZhbHVlDQogICAgICAgICAgICAjIExvZ2ljIHRvIGZpbmQgbG9nIHBhdGggaWYgbm90IHByb3ZpZGVkDQogICAgICAgICAgICAkYWN0dWFsTG9nUGF0aCA9ICRMb2dGaWxlUGF0aA0KICAgICAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRhY3R1YWxMb2dQYXRoKSkgew0KICAgICAgICAgICAgCSRMb2dGb2xkZXIgPSAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydMYXVuY2hlclBhdGgnXVsnTGF1bmNoZXJQYXRoJ10gLXJlcGxhY2UgJ1xcTGF1bmNoZXJcLmV4ZSQnLCAnJykNCiAgICAgICAgCQkkYWN0dWFsTG9nUGF0aCA9IEpvaW4tUGF0aCAtUGF0aCAkTG9nRm9sZGVyIC1DaGlsZFBhdGggIkxvZ1xuZXR3b3JrXyQoR2V0LURhdGUgLUZvcm1hdCAneXl5eU1NZGQnKS5sb2ciDQogICAgICAgIAl9DQogICAgICAgICAgICBQcm9jZXNzU2luZ2xlQ2xpZW50IC1Sb3cgJHJvdyAtTG9nRmlsZVBhdGggJGFjdHVhbExvZ1BhdGggLUxvZ2luQ29uZmlnICRsb2dpbkNvbmZpZyAtY2xpZW50SW5kZXggJGN1cnJlbnQgLXRvdGFsQ2xpZW50cyAkdG90YWwNCgkJfQ0KICAgICAgICBVcGRhdGUtUHJvZ3Jlc3MgLVRleHQgIkRvbmUiIC1DdXJyZW50U3RlcCAkdG90YWxHbG9iYWxTdGVwcyAtVG90YWxTdGVwcyAkdG90YWxHbG9iYWxTdGVwcw0KICAgICAgICBXcml0ZS1WZXJib3NlICJBbGwgc2VsZWN0ZWQgY2xpZW50cyBwcm9jZXNzZWQuIiAtRm9yZWdyb3VuZENvbG9yIEdyZWVuDQogICAgfSBjYXRjaCB7DQogICAgICAgICMgQ2F0Y2ggdGhlIEFib3J0L0ludGVydmVudGlvbiBlcnJvcnMgaGVyZQ0KICAgICAgICBVcGRhdGUtUHJvZ3Jlc3MgLVRleHQgIkFib3J0ZWQiIC1WYWx1ZSAwDQogICAgICAgIFdyaXRlLVZlcmJvc2UgIkxvZ2luIFByb2Nlc3MgU3RvcHBlZDogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQogICAgICAgICMgQ2xlYW51cCBpcyBoYW5kbGVkIGluIHRoZSAnZmluYWxseScgYmxvY2suDQogICAgfSBmaW5hbGx5IHsNCiAgICAgICAgIyBBbHdheXMgdW5ob29rIHRoZSBtb3VzZSBsaXN0ZW5lcg0KICAgICAgICBbQ3VzdG9tLk1vdXNlSG9va01hbmFnZXJdOjpTdG9wKCkNCiAgICAgICAgVW5sb2NrLU1vdXNlUG9zaXRpb24NCiAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuU3RhdGUuTG9naW5BY3RpdmUgPSAkZmFsc2UNCiAgICAgICAgIyBSZXNldCBVSQ0KICAgICAgICBpZiAoJHBiKSB7DQogICAgICAgICAgICAkcGIuVmlzaWJsZSA9ICRmYWxzZQ0KICAgICAgICAgICAgJHBiLlZhbHVlID0gMA0KICAgICAgICAgICAgJHBiLkN1c3RvbVRleHQgPSAiIg0KICAgICAgICB9DQogICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkxvZ2luQnV0dG9uLkJhY2tDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkZyb21BcmdiKDQwLCA0MCwgNDApDQogICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlVJLkxvZ2luQnV0dG9uLlRleHQgPSAiTG9naW4iDQogICAgICAgICMgRm9yY2UgdGhlIG1lc3NhZ2UgcXVldWUgdG8gcHJvY2VzcyBVSSB1cGRhdGVzIGFuZCBwcmV2ZW50IGZyZWV6aW5nLg0KICAgICAgICBbU3lzdGVtLldpbmRvd3MuRm9ybXMuQXBwbGljYXRpb25dOjpEb0V2ZW50cygpDQogICAgfQ0KfQ0KDQojZW5kcmVnaW9uDQoNCiNyZWdpb24gTW9kdWxlIEV4cG9ydHMNCg0KIyBFeHBvcnQgbW9kdWxlIGZ1bmN0aW9ucw0KRXhwb3J0LU1vZHVsZU1lbWJlciAtRnVuY3Rpb24gTG9naW5TZWxlY3RlZFJvdywgUmVzdG9yZS1XaW5kb3csIFNldC1XaW5kb3dGb3JlZ3JvdW5kLCBXYWl0LUZvckZpbGVBY2Nlc3MsIEludm9rZS1Nb3VzZUNsaWNrLCBJbnZva2UtS2V5UHJlc3MsIFdyaXRlLUxvZ1dpdGhSZXRyeQ0KI2VuZHJlZ2lvbiBNb2R1bGUgRXhwb3J0cw==
			'
		}
		'ftool.psm1'    = @{ 
			Priority = 'Optional';  
			Order = 9; 
			Dependencies = @('classes.psm1', 'ui.psm1', 'ini.psm1', 'datagrid.psm1');
			#FilePath = (Join-Path $global:DashboardConfig.Paths.Source 'ftool.psm1');
			Base64Content = '
PCMgZnRvb2wucHNtMSANCiAgICAuU1lOT1BTSVMNCiAgICAgICAgUHJvdmlkZXMgYW4gaW4tZ2FtZSBhdXRvbWF0aW9uIHRvb2wgKCJGdG9vbCIpIHRoYXQgYXR0YWNoZXMgYSBmbG9hdGluZyBVSSB0byBhIHRhcmdldCBhcHBsaWNhdGlvbiB3aW5kb3cuIA0KCQlUaGlzIFVJIGFsbG93cyB1c2VycyB0byBjb25maWd1cmUgYW5kIHJ1biBtdWx0aXBsZSwgaG90a2V5LWRyaXZlbiwgYXV0b21hdGVkIGtleS1wcmVzc2VzIGZvciB0aGF0IHNwZWNpZmljIGFwcGxpY2F0aW9uIGluc3RhbmNlLg0KDQogICAgLkRFU0NSSVBUSU9ODQogICAgICAgIFRoaXMgbW9kdWxlIGltcGxlbWVudHMgdGhlICJGdG9vbCwiIGFuIGFkdmFuY2VkIGF1dG9tYXRpb24gdXRpbGl0eSBmb3IgdGhlIEVudHJvcGlhIERhc2hib2FyZC4gV2hlbiB0cmlnZ2VyZWQgZm9yIGEgc2VsZWN0ZWQgYXBwbGljYXRpb24sIGl0IGxhdW5jaGVzIGEgc21hbGwsIGluZGVwZW5kZW50IHRvb2wgd2luZG93IHRoYXQgZG9ja3MgdG8gdGhlIHRhcmdldCBhcHBsaWNhdGlvbidzIHdpbmRvdy4gVGhpcyB0b29sIHdpbmRvdyBzZXJ2ZXMgYXMgYSBjb250cm9sIHBhbmVsIGZvciBjcmVhdGluZyBhbmQgbWFuYWdpbmcgbXVsdGlwbGUgYXV0b21hdGVkIGtleS1wcmVzcyBtYWNyb3MsIG9mdGVuIGNhbGxlZCAic3BhbW1lcnMuIiBUaGUgbW9kdWxlIGZlYXR1cmVzIGEgc29waGlzdGljYXRlZCBob3RrZXkgc3lzdGVtLCBkeW5hbWljIFVJIGdlbmVyYXRpb24sIGFuZCBwZXJzaXN0ZW50LCBwcm9maWxlLWJhc2VkIGNvbmZpZ3VyYXRpb24uDQoNCiAgICAgICAgSXRzIHByaW1hcnkgZmVhdHVyZXMgYXJlOg0KDQogICAgICAgIDEuICAqKlRoZSBGdG9vbCBXaW5kb3c6KioNCiAgICAgICAgICAgICogICBBIGZsb2F0aW5nIFVJIHRoYXQgYXR0YWNoZXMgdG8gYW5kIG1vdmVzIHdpdGggYSB0YXJnZXQgYXBwbGljYXRpb24gd2luZG93Lg0KICAgICAgICAgICAgKiAgIEFsbG93cyB0aGUgdXNlciB0byBjb25maWd1cmUgYSAibWFpbiIga2V5LXByZXNzZXIgYW5kIGR5bmFtaWNhbGx5IGFkZC9yZW1vdmUgbXVsdGlwbGUgImV4dGVuc2lvbiIga2V5LXByZXNzZXJzLg0KICAgICAgICAgICAgKiAgIEVhY2gga2V5LXByZXNzZXIgY2FuIGJlIGNvbmZpZ3VyZWQgd2l0aCBhIHNwZWNpZmljIGtleSwgYW4gZXhlY3V0aW9uIGludGVydmFsIGluIG1pbGxpc2Vjb25kcywgYW5kIGEgZGVzY3JpcHRpdmUgbmFtZS4NCiAgICAgICAgICAgICogICBLZXkgcHJlc3NlcyBhcmUgc2VudCBkaXJlY3RseSB0byB0aGUgdGFyZ2V0IHdpbmRvdyB1c2luZyBgUG9zdE1lc3NhZ2VgIHZpYSB0aGUgYGZ0b29sLmRsbGAsIGEgbWV0aG9kIG9mdGVuIHVzZWQgZm9yIGVmZmVjdGl2ZSBhdXRvbWF0aW9uIGluIGdhbWVzLg0KDQogICAgICAgIDIuICAqKkFkdmFuY2VkIEhvdGtleSBFbmdpbmU6KioNCiAgICAgICAgICAgICogICBJbXBsZW1lbnRzIGEgcm9idXN0LCBzeXN0ZW0td2lkZSBob3RrZXkgbWFuYWdlciB0aGF0IHJ1bnMgaW4gdGhlIGJhY2tncm91bmQuDQogICAgICAgICAgICAqICAgQWxsb3dzIHVzZXJzIHRvIGFzc2lnbiBhIHVuaXF1ZSBob3RrZXkgdG8gdG9nZ2xlIHRoZSBzdGFydC9zdG9wIHN0YXRlIG9mIHRoZSBtYWluIHNwYW1tZXIgYW5kIGVhY2ggaW5kaXZpZHVhbCBleHRlbnNpb24uDQogICAgICAgICAgICAqICAgSW5jbHVkZXMgYSBtYXN0ZXIgaG90a2V5IHRvIGVuYWJsZS9kaXNhYmxlIGFsbCBob3RrZXlzIGZvciBhIGdpdmVuIEZ0b29sIGluc3RhbmNlLg0KICAgICAgICAgICAgKiAgIEZlYXR1cmVzIGEgdXNlci1mcmllbmRseSAiS2V5IENhcHR1cmUiIGRpYWxvZyAoYFNob3ctS2V5Q2FwdHVyZURpYWxvZ2ApIGZvciBlYXN5IGhvdGtleSBhc3NpZ25tZW50Lg0KICAgICAgICAgICAgKiAgIFN1cHBvcnRzIHBhdXNpbmcsIHJlc3VtaW5nLCBhbmQgY29uZmxpY3QgZGV0ZWN0aW9uIGZvciBhbGwgcmVnaXN0ZXJlZCBob3RrZXlzLg0KDQogICAgICAgIDMuICAqKkR5bmFtaWMgYW5kIFBlcnNpc3RlbnQgVUk6KioNCiAgICAgICAgICAgICogICBUaGUgRnRvb2wgd2luZG93IGNhbiBiZSBleHBhbmRlZCB0byBhZGQgbmV3IGtleS1wcmVzc2VyIGV4dGVuc2lvbnMgb24gdGhlIGZseSBhbmQgY29sbGFwc2VkIHRvIGEgbWluaW1hbCB0aXRsZSBiYXIuDQogICAgICAgICAgICAqICAgQWxsIHNldHRpbmdzLCBpbmNsdWRpbmcgY29uZmlndXJlZCBrZXlzLCBpbnRlcnZhbHMsIGhvdGtleXMsIGFuZCBldmVuIHRoZSByZWxhdGl2ZSBwb3NpdGlvbiBvZiB0aGUgRnRvb2wgd2luZG93IHRvIGl0cyB0YXJnZXQsIGFyZSBzYXZlZCB0byB0aGUgbWFpbiBgY29uZmlnLmluaWAuDQogICAgICAgICAgICAqICAgSXQgdXNlcyBhIHByb2ZpbGUgc3lzdGVtIGJhc2VkIG9uIHRoZSB0YXJnZXQgd2luZG93J3MgdGl0bGUgdG8gbWFpbnRhaW4gc2VwYXJhdGUgY29uZmlndXJhdGlvbnMgZm9yIGRpZmZlcmVudCBhcHBsaWNhdGlvbiBpbnN0YW5jZXMuDQoNCiAgICAgICAgNC4gICoqTGlmZWN5Y2xlIE1hbmFnZW1lbnQ6KioNCiAgICAgICAgICAgICogICBUaGUgbW9kdWxlIGNhcmVmdWxseSBtYW5hZ2VzIGFsbCBjcmVhdGVkIHJlc291cmNlcy4gV2hlbiBhbiBGdG9vbCB3aW5kb3cgaXMgY2xvc2VkIG9yIGl0cyB0YXJnZXQgYXBwbGljYXRpb24gd2luZG93IGRpc2FwcGVhcnMsIGl0IGF1dG9tYXRpY2FsbHkgc3RvcHMgYWxsIHRpbWVycywgdW5yZWdpc3RlcnMgYXNzb2NpYXRlZCBob3RrZXlzLCBhbmQgZGlzcG9zZXMgb2YgdGhlIFVJIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzLg0KIz4NCg0KI3JlZ2lvbiBIb3RrZXkgTWFuYWdlbWVudA0KDQojIEFkZCBDIyBjb2RlIGZvciBhIGhpZGRlbiBtZXNzYWdlIHdpbmRvdyB0byBoYW5kbGUgaG90a2V5IG1lc3NhZ2VzDQppZiAoLW5vdCAoW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNUeXBlTmFtZV0nSG90a2V5TWFuYWdlcicpLlR5cGUpIHsNCiAgICBBZGQtVHlwZSAtVHlwZURlZmluaXRpb24gQCINCgl1c2luZyBTeXN0ZW07DQoJdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQoJdXNpbmcgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzOw0KCXVzaW5nIFN5c3RlbS5XaW5kb3dzLkZvcm1zOw0KDQoJcHVibGljIGNsYXNzIEhvdGtleU1hbmFnZXIgOiBJRGlzcG9zYWJsZQ0KCXsNCgkJcHVibGljIGNvbnN0IGludCBXTV9IT1RLRVkgPSAweDAzMTI7DQoJCXByaXZhdGUgc3RhdGljIGludCBfbmV4dElkID0gMTsNCgkJcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTWVzc2FnZVdpbmRvdyBfd2luZG93ID0gbmV3IE1lc3NhZ2VXaW5kb3coKTsNCgkJDQoJCXByaXZhdGUgc3RhdGljIERhdGVUaW1lIF9sYXN0SG90a2V5VGltZSA9IERhdGVUaW1lLk1pblZhbHVlOyANCgkJDQoJCXByaXZhdGUgc3RhdGljIERpY3Rpb25hcnk8aW50LCBMaXN0PEhvdGtleUFjdGlvbkVudHJ5Pj4gX2hvdGtleUFjdGlvbnMgPSBuZXcgRGljdGlvbmFyeTxpbnQsIExpc3Q8SG90a2V5QWN0aW9uRW50cnk+PigpOw0KCQlwcml2YXRlIHN0YXRpYyBEaWN0aW9uYXJ5PFR1cGxlPFN5c3RlbS5VSW50MzIsIFN5c3RlbS5VSW50MzI+LCBpbnQ+IF9ob3RrZXlJZHMgPSBuZXcgRGljdGlvbmFyeTxUdXBsZTxTeXN0ZW0uVUludDMyLCBTeXN0ZW0uVUludDMyPiwgaW50PigpOw0KCQlwcml2YXRlIHN0YXRpYyByZWFkb25seSBvYmplY3QgX2hvdGtleUFjdGlvbnNMb2NrID0gbmV3IG9iamVjdCgpOw0KCQlwcml2YXRlIHN0YXRpYyBib29sIF9pc1Byb2Nlc3NpbmdIb3RrZXkgPSBmYWxzZTsNCg0KCQlwdWJsaWMgZW51bSBIb3RrZXlBY3Rpb25UeXBlDQoJCXsNCgkJCU5vcm1hbCwNCgkJCUdsb2JhbFRvZ2dsZQ0KCQl9DQoNCgkJcHVibGljIHN0cnVjdCBIb3RrZXlBY3Rpb25FbnRyeQ0KCQl7DQoJCQlwdWJsaWMgQWN0aW9uIEFjdGlvbkRlbGVnYXRlOw0KCQkJcHVibGljIEhvdGtleUFjdGlvblR5cGUgVHlwZTsNCgkJfQ0KICAgICAgICANCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIEFyZUhvdGtleXNHbG9iYWxseVBhdXNlZCB7IGdldDsgc2V0OyB9DQoNCgkJW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvcj10cnVlKV0NCgkJcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGJvb2wgUmVnaXN0ZXJIb3RLZXkoSW50UHRyIGhXbmQsIGludCBpZCwgdWludCBmc01vZGlmaWVycywgdWludCB2ayk7DQoNCgkJW0RsbEltcG9ydCgidXNlcjMyLmRsbCIsIFNldExhc3RFcnJvcj10cnVlKV0NCgkJcHJpdmF0ZSBzdGF0aWMgZXh0ZXJuIGJvb2wgVW5yZWdpc3RlckhvdEtleShJbnRQdHIgaFduZCwgaW50IGlkKTsNCg0KCQlwdWJsaWMgc3RhdGljIGludCBSZWdpc3RlcihTeXN0ZW0uVUludDMyIG1vZGlmaWVycywgU3lzdGVtLlVJbnQzMiB2aXJ0dWFsS2V5LCBIb3RrZXlBY3Rpb25FbnRyeSBhY3Rpb25FbnRyeSkNCgkJew0KCQkJbG9jayAoX2hvdGtleUFjdGlvbnNMb2NrKQ0KCQkJew0KCQkJCXZhciBob3RrZXlUdXBsZSA9IFR1cGxlLkNyZWF0ZShtb2RpZmllcnMsIHZpcnR1YWxLZXkpOw0KCQkJCWlmIChfaG90a2V5SWRzLkNvbnRhaW5zS2V5KGhvdGtleVR1cGxlKSkNCgkJCQl7DQoJCQkJCWludCBleGlzdGluZ0lkID0gX2hvdGtleUlkc1tob3RrZXlUdXBsZV07DQoJCQkJCWlmICghX2hvdGtleUFjdGlvbnMuQ29udGFpbnNLZXkoZXhpc3RpbmdJZCkpIF9ob3RrZXlBY3Rpb25zW2V4aXN0aW5nSWRdID0gbmV3IExpc3Q8SG90a2V5QWN0aW9uRW50cnk+KCk7DQoJCQkJCV9ob3RrZXlBY3Rpb25zW2V4aXN0aW5nSWRdLkFkZChhY3Rpb25FbnRyeSk7DQoJCQkJCXJldHVybiBleGlzdGluZ0lkOw0KCQkJCX0NCg0KCQkJCWludCBpZCA9IF9uZXh0SWQrKzsNCgkJCQlpZiAoIVJlZ2lzdGVySG90S2V5KF93aW5kb3cuSGFuZGxlLCBpZCwgbW9kaWZpZXJzLCB2aXJ0dWFsS2V5KSkNCgkJCQl7DQoJCQkJCXRocm93IG5ldyBFeGNlcHRpb24oIkZhaWxlZCB0byByZWdpc3RlciBob3RrZXkuIEVycm9yOiAiICsgTWFyc2hhbC5HZXRMYXN0V2luMzJFcnJvcigpKTsNCgkJCQl9DQoJCQkJX2hvdGtleUFjdGlvbnNbaWRdID0gbmV3IExpc3Q8SG90a2V5QWN0aW9uRW50cnk+KCkgeyBhY3Rpb25FbnRyeSB9Ow0KCQkJCV9ob3RrZXlJZHNbaG90a2V5VHVwbGVdID0gaWQ7DQoJCQkJcmV0dXJuIGlkOw0KCQkJfQ0KCQl9DQoNCgkJcHVibGljIHN0YXRpYyB2b2lkIFVucmVnaXN0ZXIoaW50IGlkKQ0KCQl7DQoJCQlsb2NrIChfaG90a2V5QWN0aW9uc0xvY2spDQoJCQl7DQoJCQkJaWYgKCFfaG90a2V5QWN0aW9ucy5Db250YWluc0tleShpZCkpIHJldHVybjsNCgkJCQlVbnJlZ2lzdGVySG90S2V5KF93aW5kb3cuSGFuZGxlLCBpZCk7DQoJCQkJX2hvdGtleUFjdGlvbnMuUmVtb3ZlKGlkKTsNCg0KCQkJCVR1cGxlPHVpbnQsIHVpbnQ+IGtleVRvUmVtb3ZlID0gbnVsbDsNCgkJCQlmb3JlYWNoKHZhciBwYWlyIGluIF9ob3RrZXlJZHMpDQoJCQkJew0KCQkJCQlpZihwYWlyLlZhbHVlID09IGlkKQ0KCQkJCQl7DQoJCQkJCQlrZXlUb1JlbW92ZSA9IHBhaXIuS2V5Ow0KCQkJCQkJYnJlYWs7DQoJCQkJCX0NCgkJCQl9DQoJCQkJaWYoa2V5VG9SZW1vdmUgIT0gbnVsbCkNCgkJCQl7DQoJCQkJCV9ob3RrZXlJZHMuUmVtb3ZlKGtleVRvUmVtb3ZlKTsNCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQlwdWJsaWMgc3RhdGljIHZvaWQgVW5yZWdpc3RlckFjdGlvbihpbnQgaWQsIEFjdGlvbiBhY3Rpb24pDQoJCXsNCgkJCWxvY2sgKF9ob3RrZXlBY3Rpb25zTG9jaykNCgkJCXsNCgkJCQlpZiAoIV9ob3RrZXlBY3Rpb25zLkNvbnRhaW5zS2V5KGlkKSkgcmV0dXJuOw0KCQkJCXZhciBsaXN0ID0gX2hvdGtleUFjdGlvbnNbaWRdOw0KCQkJCWxpc3QuUmVtb3ZlQWxsKGVudHJ5ID0+IGVudHJ5LkFjdGlvbkRlbGVnYXRlID09IGFjdGlvbik7DQoJCQkJaWYgKGxpc3QuQ291bnQgPT0gMCkNCgkJCQl7DQoJCQkJCVVucmVnaXN0ZXJIb3RLZXkoX3dpbmRvdy5IYW5kbGUsIGlkKTsNCgkJCQkJX2hvdGtleUFjdGlvbnMuUmVtb3ZlKGlkKTsNCgkJCQkJVHVwbGU8dWludCwgdWludD4ga2V5VG9SZW1vdmUgPSBudWxsOw0KCQkJCQlmb3JlYWNoKHZhciBwYWlyIGluIF9ob3RrZXlJZHMpDQoJCQkJCXsNCgkJCQkJCWlmKHBhaXIuVmFsdWUgPT0gaWQpDQoJCQkJCQl7DQoJCQkJCQkJa2V5VG9SZW1vdmUgPSBwYWlyLktleTsNCgkJCQkJCQlicmVhazsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlpZihrZXlUb1JlbW92ZSAhPSBudWxsKQ0KCQkJCQl7DQoJCQkJCQlfaG90a2V5SWRzLlJlbW92ZShrZXlUb1JlbW92ZSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQlwdWJsaWMgc3RhdGljIHZvaWQgVW5yZWdpc3RlckFsbCgpDQoJCXsNCgkJCWxvY2sgKF9ob3RrZXlBY3Rpb25zTG9jaykNCgkJCXsNCgkJCQlmb3JlYWNoICh2YXIgaWQgaW4gbmV3IExpc3Q8aW50PihfaG90a2V5QWN0aW9ucy5LZXlzKSkNCgkJCQl7DQoJCQkJCVVucmVnaXN0ZXJIb3RLZXkoX3dpbmRvdy5IYW5kbGUsIGlkKTsNCgkJCQl9DQoJCQkJX2hvdGtleUFjdGlvbnMuQ2xlYXIoKTsNCgkJCQlfaG90a2V5SWRzLkNsZWFyKCk7DQoJCQl9DQoJCX0NCg0KCQlwdWJsaWMgdm9pZCBEaXNwb3NlKCkNCgkJew0KCQkJVW5yZWdpc3RlckFsbCgpOw0KCQkJX3dpbmRvdy5EaXNwb3NlKCk7DQoJCX0NCg0KCQlwcml2YXRlIGNsYXNzIE1lc3NhZ2VXaW5kb3cgOiBGb3JtDQoJCXsNCgkJCXByb3RlY3RlZCBvdmVycmlkZSBDcmVhdGVQYXJhbXMgQ3JlYXRlUGFyYW1zDQoJCQl7DQoJCQkJZ2V0DQoJCQkJew0KCQkJCQl2YXIgY3AgPSBiYXNlLkNyZWF0ZVBhcmFtczsNCgkJCQkJY3AuUGFyZW50ID0gKEludFB0cikoLTMpOyAvLyBIV05EX01FU1NBR0UNCgkJCQkJcmV0dXJuIGNwOw0KCQkJCX0NCgkJCX0NCg0KCQkJcHJvdGVjdGVkIG92ZXJyaWRlIHZvaWQgV25kUHJvYyhyZWYgTWVzc2FnZSBtKQ0KCQkJew0KCQkJCWlmIChtLk1zZyA9PSBXTV9IT1RLRVkpDQoJCQkJew0KCQkJCQlpZiAoKERhdGVUaW1lLk5vdyAtIEhvdGtleU1hbmFnZXIuX2xhc3RIb3RrZXlUaW1lKS5Ub3RhbE1pbGxpc2Vjb25kcyA8IDMwMCkgDQoJCQkJCXsNCgkJCQkJCXJldHVybjsNCgkJCQkJfQ0KDQoJCQkJCWlmIChfaXNQcm9jZXNzaW5nSG90a2V5KSB7DQoJCQkJCQlyZXR1cm47DQoJCQkJCX0NCg0KCQkJCQl0cnkNCgkJCQkJew0KCQkJCQkJX2lzUHJvY2Vzc2luZ0hvdGtleSA9IHRydWU7DQoJCQkJCQlIb3RrZXlNYW5hZ2VyLl9sYXN0SG90a2V5VGltZSA9IERhdGVUaW1lLk5vdzsNCg0KCQkJCQkJaW50IGlkID0gbS5XUGFyYW0uVG9JbnQzMigpOw0KCQkJCQkJaWYgKF9ob3RrZXlBY3Rpb25zLkNvbnRhaW5zS2V5KGlkKSAmJiBfaG90a2V5QWN0aW9uc1tpZF0gIT0gbnVsbCkNCgkJCQkJCXsNCgkJCQkJCQlMaXN0PEhvdGtleUFjdGlvbkVudHJ5PiBhY3Rpb25zVG9JbnZva2VDb3B5Ow0KCQkJCQkJCWxvY2sgKF9ob3RrZXlBY3Rpb25zTG9jaykNCgkJCQkJCQl7DQoJCQkJCQkJCWlmICghX2hvdGtleUFjdGlvbnMuQ29udGFpbnNLZXkoaWQpKSByZXR1cm47DQoJCQkJCQkJCWFjdGlvbnNUb0ludm9rZUNvcHkgPSBuZXcgTGlzdDxIb3RrZXlBY3Rpb25FbnRyeT4oX2hvdGtleUFjdGlvbnNbaWRdKTsNCgkJCQkJCQl9DQoJCQkJCQkJDQoJCQkJCQkJTGlzdDxIb3RrZXlBY3Rpb25FbnRyeT4gZ2xvYmFsVG9nZ2xlQWN0aW9ucyA9IG5ldyBMaXN0PEhvdGtleUFjdGlvbkVudHJ5PigpOw0KCQkJCQkJCUxpc3Q8SG90a2V5QWN0aW9uRW50cnk+IG5vcm1hbEFjdGlvbnMgPSBuZXcgTGlzdDxIb3RrZXlBY3Rpb25FbnRyeT4oKTsNCg0KCQkJCQkJCWZvcmVhY2ggKHZhciBlbnRyeSBpbiBhY3Rpb25zVG9JbnZva2VDb3B5KQ0KCQkJCQkJCXsNCgkJCQkJCQkJaWYgKGVudHJ5LlR5cGUgPT0gSG90a2V5QWN0aW9uVHlwZS5HbG9iYWxUb2dnbGUpDQoJCQkJCQkJCQlnbG9iYWxUb2dnbGVBY3Rpb25zLkFkZChlbnRyeSk7DQoJCQkJCQkJCWVsc2UNCgkJCQkJCQkJCW5vcm1hbEFjdGlvbnMuQWRkKGVudHJ5KTsNCgkJCQkJCQl9DQoNCgkJCQkJCQlpZiAoZ2xvYmFsVG9nZ2xlQWN0aW9ucy5Db3VudCA+IDApDQoJCQkJCQkJew0KCQkJCQkJCQl0cnkgDQoJCQkJCQkJCXsNCgkJCQkJCQkJCWlmIChnbG9iYWxUb2dnbGVBY3Rpb25zWzBdLkFjdGlvbkRlbGVnYXRlICE9IG51bGwpIA0KCQkJCQkJCQkJew0KCQkJCQkJCQkJCWdsb2JhbFRvZ2dsZUFjdGlvbnNbMF0uQWN0aW9uRGVsZWdhdGUuSW52b2tlKCk7DQoJCQkJCQkJCQl9DQoJCQkJCQkJCX0gDQoJCQkJCQkJCWNhdGNoIHsgfQ0KCQkJCQkJCQlyZXR1cm47IA0KCQkJCQkJCX0NCgkJCQkJCQkNCgkJCQkJCQlpZiAoSG90a2V5TWFuYWdlci5BcmVIb3RrZXlzR2xvYmFsbHlQYXVzZWQpIA0KCQkJCQkJCXsNCgkJCQkJCQkJcmV0dXJuOyANCgkJCQkJCQl9DQoNCgkJCQkJCQlmb3JlYWNoICh2YXIgZW50cnkgaW4gbm9ybWFsQWN0aW9ucykNCgkJCQkJCQl7DQoJCQkJCQkJCXRyeSB7IGlmIChlbnRyeS5BY3Rpb25EZWxlZ2F0ZSAhPSBudWxsKSB7IGVudHJ5LkFjdGlvbkRlbGVnYXRlLkludm9rZSgpOyB9IH0gY2F0Y2gge30NCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJZmluYWxseQ0KCQkJCQl7DQoJCQkJCQlfaXNQcm9jZXNzaW5nSG90a2V5ID0gZmFsc2U7DQoJCQkJCX0NCgkJCQl9DQoJCQkJYmFzZS5XbmRQcm9jKHJlZiBtKTsNCgkJCX0NCgkJfQ0KCX0NCiJAIC1SZWZlcmVuY2VkQXNzZW1ibGllcyAiU3lzdGVtLldpbmRvd3MuRm9ybXMiLCAiU3lzdGVtLkRyYXdpbmciDQp9DQoNCiMgRG8gbm90IG92ZXJ3cml0ZSBleGlzdGluZyBob3RrZXkgbWFwcyBpZiB0aGV5IGFscmVhZHkgZXhpc3QgZnJvbSBhIHByZXZpb3VzIGluc3RhbmNlDQppZiAoLW5vdCAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzKSB7ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMgPSBAe30gfQ0KaWYgKC1ub3QgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmcpIHsgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmcgPSBAe30gfQ0KDQpmdW5jdGlvbiBTZXQtSG90a2V5DQp7DQogICAgcGFyYW0oDQogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV0NCiAgICAgICAgW3N0cmluZ10kS2V5Q29tYmluYXRpb25TdHJpbmcsDQogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV0NCiAgICAgICAgJEFjdGlvbiwNCgkJW1BhcmFtZXRlcihNYW5kYXRvcnk9JGZhbHNlKV0NCgkJW3N0cmluZ10kT3duZXJLZXkgPSAkbnVsbCwNCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JGZhbHNlKV0NCiAgICAgICAgW2ludF0kT2xkSG90a2V5SWQgPSAkbnVsbA0KICAgICkNCg0KICAgICMgMS4gTm9ybWFsaXplIEFjdGlvbiB0byBhIHNwZWNpZmljIERlbGVnYXRlIGluc3RhbmNlLg0KICAgIGlmICgkQWN0aW9uIC1pcyBbU3lzdGVtLkFjdGlvbl0pIHsNCiAgICAgICAgJGFjdGlvbkRlbGVnYXRlID0gJEFjdGlvbg0KICAgIH0gZWxzZWlmICgkQWN0aW9uIC1pcyBbU3lzdGVtLkRlbGVnYXRlXSkgew0KICAgICAgICAkYWN0aW9uRGVsZWdhdGUgPSAkQWN0aW9uIC1hcyBbU3lzdGVtLkFjdGlvbl0NCiAgICB9IGVsc2Ugew0KICAgICAgICAkYWN0aW9uRGVsZWdhdGUgPSBbU3lzdGVtLkFjdGlvbl0kQWN0aW9uDQogICAgfQ0KDQogICAgIyAyLiBVbnJlZ2lzdHJhdGlvbg0KICAgIGlmICgtbm90IFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRPd25lcktleSkpIHsNCiAgICAgICAgJGlkc1RvQ2xlYW4gPSBAKCkNCiAgICAgICAgZm9yZWFjaCAoJGt2cCBpbiAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzLkdldEVudW1lcmF0b3IoKSkgew0KICAgICAgICAgICAgaWYgKCRrdnAuVmFsdWUuT3duZXJzIC1hbmQgJGt2cC5WYWx1ZS5Pd25lcnMuQ29udGFpbnNLZXkoJE93bmVyS2V5KSkgew0KICAgICAgICAgICAgICAgICRpZHNUb0NsZWFuICs9ICRrdnAuS2V5DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmb3JlYWNoICgkaWQgaW4gJGlkc1RvQ2xlYW4pIHsNCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkZUT09MOiBGb3VuZCBleGlzdGluZyByZWdpc3RyYXRpb24gZm9yIG93bmVyICckT3duZXJLZXknIG9uIElEICRpZC4gUmVtb3ZpbmcuLi4iDQogICAgICAgICAgICANCiAgICAgICAgICAgICRvd25lckFjdGlvbiA9ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXS5Pd25lcnNbJE93bmVyS2V5XQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAkdW5yZWdpc3RlcmVkU3BlY2lmaWMgPSAkZmFsc2UNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKCRvd25lckFjdGlvbikgew0KICAgICAgICAgICAgICAgICAgICAkdW5yZWdpc3Rlck1ldGhvZCA9IFtIb3RrZXlNYW5hZ2VyXS5HZXRNZXRob2QoJ1VucmVnaXN0ZXJBY3Rpb24nKQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJHVucmVnaXN0ZXJNZXRob2QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFtIb3RrZXlNYW5hZ2VyXTo6VW5yZWdpc3RlckFjdGlvbigkaWQsICRvd25lckFjdGlvbi5BY3Rpb25EZWxlZ2F0ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICR1bnJlZ2lzdGVyZWRTcGVjaWZpYyA9ICR0cnVlDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIHsgV3JpdGUtVmVyYm9zZSAiRlRPT0w6IFNwZWNpZmljIHVucmVnaXN0ZXIgZmFpbGVkOiAkdW5yZWdpc3RlcmVkU3BlY2lmaWMgJF8iIH0NCg0KICAgICAgICAgICAgaWYgKCRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuQ29udGFpbnNLZXkoJGlkKSkgew0KICAgICAgICAgICAgICAgICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXS5Pd25lcnMuUmVtb3ZlKCRPd25lcktleSkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skaWRdLk93bmVycy5Db3VudCAtZXEgMCkgew0KICAgICAgICAgICAgICAgICAgICAkdW5yZWdpc3RlcmVkU3VjY2Vzc2Z1bGx5ID0gJGZhbHNlDQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICBbSG90a2V5TWFuYWdlcl06OlVucmVnaXN0ZXIoJGlkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgJHVucmVnaXN0ZXJlZFN1Y2Nlc3NmdWxseSA9ICR0cnVlDQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggeyBXcml0ZS1XYXJuaW5nICJGVE9PTDogRmFpbGVkIHRvIHVucmVnaXN0ZXIgT1MgaG90a2V5IElEICRpZCBmb3IgJyRPd25lcktleScuIEVycm9yOiAkXyIgfQ0KDQogICAgICAgICAgICAgICAgICAgIGlmICgkdW5yZWdpc3RlcmVkU3VjY2Vzc2Z1bGx5KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAka3MgPSAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRpZF0uS2V5U3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGtzKSB7ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleUJ5U3RyaW5nLlJlbW92ZSgka3MpIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuUmVtb3ZlKCRpZCkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmICgkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzKSB7DQogICAgICAgICRwYXVzZWRLZXlzID0gQCgkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLktleXMpDQogICAgICAgIGZvcmVhY2ggKCRrIGluICRwYXVzZWRLZXlzKSB7DQogICAgICAgICAgICBpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLkNvbnRhaW5zS2V5KCRrKSkgeyBjb250aW51ZSB9DQogICAgICAgICAgICAkbWV0YSA9ICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXNbJGtdDQogICAgICAgICAgICBpZiAoJG1ldGEgLWFuZCAkbWV0YS5Pd25lcnMgLWFuZCAkbWV0YS5Pd25lcnMuQ29udGFpbnNLZXkoJE93bmVyS2V5KSkgew0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkZUT09MOiBGb3VuZCBhbmQgcmVtb3ZlZCBvd25lciAnJE93bmVyS2V5JyBmcm9tIHBhdXNlZCBob3RrZXkgKGZha2VJZCAkaykuIg0KICAgICAgICAgICAgICAgICRtZXRhLk93bmVycy5SZW1vdmUoJE93bmVyS2V5KQ0KICAgICAgICAgICAgICAgIGlmICgkbWV0YS5Pd25lcnMuQ291bnQgLWVxIDApIHsNCiAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5cy5SZW1vdmUoJGspDQogICAgICAgICAgICAgICAgICAgICRrcyA9ICRtZXRhLktleVN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiAoJGtzIC1hbmQgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmcuQ29udGFpbnNLZXkoJGtzKSAtYW5kICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleUJ5U3RyaW5nWyRrc10gLWVxICRrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlCeVN0cmluZy5SZW1vdmUoJGtzKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIGlmICgkT2xkSG90a2V5SWQgLW5lICRudWxsIC1hbmQgJE9sZEhvdGtleUlkIC1uZSAwKSB7DQogICAgICAgIGlmICgkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzLkNvbnRhaW5zS2V5KCRPbGRIb3RrZXlJZCkpIHsNCiAgICAgICAgICAgICB0cnkgeyBbSG90a2V5TWFuYWdlcl06OlVucmVnaXN0ZXIoJE9sZEhvdGtleUlkKSB9IGNhdGNoIHt9DQogICAgICAgICAgICAgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5SZW1vdmUoJE9sZEhvdGtleUlkKQ0KICAgICAgICB9DQogICAgfQ0KDQoJIyAzLiBQYXJzZSBOZXcgSG90a2V5IFN0cmluZw0KCSRwYXJzZWRSZXN1bHQgPSBQYXJzZUtleVN0cmluZyAkS2V5Q29tYmluYXRpb25TdHJpbmcNCgkkbW9kc0Zyb21QYXJzZSA9IEAoKQ0KCWlmICgkcGFyc2VkUmVzdWx0Lk1vZGlmaWVycykgeyBpZiAoJHBhcnNlZFJlc3VsdC5Nb2RpZmllcnMgLWlzIFtTeXN0ZW0uQXJyYXldKSB7ICRtb2RzRnJvbVBhcnNlID0gJHBhcnNlZFJlc3VsdC5Nb2RpZmllcnMgfSBlbHNlIHsgJG1vZHNGcm9tUGFyc2UgPSBAKCRwYXJzZWRSZXN1bHQuTW9kaWZpZXJzKSB9IH0NCglbU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdF0kcGFyc2VkTW9kaWZpZXJLZXlzID0gQCgpOyBpZiAoJG1vZHNGcm9tUGFyc2UuQ291bnQgLWd0IDApIHsgJHBhcnNlZE1vZGlmaWVyS2V5cy5BZGRSYW5nZSgkbW9kc0Zyb21QYXJzZSkgfQ0KCVtzdHJpbmddJHBhcnNlZFByaW1hcnlLZXkgPSBpZiAoJHBhcnNlZFJlc3VsdC5QcmltYXJ5KSB7IFtzdHJpbmddJHBhcnNlZFJlc3VsdC5QcmltYXJ5IH0gZWxzZSB7ICRudWxsIH0NCg0KICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkcGFyc2VkUHJpbWFyeUtleSkgLWFuZCAkcGFyc2VkTW9kaWZpZXJLZXlzLkNvdW50IC1ndCAwKSB7IHRocm93ICJBIHByaW1hcnkga2V5IGlzIHJlcXVpcmVkLiIgfQ0KICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkcGFyc2VkUHJpbWFyeUtleSkgLWFuZCAkcGFyc2VkTW9kaWZpZXJLZXlzLkNvdW50IC1lcSAwKSB7IHRocm93ICJObyBrZXkgcHJvdmlkZWQuIiB9DQoNCglbdWludDMyXSRtb2QgPSAwDQogICAgaWYoJHBhcnNlZE1vZGlmaWVyS2V5cyl7DQogICAgICAgIGZvcmVhY2ggKCRtS2V5IGluICRwYXJzZWRNb2RpZmllcktleXMpIHsNCiAgICAgICAgICAgIHN3aXRjaCAoJG1LZXkpIHsgJ0FsdCcgeyAkbW9kKz0xIH0gJ0N0cmwnIHsgJG1vZCs9MiB9ICdTaGlmdCcgeyAkbW9kKz00IH0gJ1dpbicgeyAkbW9kKz04IH0gfQ0KICAgICAgICB9DQogICAgfQ0KDQoJJHZrTmFtZUZyb21Ob3JtYWxpemVkID0gaWYgKCRwYXJzZWRSZXN1bHQuTm9ybWFsaXplZCkgeyAoJHBhcnNlZFJlc3VsdC5Ob3JtYWxpemVkIC1zcGxpdCAnXCsnKVstMV0gfSBlbHNlIHsgJG51bGwgfQ0KCSR2aXJ0dWFsS2V5TmFtZSA9IGlmICgtbm90IFtzdHJpbmddOjpJc051bGxPckVtcHR5KCR2a05hbWVGcm9tTm9ybWFsaXplZCkpIHsgJHZrTmFtZUZyb21Ob3JtYWxpemVkIH0gZWxzZSB7ICRwYXJzZWRQcmltYXJ5S2V5IH0NCgkkdmlydHVhbEtleSA9IChHZXQtVmlydHVhbEtleU1hcHBpbmdzKVsoW3N0cmluZ10kdmlydHVhbEtleU5hbWUpLlRvVXBwZXIoKV0NCglpZiAoLW5vdCAkdmlydHVhbEtleSkgeyB0aHJvdyAiSW52YWxpZCBwcmltYXJ5IGtleTogJHZpcnR1YWxLZXlOYW1lIiB9DQoNCgkkY2Fub25pY2FsT3JkZXIgPSBAKCdDdHJsJywnQWx0JywnU2hpZnQnLCdXaW4nKQ0KCSRjYW5vbmljYWxNb2RpZmllcnMgPSBAKCk7IGZvcmVhY2ggKCRtIGluICRjYW5vbmljYWxPcmRlcikgeyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtY29udGFpbnMgJG0pIHsgJGNhbm9uaWNhbE1vZGlmaWVycyArPSAkbSB9IH0NCgkkdmVyYm9zZUtleVN0cmluZyA9IGlmICgkY2Fub25pY2FsTW9kaWZpZXJzLkNvdW50IC1ndCAwKSB7ICIkKCgkY2Fub25pY2FsTW9kaWZpZXJzIC1qb2luICcgKyAnKSkrJHBhcnNlZFByaW1hcnlLZXkiIH0gZWxzZSB7ICRwYXJzZWRQcmltYXJ5S2V5IH0NCgkkbm9ybWFsaXplZEtleVN0cmluZyA9ICR2ZXJib3NlS2V5U3RyaW5nLlRvVXBwZXIoKQ0KDQoJIyA0LiBSZWdpc3RlciBOZXcgSG90a2V5DQogICAgJGFjdGlvblR5cGUgPSBbSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25UeXBlXTo6Tm9ybWFsDQogICAgaWYgKCRPd25lcktleSAtYW5kICRPd25lcktleSAtbGlrZSAiZ2xvYmFsX3RvZ2dsZV8qIikgew0KICAgICAgICAkYWN0aW9uVHlwZSA9IFtIb3RrZXlNYW5hZ2VyK0hvdGtleUFjdGlvblR5cGVdOjpHbG9iYWxUb2dnbGUNCiAgICB9DQoNCiAgICAkaG90a2V5QWN0aW9uRW50cnkgPSBOZXctT2JqZWN0IEhvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uRW50cnkNCiAgICAkaG90a2V5QWN0aW9uRW50cnkuQWN0aW9uRGVsZWdhdGUgPSAkYWN0aW9uRGVsZWdhdGUNCiAgICAkaG90a2V5QWN0aW9uRW50cnkuVHlwZSA9ICRhY3Rpb25UeXBlDQoNCgkkb3duZXJUb2dnbGVPbiA9ICR0cnVlDQoJaWYgKCRPd25lcktleSkgew0KCQkkaW5zdGFuY2VJZCA9ICRPd25lcktleQ0KCQlpZiAoJE93bmVyS2V5IC1saWtlICdleHRfKicpIHsNCgkJCSRwYXJ0cyA9ICRPd25lcktleSAtc3BsaXQgJ18nDQoJCQlpZiAoJHBhcnRzLkNvdW50IC1nZSAyKSB7ICRpbnN0YW5jZUlkID0gJHBhcnRzWzFdIH0NCgkJfQ0KCQl0cnkgew0KCQkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5JbnN0YW5jZUhvdGtleXNQYXVzZWQgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuSW5zdGFuY2VIb3RrZXlzUGF1c2VkLkNvbnRhaW5zKCRpbnN0YW5jZUlkKSkgew0KCQkJCSRvd25lclRvZ2dsZU9uID0gLW5vdCBbYm9vbF0kZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuSW5zdGFuY2VIb3RrZXlzUGF1c2VkWyRpbnN0YW5jZUlkXQ0KCQkJfSBlbHNlIHsNCgkJCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkZ0b29sRm9ybXMgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRnRvb2xGb3Jtcy5Db250YWlucygkaW5zdGFuY2VJZCkpIHsNCgkJCQkJJGZvcm0gPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRnRvb2xGb3Jtc1skaW5zdGFuY2VJZF0NCgkJCQkJaWYgKCRmb3JtIC1hbmQgJGZvcm0uVGFnIC1hbmQgJGZvcm0uVGFnLkJ0bkhvdGtleVRvZ2dsZSkgew0KCQkJCQkJJG93bmVyVG9nZ2xlT24gPSBbYm9vbF0kZm9ybS5UYWcuQnRuSG90a2V5VG9nZ2xlLkNoZWNrZWQNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfSBjYXRjaCB7IH0NCgl9DQoNCglpZiAoLW5vdCAkb3duZXJUb2dnbGVPbikgew0KCQkkZXhpc3RpbmdQYXVzZWRJZCA9ICRudWxsDQoJCWlmICgkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzKSB7DQoJCQlmb3JlYWNoICgkayBpbiAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLktleXMpIHsNCgkJCQl0cnkgew0KCQkJCQlpZiAoJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1ska10uS2V5U3RyaW5nIC1hbmQgJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1ska10uS2V5U3RyaW5nIC1lcSAkbm9ybWFsaXplZEtleVN0cmluZykgew0KCQkJCQkJJGV4aXN0aW5nUGF1c2VkSWQgPSAkaw0KCQkJCQkJYnJlYWsNCgkJCQkJfQ0KCQkJCX0gY2F0Y2gge30NCgkJCX0NCgkJfQ0KCQkNCgkJaWYgKCRleGlzdGluZ1BhdXNlZElkKSB7DQoJCQkkbWV0YVRvVXBkYXRlID0gJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1skZXhpc3RpbmdQYXVzZWRJZF0NCgkJCWlmICgtbm90ICRtZXRhVG9VcGRhdGUuT3duZXJzKSB7ICRtZXRhVG9VcGRhdGUuT3duZXJzID0gQHt9IH0NCgkJCQ0KICAgICAgICAgICAgJHVwZGF0ZWRIb3RrZXlBY3Rpb25FbnRyeSA9IE5ldy1PYmplY3QgSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25FbnRyeQ0KCQkJJHVwZGF0ZWRIb3RrZXlBY3Rpb25FbnRyeS5BY3Rpb25EZWxlZ2F0ZSA9ICRhY3Rpb25EZWxlZ2F0ZQ0KCQkJJHVwZGF0ZWRIb3RrZXlBY3Rpb25FbnRyeS5UeXBlID0gJGFjdGlvblR5cGUNCg0KCQkJJG1ldGFUb1VwZGF0ZS5Pd25lcnNbJE93bmVyS2V5XSA9ICR1cGRhdGVkSG90a2V5QWN0aW9uRW50cnkNCgkJCQ0KCQkJV3JpdGUtVmVyYm9zZSAiRlRPT0w6IFJlZ2lzdGVyZWQgaG90a2V5IChwYXVzZWQsIHVwZGF0ZWQpIGZvciBvd25lciAnJE93bmVyS2V5JyBvbiBrZXkgJyRub3JtYWxpemVkS2V5U3RyaW5nJy4iDQoJCQlyZXR1cm4gJGV4aXN0aW5nUGF1c2VkSWQNCgkJfSBlbHNlIHsNCgkJCWlmICgtbm90ICRnbG9iYWw6TmV4dFBhdXNlZEZha2VJZCkgeyAkZ2xvYmFsOk5leHRQYXVzZWRGYWtlSWQgPSAtMSB9DQoJCQkkZmFrZUlkID0gJGdsb2JhbDpOZXh0UGF1c2VkRmFrZUlkDQoJCQkkZ2xvYmFsOk5leHRQYXVzZWRGYWtlSWQgPSAkZ2xvYmFsOk5leHRQYXVzZWRGYWtlSWQgLSAxDQoJCQkkbWV0YSA9IEB7IE1vZGlmaWVyID0gJG1vZDsgS2V5ID0gJHZpcnR1YWxLZXk7IEtleVN0cmluZyA9ICRub3JtYWxpemVkS2V5U3RyaW5nOyBPd25lcnMgPSBAe307IEFjdGlvbiA9ICRhY3Rpb25EZWxlZ2F0ZTsgQWN0aW9uVHlwZSA9ICRhY3Rpb25UeXBlIH0NCgkJCSRtZXRhLk93bmVyc1skT3duZXJLZXldID0gJGhvdGtleUFjdGlvbkVudHJ5DQoJCQlpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzKSB7ICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMgPSBAe30gfQ0KCQkJJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1skZmFrZUlkXSA9ICRtZXRhDQoJCQkkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlCeVN0cmluZ1skbm9ybWFsaXplZEtleVN0cmluZ10gPSAkZmFrZUlkDQoJCQkkaWQgPSAkZmFrZUlkDQoJCQlXcml0ZS1WZXJib3NlICJGVE9PTDogU3RvcmVkIGhvdGtleSAocGF1c2VkKSBmb3Igb3duZXIgJE93bmVyS2V5IG9uIGtleSAkbm9ybWFsaXplZEtleVN0cmluZy4iDQoJCQlyZXR1cm4gJGlkDQoJCX0NCgl9DQoNCglpZiAoJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmcuQ29udGFpbnNLZXkoJG5vcm1hbGl6ZWRLZXlTdHJpbmcpKSB7DQoJCSRleGlzdGluZ0lkID0gJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmdbJG5vcm1hbGl6ZWRLZXlTdHJpbmddDQoJCWlmICgkT3duZXJLZXkgLWFuZCAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzLkNvbnRhaW5zS2V5KCRleGlzdGluZ0lkKSAtYW5kICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGV4aXN0aW5nSWRdLk93bmVycy5Db250YWluc0tleSgkT3duZXJLZXkpKSB7DQoJCQkkc3RhbGVBY3Rpb24gPSAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRleGlzdGluZ0lkXS5Pd25lcnNbJE93bmVyS2V5XQ0KCQkJdHJ5IHsgW0hvdGtleU1hbmFnZXJdOjpVbnJlZ2lzdGVyQWN0aW9uKCRleGlzdGluZ0lkLCAkc3RhbGVBY3Rpb24uQWN0aW9uRGVsZWdhdGUpIH0gY2F0Y2gge30NCgkJCSRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGV4aXN0aW5nSWRdLk93bmVycy5SZW1vdmUoJE93bmVyS2V5KQ0KCQl9DQoJCXRyeSB7DQoJCQkkaWQgPSBbSG90a2V5TWFuYWdlcl06OlJlZ2lzdGVyKCRtb2QsICR2aXJ0dWFsS2V5LCAkaG90a2V5QWN0aW9uRW50cnkpDQoJCX0gY2F0Y2ggew0KCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byByZWdpc3RlciBob3RrZXkgJCgkS2V5Q29tYmluYXRpb25TdHJpbmcpOiAkXyINCgkJCSRpZCA9ICRudWxsDQoJCQl0aHJvdyANCgkJfQ0KCX0gZWxzZSB7DQoJCXRyeSB7DQoJCQkkaWQgPSBbSG90a2V5TWFuYWdlcl06OlJlZ2lzdGVyKCRtb2QsICR2aXJ0dWFsS2V5LCAkaG90a2V5QWN0aW9uRW50cnkpDQoJCX0gY2F0Y2ggew0KCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byByZWdpc3RlciBob3RrZXkgJCgkS2V5Q29tYmluYXRpb25TdHJpbmcpOiAkXyINCgkJCSRpZCA9ICRudWxsDQoJCQl0aHJvdyANCgkJfQ0KCX0NCg0KCSMgNS4gVXBkYXRlIE1hcHMgLSBIYW5kbGUgcmUtc3luYyBpZiBDIyByZXR1cm5zIGV4aXN0aW5nIElEDQoJaWYgKCRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuQ29udGFpbnNLZXkoJGlkKSkgew0KCQkkZXhpc3RpbmdLZXlTdHJpbmcgPSAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRpZF0uS2V5U3RyaW5nDQoJCWlmICgkZXhpc3RpbmdLZXlTdHJpbmcgLWFuZCAkZXhpc3RpbmdLZXlTdHJpbmcgLW5lICRub3JtYWxpemVkS2V5U3RyaW5nKSB7DQoJCQkkZXJyb3JNc2cgPSAiRlRPT0w6IENSSVRJQ0FMIGhvdGtleSBjb25mbGljdC4gSUQgJGlkLiINCgkJCVdyaXRlLVdhcm5pbmcgJGVycm9yTXNnDQoJCQl0aHJvdyAkZXJyb3JNc2cNCgkJfQ0KCX0NCg0KCWlmICgtbm90ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuQ29udGFpbnNLZXkoJGlkKSkgew0KCQkkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRpZF0gPSBAe01vZGlmaWVyPSRtb2Q7IEtleT0kdmlydHVhbEtleTsgS2V5U3RyaW5nPSRub3JtYWxpemVkS2V5U3RyaW5nOyBPd25lcnMgPSBAe307IEFjdGlvbiA9ICRhY3Rpb25EZWxlZ2F0ZTsgQWN0aW9uVHlwZSA9ICRhY3Rpb25UeXBlfQ0KCX0gZWxzZSB7DQoJCWlmICgtbm90ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXS5LZXlTdHJpbmcpIHsgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skaWRdLktleVN0cmluZyA9ICRub3JtYWxpemVkS2V5U3RyaW5nIH0NCgl9DQoJDQoJaWYgKCRPd25lcktleSkgew0KCQlpZiAoLW5vdCAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRpZF0uT3duZXJzKSB7ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXS5Pd25lcnMgPSBAe30gfQ0KCQkkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRpZF0uT3duZXJzWyRPd25lcktleV0gPSAkaG90a2V5QWN0aW9uRW50cnkNCgl9DQoJJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmdbJG5vcm1hbGl6ZWRLZXlTdHJpbmddID0gJGlkDQoNCgl0cnkgew0KCQlpZiAoJE93bmVyS2V5IC1hbmQgJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5cykgew0KCQkJJHBhdXNlZEtleXMgPSBAKCRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMuS2V5cykNCgkJCWZvcmVhY2ggKCRrIGluICRwYXVzZWRLZXlzKSB7DQoJCQkJaWYgKC1ub3QgJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5cy5Db250YWluc0tleSgkaykpIHsgY29udGludWUgfQ0KCQkJCSRtZXRhID0gJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1ska10NCgkJCQlpZiAoJG1ldGEgLWFuZCAkbWV0YS5LZXlTdHJpbmcgLWFuZCAkbWV0YS5LZXlTdHJpbmcgLWVxICRub3JtYWxpemVkS2V5U3RyaW5nKSB7DQoJCQkJCWlmICgkbWV0YS5Pd25lcnMgLWFuZCAkbWV0YS5Pd25lcnMuQ29udGFpbnNLZXkoJE93bmVyS2V5KSkgew0KCQkJCQkJJG1ldGEuT3duZXJzLlJlbW92ZSgkT3duZXJLZXkpDQoJCQkJCQlpZiAoJG1ldGEuT3duZXJzLkNvdW50IC1lcSAwKSB7DQoJCQkJCQkJJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5cy5SZW1vdmUoJGspDQoJCQkJCQl9DQoJCQkJCQlicmVhayANCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KCX0gY2F0Y2gge30NCg0KCXJldHVybiAkaWQNCn0NCg0KZnVuY3Rpb24gUmVzdW1lLUFsbEhvdGtleXMgew0KCWlmICgtbm90ICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMgLW9yICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMuQ291bnQgLWVxIDApIHsgcmV0dXJuIH0NCglpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZElkTWFwKSB7ICRnbG9iYWw6UGF1c2VkSWRNYXAgPSBAe30gfQ0KDQoJJHBhdXNlZEtleXMgPSBAKCRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMuS2V5cykNCglmb3JlYWNoICgkb2xkSWQgaW4gJHBhdXNlZEtleXMpIHsNCgkJdHJ5IHsNCgkJCSRtZXRhICA9ICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXNbJG9sZElkXQ0KCQkJaWYgKC1ub3QgJG1ldGEpIHsgY29udGludWUgfQ0KDQoJCQkkbW9kICAgID0gJG1ldGEuTW9kaWZpZXINCgkJCSR2ayAgICAgPSAkbWV0YS5LZXkNCgkJCSRrcyAgICAgPSAkbWV0YS5LZXlTdHJpbmcNCgkJCSRvd25lcnMgPSBpZiAoJG1ldGEuT3duZXJzKSB7IEAoJG1ldGEuT3duZXJzLktleXMpIH0gZWxzZSB7IEAoKSB9DQoNCgkJCWlmICgtbm90ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMpIHsgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cyA9IEB7fSB9DQoNCgkJCWZvcmVhY2ggKCRvayBpbiAkb3duZXJzKSB7DQoJCQkJJHNob3VsZFJlc3VtZSA9ICR0cnVlDQoJCQkJdHJ5IHsNCgkJCQkJJGluc3RJZCA9ICRvaw0KCQkJCQlpZiAoJG9rIC1saWtlICdleHRfKicpIHsgJHBhcnRzID0gJG9rIC1zcGxpdCAnXyc7IGlmICgkcGFydHMuQ291bnQgLWdlIDIpIHsgJGluc3RJZCA9ICRwYXJ0c1sxXSB9IH0NCgkJCQkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5JbnN0YW5jZUhvdGtleXNQYXVzZWQgLWFuZCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuSW5zdGFuY2VIb3RrZXlzUGF1c2VkLkNvbnRhaW5zKCRpbnN0SWQpKSB7DQoJCQkJCQlpZiAoW2Jvb2xdJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkluc3RhbmNlSG90a2V5c1BhdXNlZFskaW5zdElkXSkgeyAkc2hvdWxkUmVzdW1lID0gJGZhbHNlIH0NCgkJCQkJfQ0KCQkJCX0gY2F0Y2ggeyB9DQoNCgkJCQlpZiAoLW5vdCAkc2hvdWxkUmVzdW1lKSB7IGNvbnRpbnVlIH0NCg0KCQkJCSRvd25lckFjdCA9ICRtZXRhLk93bmVyc1skb2tdDQoJCQkJaWYgKC1ub3QgJG93bmVyQWN0KSB7IGNvbnRpbnVlIH0NCgkJCQkNCiAgICAgICAgICAgICAgICAjIEZJWDogRXhwbGljaXQgdmFyaWFibGUgY2FwdHVyZSBmb3IgY2xvc3VyZQ0KICAgICAgICAgICAgICAgICRhY3Rpb25Ub1J1biA9ICRvd25lckFjdC5BY3Rpb25EZWxlZ2F0ZQ0KCQkJCSRkZWxlZ2F0ZSA9IFtTeXN0ZW0uQWN0aW9uXSh7IEludm9rZS1GdG9vbEFjdGlvbiAtQWN0aW9uICRhY3Rpb25Ub1J1biB9LkdldE5ld0Nsb3N1cmUoKSkNCg0KCQkJCXRyeSB7DQoJCQkJCSRob3RrZXlBY3Rpb25FbnRyeSA9IE5ldy1PYmplY3QgSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25FbnRyeQ0KCQkJCQkkaG90a2V5QWN0aW9uRW50cnkuQWN0aW9uRGVsZWdhdGUgPSAkZGVsZWdhdGUNCgkJCQkJJGhvdGtleUFjdGlvbkVudHJ5LlR5cGUgPSBpZiAoJG93bmVyQWN0LlR5cGUpIHsgJG93bmVyQWN0LlR5cGUgfSBlbHNlIHsgW0hvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uVHlwZV06Ok5vcm1hbCB9DQoNCgkJCQkJJHJlZ2lzdGVyZWRJZCA9ICRudWxsDQoJCQkJCXRyeSB7DQoJCQkJCQkkcmVnaXN0ZXJlZElkID0gW0hvdGtleU1hbmFnZXJdOjpSZWdpc3RlcigkbW9kLCAkdmssICRob3RrZXlBY3Rpb25FbnRyeSkNCgkJCQkJfSBjYXRjaCB7DQoJCQkJCQlXcml0ZS1XYXJuaW5nICgiRlRPT0w6IFJlc3VtZS1BbGxIb3RrZXlzIGZhaWxlZCBvd25lciAnezB9JzogezF9IiAtZiAkb2ssICRfLkV4Y2VwdGlvbi5NZXNzYWdlKQ0KCQkJCQl9DQoNCgkJCQkJaWYgKC1ub3QgJHJlZ2lzdGVyZWRJZCkgeyBjb250aW51ZSB9DQoJCQkJCQ0KCQkJCQkkZ2xvYmFsOlBhdXNlZElkTWFwWyRvbGRJZF0gPSAkcmVnaXN0ZXJlZElkDQoJCQkJCWlmICgtbm90ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuQ29udGFpbnNLZXkoJHJlZ2lzdGVyZWRJZCkpIHsNCgkJCQkJCSRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJHJlZ2lzdGVyZWRJZF0gPSBAeyBNb2RpZmllciA9ICRtb2Q7IEtleSA9ICR2azsgS2V5U3RyaW5nID0gJGtzOyBPd25lcnMgPSBAe307IEFjdGlvbiA9ICRudWxsOyBBY3Rpb25UeXBlID0gJGhvdGtleUFjdGlvbkVudHJ5LlR5cGUgfQ0KCQkJCQl9DQoJCQkJCSRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJHJlZ2lzdGVyZWRJZF0uT3duZXJzWyRva10gPSAkaG90a2V5QWN0aW9uRW50cnkNCgkJCQkJaWYgKCRrcykgeyAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlCeVN0cmluZ1ska3NdID0gJHJlZ2lzdGVyZWRJZCB9DQoJCQkJCSRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJHJlZ2lzdGVyZWRJZF0uQWN0aW9uVHlwZSA9ICRob3RrZXlBY3Rpb25FbnRyeS5UeXBlIA0KDQoJCQkJCSRtZXRhLk93bmVycy5SZW1vdmUoJG9rKQ0KCQkJCX0gY2F0Y2gge30NCgkJCX0NCg0KCQkJaWYgKC1ub3QgJG1ldGEuT3duZXJzIC1vciAkbWV0YS5Pd25lcnMuQ291bnQgLWVxIDApIHsNCgkJCQkkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLlJlbW92ZSgkb2xkSWQpDQoJCQl9IGVsc2Ugew0KCQkJCSRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXNbJG9sZElkXSA9ICRtZXRhDQoJCQl9DQoJCX0gY2F0Y2gge30NCgl9DQp9DQoNCmZ1bmN0aW9uIFJlc3VtZS1QYXVzZWRLZXlzIHsNCglwYXJhbShbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldW2FycmF5XSRLZXlzKQ0KCWlmICgtbm90ICRLZXlzIC1vciAkS2V5cy5Db3VudCAtZXEgMCkgeyByZXR1cm4gfQ0KCWlmICgtbm90ICRnbG9iYWw6UGF1c2VkSWRNYXApIHsgJGdsb2JhbDpQYXVzZWRJZE1hcCA9IEB7fSB9DQoJaWYgKC1ub3QgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cykgeyAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzID0gQHt9IH0NCg0KCWZvcmVhY2ggKCRvbGRJZCBpbiAkS2V5cykgew0KCQlpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLkNvbnRhaW5zKCRvbGRJZCkpIHsgY29udGludWUgfQ0KCQl0cnkgew0KCQkJJG1ldGEgPSAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzWyRvbGRJZF0NCgkJCWlmICgtbm90ICRtZXRhKSB7IGNvbnRpbnVlIH0NCg0KCQkJJG1vZCA9ICRtZXRhLk1vZGlmaWVyOyAkdmsgPSAkbWV0YS5LZXk7ICRrcyA9ICRtZXRhLktleVN0cmluZw0KCQkJJG93bmVycyA9IGlmICgkbWV0YS5Pd25lcnMpIHsgQCgkbWV0YS5Pd25lcnMuS2V5cykgfSBlbHNlIHsgQCgpIH0NCg0KCQkJZm9yZWFjaCAoJG9rIGluICRvd25lcnMpIHsNCgkJCQkkc2hvdWxkUmVzdW1lID0gJHRydWUNCgkJCQl0cnkgew0KCQkJCQkkaW5zdElkID0gJG9rDQoJCQkJCWlmICgkb2sgLWxpa2UgJ2V4dF8qJykgeyAkcGFydHMgPSAkb2sgLXNwbGl0ICdfJzsgaWYgKCRwYXJ0cy5Db3VudCAtZ2UgMikgeyAkaW5zdElkID0gJHBhcnRzWzFdIH0gfQ0KCQkJCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkluc3RhbmNlSG90a2V5c1BhdXNlZCAtYW5kICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5JbnN0YW5jZUhvdGtleXNQYXVzZWQuQ29udGFpbnMoJGluc3RJZCkpIHsNCgkJCQkJCWlmIChbYm9vbF0kZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuSW5zdGFuY2VIb3RrZXlzUGF1c2VkWyRpbnN0SWRdKSB7ICRzaG91bGRSZXN1bWUgPSAkZmFsc2UgfQ0KCQkJCQl9DQoJCQkJfSBjYXRjaCB7fQ0KDQoJCQkJaWYgKC1ub3QgJHNob3VsZFJlc3VtZSkgeyBjb250aW51ZSB9DQoNCgkJCQkkb3duZXJBY3QgPSAkbWV0YS5Pd25lcnNbJG9rXQ0KCQkJCWlmICgtbm90ICRvd25lckFjdCkgeyBjb250aW51ZSB9DQoJCQkJDQogICAgICAgICAgICAgICAgJGFjdGlvblRvUnVuID0gJG93bmVyQWN0LkFjdGlvbkRlbGVnYXRlDQoJCQkJJGRlbGVnYXRlID0gW1N5c3RlbS5BY3Rpb25dKHsgSW52b2tlLUZ0b29sQWN0aW9uIC1BY3Rpb24gJGFjdGlvblRvUnVuIH0uR2V0TmV3Q2xvc3VyZSgpKQ0KCQkJCQkJCQkNCgkJCQl0cnkgew0KCQkJCQkkaG90a2V5QWN0aW9uRW50cnkgPSBOZXctT2JqZWN0IEhvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uRW50cnkNCgkJCQkJJGhvdGtleUFjdGlvbkVudHJ5LkFjdGlvbkRlbGVnYXRlID0gJGRlbGVnYXRlDQoJCQkJCSRob3RrZXlBY3Rpb25FbnRyeS5UeXBlID0gaWYgKCRtZXRhLkFjdGlvblR5cGUpIHsgJG1ldGEuQWN0aW9uVHlwZSB9IGVsc2UgeyBbSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25UeXBlXTo6Tm9ybWFsIH0NCgkJCQkNCgkJCQkJJHJlZ2lzdGVyZWRJZCA9IFtIb3RrZXlNYW5hZ2VyXTo6UmVnaXN0ZXIoJG1vZCwgJHZrLCAkaG90a2V5QWN0aW9uRW50cnkpDQoJCQkJCSRnbG9iYWw6UGF1c2VkSWRNYXBbJG9sZElkXSA9ICRyZWdpc3RlcmVkSWQNCgkJCQkJaWYgKC1ub3QgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5Db250YWluc0tleSgkcmVnaXN0ZXJlZElkKSkgew0KCQkJCQkJJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skcmVnaXN0ZXJlZElkXSA9IEB7IE1vZGlmaWVyID0gJG1vZDsgS2V5ID0gJHZrOyBLZXlTdHJpbmcgPSAka3M7IE93bmVycyA9IEB7fTsgQWN0aW9uID0gJG51bGw7IEFjdGlvblR5cGUgPSAkaG90a2V5QWN0aW9uRW50cnkuVHlwZSB9DQoJCQkJCX0NCgkJCQkJJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skcmVnaXN0ZXJlZElkXS5Pd25lcnNbJG9rXSA9ICRob3RrZXlBY3Rpb25FbnRyeQ0KCQkJCQkkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRyZWdpc3RlcmVkSWRdLkFjdGlvblR5cGUgPSAkaG90a2V5QWN0aW9uRW50cnkuVHlwZQ0KCQkJCQlpZiAoJGtzKSB7ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleUJ5U3RyaW5nWyRrc10gPSAkcmVnaXN0ZXJlZElkIH0NCgkJCQkJDQoJCQkJCSRtZXRhLk93bmVycy5SZW1vdmUoJG9rKQ0KCQkJCX0gY2F0Y2gge30NCgkJCX0NCg0KCQkJaWYgKC1ub3QgJG1ldGEuT3duZXJzIC1vciAkbWV0YS5Pd25lcnMuQ291bnQgLWVxIDApIHsNCgkJCQkkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLlJlbW92ZSgkb2xkSWQpDQoJCQl9IGVsc2Ugew0KCQkJCSRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXNbJG9sZElkXSA9ICRtZXRhDQoJCQl9DQoJCX0gY2F0Y2gge30NCgl9DQp9DQoNCmZ1bmN0aW9uIFJlc3VtZS1Ib3RrZXlzRm9yT3duZXIgew0KCXBhcmFtKFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV1bc3RyaW5nXSRPd25lcktleSkNCglpZiAoLW5vdCAkT3duZXJLZXkpIHsgcmV0dXJuIH0NCglpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzIC1vciAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLkNvdW50IC1lcSAwKSB7IHJldHVybiB9DQoJaWYgKC1ub3QgJGdsb2JhbDpQYXVzZWRJZE1hcCkgeyAkZ2xvYmFsOlBhdXNlZElkTWFwID0gQHt9IH0NCgkNCgkkaWRzVG9SZXN1bWUgPSBAKCkNCglmb3JlYWNoICgka3ZwIGluICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMuR2V0RW51bWVyYXRvcigpKSB7DQoJCSRvbGRJZCA9ICRrdnAuS2V5DQoJCSRtZXRhID0gJGt2cC5WYWx1ZQ0KCQlpZiAoJG1ldGEuT3duZXJzIC1hbmQgJG1ldGEuT3duZXJzLkNvbnRhaW5zS2V5KCRPd25lcktleSkpIHsNCgkJCSRpZHNUb1Jlc3VtZSArPSAkb2xkSWQNCgkJfQ0KCX0NCg0KCWZvcmVhY2ggKCRvbGRJZCBpbiAkaWRzVG9SZXN1bWUpIHsNCgkJdHJ5IHsNCgkJCSRtZXRhID0gJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1skb2xkSWRdDQoJCQkkbW9kID0gJG1ldGEuTW9kaWZpZXI7ICR2ayA9ICRtZXRhLktleTsgJGtzID0gJG1ldGEuS2V5U3RyaW5nOyAkb3duZXJzID0gJG1ldGEuT3duZXJzDQoNCgkJCWZvcmVhY2ggKCRvayBpbiAkb3duZXJzLktleXMpIHsNCgkJCQkkb3duZXJBY3QgPSAkb3duZXJzWyRva10NCgkJCQlpZiAoLW5vdCAkb3duZXJBY3QpIHsgY29udGludWUgfQ0KDQogICAgICAgICAgICAgICAgaWYgKCRvd25lckFjdCAtaXMgW0hvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uRW50cnldKSB7DQogICAgICAgICAgICAgICAgICAgICRhY3Rpb25Ub1J1biA9ICRvd25lckFjdC5BY3Rpb25EZWxlZ2F0ZQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRhY3Rpb25Ub1J1biA9ICRvd25lckFjdA0KICAgICAgICAgICAgICAgIH0NCgkJCQkkZGVsZWdhdGUgPSBbU3lzdGVtLkFjdGlvbl0oeyBJbnZva2UtRnRvb2xBY3Rpb24gLUFjdGlvbiAkYWN0aW9uVG9SdW4gfS5HZXROZXdDbG9zdXJlKCkpDQoJCQkJDQoJCQkJdHJ5IHsNCgkJCQkJJGhvdGtleUFjdGlvbkVudHJ5ID0gTmV3LU9iamVjdCBIb3RrZXlNYW5hZ2VyK0hvdGtleUFjdGlvbkVudHJ5DQoJCQkJCSRob3RrZXlBY3Rpb25FbnRyeS5BY3Rpb25EZWxlZ2F0ZSA9ICRkZWxlZ2F0ZQ0KCQkJCQkkaG90a2V5QWN0aW9uRW50cnkuVHlwZSA9IGlmICgkbWV0YS5BY3Rpb25UeXBlKSB7ICRtZXRhLkFjdGlvblR5cGUgfSBlbHNlIHsgW0hvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uVHlwZV06Ok5vcm1hbCB9DQoNCgkJCQkJJHJlZ2lzdGVyZWRJZCA9IFtIb3RrZXlNYW5hZ2VyXTo6UmVnaXN0ZXIoJG1vZCwgJHZrLCAkaG90a2V5QWN0aW9uRW50cnkpDQoJCQkJCSRnbG9iYWw6UGF1c2VkSWRNYXBbJG9sZElkXSA9ICRyZWdpc3RlcmVkSWQNCgkJCQkJaWYgKC1ub3QgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5Db250YWluc0tleSgkcmVnaXN0ZXJlZElkKSkgew0KCQkJCQkJJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skcmVnaXN0ZXJlZElkXSA9IEB7TW9kaWZpZXI9JG1vZDsgS2V5PSR2azsgS2V5U3RyaW5nPSRrczsgT3duZXJzID0gQHt9OyBBY3Rpb24gPSAkbnVsbDsgQWN0aW9uVHlwZSA9ICRob3RrZXlBY3Rpb25FbnRyeS5UeXBlIH0NCgkJCQkJfQ0KCQkJCQkkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRyZWdpc3RlcmVkSWRdLk93bmVyc1skb2tdID0gJGhvdGtleUFjdGlvbkVudHJ5DQogICAgICAgICAgICAgICAgICAgICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJHJlZ2lzdGVyZWRJZF0uQWN0aW9uVHlwZSA9ICRob3RrZXlBY3Rpb25FbnRyeS5UeXBlDQoJCQkJCWlmICgka3MpIHsgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmdbJGtzXSA9ICRyZWdpc3RlcmVkSWQgfQ0KCQkJCX0gY2F0Y2gge30NCgkJCX0NCgkJCSRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMuUmVtb3ZlKCRvbGRJZCkNCgkJfSBjYXRjaCB7fQ0KCX0NCn0NCg0KZnVuY3Rpb24gUmVtb3ZlLUFsbEhvdGtleXMgew0KICAgIFtIb3RrZXlNYW5hZ2VyXTo6VW5yZWdpc3RlckFsbCgpDQogICAgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5DbGVhcigpDQoJJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmcuQ2xlYXIoKQ0KICAgIFdyaXRlLVZlcmJvc2UgIkZUT09MOiBBbGwgaG90a2V5cyB1bnJlZ2lzdGVyZWQuIg0KfQ0KDQpmdW5jdGlvbiBUZXN0LUhvdGtleUNvbmZsaWN0IHsNCiAgICBwYXJhbSgNCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUpXQ0KICAgICAgICBbc3RyaW5nXSRLZXlDb21iaW5hdGlvblN0cmluZywNCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUpXQ0KICAgICAgICBbSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25UeXBlXSROZXdIb3RrZXlUeXBlLA0KICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kZmFsc2UpXQ0KICAgICAgICBbc3RyaW5nXSRPd25lcktleVRvRXhjbHVkZQ0KICAgICkNCg0KICAgICRub3JtYWxpemVkS2V5U3RyaW5nID0gKE5vcm1hbGl6ZUtleVN0cmluZyAkS2V5Q29tYmluYXRpb25TdHJpbmcpLlRvVXBwZXIoKQ0KICAgIGlmICgtbm90ICRub3JtYWxpemVkS2V5U3RyaW5nKSB7IHJldHVybiAkZmFsc2UgfQ0KDQogICAgZm9yZWFjaCAoJGlkIGluICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuS2V5cykgew0KICAgICAgICAkbWV0YSA9ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXQ0KICAgICAgICBpZiAoJG1ldGEgLWFuZCAkbWV0YS5LZXlTdHJpbmcgLWVxICRub3JtYWxpemVkS2V5U3RyaW5nKSB7DQogICAgICAgICAgICAkZXhpc3RpbmdIb3RrZXlUeXBlID0gaWYgKCRtZXRhLkFjdGlvblR5cGUpIHsgJG1ldGEuQWN0aW9uVHlwZSB9IGVsc2UgeyBbSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25UeXBlXTo6Tm9ybWFsIH0NCg0KICAgICAgICAgICAgJGlzQ29uZmxpY3QgPSAkZmFsc2UNCiAgICAgICAgICAgIGlmICghKCROZXdIb3RrZXlUeXBlIC1lcSBbSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25UeXBlXTo6Tm9ybWFsIC1hbmQgJGV4aXN0aW5nSG90a2V5VHlwZSAtZXEgW0hvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uVHlwZV06Okdsb2JhbFRvZ2dsZSkpIHsNCiAgICAgICAgICAgICAgICAkaXNDb25mbGljdCA9ICR0cnVlDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICgkaXNDb25mbGljdCkgew0KICAgICAgICAgICAgICAgIGlmICgkT3duZXJLZXlUb0V4Y2x1ZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRtZXRhLk93bmVycy5Db250YWluc0tleSgkT3duZXJLZXlUb0V4Y2x1ZGUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSANCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gJHRydWUNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmICgkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzKSB7DQogICAgICAgIGZvcmVhY2ggKCRpZCBpbiAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLktleXMpIHsNCiAgICAgICAgICAgICRtZXRhID0gJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1skaWRdDQogICAgICAgICAgICBpZiAoJG1ldGEgLWFuZCAkbWV0YS5LZXlTdHJpbmcgLWVxICRub3JtYWxpemVkS2V5U3RyaW5nKSB7DQogICAgICAgICAgICAgICAgJGV4aXN0aW5nSG90a2V5VHlwZSA9IGlmICgkbWV0YS5BY3Rpb25UeXBlKSB7ICRtZXRhLkFjdGlvblR5cGUgfSBlbHNlIHsgW0hvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uVHlwZV06Ok5vcm1hbCB9DQoNCiAgICAgICAgICAgICAgICAkaXNDb25mbGljdCA9ICRmYWxzZQ0KICAgICAgICAgICAgICAgIGlmICghKCROZXdIb3RrZXlUeXBlIC1lcSBbSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25UeXBlXTo6Tm9ybWFsIC1hbmQgJGV4aXN0aW5nSG90a2V5VHlwZSAtZXEgW0hvdGtleU1hbmFnZXIrSG90a2V5QWN0aW9uVHlwZV06Okdsb2JhbFRvZ2dsZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGlzQ29uZmxpY3QgPSAkdHJ1ZQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICgkaXNDb25mbGljdCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJE93bmVyS2V5VG9FeGNsdWRlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG1ldGEuT3duZXJzLkNvbnRhaW5zS2V5KCRPd25lcktleVRvRXhjbHVkZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdHJ1ZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiAkZmFsc2UNCn0NCg0KDQpmdW5jdGlvbiBJbnZva2UtRnRvb2xBY3Rpb24gew0KCXBhcmFtKFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV0kQWN0aW9uKQ0KCXRyeSB7DQoJCWlmICgkQWN0aW9uIC1pcyBbU2NyaXB0QmxvY2tdKSB7IA0KCQkJJiAkQWN0aW9uIA0KCQl9IGVsc2VpZiAoJEFjdGlvbiAtaXMgW1N5c3RlbS5EZWxlZ2F0ZV0gLW9yICRBY3Rpb24gLWlzIFtTeXN0ZW0uQWN0aW9uXSkgeyANCgkJCSRBY3Rpb24uSW52b2tlKCkgDQoJCX0gZWxzZWlmICgkQWN0aW9uIC1pcyBbc3RyaW5nXSkgew0KCQkJJGNtZCA9IEdldC1Db21tYW5kICRBY3Rpb24gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCgkJCWlmICgkY21kKSB7ICYgJGNtZC5OYW1lIH0gZWxzZSB7IEludm9rZS1FeHByZXNzaW9uICRBY3Rpb24gfQ0KCQl9DQoJfSBjYXRjaCB7DQoJCVdyaXRlLVZlcmJvc2UgKCJGVE9PTC1ERUJVRzogSW52b2tlLUZ0b29sQWN0aW9uOiBFeGNlcHRpb24gaW52b2tpbmcgYWN0aW9uOiB7MH0iIC1mICRfLkV4Y2VwdGlvbi5NZXNzYWdlKQ0KCX0NCn0NCg0KZnVuY3Rpb24gUGF1c2VBbGxIb3RrZXlzIHsNCglbSG90a2V5TWFuYWdlcl06OkFyZUhvdGtleXNHbG9iYWxseVBhdXNlZCA9ICR0cnVlDQoJaWYgKC1ub3QgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cyAtb3IgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5Db3VudCAtZXEgMCkgeyByZXR1cm4gfQ0KCQ0KCSRnbG9iYWw6UGF1c2VkSWRNYXAgPSBAe30NCglpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzKSB7ICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMgPSBAe30gfQ0KDQoJJGlkc1RvUHJvY2VzcyA9IEAoJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5LZXlzKQ0KDQoJZm9yZWFjaCAoJGlkIGluICRpZHNUb1Byb2Nlc3MpIHsNCgkJdHJ5IHsNCgkJCSRtZXRhID0gJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skaWRdDQoJCQlpZiAoLW5vdCAkbWV0YSAtb3IgLW5vdCAkbWV0YS5Pd25lcnMpIHsgY29udGludWUgfQ0KDQogICAgICAgICAgICAkb3duZXJzVG9SZW1vdmUgPSBAKCkNCiAgICAgICAgICAgICRvd25lckVudHJpZXNUb1BhdXNlID0gQHt9DQogICAgICAgICAgICAkc2hvdWxkRnVsbHlVbnJlZ2lzdGVyT1NIb3RrZXkgPSAkdHJ1ZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAkb3duZXJLZXlzID0gQCgkbWV0YS5Pd25lcnMuS2V5cykgDQogICAgICAgICAgICBmb3JlYWNoICgkb3duZXJLZXkgaW4gJG93bmVyS2V5cykgew0KICAgICAgICAgICAgICAgICRvd25lckVudHJ5ID0gJG1ldGEuT3duZXJzWyRvd25lcktleV0NCiAgICAgICAgICAgICAgICBpZiAoJG51bGwgLWVxICRvd25lckVudHJ5IC1vciAkbnVsbCAtZXEgJG93bmVyRW50cnkuQWN0aW9uRGVsZWdhdGUpIHsgY29udGludWUgfQ0KDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgW0hvdGtleU1hbmFnZXJdOjpVbnJlZ2lzdGVyQWN0aW9uKCRpZCwgJG93bmVyRW50cnkuQWN0aW9uRGVsZWdhdGUpDQogICAgICAgICAgICAgICAgICAgICRvd25lcnNUb1JlbW92ZSArPSAkb3duZXJLZXkgDQogICAgICAgICAgICAgICAgICAgICRvd25lckVudHJpZXNUb1BhdXNlWyRvd25lcktleV0gPSAkb3duZXJFbnRyeQ0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggew0KICAgICAgICAgICAgICAgICAgICAkc2hvdWxkRnVsbHlVbnJlZ2lzdGVyT1NIb3RrZXkgPSAkZmFsc2UNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZvcmVhY2ggKCRvd25lcktleSBpbiAkb3duZXJzVG9SZW1vdmUpIHsNCiAgICAgICAgICAgICAgICAkbWV0YS5Pd25lcnMuUmVtb3ZlKCRvd25lcktleSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHBhdXNlZE1ldGFGb3JJZCA9IEB7DQogICAgICAgICAgICAgICAgTW9kaWZpZXIgPSAkbWV0YS5Nb2RpZmllcjsNCiAgICAgICAgICAgICAgICBLZXkgPSAkbWV0YS5LZXk7DQogICAgICAgICAgICAgICAgS2V5U3RyaW5nID0gJG1ldGEuS2V5U3RyaW5nOw0KICAgICAgICAgICAgICAgIE93bmVycyA9IEB7fQ0KICAgICAgICAgICAgICAgIEFjdGlvbiA9ICRtZXRhLkFjdGlvbjsNCiAgICAgICAgICAgICAgICBBY3Rpb25UeXBlID0gJG1ldGEuQWN0aW9uVHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKCRvd25lcktleSBpbiAkb3duZXJFbnRyaWVzVG9QYXVzZS5LZXlzKSB7DQogICAgICAgICAgICAgICAgJHBhdXNlZE1ldGFGb3JJZC5Pd25lcnNbJG93bmVyS2V5XSA9ICRvd25lckVudHJpZXNUb1BhdXNlWyRvd25lcktleV0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCRwYXVzZWRNZXRhRm9ySWQuT3duZXJzLkNvdW50IC1ndCAwKSB7DQogICAgICAgICAgICAgICAgJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1skaWRdID0gJHBhdXNlZE1ldGFGb3JJZA0KICAgICAgICAgICAgICAgIGlmICgkbWV0YS5LZXlTdHJpbmcpIHsgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmcuUmVtb3ZlKCRtZXRhLktleVN0cmluZykgfQ0KICAgICAgICAgICAgICAgICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleUJ5U3RyaW5nWyRtZXRhLktleVN0cmluZ10gPSAkaWQNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCRzaG91bGRGdWxseVVucmVnaXN0ZXJPU0hvdGtleSAtYW5kICRtZXRhLk93bmVycy5Db3VudCAtZXEgMCkgew0KICAgICAgICAgICAgICAgIHRyeSB7IFtIb3RrZXlNYW5hZ2VyXTo6VW5yZWdpc3RlcigkaWQpIH0gY2F0Y2gge30NCiAgICAgICAgICAgICAgICAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzLlJlbW92ZSgkaWQpDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXSA9ICRtZXRhDQogICAgICAgICAgICB9DQoNCgkJfSBjYXRjaCB7fQ0KCX0NCn0NCg0KZnVuY3Rpb24gUGF1c2VIb3RrZXlzRm9yT3duZXIgew0KCXBhcmFtKFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV1bc3RyaW5nXSRPd25lcktleSkNCglpZiAoLW5vdCAkT3duZXJLZXkpIHsgcmV0dXJuIH0NCglpZiAoLW5vdCAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzIC1vciAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzLkNvdW50IC1lcSAwKSB7IHJldHVybiB9DQoJaWYgKC1ub3QgJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5cykgeyAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzID0gQHt9IH0NCglpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZElkTWFwKSB7ICRnbG9iYWw6UGF1c2VkSWRNYXAgPSBAe30gfQ0KDQoJJGlkc1RvUHJvY2VzcyA9IEAoKQ0KCWZvcmVhY2ggKCRrdnAgaW4gJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5HZXRFbnVtZXJhdG9yKCkpIHsNCgkJJGlkID0gJGt2cC5LZXkNCgkJJG1ldGEgPSAka3ZwLlZhbHVlDQoJCWlmICgkbWV0YS5Pd25lcnMgLWFuZCAkbWV0YS5Pd25lcnMuQ29udGFpbnNLZXkoJE93bmVyS2V5KSkgew0KCQkJJGlkc1RvUHJvY2VzcyArPSAkaWQNCgkJfQ0KCX0NCg0KCWZvcmVhY2ggKCRpZCBpbiAkaWRzVG9Qcm9jZXNzKSB7DQoJCXRyeSB7DQoJCQkkbWV0YSA9ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXQ0KCQkJJGtzID0gJG51bGwNCgkJCXRyeSB7ICRrcyA9ICRtZXRhLktleVN0cmluZyB9IGNhdGNoIHt9DQoNCgkJCSRvd25lckVudHJ5ID0gJG51bGwNCgkJCXRyeSB7ICRvd25lckVudHJ5ID0gJG1ldGEuT3duZXJzWyRPd25lcktleV0gfSBjYXRjaCB7fQ0KDQoJCQlpZiAoJG51bGwgLWVxICRvd25lckVudHJ5IC1vciAkbnVsbCAtZXEgJG93bmVyRW50cnkuQWN0aW9uRGVsZWdhdGUpIHsNCgkJCQljb250aW51ZQ0KCQkJfQ0KDQoJCQlpZiAoLW5vdCAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzKSB7ICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMgPSBAe30gfQ0KCQkJaWYgKC1ub3QgJGdsb2JhbDpOZXh0UGF1c2VkRmFrZUlkKSB7ICRnbG9iYWw6TmV4dFBhdXNlZEZha2VJZCA9IC0xIH0NCg0KCQkJJHVucmVnaXN0ZXJBY3Rpb25NZXRob2QgPSAkbnVsbA0KCQkJdHJ5IHsgJHVucmVnaXN0ZXJBY3Rpb25NZXRob2QgPSBbSG90a2V5TWFuYWdlcl0uR2V0TWV0aG9kKCdVbnJlZ2lzdGVyQWN0aW9uJykgfSBjYXRjaCB7fQ0KCQkJaWYgKCR1bnJlZ2lzdGVyQWN0aW9uTWV0aG9kKSB7DQoJCQkJCXRyeSB7DQoJCQkJCQlbSG90a2V5TWFuYWdlcl06OlVucmVnaXN0ZXJBY3Rpb24oJGlkLCAkb3duZXJFbnRyeS5BY3Rpb25EZWxlZ2F0ZSkNCg0KCQkJCQkJaWYgKCRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuQ29udGFpbnNLZXkoJGlkKSAtYW5kICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXS5Pd25lcnMuQ29udGFpbnNLZXkoJE93bmVyS2V5KSkgew0KCQkJCQkJCSRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJGlkXS5Pd25lcnMuUmVtb3ZlKCRPd25lcktleSkNCgkJCQkJCX0NCg0KCQkJCQkJJGZha2VJZCA9ICRnbG9iYWw6TmV4dFBhdXNlZEZha2VJZDsgJGdsb2JhbDpOZXh0UGF1c2VkRmFrZUlkID0gJGdsb2JhbDpOZXh0UGF1c2VkRmFrZUlkIC0gMQ0KCQkJCQkJJHBhdXNlZE1ldGEgPSBAeyBNb2RpZmllciA9ICRtZXRhLk1vZGlmaWVyOyBLZXkgPSAkbWV0YS5LZXk7IEtleVN0cmluZyA9ICRrczsgT3duZXJzID0gQHt9OyBBY3Rpb24gPSAkb3duZXJFbnRyeS5BY3Rpb25EZWxlZ2F0ZTsgQWN0aW9uVHlwZSA9ICRvd25lckVudHJ5LlR5cGUgfSAjIFN0b3JlIEFjdGlvbkRlbGVnYXRlIGFuZCBUeXBlDQoJCQkJCQkkcGF1c2VkTWV0YS5Pd25lcnNbJE93bmVyS2V5XSA9ICRvd25lckVudHJ5DQoJCQkJCQkkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzWyRmYWtlSWRdID0gJHBhdXNlZE1ldGENCgkJCQkJCWlmICgka3MpIHsgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmcuUmVtb3ZlKCRrcykgfQ0KCQkJCQkJJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5QnlTdHJpbmdbJGtzXSA9ICRmYWtlSWQNCgkJCQkJCWNvbnRpbnVlDQoJCQkJCX0gY2F0Y2gge30NCgkJCX0NCg0KCQkJJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5c1skaWRdID0gJG1ldGENCgkJICAgIHRyeSB7IFtIb3RrZXlNYW5hZ2VyXTo6VW5yZWdpc3RlcigkaWQpIH0gY2F0Y2ggeyB9DQoJCSAgICB0cnkgeyBpZiAoJGtzKSB7ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleUJ5U3RyaW5nLlJlbW92ZSgka3MpIH0gfSBjYXRjaCB7fQ0KCQkgICAgdHJ5IHsgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5SZW1vdmUoJGlkKSB9IGNhdGNoIHt9DQoJCX0gY2F0Y2gge30NCgl9fQ0KDQpmdW5jdGlvbiBVbnJlZ2lzdGVyLUhvdGtleUluc3RhbmNlIHsNCglwYXJhbSgNCgkJW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUpXVtpbnRdJElkLA0KCQlbUGFyYW1ldGVyKE1hbmRhdG9yeT0kZmFsc2UpXVtzdHJpbmddJE93bmVyS2V5DQoJKQ0KCWlmICgtbm90ICRJZCkgeyByZXR1cm4gfQ0KCXRyeSB7DQoJCSRkaWRVbnJlZ2lzdGVyID0gJGZhbHNlDQoJCSR0cmFuc2xhdGVUYXJnZXQgPSAkbnVsbA0KCQlpZiAoJGdsb2JhbDpQYXVzZWRJZE1hcCAtYW5kICRnbG9iYWw6UGF1c2VkSWRNYXAuQ29udGFpbnNLZXkoJElkKSkgew0KCQkJJHRyYW5zbGF0ZVRhcmdldCA9ICRnbG9iYWw6UGF1c2VkSWRNYXBbJElkXQ0KCQl9DQoJCWlmICgkdHJhbnNsYXRlVGFyZ2V0KSB7ICRJZFRvVXNlID0gJHRyYW5zbGF0ZVRhcmdldCB9IGVsc2UgeyAkSWRUb1VzZSA9ICRJZCB9DQoJCQ0KCQlpZiAoLW5vdCAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzLkNvbnRhaW5zS2V5KCRJZFRvVXNlKSAtYW5kICRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMgLWFuZCAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLkNvbnRhaW5zS2V5KCRJZFRvVXNlKSkgew0KCQkJJHBhdXNlZE1ldGEgPSAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzWyRJZFRvVXNlXQ0KCQkJaWYgKCRPd25lcktleSAtYW5kICRwYXVzZWRNZXRhLk93bmVycyAtYW5kICRwYXVzZWRNZXRhLk93bmVycy5Db250YWluc0tleSgkT3duZXJLZXkpKSB7DQoJCQkJJHBhdXNlZE1ldGEuT3duZXJzLlJlbW92ZSgkT3duZXJLZXkpDQoJCQkJaWYgKCRwYXVzZWRNZXRhLk93bmVycy5Db3VudCAtZXEgMCkgeyAkZ2xvYmFsOlBhdXNlZFJlZ2lzdGVyZWRIb3RrZXlzLlJlbW92ZSgkSWRUb1VzZSk7IH0NCgkJCQkkZGlkVW5yZWdpc3RlciA9ICR0cnVlDQoJCQl9IGVsc2Ugew0KCQkJCSRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMuUmVtb3ZlKCRJZFRvVXNlKQ0KCQkJCSRkaWRVbnJlZ2lzdGVyID0gJHRydWUNCgkJCX0NCgkJfQ0KICAgICAgICBpZiAoJE93bmVyS2V5IC1hbmQgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5Db250YWluc0tleSgkSWQpIC1hbmQgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skSWRdLk93bmVycy5Db250YWluc0tleSgkT3duZXJLZXkpKSB7DQogICAgICAgICAgICAkb3duZXJFbnRyeSA9ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJElkXS5Pd25lcnNbJE93bmVyS2V5XQ0KICAgICAgICAgICAgJHVucmVnaXN0ZXJNZXRob2QgPSAkbnVsbA0KICAgICAgICAgICAgdHJ5IHsgJHVucmVnaXN0ZXJNZXRob2QgPSBbSG90a2V5TWFuYWdlcl0uR2V0TWV0aG9kKCdVbnJlZ2lzdGVyQWN0aW9uJykgfSBjYXRjaCB7fQ0KICAgICAgICAgICAgaWYgKCR1bnJlZ2lzdGVyTWV0aG9kKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgW0hvdGtleU1hbmFnZXJdOjpVbnJlZ2lzdGVyQWN0aW9uKCRJZCwgJG93bmVyRW50cnkuQWN0aW9uRGVsZWdhdGUpIA0KICAgICAgICAgICAgICAgICAgICAkZGlkVW5yZWdpc3RlciA9ICR0cnVlDQogICAgICAgICAgICAgICAgfSBjYXRjaCB7DQogICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkZUT09MOiBVbnJlZ2lzdGVyQWN0aW9uIGZhaWxlZC4gRmFsbGJhY2suIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gDQogICAgICAgICAgICBpZiAoJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5Db250YWluc0tleSgkSWQpIC1hbmQgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skSWRdLk93bmVycy5Db250YWluc0tleSgkT3duZXJLZXkpKSB7DQogICAgICAgICAgICAgICAgJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5c1skSWRdLk93bmVycy5SZW1vdmUoJE93bmVyS2V5KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuQ29udGFpbnNLZXkoJElkKSAtYW5kICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXNbJElkXS5Pd25lcnMuQ291bnQgLWVxIDApIHsNCgkJCQkka3MgPSAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRJZF0uS2V5U3RyaW5nDQoJCQkJaWYgKCRrcykgeyAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlCeVN0cmluZy5SZW1vdmUoJGtzKSB9DQoJCQkJJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5SZW1vdmUoJElkKQ0KCQkJfQ0KCQl9DQoJCWlmICgtbm90ICRkaWRVbnJlZ2lzdGVyKSB7DQoJCQlpZiAoJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5Db250YWluc0tleSgkSWQpKSB7DQogICAgICAgICAgICAgICAgJHVucmVnaXN0ZXJlZFN1Y2Nlc3NmdWxseSA9ICRmYWxzZQ0KCQkJCXRyeSB7DQoJCQkJCVtIb3RrZXlNYW5hZ2VyXTo6VW5yZWdpc3RlcigkSWQpDQogICAgICAgICAgICAgICAgICAgICR1bnJlZ2lzdGVyZWRTdWNjZXNzZnVsbHkgPSAkdHJ1ZQ0KCQkJCX0gY2F0Y2gge30NCgkJCQkNCiAgICAgICAgICAgICAgICBpZiAoJHVucmVnaXN0ZXJlZFN1Y2Nlc3NmdWxseSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJGdsb2JhbDpSZWdpc3RlcmVkSG90a2V5cy5Db250YWluc0tleSgkSWQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAka3MgPSAkZ2xvYmFsOlJlZ2lzdGVyZWRIb3RrZXlzWyRJZF0uS2V5U3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGtzKSB7ICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleUJ5U3RyaW5nLlJlbW92ZSgka3MpIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICRnbG9iYWw6UmVnaXN0ZXJlZEhvdGtleXMuUmVtb3ZlKCRJZCkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCgkJCX0NCgkJfQ0KCX0gY2F0Y2ggew0KCQlXcml0ZS1XYXJuaW5nICJGVE9PTDogRmFpbGVkIHRvIHVucmVnaXN0ZXIgaG90a2V5IElEICRJZC4gRXJyb3I6ICRfIg0KCX0NCn0NCg0KDQpmdW5jdGlvbiBUb2dnbGVTcGVjaWZpY0Z0b29sSW5zdGFuY2Ugew0KICAgIHBhcmFtKA0KICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldDQogICAgICAgIFtzdHJpbmddJEluc3RhbmNlSWQsDQogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRmYWxzZSldDQogICAgICAgIFtzdHJpbmddJEV4dEtleQ0KICAgICkNCg0KICAgIGlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5GdG9vbEZvcm1zLkNvbnRhaW5zKCRJbnN0YW5jZUlkKSkgew0KICAgICAgICByZXR1cm4NCiAgICB9DQoNCiAgICAkZm9ybSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5GdG9vbEZvcm1zWyRJbnN0YW5jZUlkXQ0KICAgIGlmICgkZm9ybSAtYW5kIC1ub3QgJGZvcm0uSXNEaXNwb3NlZCkgew0KICAgICAgICAkZm9ybURhdGEgPSAkZm9ybS5UYWcNCg0KICAgICAgICBpZiAoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkRXh0S2V5KSkgew0KICAgICAgICAgICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhLkNvbnRhaW5zKCRFeHRLZXkpKSB7DQogICAgICAgICAgICAgICAgJGV4dERhdGEgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YVskRXh0S2V5XQ0KICAgICAgICAgICAgICAgIGlmICgkZXh0RGF0YS5SdW5uaW5nU3BhbW1lcikgew0KICAgICAgICAgICAgICAgICAgICAkZXh0RGF0YS5CdG5TdG9wLlBlcmZvcm1DbGljaygpDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJGV4dERhdGEuQnRuU3RhcnQuUGVyZm9ybUNsaWNrKCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoJGZvcm1EYXRhLlJ1bm5pbmdTcGFtbWVyKSB7DQogICAgICAgICAgICAgICAgJGZvcm1EYXRhLkJ0blN0b3AuUGVyZm9ybUNsaWNrKCkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGZvcm1EYXRhLkJ0blN0YXJ0LlBlcmZvcm1DbGljaygpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gVG9nZ2xlSW5zdGFuY2VIb3RrZXlzDQp7DQogICAgcGFyYW0oDQogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV0NCiAgICAgICAgW3N0cmluZ10kSW5zdGFuY2VJZCwNCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUpXQ0KICAgICAgICBbYm9vbF0kVG9nZ2xlU3RhdGUNCiAgICApDQogICAgDQogICAgaWYgKC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkluc3RhbmNlSG90a2V5c1BhdXNlZCkgeyAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuSW5zdGFuY2VIb3RrZXlzUGF1c2VkID0gQHt9IH0NCiAgICANCiAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuSW5zdGFuY2VIb3RrZXlzUGF1c2VkWyRJbnN0YW5jZUlkXSA9ICgtbm90ICRUb2dnbGVTdGF0ZSkNCg0KICAgIHRyeSB7DQogICAgICAgIGlmICgkVG9nZ2xlU3RhdGUpIHsNCiAgICAgICAgICAgIHRyeSB7IFJlc3VtZS1Ib3RrZXlzRm9yT3duZXIgLU93bmVyS2V5ICRJbnN0YW5jZUlkIH0gY2F0Y2gge30NCiAgICAgICAgICAgIGlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YSkgew0KICAgICAgICAgICAgICAgICRleHRLZXlzID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvbkRhdGEuS2V5cyB8IFdoZXJlLU9iamVjdCB7ICRfIC1saWtlICJleHRfJHtJbnN0YW5jZUlkfV8qIiB9DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGV4dEtleSBpbiAkZXh0S2V5cykgew0KICAgICAgICAgICAgICAgICAgICB0cnkgeyBSZXN1bWUtSG90a2V5c0Zvck93bmVyIC1Pd25lcktleSAkZXh0S2V5IH0gY2F0Y2gge30NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0cnkgeyBQYXVzZUhvdGtleXNGb3JPd25lciAtT3duZXJLZXkgJEluc3RhbmNlSWQgfSBjYXRjaCB7fQ0KICAgICAgICAgICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhKSB7DQogICAgICAgICAgICAgICAgJGV4dEtleXMgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5LZXlzIHwgV2hlcmUtT2JqZWN0IHsgJF8gLWxpa2UgImV4dF8ke0luc3RhbmNlSWR9XyoiIH0NCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZXh0S2V5IGluICRleHRLZXlzKSB7DQogICAgICAgICAgICAgICAgICAgIHRyeSB7IFBhdXNlSG90a2V5c0Zvck93bmVyIC1Pd25lcktleSAkZXh0S2V5IH0gY2F0Y2gge30NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9IGNhdGNoIHt9DQoNCglpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkZ0b29sRm9ybXMuQ29udGFpbnMoJEluc3RhbmNlSWQpKSB7DQoJCSRmb3JtID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkZ0b29sRm9ybXNbJEluc3RhbmNlSWRdDQoJCWlmICgkZm9ybSAtYW5kIC1ub3QgJGZvcm0uSXNEaXNwb3NlZCkgew0KCQkJVXBkYXRlU2V0dGluZ3MgLWZvcm1EYXRhICRmb3JtLlRhZyAtZm9yY2VXcml0ZQ0KCQl9DQoJfQ0KfQ0KDQoNCiNlbmRyZWdpb24NCg0KI3JlZ2lvbiBIZWxwZXIgRnVuY3Rpb25zDQoNCmZ1bmN0aW9uIEdldC1WaXJ0dWFsS2V5TWFwcGluZ3MNCnsNCglyZXR1cm4gQHsNCgkJJ0YxJyA9IDB4NzA7ICdGMicgPSAweDcxOyAnRjMnID0gMHg3MjsgJ0Y0JyA9IDB4NzM7ICdGNScgPSAweDc0OyAnRjYnID0gMHg3NQ0KCQknRjcnID0gMHg3NjsgJ0Y4JyA9IDB4Nzc7ICdGOScgPSAweDc4OyAnRjEwJyA9IDB4Nzk7ICdGMTEnID0gMHg3QTsgJ0YxMicgPSAweDdCDQoJCSdGMTMnID0gMHg3QzsgJ0YxNCcgPSAweDdEOyAnRjE1JyA9IDB4N0U7ICdGMTYnID0gMHg3RjsgJ0YxNycgPSAweDgwOyAnRjE4JyA9IDB4ODENCgkJJ0YxOScgPSAweDgyOyAnRjIwJyA9IDB4ODM7ICdGMjEnID0gMHg4NDsgJ0YyMicgPSAweDg1OyAnRjIzJyA9IDB4ODY7ICdGMjQnID0gMHg4Nw0KDQoJCScwJyA9IDB4MzA7ICcxJyA9IDB4MzE7ICcyJyA9IDB4MzI7ICczJyA9IDB4MzM7ICc0JyA9IDB4MzQNCgkJJzUnID0gMHgzNTsgJzYnID0gMHgzNjsgJzcnID0gMHgzNzsgJzgnID0gMHgzODsgJzknID0gMHgzOQ0KDQoJCSdBJyA9IDB4NDE7ICdCJyA9IDB4NDI7ICdDJyA9IDB4NDM7ICdEJyA9IDB4NDQ7ICdFJyA9IDB4NDU7ICdGJyA9IDB4NDY7ICdHJyA9IDB4NDc7ICdIJyA9IDB4NDgNCgkJJ0knID0gMHg0OTsgJ0onID0gMHg0QTsgJ0snID0gMHg0QjsgJ0wnID0gMHg0QzsgJ00nID0gMHg0RDsgJ04nID0gMHg0RTsgJ08nID0gMHg0RjsgJ1AnID0gMHg1MA0KCQknUScgPSAweDUxOyAnUicgPSAweDUyOyAnUycgPSAweDUzOyAnVCcgPSAweDU0OyAnVScgPSAweDU1OyAnVicgPSAweDU2OyAnVycgPSAweDU3OyAnWCcgPSAweDU4DQoJCSdZJyA9IDB4NTk7ICdaJyA9IDB4NUENCg0KCQknU1BBQ0UnID0gMHgyMDsgJ0VOVEVSJyA9IDB4MEQ7ICdUQUInID0gMHgwOTsgJ0VTQ0FQRScgPSAweDFCOyAnU0hJRlQnID0gMHgxMDsgJ0NPTlRST0wnID0gMHgxMTsgJ0FMVCcgPSAweDEyDQoJCSdVUF9BUlJPVycgPSAweDI2OyAnRE9XTl9BUlJPVycgPSAweDI4OyAnTEVGVF9BUlJPVycgPSAweDI1OyAnUklHSFRfQVJST1cnID0gMHgyNzsgJ0hPTUUnID0gMHgyNDsgJ0VORCcgPSAweDIzDQoJCSdQQUdFX1VQJyA9IDB4MjE7ICdQQUdFX0RPV04nID0gMHgyMjsgJ0lOU0VSVCcgPSAweDJEOyAnREVMRVRFJyA9IDB4MkU7ICdCQUNLU1BBQ0UnID0gMHgwOA0KDQoJCSdDQVBTX0xPQ0snID0gMHgxNDsgJ05VTV9MT0NLJyA9IDB4OTA7ICdTQ1JPTExfTE9DSycgPSAweDkxOyAnUFJJTlRfU0NSRUVOJyA9IDB4MkM7ICdQQVVTRV9CUkVBSycgPSAweDEzDQoJCSdMRUZUX1dJTkRPV1MnID0gMHg1QjsgJ1JJR0hUX1dJTkRPV1MnID0gMHg1QzsgJ0FQUExJQ0FUSU9OJyA9IDB4NUQ7ICdMRUZUX1NISUZUJyA9IDB4QTA7ICdSSUdIVF9TSElGVCcgPSAweEExDQoJCSdMRUZUX0NPTlRST0wnID0gMHhBMjsgJ1JJR0hUX0NPTlRST0wnID0gMHhBMzsgJ0xFRlRfQUxUJyA9IDB4QTQ7ICdSSUdIVF9BTFQnID0gMHhBNTsgJ1NMRUVQJyA9IDB4NUYNCg0KCQknTlVNUEFEXzAnID0gMHg2MDsgJ05VTVBBRF8xJyA9IDB4NjE7ICdOVU1QQURfMicgPSAweDYyOyAnTlVNUEFEXzMnID0gMHg2MzsgJ05VTVBBRF80JyA9IDB4NjQNCgkJJ05VTVBBRF81JyA9IDB4NjU7ICdOVU1QQURfNicgPSAweDY2OyAnTlVNUEFEXzcnID0gMHg2NzsgJ05VTVBBRF84JyA9IDB4Njg7ICdOVU1QQURfOScgPSAweDY5DQoJCSdOVU1QQURfTVVMVElQTFknID0gMHg2QTsgJ05VTVBBRF9BREQnID0gMHg2QjsgJ05VTVBBRF9TRVBBUkFUT1InID0gMHg2QzsgJ05VTVBBRF9TVUJUUkFDVCcgPSAweDZEOyAnTlVNUEFEX0RFQ0lNQUwnID0gMHg2RTsgJ05VTVBBRF9ESVZJREUnID0gMHg2Rg0KDQoJCSdTRU1JQ09MT04nID0gMHhCQTsgJ0VRVUFMUycgPSAweEJCOyAnQ09NTUEnID0gMHhCQzsgJ01JTlVTJyA9IDB4QkQ7ICdQRVJJT0QnID0gMHhCRQ0KCQknRk9SV0FSRF9TTEFTSCcgPSAweEJGOyAnQkFDS1RJQ0snID0gMHhDMDsgJ0xFRlRfQlJBQ0tFVCcgPSAweERCOyAnQkFDS1NMQVNIJyA9IDB4REM7ICdSSUdIVF9CUkFDS0VUJyA9IDB4REQNCgkJJ0FQT1NUUk9QSEUnID0gMHhERQ0KDQoJCSdCUk9XU0VSX0JBQ0snID0gMHhBNjsgJ0JST1dTRVJfRk9SV0FSRCcgPSAweEE3OyAnQlJPV1NFUl9SRUZSRVNIJyA9IDB4QTg7ICdCUk9XU0VSX1NUT1AnID0gMHhBOQ0KCQknQlJPV1NFUl9TRUFSQ0gnID0gMHhBQTsgJ0JST1dTRVJfRkFWT1JJVEVTJyA9IDB4QUI7ICdCUk9XU0VSX0hPTUUnID0gMHhBQzsgJ1ZPTFVNRV9NVVRFJyA9IDB4QUQNCgkJJ1ZPTFVNRV9ET1dOJyA9IDB4QUU7ICdWT0xVTUVfVVAnID0gMHhBRjsgJ01FRElBX05FWFRfVFJBQ0snID0gMHhCMDsgJ01FRElBX1BSRVZJT1VTX1RSQUNLJyA9IDB4QjENCgkJJ01FRElBX1NUT1AnID0gMHhCMjsgJ01FRElBX1BMQVlfUEFVU0UnID0gMHhCMzsgJ0xBVU5DSF9NQUlMJyA9IDB4QjQ7ICdMQVVOQ0hfTUVESUFfUExBWUVSJyA9IDB4QjUNCgkJJ0xBVU5DSF9NWV9DT01QVVRFUicgPSAweEI2OyAnTEFVTkNIX0NBTENVTEFUT1InID0gMHhCNw0KDQoJCSdJTUVfS0FOQV9IQU5HVUwnID0gMHgxNTsgJ0lNRV9KVU5KQScgPSAweDE3OyAnSU1FX0ZJTkFMJyA9IDB4MTg7ICdJTUVfSEFOSkFfS0FOSkknID0gMHgxOQ0KCQknSU1FX0NPTlZFUlQnID0gMHgxQzsgJ0lNRV9OT05DT05WRVJUJyA9IDB4MUQ7ICdJTUVfQUNDRVBUJyA9IDB4MUU7ICdJTUVfTU9ERV9DSEFOR0UnID0gMHgxRjsgJ0lNRV9QUk9DRVNTJyA9IDB4RTUNCgkJJ1NFTEVDVCcgPSAweDI5OyAnUFJJTlQnID0gMHgyQTsgJ0VYRUNVVEUnID0gMHgyQjsgJ0hFTFAnID0gMHgyRjsgJ0NMRUFSJyA9IDB4MEMNCgkJJ0FUVE4nID0gMHhGNjsgJ0NSU0VMJyA9IDB4Rjc7ICdFWFNFTCcgPSAweEY4OyAnRVJBU0VfRU9GJyA9IDB4Rjk7ICdQTEFZJyA9IDB4RkE7ICdaT09NJyA9IDB4RkINCgkJJ1BBMScgPSAweEZEOyAnT0VNX0NMRUFSJyA9IDB4RkUNCgl9DQp9DQoNCmZ1bmN0aW9uIE5vcm1hbGl6ZUtleVN0cmluZyB7DQoJcGFyYW0oDQoJCVtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV1bc3RyaW5nXSRLZXlDb21iaW5hdGlvblN0cmluZw0KCSkNCg0KCWlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkS2V5Q29tYmluYXRpb25TdHJpbmcpKSB7IHJldHVybiAkbnVsbCB9DQoJJHBhcnRzID0gQCgkS2V5Q29tYmluYXRpb25TdHJpbmcgLXNwbGl0ICdccypcK1xzKicgfCBGb3JFYWNoLU9iamVjdCB7ICRfLlRyaW0oKSB9IHwgV2hlcmUtT2JqZWN0IHsgJF8gLW5lICcnIH0pDQoJDQoJJHBhcnNlZE1vZGlmaWVyS2V5cyA9IEAoKQ0KCSRwYXJzZWRQcmltYXJ5S2V5ID0gJG51bGwNCglmb3JlYWNoICgkcGFydCBpbiAkcGFydHMpIHsNCgkJc3dpdGNoICgkcGFydC5Ub1VwcGVyKCkpIHsNCgkJCSdBTFQnICAgeyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0FsdCcpIHsgJHBhcnNlZE1vZGlmaWVyS2V5cyArPSAnQWx0JyB9IH0NCgkJCSdNRU5VJyAgeyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0FsdCcpIHsgJHBhcnNlZE1vZGlmaWVyS2V5cyArPSAnQWx0JyB9IH0NCgkJCSdMQUxUJyAgeyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0FsdCcpIHsgJHBhcnNlZE1vZGlmaWVyS2V5cyArPSAnQWx0JyB9IH0NCgkJCSdSQUxUJyAgeyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0FsdCcpIHsgJHBhcnNlZE1vZGlmaWVyS2V5cyArPSAnQWx0JyB9IH0NCgkJCSdMRUZUX0FMVCcgIHsgaWYgKCRwYXJzZWRNb2RpZmllcktleXMgLW5vdGNvbnRhaW5zICdBbHQnKSB7ICRwYXJzZWRNb2RpZmllcktleXMgKz0gJ0FsdCcgfSB9DQoJCQknUklHSFRfQUxUJyB7IGlmICgkcGFyc2VkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnQWx0JykgeyAkcGFyc2VkTW9kaWZpZXJLZXlzICs9ICdBbHQnIH0gfQ0KCQkJJ0NUUkwnICB7IGlmICgkcGFyc2VkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnQ3RybCcpIHsgJHBhcnNlZE1vZGlmaWVyS2V5cyArPSAnQ3RybCcgfSB9DQoJCQknQ09OVFJPTCd7IGlmICgkcGFyc2VkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnQ3RybCcpIHsgJHBhcnNlZE1vZGlmaWVyS2V5cyArPSAnQ3RybCcgfSB9DQoJCQknTENUUkwnIHsgaWYgKCRwYXJzZWRNb2RpZmllcktleXMgLW5vdGNvbnRhaW5zICdDdHJsJykgeyAkcGFyc2VkTW9kaWZpZXJLZXlzICs9ICdDdHJsJyB9IH0NCgkJCSdSQ1RSTCcgeyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0N0cmwnKSB7ICRwYXJzZWRNb2RpZmllcktleXMgKz0gJ0N0cmwnIH0gfQ0KCQkJJ0xFRlRfQ09OVFJPTCcgeyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0N0cmwnKSB7ICRwYXJzZWRNb2RpZmllcktleXMgKz0gJ0N0cmwnIH0gfQ0KCQkJJ1JJR0hUX0NPTlRST0wneyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0N0cmwnKSB7ICRwYXJzZWRNb2RpZmllcktleXMgKz0gJ0N0cmwnIH0gfQ0KCQkJJ1NISUZUJyB7IGlmICgkcGFyc2VkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnU2hpZnQnKSB7ICRwYXJzZWRNb2RpZmllcktleXMgKz0gJ1NoaWZ0JyB9IH0NCgkJCSdMU0hJRlQneyBpZiAoJHBhcnNlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ1NoaWZ0JykgeyAkcGFyc2VkTW9kaWZpZXJLZXlzICs9ICdTaGlmdCcgfSB9DQoJCQknUlNISUZUJ3sgaWYgKCRwYXJzZWRNb2RpZmllcktleXMgLW5vdGNvbnRhaW5zICdTaGlmdCcpIHsgJHBhcnNlZE1vZGlmaWVyS2V5cyArPSAnU2hpZnQnIH0gfQ0KCQkJJ1dJTicgICB7IGlmICgkcGFyc2VkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnV2luJykgeyAkcGFyc2VkTW9kaWZpZXJLZXlzICs9ICdXaW4nIH0gfQ0KCQkJJ0xXSU4nICB7IGlmICgkcGFyc2VkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnV2luJykgeyAkcGFyc2VkTW9kaWZpZXJLZXlzICs9ICdXaW4nIH0gfQ0KCQkJJ1JXSU4nICB7IGlmICgkcGFyc2VkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnV2luJykgeyAkcGFyc2VkTW9kaWZpZXJLZXlzICs9ICdXaW4nIH0gfQ0KCQkJJ1dJTkRPV1MnIHsgaWYgKCRwYXJzZWRNb2RpZmllcktleXMgLW5vdGNvbnRhaW5zICdXaW4nKSB7ICRwYXJzZWRNb2RpZmllcktleXMgKz0gJ1dpbicgfSB9DQoJCQlkZWZhdWx0IHsgDQogICAgICAgICAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRwYXJzZWRQcmltYXJ5S2V5KSkgeyANCiAgICAgICAgICAgICAgICAgICAgJHBhcnNlZFByaW1hcnlLZXkgPSAkcGFydCANCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcGFyc2VkUHJpbWFyeUtleSA9ICIkcGFyc2VkUHJpbWFyeUtleSAkcGFydCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoJCX0NCgl9DQoNCgkkY2Fub25pY2FsT3JkZXIgPSBAKCdDdHJsJywnQWx0JywnU2hpZnQnLCdXaW4nKQ0KCSRjYW5vbmljYWxNb2RpZmllcnMgPSBAKCkNCglmb3JlYWNoICgkbSBpbiAkY2Fub25pY2FsT3JkZXIpIHsgaWYgKCRwYXJzZWRNb2RpZmllcktleXMgLWNvbnRhaW5zICRtKSB7ICRjYW5vbmljYWxNb2RpZmllcnMgKz0gJG0gfSB9DQoNCglpZiAoJGNhbm9uaWNhbE1vZGlmaWVycy5Db3VudCAtZ3QgMCkgew0KCQlpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHBhcnNlZFByaW1hcnlLZXkpKSB7IHJldHVybiAoW3N0cmluZ10oJGNhbm9uaWNhbE1vZGlmaWVycyAtam9pbiAnICsgJykpLlRvVXBwZXIoKSB9DQoJCXJldHVybiAoW3N0cmluZ10oIiQoKCRjYW5vbmljYWxNb2RpZmllcnMgLWpvaW4gJyArICcpKSskcGFyc2VkUHJpbWFyeUtleSIpKS5Ub1VwcGVyKCkNCgl9IGVsc2Ugew0KCQlyZXR1cm4gKFtzdHJpbmddJHBhcnNlZFByaW1hcnlLZXkpLlRvVXBwZXIoKQ0KCX0NCn0NCg0KZnVuY3Rpb24gUGFyc2VLZXlTdHJpbmcgew0KCXBhcmFtKA0KCQlbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldW3N0cmluZ10kS2V5Q29tYmluYXRpb25TdHJpbmcNCgkpDQoNCgkkbm9ybWFsaXplZCA9IE5vcm1hbGl6ZUtleVN0cmluZyAkS2V5Q29tYmluYXRpb25TdHJpbmcNCglpZiAoLW5vdCAkbm9ybWFsaXplZCkgeyByZXR1cm4gQHtNb2RpZmllcnM9QCgpOyBQcmltYXJ5PSRudWxsOyBOb3JtYWxpemVkPSRudWxsfSB9DQoNCgkkcGFydHMgPSBAKCRub3JtYWxpemVkIC1zcGxpdCAnXHMqXCtccyonIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5UcmltKCkgfSB8IFdoZXJlLU9iamVjdCB7ICRfIC1uZSAnJyB9KQ0KCQ0KCWlmICgkcGFydHMuQ291bnQgLWVxIDApIHsgcmV0dXJuIEB7TW9kaWZpZXJzPUAoKTsgUHJpbWFyeT0kbnVsbDsgTm9ybWFsaXplZD0kbm9ybWFsaXplZH0gfQ0KDQoJaWYgKCRwYXJ0cy5Db3VudCAtZXEgMSkgew0KCQlyZXR1cm4gQHtNb2RpZmllcnM9QCgpOyBQcmltYXJ5PShbc3RyaW5nXSRwYXJ0c1swXSkuVG9VcHBlcigpOyBOb3JtYWxpemVkPSRub3JtYWxpemVkfQ0KCX0NCg0KCSRwcmltYXJ5ID0gKFtzdHJpbmddJHBhcnRzWy0xXSkuVG9VcHBlcigpDQoJJG1vZHMgPSAkcGFydHNbMC4uKCRwYXJ0cy5Db3VudCAtIDIpXSB8IEZvckVhY2gtT2JqZWN0IHsNCgkJc3dpdGNoICgkXy5Ub1VwcGVyKCkpIHsNCgkJCSdDVFJMJyB7ICdDdHJsJyB9DQoJCQknQ09OVFJPTCcgeyAnQ3RybCcgfQ0KCQkJJ0xDVFJMJyB7ICdDdHJsJyB9DQoJCQknUkNUUkwnIHsgJ0N0cmwnIH0NCgkJCSdMRUZUX0NPTlRST0wnIHsgJ0N0cmwnIH0NCgkJCSdSSUdIVF9DT05UUk9MJyB7ICdDdHJsJyB9DQoJCQknQUxUJyAgeyAnQWx0JyB9DQoJCQknTUVOVScgeyAnQWx0JyB9DQoJCQknTEFMVCcgIHsgJ0FsdCcgfQ0KCQkJJ1JBTFQnICB7ICdBbHQnIH0NCgkJCSdMRUZUX0FMVCcgeyAnQWx0JyB9DQoJCQknUklHSFRfQUxUJyB7ICdBbHQnIH0NCgkJCSdTSElGVCd7ICdTaGlmdCcgfQ0KCQkJJ0xTSElGVCd7ICdTaGlmdCcgfQ0KCQkJJ1JTSElGVCd7ICdTaGlmdCcgfQ0KCQkJJ1dJTicgIHsgJ1dpbicgfQ0KCQkJJ0xXSU4nIHsgJ1dpbicgfQ0KCQkJJ1JXSU4nIHsgJ1dpbicgfQ0KCQkJJ1dJTkRPV1MnIHsgJ1dpbicgfQ0KCQkJZGVmYXVsdCB7ICRfIH0NCgkJfQ0KCX0NCglyZXR1cm4gQHtNb2RpZmllcnM9JG1vZHM7IFByaW1hcnk9JHByaW1hcnk7IE5vcm1hbGl6ZWQ9JG5vcm1hbGl6ZWR9DQp9DQoNCmZ1bmN0aW9uIEdldC1LZXlDb21iaW5hdGlvblN0cmluZyB7DQogICAgcGFyYW0oW3N0cmluZ1tdXSRtb2RpZmllcnMsIFtzdHJpbmddJHByaW1hcnlLZXkpDQogICAgJHBhcnRzID0gQCgpDQogICAgaWYgKCRtb2RpZmllcnMpIHsgJHBhcnRzICs9ICRtb2RpZmllcnMgfQ0KICAgIGlmICgkcHJpbWFyeUtleSkgeyAkcGFydHMgKz0gJHByaW1hcnlLZXkgfQ0KICAgIGlmICgkcGFydHMuQ291bnQgLWVxIDApIHsgcmV0dXJuICJub25lIiB9DQogICAgcmV0dXJuICgkcGFydHMgLWpvaW4gJyArICcpDQp9DQoNCmZ1bmN0aW9uIElzTW9kaWZpZXJLZXlDb2RlIHsNCiAgICBwYXJhbShbU3lzdGVtLldpbmRvd3MuRm9ybXMuS2V5c10ka2V5Q29kZSkNCiAgICByZXR1cm4gKA0KICAgICAgICAka2V5Q29kZSAtZXEgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLktleXNdOjpDb250cm9sS2V5IC1vciAgDQogICAgICAgICRrZXlDb2RlIC1lcSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuS2V5c106OkxDb250cm9sS2V5IC1vcg0KICAgICAgICAka2V5Q29kZSAtZXEgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLktleXNdOjpSQ29udHJvbEtleSAtb3INCiAgICAgICAgJGtleUNvZGUgLWVxIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5LZXlzXTo6U2hpZnRLZXkgLW9yICAgIA0KICAgICAgICAka2V5Q29kZSAtZXEgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLktleXNdOjpMU2hpZnRLZXkgLW9yDQogICAgICAgICRrZXlDb2RlIC1lcSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuS2V5c106OlJTaGlmdEtleSAtb3INCiAgICAgICAgJGtleUNvZGUgLWVxIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5LZXlzXTo6TWVudSAtb3IgICAgICAgIA0KICAgICAgICAka2V5Q29kZSAtZXEgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLktleXNdOjpMTWVudSAtb3IgICAgICAgDQogICAgICAgICRrZXlDb2RlIC1lcSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuS2V5c106OlJNZW51IC1vciAgICAgICANCiAgICAgICAgJGtleUNvZGUgLWVxIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5LZXlzXTo6TFdpbiAtb3INCiAgICAgICAgJGtleUNvZGUgLWVxIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5LZXlzXTo6Uldpbg0KICAgICkNCn0NCg0KZnVuY3Rpb24gU2hvdy1LZXlDYXB0dXJlRGlhbG9nDQp7DQoJcGFyYW0oDQoJCVtzdHJpbmddJGN1cnJlbnRLZXkgPSAnJyANCgkpDQoJdHJ5IHsNCgkJUGF1c2VBbGxIb3RrZXlzDQoJCSRzY3JpcHQ6S2V5Q2FwdHVyZV9QYXVzZWRTbmFwc2hvdCA9IEAoKQ0KCQlpZiAoJGdsb2JhbDpQYXVzZWRSZWdpc3RlcmVkSG90a2V5cykgeyAkc2NyaXB0OktleUNhcHR1cmVfUGF1c2VkU25hcHNob3QgPSBAKCRnbG9iYWw6UGF1c2VkUmVnaXN0ZXJlZEhvdGtleXMuS2V5cykgfQ0KCX0gY2F0Y2ggew0KCQlXcml0ZS1WZXJib3NlICgiRlRPT0w6IFBhdXNlLUFsbEhvdGtleXMgZmFpbGVkOiB7MH0iIC1mICRfLkV4Y2VwdGlvbi5NZXNzYWdlKQ0KCX0NCg0KICAgICRzY3JpcHQ6Y2FwdHVyZWRNb2RpZmllcktleXMgPSBAKCkNCiAgICAkc2NyaXB0OmNhcHR1cmVkUHJpbWFyeUtleSA9ICRudWxsDQoNCiAgICBpZiAoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkY3VycmVudEtleSkgLWFuZCAkY3VycmVudEtleSAtbmUgIkhvdGtleSIgLWFuZCAkY3VycmVudEtleSAtbmUgIm5vbmUiKSB7DQogICAgICAgICRwYXJ0cyA9ICRjdXJyZW50S2V5LlNwbGl0KCcgKyAnKQ0KICAgICAgICBmb3JlYWNoICgkcGFydCBpbiAkcGFydHMpIHsNCiAgICAgICAgICAgIHN3aXRjaCAoJHBhcnQuVG9VcHBlcigpKSB7DQogICAgICAgICAgICAgICAgJ0FMVCcgICB7IGlmICgkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnQWx0JykgeyAkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzICs9ICdBbHQnIH0gfQ0KICAgICAgICAgICAgICAgICdDVFJMJyAgeyBpZiAoJHNjcmlwdDpjYXB0dXJlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ0N0cmwnKSB7ICRzY3JpcHQ6Y2FwdHVyZWRNb2RpZmllcktleXMgKz0gJ0N0cmwnIH0gfQ0KICAgICAgICAgICAgICAgICdTSElGVCcgeyBpZiAoJHNjcmlwdDpjYXB0dXJlZE1vZGlmaWVyS2V5cyAtbm90Y29udGFpbnMgJ1NoaWZ0JykgeyAkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzICs9ICdTaGlmdCcgfSB9DQogICAgICAgICAgICAgICAgJ1dJTicgICB7IGlmICgkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzIC1ub3Rjb250YWlucyAnV2luJykgeyAkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzICs9ICdXaW4nIH0gfQ0KICAgICAgICAgICAgICAgIGRlZmF1bHQgeyBpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHNjcmlwdDpjYXB0dXJlZFByaW1hcnlLZXkpKSB7ICRzY3JpcHQ6Y2FwdHVyZWRQcmltYXJ5S2V5ID0gJHBhcnQgfTsgYnJlYWsgfSANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KCSRjYXB0dXJlRm9ybSA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuRm9ybQ0KCSRjYXB0dXJlRm9ybS5UZXh0ID0gIlByZXNzIGEgS2V5IENvbWJpbmF0aW9uIiANCgkkY2FwdHVyZUZvcm0uU2l6ZSA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuU2l6ZSgzMDAsIDE1MCkNCgkkY2FwdHVyZUZvcm0uU3RhcnRQb3NpdGlvbiA9ICdDZW50ZXJQYXJlbnQnDQoJJGNhcHR1cmVGb3JtLkZvcm1Cb3JkZXJTdHlsZSA9ICdGaXhlZERpYWxvZycNCgkkY2FwdHVyZUZvcm0uTWF4aW1pemVCb3ggPSAkZmFsc2UNCgkkY2FwdHVyZUZvcm0uTWluaW1pemVCb3ggPSAkZmFsc2UNCgkkY2FwdHVyZUZvcm0uQmFja0NvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6RnJvbUFyZ2IoMzAsIDMwLCAzMCkNCgkkY2FwdHVyZUZvcm0uRm9yZUNvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6V2hpdGUNCgkNCgkkbGFiZWwgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkxhYmVsDQoJJGxhYmVsLlRleHQgPSAiUHJlc3MgYW55IGtleSBjb21iaW5hdGlvbi5gbmBuUHJlc3MgRVNDIHRvIGNhbmNlbC4iIA0KCSRsYWJlbC5TaXplID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5TaXplKDI4MCwgNjApDQoJJGxhYmVsLkxvY2F0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Qb2ludCgxMCwgMTApDQoJJGxhYmVsLlRleHRBbGlnbiA9ICdNaWRkbGVDZW50ZXInDQoJJGxhYmVsLkZvbnQgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgMTApDQoJJGNhcHR1cmVGb3JtLkNvbnRyb2xzLkFkZCgkbGFiZWwpDQoJDQoJJHJlc3VsdExhYmVsID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5MYWJlbA0KCSRyZXN1bHRMYWJlbC5UZXh0ID0gKEdldC1LZXlDb21iaW5hdGlvblN0cmluZyAkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzICRzY3JpcHQ6Y2FwdHVyZWRQcmltYXJ5S2V5KSANCgkkcmVzdWx0TGFiZWwuU2l6ZSA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuU2l6ZSgyODAsIDI1KQ0KCSRyZXN1bHRMYWJlbC5Mb2NhdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuUG9pbnQoMTAsIDc1KQ0KCSRyZXN1bHRMYWJlbC5UZXh0QWxpZ24gPSAnTWlkZGxlQ2VudGVyJw0KCSRyZXN1bHRMYWJlbC5Gb250ID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDksIFtTeXN0ZW0uRHJhd2luZy5Gb250U3R5bGVdOjpCb2xkKQ0KCSRyZXN1bHRMYWJlbC5Gb3JlQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpZZWxsb3cNCgkkY2FwdHVyZUZvcm0uQ29udHJvbHMuQWRkKCRyZXN1bHRMYWJlbCkNCgkNCgkkY2FwdHVyZUZvcm0uQWRkX0tleURvd24oew0KICAgICAgICBwYXJhbSgkZm9ybSwgJGUpDQoNCiAgICAgICAgaWYgKCRlLktleUNvZGUgLWVxICdFc2NhcGUnKSB7DQogICAgICAgICAgICAkc2NyaXB0OmNhcHR1cmVkUHJpbWFyeUtleSA9ICRudWxsDQogICAgICAgICAgICAkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzID0gQCgpDQogICAgICAgICAgICAkY2FwdHVyZUZvcm0uRGlhbG9nUmVzdWx0ID0gJ0NhbmNlbCcNCiAgICAgICAgICAgICRjYXB0dXJlRm9ybS5DbG9zZSgpDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KDQogICAgICAgIFtTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0XSRjdXJyZW50TW9kaWZpZXJzVGVtcCA9IEAoKQ0KICAgICAgICBpZiAoJGUuQ29udHJvbCkgeyAkY3VycmVudE1vZGlmaWVyc1RlbXAuQWRkKCdDdHJsJykgfQ0KICAgICAgICBpZiAoJGUuQWx0KSB7ICRjdXJyZW50TW9kaWZpZXJzVGVtcC5BZGQoJ0FsdCcpIH0NCiAgICAgICAgaWYgKCRlLlNoaWZ0KSB7ICRjdXJyZW50TW9kaWZpZXJzVGVtcC5BZGQoJ1NoaWZ0JykgfQ0KICAgICAgICBpZiAoJGUuS2V5Q29kZSAtZXEgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLktleXNdOjpMV2luIC1vciAkZS5LZXlDb2RlIC1lcSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuS2V5c106OlJXaW4pIHsNCiAgICAgICAgICAgIGlmICgkY3VycmVudE1vZGlmaWVyc1RlbXAgLW5vdGNvbnRhaW5zICdXaW4nKSB7ICRjdXJyZW50TW9kaWZpZXJzVGVtcC5BZGQoJ1dpbicpIH0NCiAgICAgICAgfQ0KDQogICAgICAgICRrZXlNYXBwaW5ncyA9IEdldC1WaXJ0dWFsS2V5TWFwcGluZ3MNCiAgICAgICAgW3N0cmluZ10kYWN0dWFsUHJlc3NlZEtleU5hbWUgPSAkbnVsbA0KICAgICAgICBmb3JlYWNoICgka3ZwIGluICRrZXlNYXBwaW5ncy5HZXRFbnVtZXJhdG9yKCkpIHsNCiAgICAgICAgICAgIGlmICgka3ZwLlZhbHVlIC1lcSAkZS5LZXlWYWx1ZSkgew0KICAgICAgICAgICAgICAgICRhY3R1YWxQcmVzc2VkS2V5TmFtZSA9ICRrdnAuS2V5DQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoLW5vdCAkYWN0dWFsUHJlc3NlZEtleU5hbWUpIHsNCiAgICAgICAgICAgICRhY3R1YWxQcmVzc2VkS2V5TmFtZSA9ICRlLktleUNvZGUuVG9TdHJpbmcoKQ0KICAgICAgICB9DQogICAgICAgICRwcmVzc2VkS2V5TmFtZSA9ICRhY3R1YWxQcmVzc2VkS2V5TmFtZQ0KDQogICAgICAgICRpc1BoeXNpY2FsTW9kaWZpZXIgPSBJc01vZGlmaWVyS2V5Q29kZSAkZS5LZXlDb2RlDQogICAgICAgICRrbm93bk1vZGlmaWVyTmFtZXMgPSBAKA0KICAgICAgICAgICAgJ0NPTlRST0xLRVknLCAnTUVOVScsICdTSElGVEtFWScsICdMV0lOJywgJ1JXSU4nLCANCiAgICAgICAgICAgICdDT05UUk9MJywgJ0FMVCcsICdTSElGVCcsICdXSU4nLCAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICdMRUZUX0NPTlRST0wnLCAnUklHSFRfQ09OVFJPTCcsICdMRUZUX0FMVCcsICdSSUdIVF9BTFQnLCAnTEVGVF9TSElGVCcsICdSSUdIVF9TSElGVCcsIA0KICAgICAgICAgICAgJ0xCVVRUT04nLCAnUkJVVFRPTicsICdNQlVUVE9OJywgJ1hCVVRUT04xJywgJ1hCVVRUT04yJyANCiAgICAgICAgKQ0KICAgICAgICAkaXNOYW1lZE1vZGlmaWVyID0gJGtub3duTW9kaWZpZXJOYW1lcyAtY29udGFpbnMgJHByZXNzZWRLZXlOYW1lLlRvVXBwZXIoKQ0KDQoNCiAgICAgICAgaWYgKC1ub3QgJGlzUGh5c2ljYWxNb2RpZmllciAtYW5kIC1ub3QgJGlzTmFtZWRNb2RpZmllcikgew0KICAgICAgICAgICAgJHNjcmlwdDpjYXB0dXJlZFByaW1hcnlLZXkgPSAkcHJlc3NlZEtleU5hbWUNCiAgICAgICAgICAgICRzY3JpcHQ6Y2FwdHVyZWRNb2RpZmllcktleXMgPSAkY3VycmVudE1vZGlmaWVyc1RlbXANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHJlc3VsdExhYmVsLlRleHQgPSAiQ2FwdHVyZWQ6ICQoR2V0LUtleUNvbWJpbmF0aW9uU3RyaW5nICRzY3JpcHQ6Y2FwdHVyZWRNb2RpZmllcktleXMgJHNjcmlwdDpjYXB0dXJlZFByaW1hcnlLZXkpIg0KICAgICAgICAgICAgJHJlc3VsdExhYmVsLkZvcmVDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OkdyZWVuDQogICAgICAgICAgICAkY2FwdHVyZUZvcm0uRGlhbG9nUmVzdWx0ID0gJ09LJw0KICAgICAgICAgICAgJGNhcHR1cmVGb3JtLkNsb3NlKCkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRyZXN1bHRMYWJlbC5UZXh0ID0gKEdldC1LZXlDb21iaW5hdGlvblN0cmluZyAkY3VycmVudE1vZGlmaWVyc1RlbXAgJG51bGwpIA0KICAgICAgICAgICAgJHJlc3VsdExhYmVsLkZvcmVDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OldoaXRlDQogICAgICAgIH0NCiAgICB9KQ0KICAgIA0KICAgICRjYXB0dXJlRm9ybS5BZGRfS2V5VXAoew0KICAgICAgICBwYXJhbSgkZm9ybSwgJGUpDQogICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkc2NyaXB0OmNhcHR1cmVkUHJpbWFyeUtleSkpIHsNCiAgICAgICAgICAgIFtTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0XSRjdXJyZW50TW9kaWZpZXJzT25VcCA9IEAoKQ0KICAgICAgICAgICAgaWYgKCRlLkNvbnRyb2wpIHsgJGN1cnJlbnRNb2RpZmllcnNPblVwLkFkZCgnQ3RybCcpIH0NCiAgICAgICAgICAgIGlmICgkZS5BbHQpIHsgJGN1cnJlbnRNb2RpZmllcnNPblVwLkFkZCgnQWx0JykgfQ0KICAgICAgICAgICAgaWYgKCRlLlNoaWZ0KSB7ICRjdXJyZW50TW9kaWZpZXJzT25VcC5BZGQoJ1NoaWZ0JykgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAkcmVzdWx0TGFiZWwuVGV4dCA9IChHZXQtS2V5Q29tYmluYXRpb25TdHJpbmcgJGN1cnJlbnRNb2RpZmllcnNPblVwICRudWxsKQ0KICAgICAgICAgICAgJHJlc3VsdExhYmVsLkZvcmVDb2xvciA9IFtTeXN0ZW0uRHJhd2luZy5Db2xvcl06OlllbGxvdw0KICAgICAgICB9DQogICAgfSkNCg0KDQoJJGNhcHR1cmVGb3JtLktleVByZXZpZXcgPSAkdHJ1ZQ0KCSRjYXB0dXJlRm9ybS5Ub3BNb3N0ID0gJHRydWUNCgkNCgkkcmVzdWx0ID0gJGNhcHR1cmVGb3JtLlNob3dEaWFsb2coKQ0KCXRyeSB7DQoJCWlmICgkcmVzdWx0IC1lcSAnT0snIC1hbmQgLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkc2NyaXB0OmNhcHR1cmVkUHJpbWFyeUtleSkpIA0KCQl7DQoJCQlyZXR1cm4gKEdldC1LZXlDb21iaW5hdGlvblN0cmluZyAkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzICRzY3JpcHQ6Y2FwdHVyZWRQcmltYXJ5S2V5KQ0KCQl9DQoJCWVsc2UNCgkJew0KCQkJcmV0dXJuICRjdXJyZW50S2V5ICANCgkJfQ0KCX0gZmluYWxseSB7DQoJCXRyeSB7DQoJCQlbSG90a2V5TWFuYWdlcl06OkFyZUhvdGtleXNHbG9iYWxseVBhdXNlZCA9ICRmYWxzZQ0KCQkJaWYgKCRzY3JpcHQ6S2V5Q2FwdHVyZV9QYXVzZWRTbmFwc2hvdCAtYW5kICRzY3JpcHQ6S2V5Q2FwdHVyZV9QYXVzZWRTbmFwc2hvdC5Db3VudCAtZ3QgMCkgew0KCQkJCVJlc3VtZS1QYXVzZWRLZXlzIC1LZXlzICRzY3JpcHQ6S2V5Q2FwdHVyZV9QYXVzZWRTbmFwc2hvdA0KCQkJfSBlbHNlIHsNCgkJCQlSZXN1bWUtQWxsSG90a2V5cw0KCQkJfQ0KCQl9IGNhdGNoIHsNCgkJCVdyaXRlLVZlcmJvc2UgKCJGVE9PTDogUmVzdW1lLUFsbEhvdGtleXMgKG9yIFJlc3VtZS1QYXVzZWRLZXlzKSBmYWlsZWQ6IHswfSIgLWYgJF8uRXhjZXB0aW9uLk1lc3NhZ2UpDQoJCX0gZmluYWxseSB7DQoJCQlSZW1vdmUtVmFyaWFibGUgLU5hbWUgS2V5Q2FwdHVyZV9QYXVzZWRTbmFwc2hvdCAtU2NvcGUgU2NyaXB0IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlDQogICAgICAgICAgICAkc2NyaXB0OmNhcHR1cmVkUHJpbWFyeUtleSA9ICRudWxsDQogICAgICAgICAgICAkc2NyaXB0OmNhcHR1cmVkTW9kaWZpZXJLZXlzID0gQCgpDQoJCX0NCgl9DQp9DQoNCmZ1bmN0aW9uIExvYWRGdG9vbFNldHRpbmdzDQp7DQoJcGFyYW0oJGZvcm1EYXRhKQ0KCQ0KCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZykNCgl7IA0KCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWcgPSBbb3JkZXJlZF1Ae30gDQoJfQ0KCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZy5Db250YWlucygnRnRvb2wnKSkNCgl7IA0KCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10gPSBbb3JkZXJlZF1Ae30gDQoJfQ0KCQ0KCSRwcm9maWxlUHJlZml4ID0gRmluZE9yQ3JlYXRlUHJvZmlsZSAkZm9ybURhdGEuV2luZG93VGl0bGUNCgkkZm9ybURhdGEuUHJvZmlsZVByZWZpeCA9ICRwcm9maWxlUHJlZml4DQoNCglpZiAoJHByb2ZpbGVQcmVmaXgpDQoJew0KICAgICAgICAkZ2xvYmFsSG90a2V5TmFtZSA9ICJHbG9iYWxIb3RrZXlfJHByb2ZpbGVQcmVmaXgiDQogICAgICAgIGlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uQ29udGFpbnMoJGdsb2JhbEhvdGtleU5hbWUpKQ0KICAgICAgICB7DQogICAgICAgICAgICAkZm9ybURhdGEuR2xvYmFsSG90a2V5ID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRnbG9iYWxIb3RrZXlOYW1lXQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAkaG90a2V5TmFtZSA9ICJIb3RrZXlfJHByb2ZpbGVQcmVmaXgiDQogICAgICAgIGlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uQ29udGFpbnMoJGhvdGtleU5hbWUpKQ0KICAgICAgICB7DQogICAgICAgICAgICAkZm9ybURhdGEuSG90a2V5ID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRob3RrZXlOYW1lXQ0KICAgICAgICAgICAgJGZvcm1EYXRhLkJ0bkhvdEtleS5UZXh0ID0gJGZvcm1EYXRhLkhvdGtleSANCiAgICAgICAgfQ0KICAgICAgICBlbHNlDQogICAgICAgIHsNCiAgICAgICAgICAgICRmb3JtRGF0YS5Ib3RrZXkgPSAkbnVsbCANCiAgICAgICAgICAgICRmb3JtRGF0YS5CdG5Ib3RLZXkuVGV4dCA9ICJIb3RrZXkiIA0KICAgICAgICB9DQoNCgkJJGhvdGtleXNFbmFibGVkTmFtZSA9ICJob3RrZXlzX2VuYWJsZWRfJHByb2ZpbGVQcmVmaXgiDQoJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uQ29udGFpbnMoJGhvdGtleXNFbmFibGVkTmFtZSkpIHsNCgkJCSR2YWx1ZSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVskaG90a2V5c0VuYWJsZWROYW1lXQ0KCQkJdHJ5IHsgJGZvcm1EYXRhLkJ0bkhvdGtleVRvZ2dsZS5DaGVja2VkID0gW2Jvb2xdOjpQYXJzZSgkdmFsdWUpIH0gY2F0Y2ggeyAkZm9ybURhdGEuQnRuSG90a2V5VG9nZ2xlLkNoZWNrZWQgPSAkdHJ1ZSB9DQoJCX0gZWxzZSB7DQoJCQkkZm9ybURhdGEuQnRuSG90a2V5VG9nZ2xlLkNoZWNrZWQgPSAkdHJ1ZQ0KCQl9DQoNCgkJJGtleU5hbWUgPSAia2V5MV8kcHJvZmlsZVByZWZpeCINCgkJJGludGVydmFsTmFtZSA9ICJpbnB0MV8kcHJvZmlsZVByZWZpeCINCgkJJG5hbWVOYW1lID0gIm5hbWUxXyRwcm9maWxlUHJlZml4Ig0KCQkkcG9zaXRpb25YTmFtZSA9ICJwb3MxWF8kcHJvZmlsZVByZWZpeCINCgkJJHBvc2l0aW9uWU5hbWUgPSAicG9zMVlfJHByb2ZpbGVQcmVmaXgiDQoJDQoJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uQ29udGFpbnMoJGtleU5hbWUpKQ0KCQl7DQoJCQkkZm9ybURhdGEuQnRuS2V5U2VsZWN0LlRleHQgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ11bJGtleU5hbWVdDQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQkkZm9ybURhdGEuQnRuS2V5U2VsZWN0LlRleHQgPSAnbm9uZScNCgkJfQ0KCQkNCgkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXS5Db250YWlucygkaW50ZXJ2YWxOYW1lKSkNCgkJew0KCQkJJGludGVydmFsVmFsdWUgPSBbaW50XSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVskaW50ZXJ2YWxOYW1lXQ0KCQkJaWYgKCRpbnRlcnZhbFZhbHVlIC1sdCAxMCkNCgkJCXsNCgkJCQkkaW50ZXJ2YWxWYWx1ZSA9IDEwMA0KCQkJfQ0KCQkJJGZvcm1EYXRhLkludGVydmFsLlRleHQgPSAkaW50ZXJ2YWxWYWx1ZS5Ub1N0cmluZygpDQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQkkZm9ybURhdGEuSW50ZXJ2YWwuVGV4dCA9ICcxMDAnDQoJCX0NCg0KCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddLkNvbnRhaW5zKCRuYW1lTmFtZSkpDQoJCXsNCgkJCSRuYW1lVmFsdWUgPSBbc3RyaW5nXSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVskbmFtZU5hbWVdDQoJCQkkZm9ybURhdGEuTmFtZS5UZXh0ID0gJG5hbWVWYWx1ZS5Ub1N0cmluZygpDQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQkkZm9ybURhdGEuTmFtZS5UZXh0ID0gJ01haW4nDQoJCX0NCg0KCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddLkNvbnRhaW5zKCRwb3NpdGlvblhOYW1lKSkNCgkJew0KCQkJJHBvc2l0aW9uVmFsdWUgPSBbaW50XSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVskcG9zaXRpb25YTmFtZV0NCgkJCSRmb3JtRGF0YS5Qb3NpdGlvblNsaWRlclguVmFsdWUgPSAkcG9zaXRpb25WYWx1ZQ0KCQl9DQoJCWVsc2UNCgkJew0KCQkJJGZvcm1EYXRhLlBvc2l0aW9uU2xpZGVyWC5WYWx1ZSA9IDANCgkJfQ0KDQoJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uQ29udGFpbnMoJHBvc2l0aW9uWU5hbWUpKQ0KCQl7DQoJCQkkcG9zaXRpb25WYWx1ZSA9IFtpbnRdJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRwb3NpdGlvbllOYW1lXQ0KCQkJJGZvcm1EYXRhLlBvc2l0aW9uU2xpZGVyWS5WYWx1ZSA9ICRwb3NpdGlvblZhbHVlDQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQkkZm9ybURhdGEuUG9zaXRpb25TbGlkZXJZLlZhbHVlID0gMTAwDQoJCX0NCgl9DQoJZWxzZQ0KCXsNCiAgICAgICAgJGZvcm1EYXRhLkhvdGtleSA9ICRudWxsDQogICAgICAgICRmb3JtRGF0YS5CdG5Ib3RLZXkuVGV4dCA9ICJIb3RrZXkiIA0KCQkkZm9ybURhdGEuQnRuS2V5U2VsZWN0LlRleHQgPSAnbm9uZScNCgkJJGZvcm1EYXRhLkludGVydmFsLlRleHQgPSAnMTAwMCcNCgkJJGZvcm1EYXRhLk5hbWUuVGV4dCA9ICdNYWluJw0KCX0NCn0NCg0KZnVuY3Rpb24gRmluZE9yQ3JlYXRlUHJvZmlsZQ0Kew0KCXBhcmFtKCR3aW5kb3dUaXRsZSkNCgkNCgkkcHJvZmlsZVByZWZpeCA9ICRudWxsDQoJJHByb2ZpbGVGb3VuZCA9ICRmYWxzZQ0KCQ0KCWlmICgkd2luZG93VGl0bGUpDQoJew0KCQlmb3JlYWNoICgka2V5IGluICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXS5LZXlzKQ0KCQl7DQoJCQlpZiAoJGtleSAtbGlrZSAncHJvZmlsZV8qJyAtYW5kICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVska2V5XSAtZXEgJHdpbmRvd1RpdGxlKQ0KCQkJew0KCQkJCSRwcm9maWxlUHJlZml4ID0gJGtleSAtcmVwbGFjZSAncHJvZmlsZV8nLCAnJw0KCQkJCSRwcm9maWxlRm91bmQgPSAkdHJ1ZQ0KCQkJCWJyZWFrDQoJCQl9DQoJCX0NCgkJDQoJCWlmICgtbm90ICRwcm9maWxlRm91bmQpDQoJCXsNCgkJCSRtYXhQcm9maWxlTnVtID0gMA0KCQkJZm9yZWFjaCAoJGtleSBpbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uS2V5cykNCgkJCXsNCgkJCQlpZiAoJGtleSAtbWF0Y2ggJ3Byb2ZpbGVfKFxkKyknKQ0KCQkJCXsNCgkJCQkJJHByb2ZpbGVOdW0gPSBbaW50XSRtYXRjaGVzWzFdDQoJCQkJCWlmICgkcHJvZmlsZU51bSAtZ3QgJG1heFByb2ZpbGVOdW0pDQoJCQkJCXsNCgkJCQkJCSRtYXhQcm9maWxlTnVtID0gJHByb2ZpbGVOdW0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJCQ0KCQkJJHByb2ZpbGVQcmVmaXggPSAoJG1heFByb2ZpbGVOdW0gKyAxKS5Ub1N0cmluZygpDQoJCQkkcHJvZmlsZUtleSA9ICJwcm9maWxlXyRwcm9maWxlUHJlZml4Ig0KCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRwcm9maWxlS2V5XSA9ICR3aW5kb3dUaXRsZQ0KCQl9DQoJfQ0KCXJldHVybiAkcHJvZmlsZVByZWZpeA0KfQ0KDQpmdW5jdGlvbiBJbml0aWFsaXplRXh0ZW5zaW9uVHJhY2tpbmcNCnsNCglwYXJhbSgkaW5zdGFuY2VJZCkNCgkNCgkkaW5zdGFuY2VLZXkgPSAiaW5zdGFuY2VfJGluc3RhbmNlSWQiDQoJDQoJaWYgKC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvblRyYWNraW5nLkNvbnRhaW5zKCRpbnN0YW5jZUtleSkpDQoJew0KCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XSA9IEB7DQoJCQlOZXh0RXh0TnVtICAgICAgID0gMg0KCQkJQWN0aXZlRXh0ZW5zaW9ucyA9IEAoKQ0KCQkJUmVtb3ZlZEV4dE51bXMgICA9IEAoKQ0KCQl9DQoJfQ0KCQ0KCSR2YWxpZEFjdGl2ZUV4dGVuc2lvbnMgPSBAKCkNCglmb3JlYWNoICgka2V5IGluICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLkFjdGl2ZUV4dGVuc2lvbnMpDQoJew0KCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvbkRhdGEuQ29udGFpbnMoJGtleSkpDQoJCXsNCgkJCSR2YWxpZEFjdGl2ZUV4dGVuc2lvbnMgKz0gJGtleQ0KCQl9DQoJfQ0KCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLkFjdGl2ZUV4dGVuc2lvbnMgPSAkdmFsaWRBY3RpdmVFeHRlbnNpb25zDQoJDQoJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLlJlbW92ZWRFeHROdW1zKQ0KCXsNCgkJJHZhbGlkUmVtb3ZlZE51bXMgPSBAKCkNCgkJZm9yZWFjaCAoJG51bSBpbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5SZW1vdmVkRXh0TnVtcykNCgkJew0KCQkJJGludE51bSA9IDANCgkJCWlmIChbaW50XTo6VHJ5UGFyc2UoJG51bS5Ub1N0cmluZygpLCBbcmVmXSRpbnROdW0pKQ0KCQkJew0KCQkJCSMgT25seSBhZGQgaWYgbm90IGFscmVhZHkgaW4gdGhlIGxpc3QNCgkJCQlpZiAoJHZhbGlkUmVtb3ZlZE51bXMgLW5vdGNvbnRhaW5zICRpbnROdW0pDQoJCQkJew0KCQkJCQkkdmFsaWRSZW1vdmVkTnVtcyArPSAkaW50TnVtDQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLlJlbW92ZWRFeHROdW1zID0gJHZhbGlkUmVtb3ZlZE51bXMNCgl9DQp9DQoNCmZ1bmN0aW9uIEdldE5leHRFeHRlbnNpb25OdW1iZXINCnsNCglwYXJhbSgkaW5zdGFuY2VJZCkNCgkNCgkkaW5zdGFuY2VLZXkgPSAiaW5zdGFuY2VfJGluc3RhbmNlSWQiDQoJDQoJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLlJlbW92ZWRFeHROdW1zLkNvdW50IC1ndCAwKQ0KCXsNCgkJJHNvcnRlZE51bXMgPSBAKCkNCgkJZm9yZWFjaCAoJG51bSBpbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5SZW1vdmVkRXh0TnVtcykNCgkJew0KCQkJJGludE51bSA9IDANCgkJCWlmIChbaW50XTo6VHJ5UGFyc2UoJG51bS5Ub1N0cmluZygpLCBbcmVmXSRpbnROdW0pKQ0KCQkJew0KCQkJCSRzb3J0ZWROdW1zICs9ICRpbnROdW0NCgkJCX0NCgkJfQ0KCQkNCgkJJHNvcnRlZE51bXMgPSAkc29ydGVkTnVtcyB8IFNvcnQtT2JqZWN0DQoJCQ0KCQlpZiAoJHNvcnRlZE51bXMuQ291bnQgLWd0IDApDQoJCXsNCgkJCSRleHROdW0gPSAkc29ydGVkTnVtc1swXQ0KCQkJDQoJCQkkbmV3UmVtb3ZlZE51bXMgPSBAKCkNCgkJCWZvcmVhY2ggKCRudW0gaW4gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvblRyYWNraW5nWyRpbnN0YW5jZUtleV0uUmVtb3ZlZEV4dE51bXMpDQoJCQl7DQoJCQkJJGludE51bSA9IDANCgkJCQlpZiAoW2ludF06OlRyeVBhcnNlKCRudW0uVG9TdHJpbmcoKSwgW3JlZl0kaW50TnVtKSAtYW5kICRpbnROdW0gLW5lICRleHROdW0pDQoJCQkJew0KCQkJCQkkbmV3UmVtb3ZlZE51bXMgKz0gJGludE51bQ0KCQkJCX0NCgkJCX0NCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLlJlbW92ZWRFeHROdW1zID0gJG5ld1JlbW92ZWROdW1zDQoJCQkNCgkJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBSZXVzaW5nIGV4dGVuc2lvbiBudW1iZXIgJGV4dE51bSBmb3IgJGluc3RhbmNlSWQiIC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0dyYXkNCgkJfQ0KCQllbHNlDQoJCXsNCgkJCSRleHROdW0gPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5OZXh0RXh0TnVtDQoJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5OZXh0RXh0TnVtKysNCgkJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBVc2luZyBuZXcgZXh0ZW5zaW9uIG51bWJlciAkZXh0TnVtIGZvciAkaW5zdGFuY2VJZCAobm8gdmFsaWQgcmV1c2FibGUgbnVtYmVycykiIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQoJCX0NCgl9DQoJZWxzZQ0KCXsNCgkJJGV4dE51bSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLk5leHRFeHROdW0NCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvblRyYWNraW5nWyRpbnN0YW5jZUtleV0uTmV4dEV4dE51bSsrDQoJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBVc2luZyBuZXcgZXh0ZW5zaW9uIG51bWJlciAkZXh0TnVtIGZvciAkaW5zdGFuY2VJZCIgLUZvcmVncm91bmRDb2xvciBEYXJrR3JheQ0KCX0NCgkNCglyZXR1cm4gJGV4dE51bQ0KfQ0KDQpmdW5jdGlvbiBGaW5kRXh0ZW5zaW9uS2V5QnlDb250cm9sDQp7DQoJcGFyYW0oJGNvbnRyb2wsICRjb250cm9sVHlwZSkNCgkNCglpZiAoLW5vdCAkY29udHJvbCkNCgl7DQoJCXJldHVybiAkbnVsbCANCgl9DQoJaWYgKC1ub3QgJGNvbnRyb2xUeXBlIC1vciAtbm90ICgkY29udHJvbFR5cGUgLWlzIFtzdHJpbmddKSkNCgl7DQoJCXJldHVybiAkbnVsbCANCgl9DQoJDQoJJGNvbnRyb2xJZCA9ICRjb250cm9sLkdldEhhc2hDb2RlKCkNCgkkZm9ybSA9ICRjb250cm9sLkZpbmRGb3JtKCkNCgkNCglpZiAoJGZvcm0gLWFuZCAkZm9ybS5UYWcgLWFuZCAkZm9ybS5UYWcuQ29udHJvbFRvRXh0ZW5zaW9uTWFwLkNvbnRhaW5zKCRjb250cm9sSWQpKQ0KCXsNCgkJJGV4dEtleSA9ICRmb3JtLlRhZy5Db250cm9sVG9FeHRlbnNpb25NYXBbJGNvbnRyb2xJZF0NCgkJDQoJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5Db250YWlucygkZXh0S2V5KSkNCgkJew0KCQkJcmV0dXJuICRleHRLZXkNCgkJfQ0KCQllbHNlDQoJCXsNCgkJCSRmb3JtLlRhZy5Db250cm9sVG9FeHRlbnNpb25NYXAuUmVtb3ZlKCRjb250cm9sSWQpDQoJCX0NCgl9DQoJDQoJZm9yZWFjaCAoJGtleSBpbiAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5LZXlzKQ0KCXsNCgkJJGV4dERhdGEgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YVska2V5XQ0KCQlpZiAoJGV4dERhdGEgLWFuZCAkZXh0RGF0YS4kY29udHJvbFR5cGUgLWVxICRjb250cm9sKQ0KCQl7DQoJCQlpZiAoJGZvcm0gLWFuZCAkZm9ybS5UYWcpDQoJCQl7DQoJCQkJJGZvcm0uVGFnLkNvbnRyb2xUb0V4dGVuc2lvbk1hcFskY29udHJvbElkXSA9ICRrZXkNCgkJCX0NCgkJCXJldHVybiAka2V5DQoJCX0NCgl9DQoJDQoJcmV0dXJuICRudWxsDQp9DQoNCmZ1bmN0aW9uIExvYWRFeHRlbnNpb25TZXR0aW5ncw0Kew0KCXBhcmFtKCRleHREYXRhLCAkcHJvZmlsZVByZWZpeCkNCgkNCgkkZXh0TnVtID0gJGV4dERhdGEuRXh0TnVtDQoJDQoJIyBMb2FkIHNldHRpbmdzIGZyb20gY29uZmlnIGlmIHRoZXkgZXhpc3QNCgkka2V5TmFtZSA9ICJrZXkke2V4dE51bX1fJHByb2ZpbGVQcmVmaXgiDQoJJGludGVydmFsTmFtZSA9ICJpbnB0JHtleHROdW19XyRwcm9maWxlUHJlZml4Ig0KCSRuYW1lTmFtZSA9ICJuYW1lJHtleHROdW19XyRwcm9maWxlUHJlZml4Ig0KICAgICRleHRIb3RrZXlOYW1lID0gIkV4dEhvdGtleV8ke2V4dE51bX1fJHByb2ZpbGVQcmVmaXgiIA0KCQ0KICAgIGlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uQ29udGFpbnMoJGV4dEhvdGtleU5hbWUpKQ0KICAgIHsNCiAgICAgICAgJGV4dERhdGEuSG90a2V5ID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRleHRIb3RrZXlOYW1lXQ0KICAgICAgICAkZXh0RGF0YS5CdG5Ib3RLZXkuVGV4dCA9ICRleHREYXRhLkhvdGtleQ0KICAgIH0NCiAgICBlbHNlDQogICAgew0KICAgICAgICAkZXh0RGF0YS5Ib3RrZXkgPSAkbnVsbA0KICAgICAgICAkZXh0RGF0YS5CdG5Ib3RLZXkuVGV4dCA9ICJIb3RrZXkiIA0KICAgIH0NCg0KCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uQ29udGFpbnMoJGtleU5hbWUpKQ0KCXsNCgkJJGtleVZhbHVlID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRrZXlOYW1lXQ0KCQkkZXh0RGF0YS5CdG5LZXlTZWxlY3QuVGV4dCA9ICRrZXlWYWx1ZQ0KCX0NCgllbHNlDQoJew0KCQkkZXh0RGF0YS5CdG5LZXlTZWxlY3QuVGV4dCA9ICdub25lJw0KCX0NCgkNCglpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddLkNvbnRhaW5zKCRpbnRlcnZhbE5hbWUpKQ0KCXsNCgkJJGludGVydmFsVmFsdWUgPSBbaW50XSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVskaW50ZXJ2YWxOYW1lXQ0KCQlpZiAoJGludGVydmFsVmFsdWUgLWx0IDEwKQ0KCQl7DQoJCQkkaW50ZXJ2YWxWYWx1ZSA9IDEwMA0KCQl9DQoJCSRleHREYXRhLkludGVydmFsLlRleHQgPSAkaW50ZXJ2YWxWYWx1ZS5Ub1N0cmluZygpDQoJfQ0KCWVsc2UNCgl7DQoJCSRleHREYXRhLkludGVydmFsLlRleHQgPSAnMTAwMCcNCgl9DQoNCglpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddLkNvbnRhaW5zKCRuYW1lTmFtZSkpDQoJew0KCQkkbmFtZVZhbHVlID0gW3N0cmluZ10kZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ11bJG5hbWVOYW1lXQ0KDQoJCSRleHREYXRhLk5hbWUuVGV4dCA9ICRuYW1lVmFsdWUuVG9TdHJpbmcoKQ0KCX0NCgllbHNlDQoJew0KCQkkZXh0RGF0YS5OYW1lLlRleHQgPSAnTmFtZScNCgl9DQp9DQoNCmZ1bmN0aW9uIFVwZGF0ZVNldHRpbmdzDQp7DQoJcGFyYW0oJGZvcm1EYXRhLCAkZXh0RGF0YSA9ICRudWxsLCBbc3dpdGNoXSRmb3JjZVdyaXRlKQ0KCQ0KCSRwcm9maWxlUHJlZml4ID0gRmluZE9yQ3JlYXRlUHJvZmlsZSAkZm9ybURhdGEuV2luZG93VGl0bGUNCgkNCglpZiAoJHByb2ZpbGVQcmVmaXgpDQoJew0KCQlpZiAoJGV4dERhdGEpDQoJCXsNCgkJCSRleHROdW0gPSAkZXh0RGF0YS5FeHROdW0NCgkJCSRrZXlOYW1lID0gImtleSR7ZXh0TnVtfV8kcHJvZmlsZVByZWZpeCINCgkJCSRpbnRlcnZhbE5hbWUgPSAiaW5wdCR7ZXh0TnVtfV8kcHJvZmlsZVByZWZpeCINCgkJCSRuYW1lTmFtZSA9ICJuYW1lJHtleHROdW19XyRwcm9maWxlUHJlZml4Ig0KICAgICAgICAgICAgJGV4dEhvdGtleU5hbWUgPSAiRXh0SG90a2V5XyR7ZXh0TnVtfV8kcHJvZmlsZVByZWZpeCIgDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICgkZXh0RGF0YS5Ib3RrZXkpIHsgDQogICAgICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRleHRIb3RrZXlOYW1lXSA9ICRleHREYXRhLkhvdGtleQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddLkNvbnRhaW5zKCRleHRIb3RrZXlOYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ10uUmVtb3ZlKCRleHRIb3RrZXlOYW1lKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCgkJCQ0KCQkJaWYgKCRleHREYXRhLkJ0bktleVNlbGVjdCAtYW5kICRleHREYXRhLkJ0bktleVNlbGVjdC5UZXh0KQ0KCQkJew0KCQkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVska2V5TmFtZV0gPSAkZXh0RGF0YS5CdG5LZXlTZWxlY3QuVGV4dA0KCQkJfQ0KCQkJDQoJCQlpZiAoJGV4dERhdGEuSW50ZXJ2YWwpDQoJCQl7DQoJCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyRpbnRlcnZhbE5hbWVdID0gJGV4dERhdGEuSW50ZXJ2YWwuVGV4dA0KCQkJfQ0KDQoJCQlpZiAoJGV4dERhdGEuTmFtZSkNCgkJCXsNCgkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ11bJG5hbWVOYW1lXSA9ICRleHREYXRhLk5hbWUuVGV4dA0KCQkJfQ0KCQl9DQoJCWVsc2UNCgkJew0KICAgICAgICAgICAgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyJHbG9iYWxIb3RrZXlfJHByb2ZpbGVQcmVmaXgiXSA9ICRmb3JtRGF0YS5HbG9iYWxIb3RrZXkNCiAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVsiSG90a2V5XyRwcm9maWxlUHJlZml4Il0gPSAkZm9ybURhdGEuSG90a2V5DQoJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ11bImhvdGtleXNfZW5hYmxlZF8kcHJvZmlsZVByZWZpeCJdID0gJGZvcm1EYXRhLkJ0bkhvdGtleVRvZ2dsZS5DaGVja2VkDQoJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5Db25maWdbJ0Z0b29sJ11bImtleTFfJHByb2ZpbGVQcmVmaXgiXSA9ICRmb3JtRGF0YS5CdG5LZXlTZWxlY3QuVGV4dA0KCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuQ29uZmlnWydGdG9vbCddWyJpbnB0MV8kcHJvZmlsZVByZWZpeCJdID0gJGZvcm1EYXRhLkludGVydmFsLlRleHQNCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVsibmFtZTFfJHByb2ZpbGVQcmVmaXgiXSA9ICRmb3JtRGF0YS5OYW1lLlRleHQNCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVsicG9zMVhfJHByb2ZpbGVQcmVmaXgiXSA9ICRmb3JtRGF0YS5Qb3NpdGlvblNsaWRlclguVmFsdWUNCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLkNvbmZpZ1snRnRvb2wnXVsicG9zMVlfJHByb2ZpbGVQcmVmaXgiXSA9ICRmb3JtRGF0YS5Qb3NpdGlvblNsaWRlclkuVmFsdWUNCgkJfQ0KCQkNCgkJaWYgKCRmb3JjZVdyaXRlKSB7DQoJCQlXcml0ZS1Db25maWcNCgkJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzLkNvbnRhaW5zKCdDb25maWdXcml0ZVRpbWVyJykpIHsNCgkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzWydDb25maWdXcml0ZVRpbWVyJ10uU3RvcCgpDQoJCQl9DQoJCX0NCgkJZWxzZQ0KCQl7DQogICAgICAgICAgICBpZiAoLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzLkNvbnRhaW5zKCdDb25maWdXcml0ZVRpbWVyJykpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgJENvbmZpZ1dyaXRlVGltZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLlRpbWVyDQogICAgICAgICAgICAgICAgJENvbmZpZ1dyaXRlVGltZXIuSW50ZXJ2YWwgPSAxMDAwDQogICAgICAgICAgICAgICAgJENvbmZpZ1dyaXRlVGltZXIuQWRkX1RpY2soew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0oJHRpbWVyU2VuZGVyLCAkdGltZXJBcmdzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aW1lclNlbmRlcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lclNlbmRlci5TdG9wKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtQ29uZmlnDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaA0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgKCJGVE9PTDogRXJyb3IgaW4gY29uZmlnIHdyaXRlIHRpbWVyOiB7MH0iIC1mICRfLkV4Y2VwdGlvbi5NZXNzYWdlKSAtRm9yZWdyb3VuZENvbG9yIFJlZA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnNbJ0NvbmZpZ1dyaXRlVGltZXInXSA9ICRDb25maWdXcml0ZVRpbWVyDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgJENvbmZpZ1dyaXRlVGltZXIgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzWydDb25maWdXcml0ZVRpbWVyJ10NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJENvbmZpZ1dyaXRlVGltZXIuU3RvcCgpDQogICAgICAgICAgICAkQ29uZmlnV3JpdGVUaW1lci5TdGFydCgpDQogICAgICAgIH0NCgl9DQp9DQoNCmZ1bmN0aW9uIElzLVdpbmRvd0JlbG93IHsNCiAgICBwYXJhbSgNCiAgICAgICAgW0ludFB0cl0kaFduZFRvcCwNCiAgICAgICAgW0ludFB0cl0kaFduZFRvRmluZA0KICAgICkNCiAgICAkY3VycmVudCA9ICRoV25kVG9wDQogICAgIyBMaW1pdCBzZWFyY2ggdG8gYXZvaWQgaW5maW5pdGUgbG9vcHMgb24gd2VpcmQgd2luZG93IGhpZXJhcmNoaWVzDQogICAgZm9yICgkaSA9IDA7ICRpIC1sdCA1MDA7ICRpKyspIHsNCiAgICAgICAgJGN1cnJlbnQgPSBbQ3VzdG9tLk5hdGl2ZV06OkdldFdpbmRvdygkY3VycmVudCwgW0N1c3RvbS5OYXRpdmVdOjpHV19IV05ETkVYVCkNCiAgICAgICAgaWYgKCRjdXJyZW50IC1lcSBbSW50UHRyXTo6WmVybykgew0KICAgICAgICAgICAgcmV0dXJuICRmYWxzZSAjIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgWi1vcmRlcg0KICAgICAgICB9DQogICAgICAgIGlmICgkY3VycmVudCAtZXEgJGhXbmRUb0ZpbmQpIHsNCiAgICAgICAgICAgIHJldHVybiAkdHJ1ZSAjIEZvdW5kIGl0IGJlbG93DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuICRmYWxzZQ0KfQ0KDQpmdW5jdGlvbiBDcmVhdGVQb3NpdGlvblRpbWVyDQp7DQoJcGFyYW0oJGZvcm1EYXRhKQ0KCQ0KCSRwb3NpdGlvblRpbWVyID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5UaW1lcg0KCSRwb3NpdGlvblRpbWVyLkludGVydmFsID0gMTANCgkJJHBvc2l0aW9uVGltZXIuVGFnID0gQHsNCgkJCVdpbmRvd0hhbmRsZSA9ICRmb3JtRGF0YS5TZWxlY3RlZFdpbmRvdw0KCQkJRnRvb2xGb3JtICAgID0gJGZvcm1EYXRhLkZvcm0NCgkJCUluc3RhbmNlSWQgICA9ICRmb3JtRGF0YS5JbnN0YW5jZUlkDQoJCQlGb3JtRGF0YSAgICAgPSAkZm9ybURhdGENCgkJCUZ0b29sWlN0YXRlICA9ICd1bmtub3duJyAjIEFkZCBzdGF0ZSB0cmFja2luZyBmb3IgWi1vcmRlcg0KCQl9DQoJCQ0KCQkkcG9zaXRpb25UaW1lci5BZGRfVGljayh7DQoJCQkJcGFyYW0oJHMsICRlKQ0KCQkJCXRyeQ0KCQkJCXsNCgkJCQkJaWYgKC1ub3QgJHMgLW9yIC1ub3QgJHMuVGFnKSB7IHJldHVybiB9DQoJCQkJCSR0aW1lckRhdGEgPSAkcy5UYWcNCgkJCQkJaWYgKC1ub3QgJHRpbWVyRGF0YSAtb3IgJHRpbWVyRGF0YVsnV2luZG93SGFuZGxlJ10gLWVxIFtJbnRQdHJdOjpaZXJvKSB7IHJldHVybiB9DQoJCQkJCWlmICgtbm90ICR0aW1lckRhdGFbJ0Z0b29sRm9ybSddIC1vciAkdGltZXJEYXRhWydGdG9vbEZvcm0nXS5Jc0Rpc3Bvc2VkKSB7IHJldHVybiB9DQoJCQkNCgkJCQkJJHJlY3QgPSBOZXctT2JqZWN0IEN1c3RvbS5OYXRpdmUrUkVDVA0KCQkJCQkjIENoZWNrIGlmIHRoZSBwYXJlbnQgd2luZG93IGlzIHN0aWxsIGEgdmFsaWQgd2luZG93Lg0KCQkJCQlpZiAoW0N1c3RvbS5OYXRpdmVdOjpJc1dpbmRvdygkdGltZXJEYXRhWydXaW5kb3dIYW5kbGUnXSkpDQoJCQkJCXsNCgkJCQkJCWlmIChbQ3VzdG9tLk5hdGl2ZV06OkdldFdpbmRvd1JlY3QoJHRpbWVyRGF0YVsnV2luZG93SGFuZGxlJ10sIFtyZWZdJHJlY3QpKQ0KCQkJCQkJew0KCQkJCQkJCXRyeQ0KCQkJCQkJCXsNCgkJCQkJCQkJIyBQb3NpdGlvbmluZyBsb2dpYw0KCQkJCQkJCQkkc2xpZGVyVmFsdWVYID0gJHRpbWVyRGF0YS5Gb3JtRGF0YS5Qb3NpdGlvblNsaWRlclguVmFsdWUNCgkJCQkJCQkJJG1heExlZnQgPSAkcmVjdC5SaWdodCAtICR0aW1lckRhdGFbJ0Z0b29sRm9ybSddLldpZHRoIC0gOA0KCQkJCQkJCQkkdGFyZ2V0TGVmdCA9ICRyZWN0LkxlZnQgKyA4ICsgKCgkbWF4TGVmdCAtICgkcmVjdC5MZWZ0ICsgOCkpICogJHNsaWRlclZhbHVlWCAvIDEwMCkNCgkJCQkJCQkJDQoJCQkJCQkJCSRzbGlkZXJWYWx1ZVkgPSAxMDAgLSAkdGltZXJEYXRhLkZvcm1EYXRhLlBvc2l0aW9uU2xpZGVyWS5WYWx1ZQ0KCQkJCQkJCQkkbWF4VG9wID0gJHJlY3QuQm90dG9tIC0gJHRpbWVyRGF0YVsnRnRvb2xGb3JtJ10uSGVpZ2h0IC0gOA0KCQkJCQkJCQkkdGFyZ2V0VG9wID0gJHJlY3QuVG9wICsgOCArICgoJG1heFRvcCAtICgkcmVjdC5Ub3AgKyA4KSkgKiAkc2xpZGVyVmFsdWVZIC8gMTAwKQ0KCQ0KCQkJCQkJCQkkY3VycmVudExlZnQgPSAkdGltZXJEYXRhWydGdG9vbEZvcm0nXS5MZWZ0DQoJCQkJCQkJCSRuZXdMZWZ0ID0gJGN1cnJlbnRMZWZ0ICsgKCR0YXJnZXRMZWZ0IC0gJGN1cnJlbnRMZWZ0KSAqIDAuMiANCgkJCQkJCQkJJHRpbWVyRGF0YVsnRnRvb2xGb3JtJ10uTGVmdCA9IFtpbnRdJG5ld0xlZnQNCgkNCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnRUb3AgPSAkdGltZXJEYXRhWydGdG9vbEZvcm0nXS5Ub3ANCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgJG5ld1RvcCA9ICRjdXJyZW50VG9wICsgKCR0YXJnZXRUb3AgLSAkY3VycmVudFRvcCkgKiAwLjIgDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lckRhdGFbJ0Z0b29sRm9ybSddLlRvcCA9IFtpbnRdJG5ld1RvcA0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgIA0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAjIFotT3JkZXIgTWFuYWdlbWVudA0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAkZnRvb2xIYW5kbGUgPSAkdGltZXJEYXRhWydGdG9vbEZvcm0nXS5IYW5kbGUNCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgJGxpbmtlZEhhbmRsZSA9ICR0aW1lckRhdGFbJ1dpbmRvd0hhbmRsZSddDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICRmb3JlZ3JvdW5kV2luZG93ID0gW0N1c3RvbS5OYXRpdmVdOjpHZXRGb3JlZ3JvdW5kV2luZG93KCkNCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgJGZsYWdzID0gW0N1c3RvbS5OYXRpdmVdOjpTV1BfTk9NT1ZFIC1ib3IgW0N1c3RvbS5OYXRpdmVdOjpTV1BfTk9TSVpFIC1ib3IgW0N1c3RvbS5OYXRpdmVdOjpTV1BfTk9BQ1RJVkFURQ0KDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZm9yZWdyb3VuZFdpbmRvdyAtZXEgJGxpbmtlZEhhbmRsZSAtb3IgJGZvcmVncm91bmRXaW5kb3cgLWVxICRmdG9vbEhhbmRsZSkNCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgew0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBBQ1RJVkU6IFRoZSBmdG9vbC9saW5rZWQgd2luZG93IHBhaXIgaXMgYWN0aXZlLiBNYWtlIGZ0b29sIHRvcG1vc3QuDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRpbWVyRGF0YS5GdG9vbFpTdGF0ZSAtbmUgJ3RvcG1vc3QnKQ0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtDdXN0b20uTmF0aXZlXTo6UG9zaXRpb25XaW5kb3coJGZ0b29sSGFuZGxlLCBbQ3VzdG9tLk5hdGl2ZV06OkhXTkRfVE9QTU9TVCwgMCwgMCwgMCwgMCwgJGZsYWdzKSB8IE91dC1OdWxsDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVyRGF0YS5GdG9vbFpTdGF0ZSA9ICd0b3Btb3N0Jw0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICB9DQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgew0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBJTkFDVElWRTogVGhlIHBhaXIgaXMgbm90IHRoZSBmb3JlZ3JvdW5kIHdpbmRvdy4gTWFrZSBmdG9vbCBhIG5vcm1hbCwgbm9uLXRvcG1vc3Qgd2luZG93Lg0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aW1lckRhdGEuRnRvb2xaU3RhdGUgLW5lICdzdGFuZGFyZCcpDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW0N1c3RvbS5OYXRpdmVdOjpQb3NpdGlvbldpbmRvdygkZnRvb2xIYW5kbGUsIFtDdXN0b20uTmF0aXZlXTo6SFdORF9OT1RPUE1PU1QsIDAsIDAsIDAsIDAsICRmbGFncykgfCBPdXQtTnVsbA0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lckRhdGEuRnRvb2xaU3RhdGUgPSAnc3RhbmRhcmQnDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgSU5WQVJJQU5UIENIRUNLOiBBcyBhbiBpbmFjdGl2ZSB3aW5kb3csIGZ0b29sIG11c3Qgc3RpbGwgbmV2ZXIgYmUgYmVoaW5kIGl0cyBsaW5rZWQgcGFydG5lci4NCgkJCQkJCQkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgZnRvb2wgaXMgcG9zaXRpb25lZCBsb3dlciB0aGFuIChiZWhpbmQpIGl0cyBsaW5rZWQgd2luZG93IGluIHRoZSBaLW9yZGVyLg0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKElzLVdpbmRvd0JlbG93IC1oV25kVG9wICRsaW5rZWRIYW5kbGUgLWhXbmRUb0ZpbmQgJGZ0b29sSGFuZGxlKSB7DQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDT1JSRUNUSU9OOiBmdG9vbCBpcyBiZWhpbmQuIE1vdmUgaXQgdG8gYmUgZGlyZWN0bHkgaW4gZnJvbnQgb2YgdGhlIGxpbmtlZCB3aW5kb3cuDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBHZXQgdGhlIHdpbmRvdyBjdXJyZW50bHkgaW4gZnJvbnQgb2YgdGhlIGxpbmtlZCB3aW5kb3cuDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByZXZIYW5kbGUgPSBbQ3VzdG9tLk5hdGl2ZV06OkdldFdpbmRvdygkbGlua2VkSGFuZGxlLCBbQ3VzdG9tLk5hdGl2ZV06OkdXX0hXTkRQUkVWKQ0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTW92ZSBmdG9vbCB0byB0aGF0IHBvc2l0aW9uLCB3aGljaCBpcyBub3cgb24gdG9wIG9mIHRoZSBsaW5rZWQgd2luZG93Lg0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGhpcyBvbmx5IG1vdmVzIHRoZSBmdG9vbCB3aW5kb3csIHJlc3BlY3RpbmcgdGhlICJkb24ndCB0b3VjaCBsaW5rZWQgd2luZG93IiBydWxlLg0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcHJldkhhbmRsZSAtbmUgJGZ0b29sSGFuZGxlKSB7DQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtDdXN0b20uTmF0aXZlXTo6UG9zaXRpb25XaW5kb3coJGZ0b29sSGFuZGxlLCAkcHJldkhhbmRsZSwgMCwgMCwgMCwgMCwgJGZsYWdzKSB8IE91dC1OdWxsDQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgICAgICB9DQoJCQkJCQkJCSAgICAgICAgICAgICAgICAgICAgfQ0KCQkJCQkJCQkgICAgICAgICAgICAgICAgICAgIGNhdGNoDQoJCQkJCQkJCQkJCQkJewkJCQkJCQlXcml0ZS1WZXJib3NlICgiRlRPT0w6IFBvc2l0aW9uIHRpbWVyIGVycm9yOiB7MH0gZm9yIHsxfSIgLWYgJF8uRXhjZXB0aW9uLk1lc3NhZ2UsICQoJHRpbWVyRGF0YVsnSW5zdGFuY2VJZCddKSkgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCQllbHNlDQoJCQkJew0KCQkJCQkjIFBhcmVudCB3aW5kb3cgaGFuZGxlIGlzIG5vIGxvbmdlciB2YWxpZCwgc28gY2xvc2UgdGhlIGZ0b29sIGZvcm0gYW5kIHN0b3AgdGhlIHRpbWVyLg0KCQkJCQlXcml0ZS1WZXJib3NlICgiRlRPT0w6IFBhcmVudCB3aW5kb3cgaGFuZGxlIG5vIGxvbmdlciB2YWxpZC4gQ2xvc2luZyBmdG9vbCB7MH0uIiAtZiAkdGltZXJEYXRhWydJbnN0YW5jZUlkJ10pIC1Gb3JlZ3JvdW5kQ29sb3IgWWVsbG93DQoJCQkJCSR0aW1lckRhdGFbJ0Z0b29sRm9ybSddLkNsb3NlKCkNCgkJCQkJJHMuU3RvcCgpDQoJCQkJCSRzLkRpc3Bvc2UoKQ0KCQkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzLlJlbW92ZSgiZnRvb2xQb3NpdGlvbl8kKCR0aW1lckRhdGEuSW5zdGFuY2VJZCkiKQ0KCQkJCX0NCgkJCX0NCgkJCWNhdGNoDQoJCQl7DQoJCQkJV3JpdGUtVmVyYm9zZSAoIkZUT09MOiBQb3NpdGlvbiB0aW1lciBjcml0aWNhbCBlcnJvcjogezB9IiAtZiAkXy5FeGNlcHRpb24uTWVzc2FnZSkgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCX0NCgkJfSkNCgkNCgkkcG9zaXRpb25UaW1lci5TdGFydCgpDQoJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVyc1siZnRvb2xQb3NpdGlvbl8kKCRmb3JtRGF0YS5JbnN0YW5jZUlkKSJdID0gJHBvc2l0aW9uVGltZXINCn0NCg0KZnVuY3Rpb24gUmVwb3NpdGlvbkV4dGVuc2lvbnMNCnsNCglwYXJhbSgkZm9ybSwgJGluc3RhbmNlSWQpDQoJDQoJaWYgKC1ub3QgJGZvcm0gLW9yIC1ub3QgJGluc3RhbmNlSWQpDQoJew0KCQlyZXR1cm4gDQoJfQ0KCQ0KCSRpbnN0YW5jZUtleSA9ICJpbnN0YW5jZV8kaW5zdGFuY2VJZCINCgkNCglpZiAoLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmcgLW9yIA0KCQktbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZy5Db250YWlucygkaW5zdGFuY2VLZXkpKQ0KCXsNCgkJcmV0dXJuDQoJfQ0KCQ0KCSRmb3JtLlN1c3BlbmRMYXlvdXQoKQ0KCQ0KCXRyeQ0KCXsNCgkJJGJhc2VIZWlnaHQgPSAxMzANCgkJDQoJCSRhY3RpdmVFeHRlbnNpb25zID0gQCgpDQoJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5BY3RpdmVFeHRlbnNpb25zKQ0KCQl7DQoJCQkkYWN0aXZlRXh0ZW5zaW9ucyA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLkFjdGl2ZUV4dGVuc2lvbnMNCgkJfQ0KCQkNCgkJJG5ld0hlaWdodCA9IDEzMCAgDQoJCSRwb3NpdGlvbiA9IDANCgkJDQoJCWlmICgkYWN0aXZlRXh0ZW5zaW9ucy5Db3VudCAtZ3QgMCkNCgkJew0KCQkJJHNvcnRlZEV4dGVuc2lvbnMgPSBAKCkNCgkJCWZvcmVhY2ggKCRleHRLZXkgaW4gJGFjdGl2ZUV4dGVuc2lvbnMpDQoJCQl7DQoJCQkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhLkNvbnRhaW5zKCRleHRLZXkpKQ0KCQkJCXsNCgkJCQkJJGV4dERhdGEgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YVskZXh0S2V5XQ0KCQkJCQkkc29ydGVkRXh0ZW5zaW9ucyArPSBbUFNDdXN0b21PYmplY3RdQHsNCgkJCQkJCUtleSAgICA9ICRleHRLZXkNCgkJCQkJCUV4dE51bSA9IFtpbnRdJGV4dERhdGEuRXh0TnVtIA0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQkJJHNvcnRlZEV4dGVuc2lvbnMgPSAkc29ydGVkRXh0ZW5zaW9ucyB8IFNvcnQtT2JqZWN0IEV4dE51bQ0KCQkJDQoJCQlmb3JlYWNoICgkZXh0T2JqIGluICRzb3J0ZWRFeHRlbnNpb25zKQ0KCQkJew0KCQkJCSRleHRLZXkgPSAkZXh0T2JqLktleQ0KCQkJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5Db250YWlucygkZXh0S2V5KSkNCgkJCQl7DQoJCQkJCSRleHREYXRhID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvbkRhdGFbJGV4dEtleV0NCgkJCQkJaWYgKCRleHREYXRhIC1hbmQgJGV4dERhdGEuUGFuZWwgLWFuZCAtbm90ICRleHREYXRhLlBhbmVsLklzRGlzcG9zZWQpDQoJCQkJCXsNCgkJCQkJCSRuZXdUb3AgPSAkYmFzZUhlaWdodCArICgkcG9zaXRpb24gKiA3MCkNCgkJCQkJCQ0KCQkJCQkJJGV4dERhdGEuUGFuZWwuVG9wID0gJG5ld1RvcA0KCQkJCQkJJGV4dERhdGEuUG9zaXRpb24gPSAkcG9zaXRpb24NCgkJCQkJCQ0KCQkJCQkJJHBvc2l0aW9uKysNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJCQ0KCQkJaWYgKCRwb3NpdGlvbiAtZ3QgMCkNCgkJCXsNCgkJCQkkbmV3SGVpZ2h0ID0gMTMwICsgKCRwb3NpdGlvbiAqIDcwKQ0KCQkJfQ0KCQl9DQoJCQ0KCQlpZiAoLW5vdCAkZm9ybS5UYWcuSXNDb2xsYXBzZWQpDQoJCXsNCgkJCSRmb3JtLkhlaWdodCA9ICRuZXdIZWlnaHQNCgkJCSRmb3JtLlRhZy5PcmlnaW5hbEhlaWdodCA9ICRuZXdIZWlnaHQNCgkJCSRmb3JtLlRhZy5Qb3NpdGlvblNsaWRlclkuSGVpZ2h0ID0gJG5ld0hlaWdodCAtIDIwDQoJCX0NCgl9DQoJY2F0Y2gNCgl7DQoJCVdyaXRlLVZlcmJvc2UgKCJGVE9PTDogRXJyb3IgaW4gUmVwb3NpdGlvbkV4dGVuc2lvbnM6IHswfSIgLWYgJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJfQ0KCWZpbmFsbHkNCgl7DQoJCSRmb3JtLlJlc3VtZUxheW91dCgpDQoJfQ0KfQ0KDQpmdW5jdGlvbiBDcmVhdGVTcGFtbWVyVGltZXINCnsNCglwYXJhbSgkd2luZG93SGFuZGxlLCAka2V5VmFsdWUsICRpbnN0YW5jZUlkLCAkaW50ZXJ2YWwsICRleHROdW0gPSAkbnVsbCwgJGV4dEtleSA9ICRudWxsKQ0KCQ0KCSRzcGFtVGltZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLlRpbWVyDQoJJHNwYW1UaW1lci5JbnRlcnZhbCA9ICRpbnRlcnZhbA0KCQ0KCSR0aW1lclRhZyA9IEB7DQoJCVdpbmRvd0hhbmRsZSA9ICR3aW5kb3dIYW5kbGUNCgkJS2V5ICAgICAgICAgID0gJGtleVZhbHVlDQoJCUluc3RhbmNlSWQgICA9ICRpbnN0YW5jZUlkDQoJfQ0KCQ0KCWlmICgkbnVsbCAtbmUgJGV4dE51bSkNCgl7DQoJCSR0aW1lclRhZ1snRXh0TnVtJ10gPSAkZXh0TnVtDQoJCSR0aW1lclRhZ1snRXh0S2V5J10gPSAkZXh0S2V5DQoJfQ0KCQ0KCSRzcGFtVGltZXIuVGFnID0gJHRpbWVyVGFnDQoJDQoJJHNwYW1UaW1lci5BZGRfVGljayh7DQoJCQlwYXJhbSgkcywgJGV2dCkNCgkJCXRyeQ0KCQkJew0KCQkJCWlmICgtbm90ICRzIC1vciAtbm90ICRzLlRhZykNCgkJCQl7DQoJCQkJCXJldHVybg0KCQkJCX0NCgkJCQkkdGltZXJEYXRhID0gJHMuVGFnDQoJCQkJaWYgKC1ub3QgJHRpbWVyRGF0YSAtb3IgJHRpbWVyRGF0YVsnV2luZG93SGFuZGxlJ10gLWVxIFtJbnRQdHJdOjpaZXJvKQ0KCQkJCXsNCgkJCQkJcmV0dXJuDQoJCQkJfQ0KCQkJCQ0KCQkJCSRrZXlNYXBwaW5ncyA9IEdldC1WaXJ0dWFsS2V5TWFwcGluZ3MNCgkJCQkkdmlydHVhbEtleUNvZGUgPSAka2V5TWFwcGluZ3NbJHRpbWVyRGF0YVsnS2V5J11dDQoJCQkJDQoJCQkJaWYgKCR2aXJ0dWFsS2V5Q29kZSkNCgkJCQl7DQoJCQkJCVtDdXN0b20uRnRvb2xdOjpmblBvc3RNZXNzYWdlKCR0aW1lckRhdGFbJ1dpbmRvd0hhbmRsZSddLCAyNTYsICR2aXJ0dWFsS2V5Q29kZSwgMCkNCgkJCQl9DQoJCQkJZWxzZQ0KCQkJCXsNCgkJCQkJV3JpdGUtVmVyYm9zZSAiRlRPT0w6IFVua25vd24ga2V5ICckKCR0aW1lckRhdGFbJ0tleSddKScgZm9yICQoJHRpbWVyRGF0YVsnSW5zdGFuY2VJZCddKSIgLUZvcmVncm91bmRDb2xvciBZZWxsb3cNCgkJCQl9DQoJCQl9DQoJCQljYXRjaA0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgKCJGVE9PTDogU3BhbW1lciB0aW1lciBlcnJvcjogezB9IiAtZiAkXy5FeGNlcHRpb24uTWVzc2FnZSkgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJCX0NCgkJfSkNCgkNCgkkc3BhbVRpbWVyLlN0YXJ0KCkNCglyZXR1cm4gJHNwYW1UaW1lcg0KfQ0KDQpmdW5jdGlvbiBUb2dnbGVCdXR0b25TdGF0ZQ0Kew0KCXBhcmFtKCRzdGFydEJ0biwgJHN0b3BCdG4sICRpc1N0YXJ0aW5nKQ0KCQ0KCWlmICgkaXNTdGFydGluZykNCgl7DQoJCSRzdGFydEJ0bi5FbmFibGVkID0gJGZhbHNlDQoJCSRzdGFydEJ0bi5WaXNpYmxlID0gJGZhbHNlDQoJCSRzdG9wQnRuLkVuYWJsZWQgPSAkdHJ1ZQ0KCQkkc3RvcEJ0bi5WaXNpYmxlID0gJHRydWUNCgl9DQoJZWxzZQ0KCXsNCgkJJHN0YXJ0QnRuLkVuYWJsZWQgPSAkdHJ1ZQ0KCQkkc3RhcnRCdG4uVmlzaWJsZSA9ICR0cnVlDQoJCSRzdG9wQnRuLkVuYWJsZWQgPSAkZmFsc2UNCgkJJHN0b3BCdG4uVmlzaWJsZSA9ICRmYWxzZQ0KCX0NCn0NCg0KZnVuY3Rpb24gQ2hlY2tSYXRlTGltaXQNCnsNCglwYXJhbSgkY29udHJvbElkLCAkbWluSW50ZXJ2YWwgPSAxMDApDQoJDQoJJGN1cnJlbnRUaW1lID0gR2V0LURhdGUNCglpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkxhc3RFdmVudFRpbWVzLkNvbnRhaW5zKCRjb250cm9sSWQpIC1hbmQgDQoJKCRjdXJyZW50VGltZSAtICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5MYXN0RXZlbnRUaW1lc1skY29udHJvbElkXSkuVG90YWxNaWxsaXNlY29uZHMgLWx0ICRtaW5JbnRlcnZhbCkNCgl7DQoJCXJldHVybiAkZmFsc2UNCgl9DQoJDQoJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkxhc3RFdmVudFRpbWVzWyRjb250cm9sSWRdID0gJGN1cnJlbnRUaW1lDQoJcmV0dXJuICR0cnVlDQp9DQoNCmZ1bmN0aW9uIEFkZEZvcm1DbGVhbnVwSGFuZGxlcg0Kew0KCXBhcmFtKCRmb3JtKQ0KCQ0KCWlmICgtbm90ICRmb3JtLlRhZy5FeHRlbnNpb25DbGVhbnVwQWRkZWQpDQoJew0KCQkkZm9ybS5BZGRfRm9ybUNsb3Npbmcoew0KCQkJCXBhcmFtKCRzcmMsICRlKQ0KCQkJDQoJCQkJdHJ5DQoJCQkJew0KCQkJCQkkaW5zdGFuY2VJZCA9ICRzcmMuVGFnLkluc3RhbmNlSWQNCgkJCQkJaWYgKCRpbnN0YW5jZUlkKQ0KCQkJCQl7DQoJCQkJCQlDbGVhbnVwSW5zdGFuY2VSZXNvdXJjZXMgJGluc3RhbmNlSWQNCgkJCQkJfQ0KCQkJCX0NCgkJCQljYXRjaA0KCQkJCXsNCgkJCQkJV3JpdGUtVmVyYm9zZSAoIkZUT09MOiBFcnJvciBkdXJpbmcgZm9ybSBjbGVhbnVwOiB7MH0iIC1mICRfLkV4Y2VwdGlvbi5NZXNzYWdlKSAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJCX0NCgkJCX0pDQoJCQ0KCQkkZm9ybS5UYWcgfCBBZGQtTWVtYmVyIC1Ob3RlUHJvcGVydHlOYW1lIEV4dGVuc2lvbkNsZWFudXBBZGRlZCAtTm90ZVByb3BlcnR5VmFsdWUgJHRydWUgLUZvcmNlDQoJfQ0KfQ0KDQpmdW5jdGlvbiBDbGVhbnVwSW5zdGFuY2VSZXNvdXJjZXMNCnsNCglwYXJhbSgkaW5zdGFuY2VJZCkNCgkNCgkkaW5zdGFuY2VLZXkgPSAiaW5zdGFuY2VfJGluc3RhbmNlSWQiDQoJDQoJJGtleXNUb1JlbW92ZSA9IEAoKQ0KCQ0KCSRhY3RpdmVFeHRlbnNpb25zID0gQCgpDQoJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZy5Db250YWlucygkaW5zdGFuY2VLZXkpIC1hbmQgDQoJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLkFjdGl2ZUV4dGVuc2lvbnMpDQoJew0KCQkkYWN0aXZlRXh0ZW5zaW9ucyA9IEAoKSArICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLkFjdGl2ZUV4dGVuc2lvbnMNCgl9DQoJDQoJZm9yZWFjaCAoJGtleSBpbiAkYWN0aXZlRXh0ZW5zaW9ucykNCgl7DQoJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5Db250YWlucygka2V5KSkNCgkJew0KCQkJJGV4dERhdGEgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YVska2V5XQ0KCQkJaWYgKCRleHREYXRhLlJ1bm5pbmdTcGFtbWVyKQ0KCQkJew0KCQkJCSRleHREYXRhLlJ1bm5pbmdTcGFtbWVyLlN0b3AoKQ0KCQkJCSRleHREYXRhLlJ1bm5pbmdTcGFtbWVyLkRpc3Bvc2UoKQ0KCQkJfQ0KCQkJJGtleXNUb1JlbW92ZSArPSAka2V5DQoJCX0NCgl9DQoJDQoJZm9yZWFjaCAoJGtleSBpbiAka2V5c1RvUmVtb3ZlKQ0KCXsNCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvbkRhdGEuUmVtb3ZlKCRrZXkpDQoJfQ0KCQ0KCSR0aW1lcktleXNUb1JlbW92ZSA9IEAoKQ0KCWZvcmVhY2ggKCRrZXkgaW4gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVycy5LZXlzKQ0KCXsNCgkJaWYgKCRrZXkgLWxpa2UgIkV4dFNwYW1tZXJfJHtpbnN0YW5jZUlkfV8qIiAtb3IgJGtleSAtZXEgImZ0b29sUG9zaXRpb25fJGluc3RhbmNlSWQiKQ0KCQl7DQoJCQkkdGltZXIgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzWyRrZXldDQoJCQlpZiAoJHRpbWVyKQ0KCQkJew0KCQkJCSR0aW1lci5TdG9wKCkNCgkJCQkkdGltZXIuRGlzcG9zZSgpDQoJCQl9DQoJCQkkdGltZXJLZXlzVG9SZW1vdmUgKz0gJGtleQ0KCQl9DQoJfQ0KCQ0KCWZvcmVhY2ggKCRrZXkgaW4gJHRpbWVyS2V5c1RvUmVtb3ZlKQ0KCXsNCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVycy5SZW1vdmUoJGtleSkNCgl9DQoJDQogICAgaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5GdG9vbEZvcm1zLkNvbnRhaW5zKCRpbnN0YW5jZUlkKSkgew0KICAgICAgICAkZm9ybSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5GdG9vbEZvcm1zWyRpbnN0YW5jZUlkXQ0KICAgICAgICBpZiAoJGZvcm0gLWFuZCAkZm9ybS5UYWcgLWFuZCAkZm9ybS5UYWcuSG90a2V5SWQpIHsNCgkJCXRyeSB7DQoJCQkJVW5yZWdpc3Rlci1Ib3RrZXlJbnN0YW5jZSAtSWQgJGZvcm0uVGFnLkhvdGtleUlkIC1Pd25lcktleSAkZm9ybS5UYWcuSW5zdGFuY2VJZA0KCQkJfSBjYXRjaCB7DQoJCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byB1bnJlZ2lzdGVyIGhvdGtleSB3aXRoIElEICQoJGZvcm0uVGFnLkhvdGtleUlkKSBmb3IgaW5zdGFuY2UgJGluc3RhbmNlSWQuIEVycm9yOiAkXyINCgkJCX0NCiAgICAgICAgfQ0KICAgIH0NCg0KCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmcuQ29udGFpbnMoJGluc3RhbmNlS2V5KSkNCgl7DQoJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZy5SZW1vdmUoJGluc3RhbmNlS2V5KQ0KCX0NCgkNCglbU3lzdGVtLkdDXTo6Q29sbGVjdCgpDQoJW1N5c3RlbS5HQ106OldhaXRGb3JQZW5kaW5nRmluYWxpemVycygpDQp9DQoNCmZ1bmN0aW9uIFN0b3AtRnRvb2xGb3JtDQp7DQoJcGFyYW0oJEZvcm0pDQoJDQoJaWYgKC1ub3QgJEZvcm0gLW9yICRGb3JtLklzRGlzcG9zZWQpDQoJew0KCQlyZXR1cm4NCgl9DQoJDQoJdHJ5DQoJew0KCQkkaW5zdGFuY2VJZCA9ICRGb3JtLlRhZy5JbnN0YW5jZUlkDQoJCWlmICgkaW5zdGFuY2VJZCkNCgkJew0KCQkJQ2xlYW51cEluc3RhbmNlUmVzb3VyY2VzICRpbnN0YW5jZUlkDQoJCQkNCgkJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRnRvb2xGb3Jtcy5Db250YWlucygkaW5zdGFuY2VJZCkpDQoJCQl7DQoJCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkZ0b29sRm9ybXMuUmVtb3ZlKCRpbnN0YW5jZUlkKQ0KCQkJfQ0KCQl9DQoJCQ0KCQkkRm9ybS5DbG9zZSgpDQoJCSRGb3JtLkRpc3Bvc2UoKQ0KCX0NCgljYXRjaA0KCXsNCgkJV3JpdGUtVmVyYm9zZSAoIkZUT09MOiBFcnJvciBzdG9wcGluZyBGdG9vbCBmb3JtOiB7MH0iIC1mICRfLkV4Y2VwdGlvbi5NZXNzYWdlKSAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCX0NCn0NCg0KZnVuY3Rpb24gUmVtb3ZlRXh0ZW5zaW9uDQp7DQoJcGFyYW0oJGZvcm0sICRleHRLZXkpDQoJDQoJaWYgKC1ub3QgJGZvcm0gLW9yIC1ub3QgJGV4dEtleSkNCgl7DQoJCXJldHVybiAkZmFsc2UgDQoJfQ0KCQ0KCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhIC1vciANCgkJLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5Db250YWlucygkZXh0S2V5KSkNCgl7DQoJCXJldHVybiAkZmFsc2UNCgl9DQoJDQoJJGV4dERhdGEgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YVskZXh0S2V5XQ0KCWlmICgtbm90ICRleHREYXRhKQ0KCXsNCgkJcmV0dXJuICRmYWxzZSANCgl9DQoJDQoJJGV4dE51bSA9IFtpbnRdJGV4dERhdGEuRXh0TnVtIA0KCSRpbnN0YW5jZUlkID0gJGV4dERhdGEuSW5zdGFuY2VJZA0KCSRpbnN0YW5jZUtleSA9ICJpbnN0YW5jZV8kaW5zdGFuY2VJZCINCgkNCgl0cnkNCgl7DQoJCWlmICgkZXh0RGF0YS5SdW5uaW5nU3BhbW1lcikNCgkJew0KCQkJJGV4dERhdGEuUnVubmluZ1NwYW1tZXIuU3RvcCgpDQoJCQkkZXh0RGF0YS5SdW5uaW5nU3BhbW1lci5EaXNwb3NlKCkNCgkJCSRleHREYXRhLlJ1bm5pbmdTcGFtbWVyID0gJG51bGwNCgkJCQ0KCQkJJHRpbWVyS2V5ID0gIkV4dFNwYW1tZXJfJHtpbnN0YW5jZUlkfV8kZXh0TnVtIg0KCQkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnMuQ29udGFpbnMoJHRpbWVyS2V5KSkNCgkJCXsNCgkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzLlJlbW92ZSgkdGltZXJLZXkpDQoJCQl9DQoJCX0NCgkJDQoJCWlmICgkZXh0RGF0YS5QYW5lbCAtYW5kIC1ub3QgJGV4dERhdGEuUGFuZWwuSXNEaXNwb3NlZCkNCgkJew0KCQkJJGZvcm0uQ29udHJvbHMuUmVtb3ZlKCRleHREYXRhLlBhbmVsKQ0KCQkJJGV4dERhdGEuUGFuZWwuRGlzcG9zZSgpDQoJCX0NCgkJDQoJCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZyAtb3IgDQoJCQktbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZy5Db250YWlucygkaW5zdGFuY2VLZXkpKQ0KCQl7DQoJCQlJbml0aWFsaXplRXh0ZW5zaW9uVHJhY2tpbmcgJGluc3RhbmNlSWQNCgkJfQ0KCQkNCgkJJGludEV4dE51bSA9IFtpbnRdJGV4dE51bSANCgkJDQoJCSRmb3VuZCA9ICRmYWxzZQ0KCQlmb3JlYWNoICgkbnVtIGluICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLlJlbW92ZWRFeHROdW1zKQ0KCQl7DQoJCQkkaW50TnVtID0gMA0KCQkJaWYgKFtpbnRdOjpUcnlQYXJzZSgkbnVtLlRvU3RyaW5nKCksIFtyZWZdJGludE51bSkgLWFuZCAkaW50TnVtIC1lcSAkaW50RXh0TnVtKQ0KCQkJew0KCQkJCSRmb3VuZCA9ICR0cnVlDQoJCQkJYnJlYWsNCgkJCX0NCgkJfQ0KCQkNCgkJaWYgKC1ub3QgJGZvdW5kKQ0KCQl7DQoJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5SZW1vdmVkRXh0TnVtcyArPSAkaW50RXh0TnVtDQoJCX0NCgkJDQoJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25UcmFja2luZ1skaW5zdGFuY2VLZXldLkFjdGl2ZUV4dGVuc2lvbnMgPSANCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvblRyYWNraW5nWyRpbnN0YW5jZUtleV0uQWN0aXZlRXh0ZW5zaW9ucyB8IA0KCQlXaGVyZS1PYmplY3QgeyAkXyAtbmUgJGV4dEtleSB9DQoJCQ0KCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5SZW1vdmUoJGV4dEtleSkNCg0KICAgICAgICBpZiAoJGV4dERhdGEuSG90a2V5SWQpIHsNCgkJCXRyeSB7DQoJCQkJVW5yZWdpc3Rlci1Ib3RrZXlJbnN0YW5jZSAtSWQgJGV4dERhdGEuSG90a2V5SWQgLU93bmVyS2V5ICRleHRLZXkNCgkJCX0gY2F0Y2ggew0KCQkJCVdyaXRlLVdhcm5pbmcgIkZUT09MOiBGYWlsZWQgdG8gdW5yZWdpc3RlciBob3RrZXkgSUQgJCgkZXh0RGF0YS5Ib3RrZXlJZCkgZm9yIGV4dGVuc2lvbiAkKCRleHRLZXkpLiBFcnJvcjogJF8iDQoJCQl9DQogICAgICAgIH0NCgkJDQoJCVJlcG9zaXRpb25FeHRlbnNpb25zICRmb3JtICRpbnN0YW5jZUlkDQoJCQ0KCQlyZXR1cm4gJHRydWUNCgl9DQoJY2F0Y2gNCgl7DQoJCVdyaXRlLVZlcmJvc2UgKCJGVE9PTDogRXJyb3IgaW4gUmVtb3ZlRXh0ZW5zaW9uOiB7MH0iIC1mICRfLkV4Y2VwdGlvbi5NZXNzYWdlKSAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQlyZXR1cm4gJGZhbHNlDQoJfQ0KfQ0KDQojZW5kcmVnaW9uDQoNCiNyZWdpb24gQ29yZSBGdW5jdGlvbnMNCg0KZnVuY3Rpb24gRnRvb2xTZWxlY3RlZFJvdw0Kew0KCXBhcmFtKCRyb3cpDQoJDQoJaWYgKC1ub3QgJHJvdyAtb3IgLW5vdCAkcm93LkNlbGxzIC1vciAkcm93LkNlbGxzLkNvdW50IC1sdCAzKQ0KCXsNCgkJV3JpdGUtVmVyYm9zZSAnRlRPT0w6IEludmFsaWQgcm93IGRhdGEsIHNraXBwaW5nJyAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KCQlyZXR1cm4NCgl9DQoJDQoJJGluc3RhbmNlSWQgPSAkcm93LkNlbGxzWzJdLlZhbHVlLlRvU3RyaW5nKCkNCglpZiAoLW5vdCAkcm93LlRhZyAtb3IgLW5vdCAkcm93LlRhZy5NYWluV2luZG93SGFuZGxlKQ0KCXsNCgkJV3JpdGUtVmVyYm9zZSAiRlRPT0w6IE1pc3Npbmcgd2luZG93IGhhbmRsZSBmb3IgaW5zdGFuY2UgJGluc3RhbmNlSWQsIHNraXBwaW5nIiAtRm9yZWdyb3VuZENvbG9yIFllbGxvdw0KCQlyZXR1cm4NCgl9DQoJDQoJJHdpbmRvd0hhbmRsZSA9ICRyb3cuVGFnLk1haW5XaW5kb3dIYW5kbGUNCglpZiAoLW5vdCAkaW5zdGFuY2VJZCkNCgl7DQoJCVdyaXRlLVZlcmJvc2UgJ0ZUT09MOiBNaXNzaW5nIGluc3RhbmNlIElELCBza2lwcGluZycgLUZvcmVncm91bmRDb2xvciBZZWxsb3cNCgkJcmV0dXJuDQoJfQ0KCQ0KCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRnRvb2xGb3Jtcy5Db250YWlucygkaW5zdGFuY2VJZCkpDQoJew0KCQkkZXhpc3RpbmdGb3JtID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkZ0b29sRm9ybXNbJGluc3RhbmNlSWRdDQoJCWlmICgtbm90ICRleGlzdGluZ0Zvcm0uSXNEaXNwb3NlZCkNCgkJew0KCQkJJGV4aXN0aW5nRm9ybS5CcmluZ1RvRnJvbnQoKQ0KCQkJcmV0dXJuDQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRnRvb2xGb3Jtcy5SZW1vdmUoJGluc3RhbmNlSWQpDQoJCX0NCgl9DQoJDQoJCSR0YXJnZXRXaW5kb3dSZWN0ID0gTmV3LU9iamVjdCBDdXN0b20uTmF0aXZlK1JFQ1QNCgkJW0N1c3RvbS5OYXRpdmVdOjpHZXRXaW5kb3dSZWN0KCR3aW5kb3dIYW5kbGUsIFtyZWZdJHRhcmdldFdpbmRvd1JlY3QpDQoJDQoJJHdpbmRvd1RpdGxlID0gaWYgKCRyb3cuVGFnIC1hbmQgJHJvdy5UYWcuTWFpbldpbmRvd1RpdGxlKQ0KCXsNCgkJJHJvdy5UYWcuTWFpbldpbmRvd1RpdGxlDQoJfQ0KCWVsc2VpZiAoJHJvdy5DZWxsc1sxXS5WYWx1ZSkNCgl7DQoJCSRyb3cuQ2VsbHNbMV0uVmFsdWUuVG9TdHJpbmcoKQ0KCX0NCgllbHNlDQoJew0KCQkiV2luZG93XyRpbnN0YW5jZUlkIg0KCX0NCgkNCgkkZnRvb2xGb3JtID0gQ3JlYXRlRnRvb2xGb3JtICRpbnN0YW5jZUlkICR0YXJnZXRXaW5kb3dSZWN0ICR3aW5kb3dUaXRsZSAkcm93DQoJDQoJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkZ0b29sRm9ybXNbJGluc3RhbmNlSWRdID0gJGZ0b29sRm9ybQ0KCQ0KICAgICRmdG9vbEZvcm0uU2hvdygpDQoJJGZ0b29sRm9ybS5CcmluZ1RvRnJvbnQoKQ0KfQ0KDQpmdW5jdGlvbiBDcmVhdGVGdG9vbEZvcm0NCnsNCglwYXJhbSgkaW5zdGFuY2VJZCwgJHRhcmdldFdpbmRvd1JlY3QsICR3aW5kb3dUaXRsZSwgJHJvdykNCgkNCgkkZnRvb2xGb3JtID0gU2V0LVVJRWxlbWVudCAtdHlwZSAnRm9ybScgLXZpc2libGUgJHRydWUgLXdpZHRoIDI1MCAtaGVpZ2h0IDE3MCAtdG9wICgkdGFyZ2V0V2luZG93UmVjdC5Ub3AgKyAzMCkgLWxlZnQgKCR0YXJnZXRXaW5kb3dSZWN0LkxlZnQgKyAxMCkgLWJnIEAoMzAsIDMwLCAzMCkgLWZnIEAoMjU1LCAyNTUsIDI1NSkgLXRleHQgIkZUb29sIC0gJGluc3RhbmNlSWQiIC1zdGFydFBvc2l0aW9uICdNYW51YWwnIC1mb3JtQm9yZGVyU3R5bGUgMCAtb3BhY2l0eSAxDQoJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkljb24gLWFuZCAoVGVzdC1QYXRoICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkljb24pKQ0KCXsNCgkJdHJ5DQoJCXsNCgkJCSRpY29uID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5JY29uKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlBhdGhzLkljb24pDQoJCQkkZnRvb2xGb3JtLkljb24gPSAkaWNvbg0KCQl9DQoJCWNhdGNoDQoJCXsNCgkJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBGYWlsZWQgdG8gbG9hZCBpY29uIGZyb20gJCgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5QYXRocy5JY29uKTogJF8iIC1Gb3JlZ3JvdW5kQ29sb3IgUmVkDQoJCX0NCgl9DQoJaWYgKC1ub3QgJGZ0b29sRm9ybSkNCgl7DQoJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBGYWlsZWQgdG8gY3JlYXRlIGZvcm0gZm9yICRpbnN0YW5jZUlkLCBza2lwcGluZyIgLUZvcmVncm91bmRDb2xvciBSZWQNCgkJcmV0dXJuICRudWxsDQoJfQ0KCQ0KCSRoZWFkZXJQYW5lbCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ1BhbmVsJyAtdmlzaWJsZSAkdHJ1ZSAtd2lkdGggMjUwIC1oZWlnaHQgMjAgLXRvcCAwIC1sZWZ0IDAgLWJnIEAoNDAsIDQwLCA0MCkNCgkkZnRvb2xGb3JtLkNvbnRyb2xzLkFkZCgkaGVhZGVyUGFuZWwpDQoNCgkkYnRuSW5zdGFuY2VIb3RrZXlUb2dnbGUgPSBTZXQtVUlFbGVtZW50IC10eXBlICdMYWJlbCcgLXZpc2libGUgJHRydWUgLXdpZHRoIDE1IC1oZWlnaHQgMTQgLXRvcCAyIC1sZWZ0IDExOCAtYmcgQCg0MCwgNDAsIDQwLCAwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAoW2NoYXJdMHgyMzI4KSAtZm9udCAoTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDEwKSkNCgkkaGVhZGVyUGFuZWwuQ29udHJvbHMuQWRkKCRidG5JbnN0YW5jZUhvdGtleVRvZ2dsZSkNCg0KCSRsYWJlbFdpblRpdGxlID0gU2V0LVVJRWxlbWVudCAtdHlwZSAnTGFiZWwnIC12aXNpYmxlICR0cnVlIC13aWR0aCAxMjAgLWhlaWdodCAyMCAtdG9wIDUgLWxlZnQgNSAtYmcgQCg0MCwgNDAsIDQwLCAwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAkcm93LkNlbGxzWzFdLlZhbHVlIC1mb250IChOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgNiwgW1N5c3RlbS5EcmF3aW5nLkZvbnRTdHlsZV06OlJlZ3VsYXIpKQ0KCSRoZWFkZXJQYW5lbC5Db250cm9scy5BZGQoJGxhYmVsV2luVGl0bGUpDQoJDQoJJGJ0bkhvdGtleVRvZ2dsZSA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ1RvZ2dsZScgLXZpc2libGUgJHRydWUgLXdpZHRoIDMwIC1oZWlnaHQgMTQgLXRvcCAzIC1sZWZ0IDEzNSAtYmcgQCg0MCwgODAsIDgwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAnJyAtZnMgJ0ZsYXQnIC1mb250IChOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOCkpIC1jaGVja2VkICR0cnVlDQoJJGhlYWRlclBhbmVsLkNvbnRyb2xzLkFkZCgkYnRuSG90a2V5VG9nZ2xlKQ0KDQoJJGJ0bkFkZCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ0J1dHRvbicgLXZpc2libGUgJHRydWUgLXdpZHRoIDE0IC1oZWlnaHQgMTQgLXRvcCAzIC1sZWZ0IDE3MCAtYmcgQCg0MCwgODAsIDgwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAoW2NoYXJdMHgyNzk1KSAtZnMgJ0ZsYXQnIC1mb250IChOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgMTEpKQ0KCSRoZWFkZXJQYW5lbC5Db250cm9scy5BZGQoJGJ0bkFkZCkNCgkNCgkkYnRuU2hvd0hpZGUgPSBTZXQtVUlFbGVtZW50IC10eXBlICdCdXR0b24nIC12aXNpYmxlICR0cnVlIC13aWR0aCAxNCAtaGVpZ2h0IDE0IC10b3AgMyAtbGVmdCAxODUgLWJnIEAoNjAsIDYwLCAxMDApIC1mZyBAKDI1NSwgMjU1LCAyNTUpIC10ZXh0IChbY2hhcl0weDI1QjIpIC1mcyAnRmxhdCcgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCAxMSkpDQoJJGhlYWRlclBhbmVsLkNvbnRyb2xzLkFkZCgkYnRuU2hvd0hpZGUpDQoJDQoJJGJ0bkNsb3NlID0gU2V0LVVJRWxlbWVudCAtdHlwZSAnQnV0dG9uJyAtdmlzaWJsZSAkdHJ1ZSAtd2lkdGggMTQgLWhlaWdodCAxNCAtdG9wIDMgLWxlZnQgMjEwIC1iZyBAKDE1MCwgMjAsIDIwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAoW2NoYXJdMHgxNjZEKSAtZnMgJ0ZsYXQnIC1mb250IChOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgMTEpKQ0KCSRoZWFkZXJQYW5lbC5Db250cm9scy5BZGQoJGJ0bkNsb3NlKQ0KCQ0KCSRwYW5lbFNldHRpbmdzID0gU2V0LVVJRWxlbWVudCAtdHlwZSAnUGFuZWwnIC12aXNpYmxlICR0cnVlIC13aWR0aCAxOTAgLWhlaWdodCA2MCAtdG9wIDYwIC1sZWZ0IDQwIC1iZyBAKDUwLCA1MCwgNTApDQoJJGZ0b29sRm9ybS5Db250cm9scy5BZGQoJHBhbmVsU2V0dGluZ3MpDQoJDQoJJGJ0bktleVNlbGVjdCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ0J1dHRvbicgLXZpc2libGUgJHRydWUgLXdpZHRoIDU1IC1oZWlnaHQgMjUgLXRvcCA0IC1sZWZ0IDMgLWJnIEAoNDAsIDQwLCA0MCkgLWZnIEAoMjU1LCAyNTUsIDI1NSkgLXRleHQgJycgLWZzICdGbGF0JyAtZm9udCAoTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDgpKQ0KCSRwYW5lbFNldHRpbmdzLkNvbnRyb2xzLkFkZCgkYnRuS2V5U2VsZWN0KQ0KCQ0KCSRpbnRlcnZhbCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ1RleHRCb3gnIC12aXNpYmxlICR0cnVlIC13aWR0aCA0NyAtaGVpZ2h0IDE1IC10b3AgNSAtbGVmdCA1OSAtYmcgQCg0MCwgNDAsIDQwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAnMTAwMCcgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkNCgkkcGFuZWxTZXR0aW5ncy5Db250cm9scy5BZGQoJGludGVydmFsKQ0KCQ0KCSRuYW1lID0gU2V0LVVJRWxlbWVudCAtdHlwZSAnVGV4dEJveCcgLXZpc2libGUgJHRydWUgLXdpZHRoIDM3IC1oZWlnaHQgMTcgLXRvcCA1IC1sZWZ0IDEwOCAtYmcgQCg0MCwgNDAsIDQwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAnTWFpbicgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA4LCBbU3lzdGVtLkRyYXdpbmcuRm9udFN0eWxlXTo6UmVndWxhcikpDQoJJHBhbmVsU2V0dGluZ3MuQ29udHJvbHMuQWRkKCRuYW1lKQ0KCQ0KCSRidG5TdGFydCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ0J1dHRvbicgLXZpc2libGUgJHRydWUgLXdpZHRoIDQ1IC1oZWlnaHQgMjAgLXRvcCAzNSAtbGVmdCAxMCAtYmcgQCgwLCAxMjAsIDIxNSkgLWZnIEAoMjU1LCAyNTUsIDI1NSkgLXRleHQgJ1N0YXJ0JyAtZnMgJ0ZsYXQnIC1mb250IChOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOSkpDQoJJHBhbmVsU2V0dGluZ3MuQ29udHJvbHMuQWRkKCRidG5TdGFydCkNCgkNCgkkYnRuU3RvcCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ0J1dHRvbicgLXZpc2libGUgJHRydWUgLXdpZHRoIDQ1IC1oZWlnaHQgMjAgLXRvcCAzNSAtbGVmdCA2NyAtYmcgQCgyMDAsIDUwLCA1MCkgLWZnIEAoMjU1LCAyNTUsIDI1NSkgLXRleHQgJ1N0b3AnIC1mcyAnRmxhdCcgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkNCgkkYnRuU3RvcC5FbmFibGVkID0gJGZhbHNlDQoJJGJ0blN0b3AuVmlzaWJsZSA9ICRmYWxzZQ0KCSRwYW5lbFNldHRpbmdzLkNvbnRyb2xzLkFkZCgkYnRuU3RvcCkNCg0KCSRidG5Ib3RLZXkgPSBTZXQtVUlFbGVtZW50IC10eXBlICdCdXR0b24nIC12aXNpYmxlICR0cnVlIC13aWR0aCA0MCAtaGVpZ2h0IDI0IC10b3AgNCAtbGVmdCAxNDYgLWJnIEAoMjAwLCA1MCwgNTApIC1mZyBAKDI1NSwgMjU1LCAyNTUpIC10ZXh0ICdIb3RrZXknIC1mcyAnRmxhdCcgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA2KSkNCgkkcGFuZWxTZXR0aW5ncy5Db250cm9scy5BZGQoJGJ0bkhvdEtleSkNCgkNCgkkcG9zaXRpb25TbGlkZXJZID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5UcmFja0Jhcg0KCSRwb3NpdGlvblNsaWRlclkuT3JpZW50YXRpb24gPSAnVmVydGljYWwnDQoJJHBvc2l0aW9uU2xpZGVyWS5NaW5pbXVtID0gMA0KCSRwb3NpdGlvblNsaWRlclkuTWF4aW11bSA9IDEwMA0KCSRwb3NpdGlvblNsaWRlclkuVGlja0ZyZXF1ZW5jeSA9IDMwMA0KCSRwb3NpdGlvblNsaWRlclkuVmFsdWUgPSAwDQoJJHBvc2l0aW9uU2xpZGVyWS5TaXplID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5TaXplKDEsIDExMCkNCgkkcG9zaXRpb25TbGlkZXJZLkxvY2F0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Qb2ludCg1LCAyMCkNCgkkZnRvb2xGb3JtLkNvbnRyb2xzLkFkZCgkcG9zaXRpb25TbGlkZXJZKQ0KCQkNCgkkcG9zaXRpb25TbGlkZXJYID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5UcmFja0Jhcg0KCSRwb3NpdGlvblNsaWRlclguTWluaW11bSA9IDANCgkkcG9zaXRpb25TbGlkZXJYLk1heGltdW0gPSAxMDANCgkkcG9zaXRpb25TbGlkZXJYLlRpY2tGcmVxdWVuY3kgPSAzMDANCgkkcG9zaXRpb25TbGlkZXJYLlZhbHVlID0gMA0KCSRwb3NpdGlvblNsaWRlclguU2l6ZSA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuU2l6ZSgxOTAsIDEpDQoJJHBvc2l0aW9uU2xpZGVyWC5Mb2NhdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuUG9pbnQoNDUsIDI1KQ0KCSRmdG9vbEZvcm0uQ29udHJvbHMuQWRkKCRwb3NpdGlvblNsaWRlclgpDQoNCgkkZm9ybURhdGEgPSBbUFNDdXN0b21PYmplY3RdQHsNCgkJSW5zdGFuY2VJZCAgICAgICAgICAgID0gJGluc3RhbmNlSWQNCgkJU2VsZWN0ZWRXaW5kb3cgICAgICAgID0gJHJvdy5UYWcuTWFpbldpbmRvd0hhbmRsZQ0KCQlCdG5LZXlTZWxlY3QgICAgICAgICAgPSAkYnRuS2V5U2VsZWN0DQoJCUludGVydmFsICAgICAgICAgICAgICA9ICRpbnRlcnZhbA0KCQlOYW1lICAgICAgICAgICAgICAgICAgPSAkbmFtZQ0KCQlCdG5TdGFydCAgICAgICAgICAgICAgPSAkYnRuU3RhcnQNCgkJQnRuU3RvcCAgICAgICAgICAgICAgID0gJGJ0blN0b3ANCgkJQnRuSG90S2V5ICAgICAgICAgICAgID0gJGJ0bkhvdEtleQ0KCQlCdG5JbnN0YW5jZUhvdGtleVRvZ2dsZSA9ICRidG5JbnN0YW5jZUhvdGtleVRvZ2dsZQ0KCQlCdG5Ib3RrZXlUb2dnbGUgICAgICAgPSAkYnRuSG90a2V5VG9nZ2xlDQoJCUJ0bkFkZCAgICAgICAgICAgICAgICA9ICRidG5BZGQNCgkJQnRuQ2xvc2UgICAgICAgICAgICAgID0gJGJ0bkNsb3NlDQoJCUJ0blNob3dIaWRlICAgICAgICAgICA9ICRidG5TaG93SGlkZQ0KCQlQb3NpdGlvblNsaWRlclggICAgICAgPSAkcG9zaXRpb25TbGlkZXJYDQoJCVBvc2l0aW9uU2xpZGVyWSAgICAgICA9ICRwb3NpdGlvblNsaWRlclkNCgkJRm9ybSAgICAgICAgICAgICAgICAgID0gJGZ0b29sRm9ybQ0KCQlSdW5uaW5nU3BhbW1lciAgICAgICAgPSAkbnVsbA0KCQlXaW5kb3dUaXRsZSAgICAgICAgICAgPSAkd2luZG93VGl0bGUNCgkJUHJvY2VzcyAgICAgICAgICAgICAgID0gJHJvdy5UYWcNCgkJT3JpZ2luYWxMZWZ0ICAgICAgICAgID0gJHRhcmdldFdpbmRvd1JlY3QuTGVmdA0KCQlJc0NvbGxhcHNlZCAgICAgICAgICAgPSAkZmFsc2UNCgkJTGFzdEV4dGVuc2lvbkFkZGVkICAgID0gMA0KCQlFeHRlbnNpb25Db3VudCAgICAgICAgPSAwDQoJCUNvbnRyb2xUb0V4dGVuc2lvbk1hcCA9IEB7fQ0KCQlPcmlnaW5hbEhlaWdodCAgICAgICAgPSAxMzANCgkJSG90a2V5SWQgICAgICAgICAgICAgID0gJG51bGwgDQoJCUdsb2JhbEhvdGtleUlkICAgICAgICA9ICRudWxsIA0KCQlQcm9maWxlUHJlZml4ICAgICAgICAgPSAkbnVsbCANCgkJSG90a2V5ICAgICAgICAgICAgICAgID0gJG51bGwgDQoJCUdsb2JhbEhvdGtleSAgICAgICAgICA9ICRudWxsIA0KCX0NCgkNCgkkZnRvb2xGb3JtLlRhZyA9ICRmb3JtRGF0YQ0KCQ0KCUxvYWRGdG9vbFNldHRpbmdzICRmb3JtRGF0YQ0KCVRvZ2dsZUluc3RhbmNlSG90a2V5cyAtSW5zdGFuY2VJZCAkZm9ybURhdGEuSW5zdGFuY2VJZCAtVG9nZ2xlU3RhdGUgJGZvcm1EYXRhLkJ0bkhvdGtleVRvZ2dsZS5DaGVja2VkDQoJDQoJaWYgKC1ub3QgW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGZvcm1EYXRhLkhvdGtleSkpIHsNCgkJdHJ5IHsNCgkJCSRzY3JpcHRCbG9jayA9IFtzY3JpcHRibG9ja106OkNyZWF0ZSgiVG9nZ2xlU3BlY2lmaWNGdG9vbEluc3RhbmNlIC1JbnN0YW5jZUlkICckKCRmb3JtRGF0YS5JbnN0YW5jZUlkKScgLUV4dEtleSBgJG51bGwiKQ0KCQkJJG5ld0hvdGtleUlkID0gU2V0LUhvdGtleSAtS2V5Q29tYmluYXRpb25TdHJpbmcgJGZvcm1EYXRhLkhvdGtleSAtQWN0aW9uICRzY3JpcHRCbG9jayAtT3duZXJLZXkgJGZvcm1EYXRhLkluc3RhbmNlSWQNCgkJCSRmb3JtRGF0YS5Ib3RrZXlJZCA9ICRuZXdIb3RrZXlJZA0KCQkJJGhvdGtleUlkRGlzcGxheSA9IGlmICgkZm9ybURhdGEuSG90a2V5SWQpIHsgJGZvcm1EYXRhLkhvdGtleUlkIH0gZWxzZSB7ICdOb25lJyB9DQoJCQlXcml0ZS1WZXJib3NlICJGVE9PTDogUmVnaXN0ZXJlZCBob3RrZXkgJCgkZm9ybURhdGEuSG90a2V5KSAoSUQ6ICRob3RrZXlJZERpc3BsYXkpIGZvciBtYWluIGluc3RhbmNlICQoJGZvcm1EYXRhLkluc3RhbmNlSWQpIG9uIGxvYWQuIg0KCQl9IGNhdGNoIHsNCgkJCVdyaXRlLVdhcm5pbmcgIkZUT09MOiBGYWlsZWQgdG8gcmVnaXN0ZXIgaG90a2V5ICQoJGZvcm1EYXRhLkhvdGtleSkgZm9yIG1haW4gaW5zdGFuY2UgJCgkZm9ybURhdGEuSW5zdGFuY2VJZCkgb24gbG9hZC4gRXJyb3I6ICRfIg0KCQkJJGZvcm1EYXRhLkhvdGtleUlkID0gJG51bGwgDQoJCX0NCgl9DQoNCglpZiAoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZm9ybURhdGEuR2xvYmFsSG90a2V5KSkgew0KCQl0cnkgew0KCQkJJG93bmVyS2V5ID0gImdsb2JhbF90b2dnbGVfJCgkZm9ybURhdGEuSW5zdGFuY2VJZCkiDQoJCQkkc2NyaXB0ID0gQCINCldyaXRlLVZlcmJvc2UgIkZUT09MOiBHbG9iYWwtdG9nZ2xlIGhvdGtleSB0cmlnZ2VyZWQgZm9yIGluc3RhbmNlICckKCRmb3JtRGF0YS5JbnN0YW5jZUlkKSciDQppZiAoYCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5GdG9vbEZvcm1zLkNvbnRhaW5zKCckKCRmb3JtRGF0YS5JbnN0YW5jZUlkKScpKSB7DQoJYCRmID0gYCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5GdG9vbEZvcm1zWyckKCRmb3JtRGF0YS5JbnN0YW5jZUlkKSddDQoJaWYgKGAkZiAtYW5kIC1ub3QgYCRmLklzRGlzcG9zZWQgLWFuZCBgJGYuVGFnKSB7DQoJCWAkdG9nZ2xlID0gYCRmLlRhZy5CdG5Ib3RrZXlUb2dnbGUNCgkJaWYgKGAkdG9nZ2xlKSB7DQoJCQl0cnkgew0KICAgICAgICAgICAgICAgIGlmIChgJHRvZ2dsZS5JbnZva2VSZXF1aXJlZCkgew0KICAgICAgICAgICAgICAgICAgICBgJGFjdGlvbiA9IFtTeXN0ZW0uQWN0aW9uXXsgYCR0b2dnbGUuQ2hlY2tlZCA9IC1ub3QgYCR0b2dnbGUuQ2hlY2tlZCB9DQogICAgICAgICAgICAgICAgICAgIGAkdG9nZ2xlLkludm9rZShgJGFjdGlvbikNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBgJHRvZ2dsZS5DaGVja2VkID0gLW5vdCBgJHRvZ2dsZS5DaGVja2VkDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIFRvZ2dsZUluc3RhbmNlSG90a2V5cyAtSW5zdGFuY2VJZCAnJCgkZm9ybURhdGEuSW5zdGFuY2VJZCknIC1Ub2dnbGVTdGF0ZSBgJHRvZ2dsZS5DaGVja2VkDQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRlRPT0w6IEdsb2JhbCB0b2dnbGUgYWN0aW9uIGNvbXBsZXRlZCBmb3IgaW5zdGFuY2UgJyQoJGZvcm1EYXRhLkluc3RhbmNlSWQpJy4iDQogICAgICAgICAgICB9IGNhdGNoIHsNCiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJGVE9PTDogRXJyb3IgZHVyaW5nIGdsb2JhbCB0b2dnbGUgYWN0aW9uIGZvciBpbnN0YW5jZSAnJCgkZm9ybURhdGEuSW5zdGFuY2VJZCknLiBFcnJvcjogYCRfIg0KICAgICAgICAgICAgfQ0KCQl9DQoJfQ0KfQ0KIkANCgkJCSRzY3JpcHRCbG9jayA9IFtzY3JpcHRibG9ja106OkNyZWF0ZSgkc2NyaXB0KQ0KCQkJJGZvcm1EYXRhLkdsb2JhbEhvdGtleUlkID0gU2V0LUhvdGtleSAtS2V5Q29tYmluYXRpb25TdHJpbmcgJGZvcm1EYXRhLkdsb2JhbEhvdGtleSAtQWN0aW9uICRzY3JpcHRCbG9jayAtT3duZXJLZXkgJG93bmVyS2V5DQoJCQlXcml0ZS1WZXJib3NlICJGVE9PTDogUmVnaXN0ZXJlZCBnbG9iYWwtdG9nZ2xlIGhvdGtleSAkKCRmb3JtRGF0YS5HbG9iYWxIb3RrZXkpIChJRDogJCgkZm9ybURhdGEuR2xvYmFsSG90a2V5SWQpKSBmb3IgaW5zdGFuY2UgJCgkZm9ybURhdGEuSW5zdGFuY2VJZCkgb24gbG9hZC4iDQoJCX0gY2F0Y2ggew0KCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byByZWdpc3RlciBnbG9iYWwtdG9nZ2xlIGhvdGtleSAkKCRmb3JtRGF0YS5HbG9iYWxIb3RrZXkpIGZvciBpbnN0YW5jZSAkKCRmb3JtRGF0YS5JbnN0YW5jZUlkKSBvbiBsb2FkLiBFcnJvcjogJF8iDQoJCQkkZm9ybURhdGEuR2xvYmFsSG90a2V5SWQgPSAkbnVsbA0KCQl9DQoJfQ0KDQoJQ3JlYXRlUG9zaXRpb25UaW1lciAkZm9ybURhdGENCglBZGRGdG9vbEV2ZW50SGFuZGxlcnMgJGZvcm1EYXRhDQoJDQoJcmV0dXJuICRmdG9vbEZvcm0NCn0NCg0KZnVuY3Rpb24gQWRkRnRvb2xFdmVudEhhbmRsZXJzDQp7DQoJcGFyYW0oJGZvcm1EYXRhKQ0KCQ0KCSRmb3JtRGF0YS5JbnRlcnZhbC5BZGRfVGV4dENoYW5nZWQoew0KCQkJJGZvcm0gPSAkdGhpcy5GaW5kRm9ybSgpDQoJCQlpZiAoLW5vdCAkZm9ybSAtb3IgLW5vdCAkZm9ybS5UYWcpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkJJGRhdGEgPSAkZm9ybS5UYWcNCgkJDQoJCQkkaW50ZXJ2YWxWYWx1ZSA9IDANCgkJCWlmICgtbm90IFtpbnRdOjpUcnlQYXJzZSgkdGhpcy5UZXh0LCBbcmVmXSRpbnRlcnZhbFZhbHVlKSAtb3IgJGludGVydmFsVmFsdWUgLWx0IDEwKQ0KCQkJew0KCQkJCSR0aGlzLlRleHQgPSAnMTAwJw0KCQkJfQ0KCQkNCgkJCVVwZGF0ZVNldHRpbmdzICRkYXRhIC1mb3JjZVdyaXRlDQoJCX0pDQoNCgkkZm9ybURhdGEuTmFtZS5BZGRfVGV4dENoYW5nZWQoew0KCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJaWYgKC1ub3QgJGZvcm0gLW9yIC1ub3QgJGZvcm0uVGFnKQ0KCQl7DQoJCQlyZXR1cm4gDQoJCX0NCgkJJGRhdGEgPSAkZm9ybS5UYWcNCgkNCgkJVXBkYXRlU2V0dGluZ3MgJGRhdGEgLWZvcmNlV3JpdGUNCgl9KQ0KDQoJJGZvcm1EYXRhLlBvc2l0aW9uU2xpZGVyWC5BZGRfVmFsdWVDaGFuZ2VkKHsNCgkJJGZvcm0gPSAkdGhpcy5GaW5kRm9ybSgpDQoJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJew0KCQkJcmV0dXJuDQoJCX0NCgkJJGRhdGEgPSAkZm9ybS5UYWcNCgkJVXBkYXRlU2V0dGluZ3MgJGRhdGEgLWZvcmNlV3JpdGUNCgl9KQ0KDQoJJGZvcm1EYXRhLlBvc2l0aW9uU2xpZGVyWS5BZGRfVmFsdWVDaGFuZ2VkKHsNCgkJJGZvcm0gPSAkdGhpcy5GaW5kRm9ybSgpDQoJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJew0KCQkJcmV0dXJuDQoJCX0NCgkJJGRhdGEgPSAkZm9ybS5UYWcNCgkJVXBkYXRlU2V0dGluZ3MgJGRhdGEgLWZvcmNlV3JpdGUNCgl9KQ0KCQ0KCSRmb3JtRGF0YS5CdG5LZXlTZWxlY3QuQWRkX0NsaWNrKHsNCgkJJGZvcm0gPSAkdGhpcy5GaW5kRm9ybSgpDQoJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJew0KCQkJcmV0dXJuIA0KCQl9DQoJCSRkYXRhID0gJGZvcm0uVGFnDQoJCQ0KCQkkY3VycmVudEtleSA9ICRkYXRhLkJ0bktleVNlbGVjdC5UZXh0DQoJCSRuZXdLZXkgPSBTaG93LUtleUNhcHR1cmVEaWFsb2cgJGN1cnJlbnRLZXkNCgkJDQoJCWlmICgkbmV3S2V5IC1hbmQgJG5ld0tleSAtbmUgJGN1cnJlbnRLZXkpDQoJCXsNCgkJCWlmICgkZGF0YS5SdW5uaW5nU3BhbW1lcikNCgkJCXsNCgkJCQkkZGF0YS5SdW5uaW5nU3BhbW1lci5TdG9wKCkNCgkJCQkkZGF0YS5SdW5uaW5nU3BhbW1lci5EaXNwb3NlKCkNCgkJCQkkZGF0YS5SdW5uaW5nU3BhbW1lciA9ICRudWxsDQoJCQl9DQoJCQkNCgkJCSRkYXRhLkJ0bktleVNlbGVjdC5UZXh0ID0gJG5ld0tleQ0KCQkJVXBkYXRlU2V0dGluZ3MgJGRhdGEgLWZvcmNlV3JpdGUNCgkJCQ0KCQkJVG9nZ2xlQnV0dG9uU3RhdGUgJGRhdGEuQnRuU3RhcnQgJGRhdGEuQnRuU3RvcCAkZmFsc2UNCgkJfQ0KCX0pDQoJDQoJJGZvcm1EYXRhLkJ0blN0YXJ0LkFkZF9DbGljayh7DQoJCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQkkZGF0YSA9ICRmb3JtLlRhZw0KCQkNCgkJCSRrZXlWYWx1ZSA9ICRkYXRhLkJ0bktleVNlbGVjdC5UZXh0DQoJCQlpZiAoLW5vdCAka2V5VmFsdWUgLW9yICRrZXlWYWx1ZS5UcmltKCkgLWVxICcnKQ0KCQkJew0KCQkJW1N5c3RlbS5XaW5kb3dzLkZvcm1zLk1lc3NhZ2VCb3hdOjpTaG93KCdQbGVhc2Ugc2VsZWN0IGEga2V5JywgJ0Vycm9yJykNCgkJCXJldHVybg0KCQkJfQ0KCQkNCgkJCSRpbnRlcnZhbE51bSA9IDANCgkJCWlmICgtbm90IFtpbnRdOjpUcnlQYXJzZSgkZGF0YS5JbnRlcnZhbC5UZXh0LCBbcmVmXSRpbnRlcnZhbE51bSkgLW9yICRpbnRlcnZhbE51bSAtbHQgMTApDQoJCQl7DQoJCQkJJGludGVydmFsTnVtID0gMTAwDQoJCQkJJGRhdGEuSW50ZXJ2YWwuVGV4dCA9ICcxMDAnDQoJCQl9DQoJCQ0KCQkJVG9nZ2xlQnV0dG9uU3RhdGUgJGRhdGEuQnRuU3RhcnQgJGRhdGEuQnRuU3RvcCAkdHJ1ZQ0KCQkNCgkJCSRzcGFtVGltZXIgPSBDcmVhdGVTcGFtbWVyVGltZXIgJGRhdGEuU2VsZWN0ZWRXaW5kb3cgJGtleVZhbHVlICRkYXRhLkluc3RhbmNlSWQgJGludGVydmFsTnVtDQoJCQ0KCQkJJGRhdGEuUnVubmluZ1NwYW1tZXIgPSAkc3BhbVRpbWVyDQoJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzWyJFeHRTcGFtbWVyXyQoJGRhdGEuSW5zdGFuY2VJZClfMSJdID0gJHNwYW1UaW1lcg0KCQl9KQ0KCQ0KCSRmb3JtRGF0YS5CdG5TdG9wLkFkZF9DbGljayh7DQoJCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQkkZGF0YSA9ICRmb3JtLlRhZw0KCQkNCgkJCWlmICgkZGF0YS5SdW5uaW5nU3BhbW1lcikNCgkJCXsNCgkJCQkkZGF0YS5SdW5uaW5nU3BhbW1lci5TdG9wKCkNCgkJCQkkZGF0YS5SdW5uaW5nU3BhbW1lci5EaXNwb3NlKCkNCgkJCQkkZGF0YS5SdW5uaW5nU3BhbW1lciA9ICRudWxsDQoJCQl9DQoJCQ0KCQkJVG9nZ2xlQnV0dG9uU3RhdGUgJGRhdGEuQnRuU3RhcnQgJGRhdGEuQnRuU3RvcCAkZmFsc2UNCgkJDQoJCQlpZiAoJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVycy5Db250YWlucygiRXh0U3BhbW1lcl8kKCRkYXRhLkluc3RhbmNlSWQpXzEiKSkNCgkJCXsNCgkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzLlJlbW92ZSgiRXh0U3BhbW1lcl8kKCRkYXRhLkluc3RhbmNlSWQpXzEiKQ0KCQkJfQ0KCQl9KQ0KDQoJJGZvcm1EYXRhLkJ0bkhvdEtleS5BZGRfQ2xpY2soew0KCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJaWYgKC1ub3QgJGZvcm0gLW9yIC1ub3QgJGZvcm0uVGFnKQ0KCQl7DQoJCQlyZXR1cm4gDQoJCX0NCgkJJGRhdGEgPSAkZm9ybS5UYWcNCg0KCQkkY3VycmVudEhvdGtleVRleHQgPSAkZGF0YS5CdG5Ib3RLZXkuVGV4dA0KCQlpZiAoJGN1cnJlbnRIb3RrZXlUZXh0IC1lcSAiSG90a2V5IikgeyAkY3VycmVudEhvdGtleVRleHQgPSAkbnVsbCB9IA0KDQoJCSRvbGRIb3RrZXlJZFRvVW5yZWdpc3RlciA9ICRkYXRhLkhvdGtleUlkDQoNCgkJJG5ld0hvdGtleSA9IFNob3ctS2V5Q2FwdHVyZURpYWxvZyAkY3VycmVudEhvdGtleVRleHQNCgkJDQoJCSAgICAgICAgaWYgKCRuZXdIb3RrZXkgLWFuZCAkbmV3SG90a2V5IC1uZSAkY3VycmVudEhvdGtleVRleHQpIHsgDQoJCQ0KCQkgICAgICAgICAgICAkZGF0YS5Ib3RrZXkgPSAkbmV3SG90a2V5IAkJDQoJCQl0cnkgew0KCQkJCSRzY3JpcHRCbG9jayA9IFtzY3JpcHRibG9ja106OkNyZWF0ZSgiVG9nZ2xlU3BlY2lmaWNGdG9vbEluc3RhbmNlIC1JbnN0YW5jZUlkICckKCRkYXRhLkluc3RhbmNlSWQpJyAtRXh0S2V5IGAkbnVsbCIpDQoJCQkJJGRhdGEuSG90a2V5SWQgPSBTZXQtSG90a2V5IC1LZXlDb21iaW5hdGlvblN0cmluZyAkZGF0YS5Ib3RrZXkgLUFjdGlvbiAkc2NyaXB0QmxvY2sgLU93bmVyS2V5ICRkYXRhLkluc3RhbmNlSWQgLU9sZEhvdGtleUlkICRvbGRIb3RrZXlJZFRvVW5yZWdpc3Rlcg0KCQkJCSRkYXRhLkJ0bkhvdEtleS5UZXh0ID0gJG5ld0hvdGtleSANCgkJCQlXcml0ZS1WZXJib3NlICJGVE9PTDogUmVnaXN0ZXJlZCBob3RrZXkgJCgkZGF0YS5Ib3RrZXkpIChJRDogJCgkZGF0YS5Ib3RrZXlJZCkpIGZvciBtYWluIGluc3RhbmNlICQoJGRhdGEuSW5zdGFuY2VJZCkuIg0KCQkJfSBjYXRjaCB7DQoJCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byByZWdpc3RlciBob3RrZXkgJCgkZGF0YS5Ib3RrZXkpIGZvciBtYWluIGluc3RhbmNlICQoJGRhdGEuSW5zdGFuY2VJZCkuIEVycm9yOiAkXyINCiAgICAgICAgICAgICAgICAkZGF0YS5Ib3RrZXlJZCA9ICRudWxsIA0KICAgICAgICAgICAgICAgICRkYXRhLkhvdGtleSA9ICRjdXJyZW50SG90a2V5VGV4dA0KICAgICAgICAgICAgICAgICRkYXRhLkJ0bkhvdEtleS5UZXh0ID0gJGN1cnJlbnRIb3RrZXlUZXh0IC1vciAiSG90a2V5Ig0KCQkJfQ0KCQkJDQoJCQlVcGRhdGVTZXR0aW5ncyAkZGF0YSAtZm9yY2VXcml0ZSANCgkJfSBlbHNlaWYgKC1ub3QgJG5ld0hvdGtleSAtYW5kICRvbGRIb3RrZXlJZFRvVW5yZWdpc3RlcikgeyANCgkJCXRyeSB7DQoJCQkJVW5yZWdpc3Rlci1Ib3RrZXlJbnN0YW5jZSAtSWQgJG9sZEhvdGtleUlkVG9VbnJlZ2lzdGVyIC1Pd25lcktleSAkZGF0YS5JbnN0YW5jZUlkDQoJCQkJV3JpdGUtVmVyYm9zZSAiRlRPT0w6IFVucmVnaXN0ZXJlZCBob3RrZXkgKElEOiAkKCRvbGRIb3RrZXlJZFRvVW5yZWdpc3RlcikpIGZvciBtYWluIGluc3RhbmNlICQoJGRhdGEuSW5zdGFuY2VJZCkgZHVlIHRvIHVzZXIgY2xlYXIuIg0KCQkJfSBjYXRjaCB7DQoJCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byB1bnJlZ2lzdGVyIGhvdGtleSAoSUQ6ICQoJG9sZEhvdGtleUlkVG9VbnJlZ2lzdGVyKSkgZm9yIG1haW4gaW5zdGFuY2UgJCgkZGF0YS5JbnN0YW5jZUlkKSBvbiBjbGVhci4gRXJyb3I6ICRfIg0KCQkJfQ0KICAgICAgICAgICAgJGRhdGEuSG90a2V5SWQgPSAkbnVsbA0KICAgICAgICAgICAgJGRhdGEuSG90a2V5ID0gJG51bGwNCiAgICAgICAgICAgICRkYXRhLkJ0bkhvdEtleS5UZXh0ID0gIkhvdGtleSINCiAgICAgICAgICAgIFVwZGF0ZVNldHRpbmdzICRkYXRhIC1mb3JjZVdyaXRlDQogICAgICAgIH0NCgl9KQ0KDQoJJGZvcm1EYXRhLkJ0bkhvdGtleVRvZ2dsZS5BZGRfQ2xpY2soew0KCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJaWYgKC1ub3QgJGZvcm0gLW9yIC1ub3QgJGZvcm0uVGFnKSB7IHJldHVybiB9DQoJCSRkYXRhID0gJGZvcm0uVGFnDQoJCSR0b2dnbGVPbiA9ICR0aGlzLkNoZWNrZWQNCiAgICAgICAgVG9nZ2xlSW5zdGFuY2VIb3RrZXlzIC1JbnN0YW5jZUlkICRkYXRhLkluc3RhbmNlSWQgLVRvZ2dsZVN0YXRlICR0b2dnbGVPbg0KCX0pDQoNCgkJCSRmb3JtRGF0YS5CdG5JbnN0YW5jZUhvdGtleVRvZ2dsZS5BZGRfQ2xpY2soew0KCQkJCSRmb3JtID0gJHRoaXMuRmluZEZvcm0oKQ0KCQkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykgeyByZXR1cm4gfQ0KCQkJCSRkYXRhID0gJGZvcm0uVGFnDQoJCQ0KCQkJCSRjdXJyZW50SG90a2V5VGV4dCA9ICRkYXRhLkdsb2JhbEhvdGtleQ0KCQkNCgkJCQkkb2xkSG90a2V5SWRUb1VucmVnaXN0ZXIgPSAkZGF0YS5HbG9iYWxIb3RrZXlJZA0KCQkJCSRvd25lcktleSA9ICJnbG9iYWxfdG9nZ2xlXyQoJGRhdGEuSW5zdGFuY2VJZCkiDQoJCQ0KCQkJCSRuZXdIb3RrZXkgPSBTaG93LUtleUNhcHR1cmVEaWFsb2cgJGN1cnJlbnRIb3RrZXlUZXh0DQoJCQ0KCQkJCWlmICgkbmV3SG90a2V5IC1hbmQgJG5ld0hvdGtleSAtbmUgJGN1cnJlbnRIb3RrZXlUZXh0KSB7DQoJCQkJCWlmIChUZXN0LUhvdGtleUNvbmZsaWN0IC1LZXlDb21iaW5hdGlvblN0cmluZyAkbmV3SG90a2V5IC1OZXdIb3RrZXlUeXBlIChbSG90a2V5TWFuYWdlcitIb3RrZXlBY3Rpb25UeXBlXTo6R2xvYmFsVG9nZ2xlKSAtT3duZXJLZXlUb0V4Y2x1ZGUgJG93bmVyS2V5KSB7DQoJCQkJCQlbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coIlRoaXMgaG90a2V5IGNvbWJpbmF0aW9uICgnJG5ld0hvdGtleScpIGlzIGFscmVhZHkgYXNzaWduZWQgdG8gYW5vdGhlciBmdW5jdGlvbiBvciBpbnN0YW5jZS4gUGxlYXNlIGNob29zZSBhIGRpZmZlcmVudCBrZXkuIiwgIkhvdGtleSBDb25mbGljdCIsIFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94QnV0dG9uc106Ok9LLCBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveEljb25dOjpXYXJuaW5nKQ0KCQkJCQkJJGRhdGEuR2xvYmFsSG90a2V5ID0gJGN1cnJlbnRIb3RrZXlUZXh0DQoJCQkJCQlyZXR1cm4gDQoJCQkJCX0NCgkJDQoJCQkJCSRkYXRhLkdsb2JhbEhvdGtleSA9ICRuZXdIb3RrZXkNCgkJCQkJdHJ5IHsNCgkJCQkJCSRzY3JpcHQgPSBAIg0KCQlXcml0ZS1WZXJib3NlICJGVE9PTDogR2xvYmFsLXRvZ2dsZSBob3RrZXkgdHJpZ2dlcmVkIGZvciBpbnN0YW5jZSAnJCgkZGF0YS5JbnN0YW5jZUlkKSciDQoJCWlmIChgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkZ0b29sRm9ybXMuQ29udGFpbnMoJyQoJGRhdGEuSW5zdGFuY2VJZCknKSkgew0KCQkJYCRmID0gYCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5GdG9vbEZvcm1zWyckKCRkYXRhLkluc3RhbmNlSWQpJ10NCgkJCWlmIChgJGYgLWFuZCAtbm90IGAkZi5Jc0Rpc3Bvc2VkIC1hbmQgYCRmLlRhZykgew0KCQkJCWAkdG9nZ2xlID0gYCRmLlRhZy5CdG5Ib3RrZXlUb2dnbGUNCgkJCQlpZiAoYCR0b2dnbGUpIHsNCgkJCQkJdHJ5IHsNCgkJCQkJCWlmIChgJHRvZ2dsZS5JbnZva2VSZXF1aXJlZCkgew0KCQkJCQkJCWAkYWN0aW9uID0gW1N5c3RlbS5BY3Rpb25deyBgJHRvZ2dsZS5DaGVja2VkID0gLW5vdCBgJHRvZ2dsZS5DaGVja2VkIH0NCgkJCQkJCQlgJHRvZ2dsZS5JbnZva2UoYCRhY3Rpb24pDQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCWAkdG9nZ2xlLkNoZWNrZWQgPSAtbm90IGAkdG9nZ2xlLkNoZWNrZWQNCgkJCQkJCX0NCgkJCQkJCVRvZ2dsZUluc3RhbmNlSG90a2V5cyAtSW5zdGFuY2VJZCAnJCgkZGF0YS5JbnN0YW5jZUlkKScgLVRvZ2dsZVN0YXRlIGAkdG9nZ2xlLkNoZWNrZWQNCgkJCQkJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBHbG9iYWwgdG9nZ2xlIGFjdGlvbiBjb21wbGV0ZWQgZm9yIGluc3RhbmNlICckKCRkYXRhLkluc3RhbmNlSWQpJy4iDQoJCQkJCX0gY2F0Y2ggew0KCQkJCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEVycm9yIGR1cmluZyBnbG9iYWwgdG9nZ2xlIGFjdGlvbiBmb3IgaW5zdGFuY2UgJyQoJGRhdGEuSW5zdGFuY2VJZCknLiBFcnJvcjogYCRfIg0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoiQA0KCQkJCQkJJHNjcmlwdEJsb2NrID0gW3NjcmlwdGJsb2NrXTo6Q3JlYXRlKCRzY3JpcHQpDQoJCQkJCQkkZGF0YS5HbG9iYWxIb3RrZXlJZCA9IFNldC1Ib3RrZXkgLUtleUNvbWJpbmF0aW9uU3RyaW5nICRkYXRhLkdsb2JhbEhvdGtleSAtQWN0aW9uICRzY3JpcHRCbG9jayAtT3duZXJLZXkgJG93bmVyS2V5IC1PbGRIb3RrZXlJZCAkb2xkSG90a2V5SWRUb1VucmVnaXN0ZXINCgkJCQkJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBSZWdpc3RlcmVkIGdsb2JhbC10b2dnbGUgaG90a2V5ICQoJGRhdGEuR2xvYmFsSG90a2V5KSAoSUQ6ICQoJGRhdGEuR2xvYmFsSG90a2V5SWQpKSBmb3IgaW5zdGFuY2UgJCgkZGF0YS5JbnN0YW5jZUlkKS4iDQoJCQkJCX0gY2F0Y2ggew0KCQkJCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byByZWdpc3RlciBnbG9iYWwtdG9nZ2xlIGhvdGtleSAkKCRkYXRhLkdsb2JhbEhvdGtleSkgZm9yIGluc3RhbmNlICQoJGRhdGEuSW5zdGFuY2VJZCkuIEVycm9yOiAkXyINCgkJCQkJCSRkYXRhLkdsb2JhbEhvdGtleUlkID0gJG51bGwNCgkJCQkJCSRkYXRhLkdsb2JhbEhvdGtleSA9ICRjdXJyZW50SG90a2V5VGV4dA0KCQkJCQl9DQoJCQ0KCQkJCQlVcGRhdGVTZXR0aW5ncyAkZGF0YSAtZm9yY2VXcml0ZQ0KCQkJCX0gZWxzZWlmICgtbm90ICRuZXdIb3RrZXkgLWFuZCAkb2xkSG90a2V5SWRUb1VucmVnaXN0ZXIpIHsNCgkJCQkJdHJ5IHsNCgkJCQkJCVVucmVnaXN0ZXItSG90a2V5SW5zdGFuY2UgLUlkICRvbGRIb3RrZXlJZFRvVW5yZWdpc3RlciAtT3duZXJLZXkgJG93bmVyS2V5DQoJCQkJCQlXcml0ZS1WZXJib3NlICJGVE9PTDogVW5yZWdpc3RlcmVkIGdsb2JhbC10b2dnbGUgaG90a2V5IChJRDogJCgkb2xkSG90a2V5SWRUb1VucmVnaXN0ZXIpKSBmb3IgaW5zdGFuY2UgJCgkZGF0YS5JbnN0YW5jZUlkKSBkdWUgdG8gdXNlciBjbGVhci4iDQoJCQkJCX0gY2F0Y2ggew0KCQkJCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byB1bnJlZ2lzdGVyIGdsb2JhbC10b2dnbGUgaG90a2V5IChJRDogJCgkb2xkSG90a2V5SWRUb1VucmVnaXN0ZXIpKSBmb3IgaW5zdGFuY2UgJCgkZGF0YS5JbnN0YW5jZUlkKSBvbiBjbGVhci4gRXJyb3I6ICRfIg0KCQkJCQl9DQoJCQkJCSRkYXRhLkdsb2JhbEhvdGtleUlkID0gJG51bGwNCgkJCQkJJGRhdGEuR2xvYmFsSG90a2V5ID0gJG51bGwNCgkJCQkJVXBkYXRlU2V0dGluZ3MgJGRhdGEgLWZvcmNlV3JpdGUNCgkJCQl9DQoJCQl9KQ0KDQoJDQoJJGZvcm1EYXRhLkJ0blNob3dIaWRlLkFkZF9DbGljayh7DQoJCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQkkZGF0YSA9ICRmb3JtLlRhZw0KCQkNCgkJCWlmICgtbm90IChDaGVja1JhdGVMaW1pdCAkdGhpcy5HZXRIYXNoQ29kZSgpIDIwMCkpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkNCgkJCWlmICgkZGF0YS5Jc0NvbGxhcHNlZCkNCgkJCXsNCgkJCQkkZm9ybS5IZWlnaHQgPSAkZGF0YS5PcmlnaW5hbEhlaWdodA0KCQkJCSRkYXRhLklzQ29sbGFwc2VkID0gJGZhbHNlDQoJCQkJJHRoaXMuVGV4dCA9IFtjaGFyXTB4MjVCMiAgDQoJCQl9DQoJCQllbHNlDQoJCQl7DQoJCQkJJGRhdGEuT3JpZ2luYWxIZWlnaHQgPSAkZm9ybS5IZWlnaHQNCgkJCQkkZm9ybS5IZWlnaHQgPSAyNQ0KCQkJCSRkYXRhLklzQ29sbGFwc2VkID0gJHRydWUNCgkJCQkkdGhpcy5UZXh0ID0gW2NoYXJdMHgyNUJDICANCgkJCX0NCgkJfSkNCgkNCgkkZm9ybURhdGEuQnRuQWRkLkFkZF9DbGljayh7DQoJCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZyAtb3IgJGZvcm0uVGFnLklzQ29sbGFwc2VkKQ0KCQkJew0KCQkJCXJldHVybiANCgkJCX0NCgkJCSRkYXRhID0gJGZvcm0uVGFnDQoJCQ0KCQkJaWYgKC1ub3QgKENoZWNrUmF0ZUxpbWl0ICR0aGlzLkdldEhhc2hDb2RlKCkgMjAwKSkNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQ0KCQkJaWYgKCRkYXRhLkV4dGVuc2lvbkNvdW50IC1nZSA4KQ0KCQkJew0KCQkJCVtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5NZXNzYWdlQm94XTo6U2hvdygnTWF4aW11bSBudW1iZXIgb2YgZXh0ZW5zaW9ucyByZWFjaGVkLicsICdXYXJuaW5nJykNCgkJCQlyZXR1cm4NCgkJCX0NCgkJDQoJCQkkZGF0YS5FeHRlbnNpb25Db3VudCsrDQoJCQ0KCQkJSW5pdGlhbGl6ZUV4dGVuc2lvblRyYWNraW5nICRkYXRhLkluc3RhbmNlSWQNCgkJDQoJCQkkZXh0TnVtID0gR2V0TmV4dEV4dGVuc2lvbk51bWJlciAkZGF0YS5JbnN0YW5jZUlkDQoJCQ0KCQkJJGV4dERhdGEgPSBDcmVhdGVFeHRlbnNpb25QYW5lbCAkZm9ybSAkY3VycmVudEhlaWdodCAkZXh0TnVtICRkYXRhLkluc3RhbmNlSWQgJGRhdGEuU2VsZWN0ZWRXaW5kb3cNCiAgICAgICAgICAgICRleHRLZXlGb3JTY3JpcHRCbG9jayA9ICJleHRfJCgkZGF0YS5JbnN0YW5jZUlkKV8kZXh0TnVtIg0KCQkNCgkJCSRwcm9maWxlUHJlZml4ID0gRmluZE9yQ3JlYXRlUHJvZmlsZSAkZGF0YS5XaW5kb3dUaXRsZQ0KCQkNCgkJCUxvYWRFeHRlbnNpb25TZXR0aW5ncyAkZXh0RGF0YSAkcHJvZmlsZVByZWZpeA0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZXh0RGF0YS5Ib3RrZXkpKSB7DQoJCQkJdHJ5IHsNCgkJCQkJJHNjcmlwdEJsb2NrID0gW3NjcmlwdGJsb2NrXTo6Q3JlYXRlKCJUb2dnbGVTcGVjaWZpY0Z0b29sSW5zdGFuY2UgLUluc3RhbmNlSWQgJyQoJGV4dERhdGEuSW5zdGFuY2VJZCknIC1FeHRLZXkgJyQoJGV4dEtleUZvclNjcmlwdEJsb2NrKSciKQ0KCQkJCQkkbmV3SG90a2V5SWQgPSBTZXQtSG90a2V5IC1LZXlDb21iaW5hdGlvblN0cmluZyAkZXh0RGF0YS5Ib3RrZXkgLUFjdGlvbiAkc2NyaXB0QmxvY2sgLU93bmVyS2V5ICRleHRLZXlGb3JTY3JpcHRCbG9jaw0KCQkJCQkkZXh0RGF0YS5Ib3RrZXlJZCA9ICRuZXdIb3RrZXlJZA0KCQkJCQkkZXh0SG90S2V5SWREaXNwbGF5ID0gaWYgKCRleHREYXRhLkhvdGtleUlkKSB7ICRleHREYXRhLkhvdGtleUlkIH0gZWxzZSB7ICdOb25lJyB9DQoJCQkJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBSZWdpc3RlcmVkIGhvdGtleSAkKCRleHREYXRhLkhvdGtleSkgKElEOiAkZXh0SG90S2V5SWREaXNwbGF5KSBmb3IgZXh0ZW5zaW9uICQoJGV4dEtleUZvclNjcmlwdEJsb2NrKSBvbiBsb2FkLiINCgkJCQl9IGNhdGNoIHsNCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byByZWdpc3RlciBob3RrZXkgJCgkZXh0RGF0YS5Ib3RrZXkpIGZvciBleHRlbnNpb24gJCgkZXh0S2V5Rm9yU2NyaXB0QmxvY2spIG9uIGxvYWQuIEVycm9yOiAkXyINCiAgICAgICAgICAgICAgICAgICAgJGV4dERhdGEuSG90a2V5SWQgPSAkbnVsbCANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoJCQ0KCQkJQWRkRXh0ZW5zaW9uRXZlbnRIYW5kbGVycyAkZXh0RGF0YSAkZGF0YQ0KCQkNCgkJCUFkZEZvcm1DbGVhbnVwSGFuZGxlciAkZm9ybQ0KCQkNCgkJCVJlcG9zaXRpb25FeHRlbnNpb25zICRmb3JtICRleHREYXRhLkluc3RhbmNlSWQNCgkJCQkNCgkJCSRmb3JtLlJlZnJlc2goKQ0KCQl9KQ0KCQ0KCSRmb3JtRGF0YS5CdG5DbG9zZS5BZGRfQ2xpY2soew0KCQkJJGZvcm0gPSAkdGhpcy5GaW5kRm9ybSgpDQoJCQlpZiAoLW5vdCAkZm9ybSAtb3IgLW5vdCAkZm9ybS5UYWcpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkJJGRhdGEgPSAkZm9ybS5UYWcNCgkJDQoJCQlDbGVhbnVwSW5zdGFuY2VSZXNvdXJjZXMgJGRhdGEuSW5zdGFuY2VJZA0KCQkNCgkJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRnRvb2xGb3Jtcy5Db250YWlucygkZGF0YS5JbnN0YW5jZUlkKSkNCgkJCXsNCgkJCQkkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRnRvb2xGb3Jtcy5SZW1vdmUoJGRhdGEuSW5zdGFuY2VJZCkNCgkJCX0NCgkJDQoJCQkkZm9ybS5DbG9zZSgpDQoJCQkkZm9ybS5EaXNwb3NlKCkNCgkJfSkNCgkNCgkkZm9ybURhdGEuRm9ybS5BZGRfRm9ybUNsb3NlZCh7DQoJCQlwYXJhbSgkc3JjLCAkZSkNCgkJDQoJCQkkaW5zdGFuY2VJZCA9ICRzcmMuVGFnLkluc3RhbmNlSWQNCgkJCWlmICgkaW5zdGFuY2VJZCkNCgkJCXsNCgkJCQlDbGVhbnVwSW5zdGFuY2VSZXNvdXJjZXMgJGluc3RhbmNlSWQNCgkJCX0NCgkJfSkNCn0NCg0KZnVuY3Rpb24gQ3JlYXRlRXh0ZW5zaW9uUGFuZWwNCnsNCglwYXJhbSgkZm9ybSwgJGN1cnJlbnRIZWlnaHQsICRleHROdW0sICRpbnN0YW5jZUlkLCAkd2luZG93SGFuZGxlKQ0KCQ0KCSRwYW5lbEV4dCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ1BhbmVsJyAtdmlzaWJsZSAkdHJ1ZSAtd2lkdGggMTkwIC1oZWlnaHQgNjAgLXRvcCAwIC1sZWZ0IDQwIC1iZyBAKDUwLCA1MCwgNTApDQoJJGZvcm0uQ29udHJvbHMuQWRkKCRwYW5lbEV4dCkNCgkkcGFuZWxFeHQuQnJpbmdUb0Zyb250KCkNCgkNCgkkYnRuS2V5U2VsZWN0RXh0ID0gU2V0LVVJRWxlbWVudCAtdHlwZSAnQnV0dG9uJyAtdmlzaWJsZSAkdHJ1ZSAtd2lkdGggNTUgLWhlaWdodCAyNSAtdG9wIDQgLWxlZnQgMyAtYmcgQCg0MCwgNDAsIDQwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAnJyAtZnMgJ0ZsYXQnIC1mb250IChOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoJ1NlZ29lIFVJJywgOCkpDQoJJHBhbmVsRXh0LkNvbnRyb2xzLkFkZCgkYnRuS2V5U2VsZWN0RXh0KQ0KCQ0KCSRpbnRlcnZhbEV4dCA9IFNldC1VSUVsZW1lbnQgLXR5cGUgJ1RleHRCb3gnIC12aXNpYmxlICR0cnVlIC13aWR0aCA0NyAtaGVpZ2h0IDE1IC10b3AgNSAtbGVmdCA1OSAtYmcgQCg0MCwgNDAsIDQwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAnMTAwMCcgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA5KSkNCgkkcGFuZWxFeHQuQ29udHJvbHMuQWRkKCRpbnRlcnZhbEV4dCkNCgkNCgkkYnRuU3RhcnRFeHQgPSBTZXQtVUlFbGVtZW50IC10eXBlICdCdXR0b24nIC12aXNpYmxlICR0cnVlIC13aWR0aCA0NSAtaGVpZ2h0IDIwIC10b3AgMzUgLWxlZnQgMTAgLWJnIEAoMCwgMTIwLCAyMTUpIC1mZyBAKDI1NSwgMjU1LCAyNTUpIC10ZXh0ICdTdGFydCcgLWZzICdGbGF0JyAtZm9udCAoTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKQ0KCSRwYW5lbEV4dC5Db250cm9scy5BZGQoJGJ0blN0YXJ0RXh0KQ0KCQ0KCSRidG5TdG9wRXh0ID0gU2V0LVVJRWxlbWVudCAtdHlwZSAnQnV0dG9uJyAtdmlzaWJsZSAkdHJ1ZSAtd2lkdGggNDUgLWhlaWdodCAyMCAtdG9wIDM1IC1sZWZ0IDY3IC1iZyBAKDIwMCwgNTAsIDUwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAnU3RvcCcgLWZzICdGbGF0JyAtZm9udCAoTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDkpKQ0KCSRidG5TdG9wRXh0LkVuYWJsZWQgPSAkZmFsc2UNCgkkYnRuU3RvcEV4dC5WaXNpYmxlID0gJGZhbHNlDQoJJHBhbmVsRXh0LkNvbnRyb2xzLkFkZCgkYnRuU3RvcEV4dCkNCg0KCSRidG5Ib3RLZXlFeHQgPSBTZXQtVUlFbGVtZW50IC10eXBlICdCdXR0b24nIC12aXNpYmxlICR0cnVlIC13aWR0aCA0MCAtaGVpZ2h0IDMwIC10b3AgMSAtbGVmdCAxNDYgLWJnIEAoMTUwLCAyMCwgMjApIC1mZyBAKDI1NSwgMjU1LCAyNTUpIC10ZXh0ICdIb3RrZXknIC1mcyAnRmxhdCcgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA2KSkNCgkkcGFuZWxFeHQuQ29udHJvbHMuQWRkKCRidG5Ib3RLZXlFeHQpDQoJDQoJJG5hbWVFeHQgPSBTZXQtVUlFbGVtZW50IC10eXBlICdUZXh0Qm94JyAtdmlzaWJsZSAkdHJ1ZSAtd2lkdGggMzcgLWhlaWdodCAxNyAtdG9wIDUgLWxlZnQgMTA4IC1iZyBAKDQwLCA0MCwgNDApIC1mZyBAKDI1NSwgMjU1LCAyNTUpIC10ZXh0ICJOYW1lIiAtZm9udCAoTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Gb250KCdTZWdvZSBVSScsIDgsIFtTeXN0ZW0uRHJhd2luZy5Gb250U3R5bGVdOjpSZWd1bGFyKSkNCgkkcGFuZWxFeHQuQ29udHJvbHMuQWRkKCRuYW1lRXh0KQ0KCQ0KCSRidG5SZW1vdmVFeHQgPSBTZXQtVUlFbGVtZW50IC10eXBlICdCdXR0b24nIC12aXNpYmxlICR0cnVlIC13aWR0aCA0MCAtaGVpZ2h0IDIwIC10b3AgMzUgLWxlZnQgMTIwIC1iZyBAKDE1MCwgNTAsIDUwKSAtZmcgQCgyNTUsIDI1NSwgMjU1KSAtdGV4dCAnQ2xvc2UnIC1mcyAnRmxhdCcgLWZvbnQgKE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgnU2Vnb2UgVUknLCA3KSkNCgkkcGFuZWxFeHQuQ29udHJvbHMuQWRkKCRidG5SZW1vdmVFeHQpDQoJDQoJJGV4dEtleSA9ICJleHRfJHtpbnN0YW5jZUlkfV8kZXh0TnVtIg0KCSRpbnN0YW5jZUtleSA9ICJpbnN0YW5jZV8kaW5zdGFuY2VJZCINCgkNCgkkZXh0RGF0YSA9IFtQU0N1c3RvbU9iamVjdF1Aew0KCQlQYW5lbCAgICAgICAgICA9ICRwYW5lbEV4dA0KCQlCdG5LZXlTZWxlY3QgICA9ICRidG5LZXlTZWxlY3RFeHQNCgkJSW50ZXJ2YWwgICAgICAgPSAkaW50ZXJ2YWxFeHQNCgkJQnRuU3RhcnQgICAgICAgPSAkYnRuU3RhcnRFeHQNCgkJQnRuU3RvcCAgICAgICAgPSAkYnRuU3RvcEV4dA0KCQlCdG5Ib3RLZXkgICAgICA9ICRidG5Ib3RLZXlFeHQNCgkJQnRuUmVtb3ZlICAgICAgPSAkYnRuUmVtb3ZlRXh0DQoJCU5hbWUgICAgICAgICAgID0gJG5hbWVFeHQNCgkJRXh0TnVtICAgICAgICAgPSAkZXh0TnVtDQoJCUluc3RhbmNlSWQgICAgID0gJGluc3RhbmNlSWQNCgkJV2luZG93SGFuZGxlICAgPSAkd2luZG93SGFuZGxlDQoJCVJ1bm5pbmdTcGFtbWVyID0gJG51bGwNCgkJUG9zaXRpb24gICAgICAgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5BY3RpdmVFeHRlbnNpb25zLkNvdW50DQogICAgICAgIEhvdGtleSAgICAgICAgID0gJG51bGwgDQogICAgICAgIEhvdGtleUlkICAgICAgID0gJG51bGwgDQoJfQ0KCQ0KCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhWyRleHRLZXldID0gJGV4dERhdGENCgkNCglpZiAoLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uVHJhY2tpbmdbJGluc3RhbmNlS2V5XS5BY3RpdmVFeHRlbnNpb25zLkNvbnRhaW5zKCRleHRLZXkpKQ0KCXsNCgkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvblRyYWNraW5nWyRpbnN0YW5jZUtleV0uQWN0aXZlRXh0ZW5zaW9ucyArPSAkZXh0S2V5DQoJfQ0KCQ0KCXJldHVybiAkZXh0RGF0YQ0KfQ0KDQpmdW5jdGlvbiBBZGRFeHRlbnNpb25FdmVudEhhbmRsZXJzDQp7DQoJcGFyYW0oJGV4dERhdGEsICRmb3JtRGF0YSkNCgkNCgkkZXh0RGF0YS5JbnRlcnZhbC5BZGRfVGV4dENoYW5nZWQoew0KCQkJJGZvcm0gPSAkdGhpcy5GaW5kRm9ybSgpDQoJCQlpZiAoLW5vdCAkZm9ybSAtb3IgLW5vdCAkZm9ybS5UYWcpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkJJGRhdGEgPSAkZm9ybS5UYWcNCgkJDQoJCQlpZiAoLW5vdCAoQ2hlY2tSYXRlTGltaXQgJHRoaXMuR2V0SGFzaENvZGUoKSkpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkNCgkJCSRleHRLZXkgPSBGaW5kRXh0ZW5zaW9uS2V5QnlDb250cm9sICR0aGlzICdJbnRlcnZhbCcNCgkJCWlmICgtbm90ICRleHRLZXkpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkNCgkJCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhLkNvbnRhaW5zKCRleHRLZXkpKQ0KCQkJew0KCQkJCXJldHVybiANCgkJCX0NCgkJDQoJCQkkZXh0RGF0YSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhWyRleHRLZXldDQoJCQlpZiAoLW5vdCAkZXh0RGF0YSkNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQ0KCQkJJGludGVydmFsVmFsdWUgPSAwDQoJCQlpZiAoLW5vdCBbaW50XTo6VHJ5UGFyc2UoJHRoaXMuVGV4dCwgW3JlZl0kaW50ZXJ2YWxWYWx1ZSkgLW9yICRpbnRlcnZhbFZhbHVlIC1sdCAxMCkNCgkJCXsNCgkJCQkkdGhpcy5UZXh0ID0gJzEwMCcNCgkJCQkkaW50ZXJ2YWxWYWx1ZSA9IDEwMA0KCQkJfQ0KCQkNCgkJCVVwZGF0ZVNldHRpbmdzICRkYXRhICRleHREYXRhIC1mb3JjZVdyaXRlDQoJCX0pDQoNCgkkZXh0RGF0YS5OYW1lLkFkZF9UZXh0Q2hhbmdlZCh7DQoJCSRmb3JtID0gJHRoaXMuRmluZEZvcm0oKQ0KCQlpZiAoLW5vdCAkZm9ybSAtb3IgLW5vdCAkZm9ybS5UYWcpDQoJCXsNCgkJCXJldHVybiANCgkJfQ0KCQkkZGF0YSA9ICRmb3JtLlRhZw0KCQ0KCQlpZiAoLW5vdCAoQ2hlY2tSYXRlTGltaXQgJHRoaXMuR2V0SGFzaENvZGUoKSkpDQoJCXsNCgkJCXJldHVybiANCgkJfQ0KCQ0KCQkkZXh0S2V5ID0gRmluZEV4dGVuc2lvbktleUJ5Q29udHJvbCAkdGhpcyAnTmFtZScNCgkJaWYgKC1ub3QgJGV4dEtleSkNCgkJew0KCQkJcmV0dXJuIA0KCQl9DQoJDQoJCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhLkNvbnRhaW5zKCRleHRLZXkpKQ0KCQl7DQoJCQlyZXR1cm4gDQoJCX0NCgkNCgkJJGV4dERhdGEgPSAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YVskZXh0S2V5XQ0KCQlpZiAoLW5vdCAkZXh0RGF0YSkNCgkJew0KCQkJcmV0dXJuIA0KCQl9DQoJDQoJCVVwZGF0ZVNldHRpbmdzICRkYXRhICRleHREYXRhIC1mb3JjZVdyaXRlDQoJfSkNCgkNCgkkZXh0RGF0YS5CdG5LZXlTZWxlY3QuQWRkX0NsaWNrKHsNCgkJJGZvcm0gPSAkdGhpcy5GaW5kRm9ybSgpDQoJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJew0KCQkJcmV0dXJuIA0KCQl9DQoJCSRkYXRhID0gJGZvcm0uVGFnDQoJCQ0KCQkkZXh0S2V5ID0gRmluZEV4dGVuc2lvbktleUJ5Q29udHJvbCAkdGhpcyAnQnRuS2V5U2VsZWN0Jw0KCQlpZiAoLW5vdCAkZXh0S2V5KQ0KCQl7DQoJCQlyZXR1cm4gDQoJCX0NCgkJDQoJCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhLkNvbnRhaW5zKCRleHRLZXkpKQ0KCQl7DQoJCQlyZXR1cm4gDQoJCX0NCgkJDQoJCSRleHREYXRhID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvbkRhdGFbJGV4dEtleV0NCgkJaWYgKC1ub3QgJGV4dERhdGEpDQoJCXsNCgkJCXJldHVybiANCgkJfQ0KCQkNCgkJJGN1cnJlbnRLZXkgPSAkZXh0RGF0YS5CdG5LZXlTZWxlY3QuVGV4dA0KCQkkbmV3S2V5ID0gU2hvdy1LZXlDYXB0dXJlRGlhbG9nICRjdXJyZW50S2V5DQoJCQ0KCQlpZiAoJG5ld0tleSAtYW5kICRuZXdLZXkgLW5lICRjdXJyZW50S2V5KQ0KCQl7DQoJCQlpZiAoJGV4dERhdGEuUnVubmluZ1NwYW1tZXIpDQoJCQl7DQoJCQkJJGV4dERhdGEuUnVubmluZ1NwYW1tZXIuU3RvcCgpDQoJCQkJJGV4dERhdGEuUnVubmluZ1NwYW1tZXIuRGlzcG9zZSgpDQoJCQkJJGV4dERhdGEuUnVubmluZ1NwYW1tZXIgPSAkbnVsbA0KCQkJfQ0KCQkJDQoJCQkkZXh0RGF0YS5CdG5LZXlTZWxlY3QuVGV4dCA9ICRuZXdLZXkNCgkJCVVwZGF0ZVNldHRpbmdzICRkYXRhICRleHREYXRhIC1mb3JjZVdyaXRlDQoJCQkNCgkJCVRvZ2dsZUJ1dHRvblN0YXRlICRleHREYXRhLkJ0blN0YXJ0ICRleHREYXRhLkJ0blN0b3AgJGZhbHNlDQoJCX0NCgl9KQ0KCQ0KCSRleHREYXRhLkJ0blN0YXJ0LkFkZF9DbGljayh7DQoJCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQkkZGF0YSA9ICRmb3JtLlRhZw0KCQkNCgkJCWlmICgtbm90IChDaGVja1JhdGVMaW1pdCAkdGhpcy5HZXRIYXNoQ29kZSgpIDUwMCkpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkNCgkJCSRleHRLZXkgPSBGaW5kRXh0ZW5zaW9uS2V5QnlDb250cm9sICR0aGlzICdCdG5TdGFydCcNCgkJCWlmICgtbm90ICRleHRLZXkpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkNCgkJCWlmICgtbm90ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhLkNvbnRhaW5zKCRleHRLZXkpKQ0KCQkJew0KCQkJCXJldHVybiANCgkJCX0NCgkJDQoJCQkkZXh0RGF0YSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhWyRleHRLZXldDQoJCQlpZiAoLW5vdCAkZXh0RGF0YSkNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQ0KCQkJJGV4dE51bSA9ICRleHREYXRhLkV4dE51bQ0KCQkNCgkJCSRrZXlWYWx1ZSA9ICRleHREYXRhLkJ0bktleVNlbGVjdC5UZXh0DQoJCQkgaWYgKC1ub3QgJGtleVZhbHVlIC1vciAka2V5VmFsdWUuVHJpbSgpIC1lcSAnJykNCgkJCXsNCgkJCSBbU3lzdGVtLldpbmRvd3MuRm9ybXMuTWVzc2FnZUJveF06OlNob3coJ1BsZWFzZSBzZWxlY3QgYSBrZXknLCAnRXJyb3InKQ0KCQkJIHJldHVybg0KCQkJfQ0KCQkNCgkJCSRpbnRlcnZhbE51bSA9IDANCgkJDQoJCQlpZiAoLW5vdCAkZXh0RGF0YS5JbnRlcnZhbCAtb3IgLW5vdCAkZXh0RGF0YS5JbnRlcnZhbC5UZXh0KQ0KCQkJew0KCQkJCSRpbnRlcnZhbE51bSA9IDEwMA0KCQkJfQ0KCQkJZWxzZQ0KCQkJew0KCQkJCWlmICgtbm90IFtpbnRdOjpUcnlQYXJzZSgkZXh0RGF0YS5JbnRlcnZhbC5UZXh0LCBbcmVmXSRpbnRlcnZhbE51bSkgLW9yICRpbnRlcnZhbE51bSAtbHQgMTApDQoJCQkJew0KCQkJCQkkaW50ZXJ2YWxOdW0gPSAxMDANCgkJCQkJaWYgKCRleHREYXRhLkludGVydmFsKQ0KCQkJCQl7DQoJCQkJCQkkZXh0RGF0YS5JbnRlcnZhbC5UZXh0ID0gJzEwMCcNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJDQoJCQlUb2dnbGVCdXR0b25TdGF0ZSAkZXh0RGF0YS5CdG5TdGFydCAkZXh0RGF0YS5CdG5TdG9wICR0cnVlDQoJCQ0KCQkJJHRpbWVyS2V5ID0gIkV4dFNwYW1tZXJfJCgkZGF0YS5JbnN0YW5jZUlkKV8kZXh0TnVtIg0KCQkJaWYgKCRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnMuQ29udGFpbnMoJHRpbWVyS2V5KSkNCgkJCXsNCgkJCQkkZXhpc3RpbmdUaW1lciA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnNbJHRpbWVyS2V5XQ0KCQkJCWlmICgkZXhpc3RpbmdUaW1lcikNCgkJCQl7DQoJCQkJCSRleGlzdGluZ1RpbWVyLlN0b3AoKQ0KCQkJCQkkZXhpc3RpbmdUaW1lci5EaXNwb3NlKCkNCgkJCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVycy5SZW1vdmUoJHRpbWVyS2V5KQ0KCQkJCX0NCgkJCX0NCgkJDQoJCQkkc3BhbVRpbWVyID0gQ3JlYXRlU3BhbW1lclRpbWVyICRkYXRhLlNlbGVjdGVkV2luZG93ICRrZXlWYWx1ZSAkZGF0YS5JbnN0YW5jZUlkICRpbnRlcnZhbE51bSAkZXh0TnVtICRleHRLZXkNCgkJDQoJCQkkZXh0RGF0YS5SdW5uaW5nU3BhbW1lciA9ICRzcGFtVGltZXINCgkJCSRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5UaW1lcnNbJHRpbWVyS2V5XSA9ICRzcGFtVGltZXINCgkJfSkNCgkNCgkkZXh0RGF0YS5CdG5TdG9wLkFkZF9DbGljayh7DQoJCQkkZm9ybSA9ICR0aGlzLkZpbmRGb3JtKCkNCgkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQkkZGF0YSA9ICRmb3JtLlRhZw0KCQkNCgkJCWlmICgtbm90IChDaGVja1JhdGVMaW1pdCAkdGhpcy5HZXRIYXNoQ29kZSgpIDUwMCkpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkNCgkJCSRleHRLZXkgPSBGaW5kRXh0ZW5zaW9uS2V5QnlDb250cm9sICR0aGlzICdCdG5TdG9wJw0KCQkJaWYgKC1ub3QgJGV4dEtleSkNCgkJCXsNCgkJCQlyZXR1cm4gDQoJCQl9DQoJCQ0KCQkJaWYgKC1ub3QgJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvbkRhdGEuQ29udGFpbnMoJGV4dEtleSkpDQoJCQl7DQoJCQkJcmV0dXJuIA0KCQkJfQ0KCQkNCgkJCSRleHREYXRhID0gJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLkV4dGVuc2lvbkRhdGFbJGV4dEtleV0NCgkJCWlmICgtbm90ICRleHREYXRhKQ0KCQkJew0KCQkJCXJldHVybiANCgkJCX0NCgkJDQoJCQkkZXh0TnVtID0gJGV4dERhdGEuRXh0TnVtDQoJCQ0KCQkJaWYgKCRleHREYXRhLlJ1bm5pbmdTcGFtbWVyKQ0KCQkJew0KCQkJCSRleHREYXRhLlJ1bm5pbmdTcGFtbWVyLlN0b3AoKQ0KCQkJCSRleHREYXRhLlJ1bm5pbmdTcGFtbWVyLkRpc3Bvc2UoKQ0KCQkJCSRleHREYXRhLlJ1bm5pbmdTcGFtbWVyID0gJG51bGwNCgkJCX0NCgkJDQoJCQlUb2dnbGVCdXR0b25TdGF0ZSAkZXh0RGF0YS5CdG5TdGFydCAkZXh0RGF0YS5CdG5TdG9wICRmYWxzZQ0KCQkNCgkJCSR0aW1lcktleSA9ICJFeHRTcGFtbWVyXyQoJGRhdGEuSW5zdGFuY2VJZClfJGV4dE51bSINCgkJCWlmICgkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuVGltZXJzLkNvbnRhaW5zKCR0aW1lcktleSkpDQoJCQl7DQoJCQkJJGdsb2JhbDpEYXNoYm9hcmRDb25maWcuUmVzb3VyY2VzLlRpbWVycy5SZW1vdmUoJHRpbWVyS2V5KQ0KCQkJfQ0KCQl9KQ0KDQoJJGV4dERhdGEuQnRuSG90S2V5LkFkZF9DbGljayh7DQoJCSRmb3JtID0gJHRoaXMuRmluZEZvcm0oKQ0KCQlpZiAoLW5vdCAkZm9ybSAtb3IgLW5vdCAkZm9ybS5UYWcpDQoJCXsNCgkJCXJldHVybiANCgkJfQ0KCQkkZm9ybURhdGEgPSAkZm9ybS5UYWcgDQoNCgkJJGV4dEtleSA9IEZpbmRFeHRlbnNpb25LZXlCeUNvbnRyb2wgJHRoaXMgJ0J0bkhvdEtleScNCgkJaWYgKC1ub3QgJGV4dEtleSkNCgkJew0KCQkJcmV0dXJuIA0KCQl9DQoJCQ0KCQlpZiAoLW5vdCAkZ2xvYmFsOkRhc2hib2FyZENvbmZpZy5SZXNvdXJjZXMuRXh0ZW5zaW9uRGF0YS5Db250YWlucygkZXh0S2V5KSkNCgkJew0KCQkJcmV0dXJuIA0KCQl9DQoJCQ0KCQkkZXh0RGF0YSA9ICRnbG9iYWw6RGFzaGJvYXJkQ29uZmlnLlJlc291cmNlcy5FeHRlbnNpb25EYXRhWyRleHRLZXldDQoJCWlmICgtbm90ICRleHREYXRhKQ0KCQl7DQoJCQlyZXR1cm4gDQoJCX0NCgkJDQoJCSRjdXJyZW50SG90a2V5VGV4dCA9ICRleHREYXRhLkJ0bkhvdEtleS5UZXh0DQoJCWlmICgkY3VycmVudEhvdGtleVRleHQgLWVxICJIb3RrZXkiKSB7ICRjdXJyZW50SG90a2V5VGV4dCA9ICRudWxsIH0gDQoNCiAgICAgICAgJG9sZEhvdGtleUlkVG9VbnJlZ2lzdGVyID0gJGV4dERhdGEuSG90a2V5SWQNCg0KCQkkbmV3SG90a2V5ID0gU2hvdy1LZXlDYXB0dXJlRGlhbG9nICRjdXJyZW50SG90a2V5VGV4dA0KCQkNCgkJaWYgKCRuZXdIb3RrZXkgLWFuZCAkbmV3SG90a2V5IC1uZSAkY3VycmVudEhvdGtleVRleHQpIHsgDQoNCgkJCSRleHREYXRhLkhvdGtleSA9ICRuZXdIb3RrZXkNCgkJCQ0KCQkJdHJ5IHsNCgkJCQkkc2NyaXB0QmxvY2sgPSBbc2NyaXB0YmxvY2tdOjpDcmVhdGUoIlRvZ2dsZVNwZWNpZmljRnRvb2xJbnN0YW5jZSAtSW5zdGFuY2VJZCAnJCgkZXh0RGF0YS5JbnN0YW5jZUlkKScgLUV4dEtleSAnJCgkZXh0S2V5KSciKQ0KCQkJCSRleHREYXRhLkhvdGtleUlkID0gU2V0LUhvdGtleSAtS2V5Q29tYmluYXRpb25TdHJpbmcgJGV4dERhdGEuSG90a2V5IC1BY3Rpb24gJHNjcmlwdEJsb2NrIC1Pd25lcktleSAkZXh0S2V5IC1PbGRIb3RrZXlJZCAkb2xkSG90a2V5SWRUb1VucmVnaXN0ZXINCgkJCQkkZXh0RGF0YS5CdG5Ib3RLZXkuVGV4dCA9ICRuZXdIb3RrZXkgDQoJCQkJJGV4dEhvdEtleUlkRGlzcGxheSA9IGlmICgkZXh0RGF0YS5Ib3RrZXlJZCkgeyAkZXh0RGF0YS5Ib3RrZXlJZCB9IGVsc2UgeyAnTm9uZScgfQ0KCQkJCVdyaXRlLVZlcmJvc2UgIkZUT09MOiBSZWdpc3RlcmVkIGhvdGtleSAkKCRleHREYXRhLkhvdGtleSkgKElEOiAkZXh0SG90S2V5SWREaXNwbGF5KSBmb3IgZXh0ZW5zaW9uICQoJGV4dEtleSkuIg0KCQkJfSBjYXRjaCB7DQoJCQkJV3JpdGUtV2FybmluZyAiRlRPT0w6IEZhaWxlZCB0byByZWdpc3RlciBob3RrZXkgJCgkZXh0RGF0YS5Ib3RrZXkpIGZvciBleHRlbnNpb24gJCgkZXh0S2V5KS4gRXJyb3I6ICRfIg0KICAgICAgICAgICAgICAgICRleHREYXRhLkhvdGtleUlkID0gJG51bGwgDQogICAgICAgICAgICAgICAgJGV4dERhdGEuSG90a2V5ID0gJGN1cnJlbnRIb3RrZXlUZXh0DQogICAgICAgICAgICAgICAgJGV4dERhdGEuQnRuSG90S2V5LlRleHQgPSAkY3VycmVudEhvdGtleVRleHQgLW9yICJIb3RrZXkiDQoJCQl9DQoJCQkNCgkJCVVwZGF0ZVNldHRpbmdzICRmb3JtRGF0YSAkZXh0RGF0YSAtZm9yY2VXcml0ZQ0KCQl9IGVsc2VpZiAoLW5vdCAkbmV3SG90a2V5IC1hbmQgJG9sZEhvdGtleUlkVG9VbnJlZ2lzdGVyKSB7IA0KCQkJdHJ5IHsNCgkJCQlVbnJlZ2lzdGVyLUhvdGtleUluc3RhbmNlIC1JZCAkb2xkSG90a2V5SWRUb1VucmVnaXN0ZXIgLU93bmVyS2V5ICRleHRLZXkNCgkJCQlXcml0ZS1WZXJib3NlICJGVE9PTDogVW5yZWdpc3RlcmVkIGhvdGtleSAoSUQ6ICQoJG9sZEhvdGtleUlkVG9VbnJlZ2lzdGVyKSkgZm9yIGV4dGVuc2lvbiAkKCRleHRLZXkpIGR1ZSB0byB1c2VyIGNsZWFyLiINCgkJCX0gY2F0Y2ggew0KCQkJCVdyaXRlLVdhcm5pbmcgIkZUT09MOiBGYWlsZWQgdG8gdW5yZWdpc3RlciBob3RrZXkgKElEOiAkKCRvbGRIb3RrZXlJZFRvVW5yZWdpc3RlcikpIGZvciBleHRlbnNpb24gJCgkZXh0S2V5KSBvbiBjbGVhci4gRXJyb3I6ICRfIg0KCQkJfQ0KICAgICAgICAgICAgJGV4dERhdGEuSG90a2V5SWQgPSAkbnVsbA0KICAgICAgICAgICAgJGV4dERhdGEuSG90a2V5ID0gJG51bGwNCiAgICAgICAgICAgICRleHREYXRhLkJ0bkhvdEtleS5UZXh0ID0gIkhvdGtleSINCiAgICAgICAgICAgIFVwZGF0ZVNldHRpbmdzICRmb3JtRGF0YSAkZXh0RGF0YSAtZm9yY2VXcml0ZQ0KICAgICAgICB9DQoJfSkNCgkNCgkkZXh0RGF0YS5CdG5SZW1vdmUuQWRkX0NsaWNrKHsNCgkJCXRyeQ0KCQkJew0KCQkJCSRmb3JtID0gJHRoaXMuRmluZEZvcm0oKQ0KCQkJCWlmICgtbm90ICRmb3JtIC1vciAtbm90ICRmb3JtLlRhZykNCgkJCQl7DQoJCQkJCXJldHVybiANCgkJCQl9DQoJCQkNCgkJCQlpZiAoLW5vdCAoQ2hlY2tSYXRlTGltaXQgJHRoaXMuR2V0SGFzaENvZGUoKSAxMDAwKSkNCgkJCQl7DQoJCQkJCXJldHVybiANCgkJCQl9DQoJCQkNCgkJCQkkZXh0S2V5ID0gRmluZEV4dGVuc2lvbktleUJ5Q29udHJvbCAkdGhpcyAnQnRuUmVtb3ZlJw0KCQkJCWlmICgtbm90ICRleHRLZXkpDQoJCQkJew0KCQkJCQlyZXR1cm4gDQoJCQkJfQ0KCQkJDQoJCQkJJHRoaXMuRW5hYmxlZCA9ICRmYWxzZQ0KCQkJDQoJCQkJUmVtb3ZlRXh0ZW5zaW9uICRmb3JtICRleHRLZXkNCgkJCQ0KCQkJCSRmb3JtLlRhZy5FeHRlbnNpb25Db3VudC0tDQoJCQl9DQoJCQljYXRjaA0KCQkJew0KCQkJCVdyaXRlLVZlcmJvc2UgKCJGVE9PTDogRXJyb3IgaW4gUmVtb3ZlIGJ1dHRvbiBoYW5kbGVyOiB7MH0iIC1mICRfLkV4Y2VwdGlvbi5NZXNzYWdlKSAtRm9yZWdyb3VuZENvbG9yIFJlZA0KCQkJfQ0KCQl9KQ0KfQ0KDQojZW5kcmVnaW9uDQoNCiNyZWdpb24gTW9kdWxlIEV4cG9ydHMNCg0KRXhwb3J0LU1vZHVsZU1lbWJlciAtRnVuY3Rpb24gRnRvb2xTZWxlY3RlZFJvdywgU2V0LUhvdGtleSwgUmVzdW1lLUFsbEhvdGtleXMsIFJlc3VtZS1QYXVzZWRLZXlzLCBSZXN1bWUtSG90a2V5c0Zvck93bmVyLCBSZW1vdmUtQWxsSG90a2V5cywgVGVzdC1Ib3RrZXlDb25mbGljdCwgSW52b2tlLUZ0b29sQWN0aW9uLCBQYXVzZUFsbEhvdGtleXMsIFBhdXNlSG90a2V5c0Zvck93bmVyLCBVbnJlZ2lzdGVyLUhvdGtleUluc3RhbmNlLCBUb2dnbGVTcGVjaWZpY0Z0b29sSW5zdGFuY2UsIFRvZ2dsZUluc3RhbmNlSG90a2V5cywgR2V0LVZpcnR1YWxLZXlNYXBwaW5ncywgTm9ybWFsaXplS2V5U3RyaW5nLCBQYXJzZUtleVN0cmluZywgR2V0LUtleUNvbWJpbmF0aW9uU3RyaW5nLCBJc01vZGlmaWVyS2V5Q29kZSwgU2hvdy1LZXlDYXB0dXJlRGlhbG9nLCBMb2FkRnRvb2xTZXR0aW5ncywgRmluZE9yQ3JlYXRlUHJvZmlsZSwgSW5pdGlhbGl6ZUV4dGVuc2lvblRyYWNraW5nLCBHZXROZXh0RXh0ZW5zaW9uTnVtYmVyLCBGaW5kRXh0ZW5zaW9uS2V5QnlDb250cm9sLCBMb2FkRXh0ZW5zaW9uU2V0dGluZ3MsIFVwZGF0ZVNldHRpbmdzLCBDcmVhdGVQb3NpdGlvblRpbWVyLCBSZXBvc2l0aW9uRXh0ZW5zaW9ucywgQ3JlYXRlU3BhbW1lclRpbWVyLCBUb2dnbGVCdXR0b25TdGF0ZSwgQ2hlY2tSYXRlTGltaXQsIEFkZEZvcm1DbGVhbnVwSGFuZGxlciwgQ2xlYW51cEluc3RhbmNlUmVzb3VyY2VzLCBTdG9wLUZ0b29sRm9ybSwgUmVtb3ZlRXh0ZW5zaW9uLCBDcmVhdGVGdG9vbEZvcm0sIEFkZEZ0b29sRXZlbnRIYW5kbGVycywgQ3JlYXRlRXh0ZW5zaW9uUGFuZWwsIEFkZEV4dGVuc2lvbkV2ZW50SGFuZGxlcnMNCg0KI2VuZHJlZ2lvbg==
			'
		}
	}
#endregion Step: Define Module Metadata

#endregion Global Configuration

#region Environment Initialization and Checks

#region Function: Show-ErrorDialog
	function Show-ErrorDialog
	{
		<#
		.SYNOPSIS
			Displays a standardized error message box using Windows Forms for critical errors.
		
		.PARAMETER Message
			[string] The error message text to display in the dialog box. This message should clearly state the problem encountered. (Mandatory)
		
		.OUTPUTS
			[void] This function does not return any value. Its purpose is to display a modal error dialog to the user.
		
		.NOTES
			This function requires the System.Windows.Forms .NET assembly to be loaded. It attempts to load the assembly if not already present.
			If displaying the Windows Forms MessageBox fails (e.g., in a non-interactive session or if assembly loading fails), it falls back to writing
			the error message to the PowerShell error stream using Write-Verbose for logging purposes. This function is intended for critical errors
			that need immediate user attention, often before exiting the script.
		#>
		param(
			[Parameter(Mandatory = $true)]
			[string]$Message
		)
		try
		{
			#region Step: Ensure WinForms Assembly is Loaded
				# Try loading the .NET part needed for MessageBox. Use -ErrorAction Stop to catch errors.
				# See if it's already loaded to avoid trying again/warnings.
				if (-not ([System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms')))
				{
					Add-Type -AssemblyName System.Windows.Forms -ErrorAction Stop
				}
				#endregion Step: Ensure WinForms Assembly is Loaded
				
				#region Step: Display WinForms MessageBox
				# Show the error pop-up box to the user.
				# Title shows the app name clearly. MessageBoxIcon.Error gives a visual hint.
				[System.Windows.Forms.MessageBox]::Show($Message, 'Entropia Dashboard Error',
					[System.Windows.Forms.MessageBoxButtons]::OK,
					[System.Windows.Forms.MessageBoxIcon]::Error) | Out-Null # Send to Out-Null to hide the 'OK' button result.
			#endregion Step: Display WinForms MessageBox
		}
		catch
		{
			# Backup plan if the WinForms MessageBox doesn't work.
			# Write the original message and why the pop-up failed to the error output.
			Write-Verbose "Failed to display error dialog: `"$Message`". Dialog Display Error: $($_.Exception.Message)" -ForegroundColor Red
		}
	}
#endregion Function: Show-ErrorDialog

#region Function: Request-Elevation
	function Request-Elevation
	{
		<#
		.SYNOPSIS
			Checks for required execution context (Admin rights, 32-bit, Bypass Policy) and attempts to restart the script if necessary.
		
		.DESCRIPTION
			This function assesses the current script execution environment. It verifies:
			1. Administrator Privileges: Checks if the current user is a member of the Administrators group.
			2. 32-bit Execution: Confirms if the current PowerShell process is running in 32-bit mode (required for potential interaction with 32-bit game clients or libraries).
			3. Execution Policy: Ensures the effective execution policy for the current process is 'Bypass' to allow dynamic script and module loading.
			
			If any of these conditions are not met, the function attempts to relaunch the script using the 32-bit PowerShell executable located in SysWOW64.
			The relaunch uses the 'RunAs' verb, triggering a UAC prompt for elevation if needed, and explicitly sets the execution policy to 'Bypass' for the new process.
			Upon successfully starting the new process, the *current* script instance exits immediately.
		
		.OUTPUTS
			[void] This function does not return a value. It either determines no restart is needed and returns silently, or it attempts to start a new process and then exits the current one using 'exit'.
		
		.NOTES
			- Relies on the existence of the 32-bit PowerShell executable at '$env:SystemRoot\SysWOW64\WindowsPowerShell\v1.0\powershell.exe'. If not found, the script will exit with an error.
			- Uses the '$myinvocation' automatic variable to get the path of the currently running script for the relaunch command.
			- If the relaunch attempt fails (e.g., user cancels UAC, file not found), an error dialog is shown, and the script exits.
			- The use of '-ExecutionPolicy Bypass' in the relaunch arguments is a security consideration; see the main script notes.
		#>
		param() # No inputs needed for this function.
		
		#region Step: Check Current Environment State
			Write-Verbose "Checking current execution environment (Admin, 32-bit, Execution Policy)..." -ForegroundColor Cyan
			# $needsRestart - Flag ($true/$false), set to $true if something isn't right.
			[bool]$needsRestart = $false
			# $reason - A list to gather easy-to-read reasons why we need a restart.
			[System.Collections.ArrayList]$reason = @()
			
			# Check if we're running as Admin.
			# $isAdmin - Flag ($true/$false), $true if the current user is an Admin.
			[bool]$isAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
			if (-not $isAdmin)
			{
				$needsRestart = $true; $null = $reason.Add('Administrator privileges required.') # Add reason if not admin.
			}
			
			# Check if this process is 32-bit. [IntPtr]::Size is 4 for 32-bit, 8 for 64-bit.
			# $is32Bit - Flag ($true/$false), $true if the process is 32-bit.
			[bool]$is32Bit = [IntPtr]::Size -eq 4
			if (-not $is32Bit)
			{
				$needsRestart = $true; $null = $reason.Add('32-bit execution required.') # Add reason if not 32-bit.
			}
			
			# Check the Execution Policy just for this running process.
			# $currentPolicy - Text showing the execution policy (like 'Restricted', 'Bypass').
			[string]$currentPolicy = Get-ExecutionPolicy -Scope Process -ErrorAction SilentlyContinue # SilentlyContinue handles if it's not set for the process.
			# Needs 'Bypass' for loading/running things the way we planned.
			if ($currentPolicy -ne 'Bypass')
			{
				$needsRestart = $true
				if ($currentPolicy -ne '') {
					$effectivePolicy = $currentPolicy
				} else {
					$effectivePolicy = Get-ExecutionPolicy
				}
				$null = $reason.Add("Execution Policy 'Bypass' required for Process scope (Current effective: '$effectivePolicy').") # Show the actual policy being used.
			}
		#endregion Step: Check Current Environment State
		
		#region Step: Perform Restart if Necessary
			if ($needsRestart)
			{
				# Write down the reasons we're trying to restart.
				Write-Verbose "  Restarting script needed: $($reason -join ' ')" -ForegroundColor Yellow
				
				# Set the path to the 32-bit PowerShell program.
				# $psExe - Text, full path to the 32-bit powershell.exe.
				[string]$psExe = Join-Path $env:SystemRoot 'SysWOW64\WindowsPowerShell\v1.0\powershell.exe'
				if (-not (Test-Path $psExe -PathType Leaf)) # Check if the program file exists.
				{
					# Show error and quit if the needed program is missing.
					Show-ErrorDialog "FATAL: Required 32-bit PowerShell executable not found at '$psExe'. Cannot continue."
					exit 1 # Exit code 1 means there was an error.
				}
				
				# Get everything inside the current script file.
				$encodedCommand = @"

"@

				# Decode the command
				try {
					$decodedBytes = [System.Convert]::FromBase64String($encodedCommand)
					# IMPORTANT: Use the right encoding the script was saved with! UTF8 is typical, but PowerShell might use UTF8 with BOM or UTF16LE. Assume UTF8 here.
					$decodedCommand = [System.Text.Encoding]::UTF8.GetString($decodedBytes)
				} catch {
					Show-ErrorDialog "FATAL: Failed to decode the embedded command. Error: $($_.Exception.Message)"
					exit 1
				}

				# Make a temporary file path
				$tempScriptPath = [System.IO.Path]::Combine([System.IO.Path]::GetTempPath(), ([System.Guid]::NewGuid().ToString() + ".ps1"))

				try
				{
					# Save the decoded command to the temp file (using the right encoding)
					[System.IO.File]::WriteAllText($tempScriptPath, $decodedCommand, [System.Text.Encoding]::UTF8) # Match encoding from GetString

					# Build the NEW arguments using -File
					# Added -ExecutionPolicy Bypass, often needed when running scripts like this.
					# $psArgs - Text holding the command-line arguments.
					[string]$psArgs = "-WindowStyle Hidden -noexit -ExecutionPolicy Bypass -File `"$tempScriptPath`"" # Note the quotes around the path

					# Set up the ProcessStartInfo object
					$psi = New-Object System.Diagnostics.ProcessStartInfo
					$psi.FileName = $psExe         # The program to run. Make sure $psExe is set!
					$psi.Arguments = $psArgs       # The arguments for the program.
					$psi.UseShellExecute = $true   # MUST be $true to use the 'Verb' property.
					$psi.Verb = 'RunAs'            # Ask for Admin rights (UAC).

					Write-Verbose "  Attempting to start new elevated/32-bit process via temp file: `"$psExe`" $psArgs" -ForegroundColor Cyan
					Write-Verbose "  Temporary script file: $tempScriptPath" -ForegroundColor DarkGray

					# Start the new process
					[System.Diagnostics.Process]::Start($psi) | Out-Null

					# Success (request sent)
					Write-Verbose "  Successfully requested elevated/32-bit process start. Exiting current process." -ForegroundColor Green
					exit 0
				}
				catch
				{
					# Error handling
					Show-ErrorDialog "FATAL: Failed to restart script with required settings (Admin/32-bit/Bypass). Error: $($_.Exception.Message)"
					# Delete the temp file if it failed (might not work if permissions are odd)
					if (Test-Path $tempScriptPath) {
						try { Remove-Item $tempScriptPath -ErrorAction Stop } catch {}
					}
					exit 1
				}
			}
			else
			{
				# Log that the script is already running with the right settings.
				Write-Verbose "  Script already running with required environment settings (Admin, 32-bit, Bypass Policy)." -ForegroundColor Green
			}
		#endregion Step: Perform Restart if Necessary
	}
#endregion Function: Request-Elevation

#region Function: Initialize-ScriptEnvironment
	function Initialize-ScriptEnvironment
	{
		<#
		.SYNOPSIS
			Verifies that the script environment meets all requirements *after* any potential restart attempt by Request-Elevation.
		
		.DESCRIPTION
			This function performs final checks to ensure the script is operating in the correct environment before proceeding with core logic.
			It re-validates:
			1. Administrator Privileges: Confirms the script is now running elevated.
			2. 32-bit Mode: Confirms the script is now running in a 32-bit PowerShell process.
			3. Execution Policy: Confirms the process scope execution policy is 'Bypass'. If not (which shouldn't happen if Request-Elevation worked),
			it makes a final attempt to set it using Set-ExecutionPolicy.
			
			If any check fails, it displays a specific error message using Show-ErrorDialog and returns $false.
		
		.OUTPUTS
			[bool] Returns $true if all environment checks pass successfully, otherwise returns $false.
		
		.NOTES
			- This function should be called *after* Request-Elevation. It acts as a final safeguard.
			- Failure here is typically fatal for the application, as indicated by the error messages and the return value.
			- The attempt to set ExecutionPolicy within this function is a fallback; ideally, Request-Elevation should have ensured this.
		#>
		[CmdletBinding()]
		[OutputType([bool])] 
		param()
		
		Write-Verbose "Verifying final script environment settings..." -ForegroundColor Cyan
		try
		{
			#region Step: Verify Administrator Privileges
				# $isAdmin - Flag ($true/$false), $true if the current user is an Admin.
				[bool]$isAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
				if (-not $isAdmin)
				{
					# Show error and return $false if not running as Admin.
					Show-ErrorDialog 'FATAL: Application requires administrator privileges to run.'
					return $false
				}
				Write-Verbose "[OK] Running with administrator privileges." -ForegroundColor Green
			#endregion Step: Verify Administrator Privileges
			
			#region Step: Verify 32-bit Execution Mode
				# $is32Bit - Flag ($true/$false), $true if the process is 32-bit.
				[bool]$is32Bit = [IntPtr]::Size -eq 4
				if (-not $is32Bit)
				{
					# Show error and return $false if not running in 32-bit mode.
					Show-ErrorDialog 'FATAL: Application must run in 32-bit PowerShell mode.'
					return $false
				}
				Write-Verbose "[OK] Running in 32-bit mode." -ForegroundColor Green
			#endregion Step: Verify 32-bit Execution Mode
			
			#region Step: Verify Process Execution Policy
				# $currentPolicy - Text, the execution policy for this process.
				[string]$currentPolicy = Get-ExecutionPolicy -Scope Process -ErrorAction SilentlyContinue
				if ($currentPolicy -ne 'Bypass')
				{
					# This is a backup. Ideally, Request-Elevation already set 'Bypass'.
					Write-Verbose "  Process Execution Policy is not 'Bypass' (Current: '$(if (-not [string]::IsNullOrEmpty($currentPolicy)) { $currentPolicy } else { Get-ExecutionPolicy })'). Attempting final Set..." -ForegroundColor Yellow
					try
					{
						# Try to force the policy to Bypass for this process.
						Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force -ErrorAction Stop
						# Check again after trying.
						$currentPolicy = Get-ExecutionPolicy -Scope Process -ErrorAction SilentlyContinue
						if ($currentPolicy -ne 'Bypass')
						{
							# If it still didn't work, report a major error.
							Show-ErrorDialog "FATAL: Failed to set required PowerShell Execution Policy to 'Bypass'.  (Current: '$(if (-not [string]::IsNullOrEmpty($currentPolicy)) { $currentPolicy } else { Get-ExecutionPolicy })')."
							return $false
						}
						Write-Verbose "[OK] Execution policy successfully forced to Bypass for this process." -ForegroundColor Green
					}
					catch
					{
						# Catch errors during the last Set-ExecutionPolicy try.
						Show-ErrorDialog "FATAL: Error setting PowerShell Execution Policy to 'Bypass'.  (Current: '$(if (-not [string]::IsNullOrEmpty($currentPolicy)) { $currentPolicy } else { Get-ExecutionPolicy })'). Error: $($_.Exception.Message)"
						return $false
					}
				}
				else
				{
					Write-Verbose "[OK] Execution policy is '$currentPolicy'." -ForegroundColor Green
				}
			#endregion Step: Verify Process Execution Policy
			
			# If all checks passed:
			Write-Verbose "  Environment verification successful." -ForegroundColor Green
			return $true
		}
		catch
		{
			# Catch any surprise errors during the check itself.
			Show-ErrorDialog "FATAL: An unexpected error occurred during environment verification: $($_.Exception.Message)"
			return $false
		}
	}
#endregion Function: Initialize-ScriptEnvironment

#region Function: Initialize-BaseConfig
	function Initialize-BaseConfig
	{
		<#
		.SYNOPSIS
			Ensures necessary application data directories exist in %APPDATA% and are writable.
		
		.DESCRIPTION
			This function is responsible for setting up the fundamental directory structure required by the application
			within the user's roaming application data folder (%APPDATA%). It specifically checks for and, if necessary, creates:
			1. The main application directory: %APPDATA%\Entropia_Dashboard
			2. The modules subdirectory: %APPDATA%\Entropia_Dashboard\modules
			
			After ensuring the directories exist, it performs a quick write test in each directory by creating and immediately
			deleting a temporary file ('write_test.tmp'). This verifies that the script has the necessary permissions to write
			files (like modules and configuration) to these locations.
		
		.OUTPUTS
			[bool] Returns $true if both directories exist (or were created successfully) AND are verified as writable. Returns $false if
			directory creation fails or if either directory is found to be non-writable.
		
		.NOTES
			- Upon successful completion (returning $true), it sets the global state flag '$global:DashboardConfig.State.ConfigInitialized' to $true.
			- Errors during directory creation or the write test are logged to the error stream and presented to the user via Show-ErrorDialog,
			as these are typically fatal issues preventing the application from functioning correctly.
			- Uses -Force with New-Item to create parent directories if they don't exist.
		#>
		[CmdletBinding()]
		[OutputType([bool])]
		param()

		Write-Verbose "Initializing base configuration directories in %APPDATA%..." -ForegroundColor Cyan
		try
		{
			# List of essential folders that must exist and be writable.
			# $directories - List of text paths for the required folders.
			[string[]]$directories = @(
				$global:DashboardConfig.Paths.App,     # e.g., C:\Users\User\AppData\Roaming\Entropia_Dashboard\
				$global:DashboardConfig.Paths.Modules  # e.g., C:\Users\User\AppData\Roaming\Entropia_Dashboard\modules\
			)
			
			# Go through each needed folder path.
			foreach ($dir in $directories)
			{
				#region Step: Ensure Directory Exists
					# Check if the path exists and is actually a folder (Container).
					if (-not (Test-Path -Path $dir -PathType Container))
					{
						Write-Verbose "  Directory not found. Creating: '$dir'" -ForegroundColor DarkGray
						try
						{
							# Create the folder. -Force makes parent folders too. -ErrorAction Stop stops if it fails.
							$null = New-Item -Path $dir -ItemType Directory -Force -ErrorAction Stop
						}
						catch
						{
							# Handle errors when creating the folder (like permissions, bad path).
							$errorMsg = "  Failed to create required directory '$dir'. Please check permissions or path validity. Error: $($_.Exception.Message)"
							Write-Verbose $errorMsg -ForegroundColor Red
							Show-ErrorDialog $errorMsg
							return $false # Can't continue if creating the folder fails.
						}
					}
					else
					{
						Write-Verbose "  Directory exists: '$dir'" -ForegroundColor DarkGray
					}
				#endregion Step: Ensure Directory Exists
				
				#region Step: Test Directory Writability
					# Make a temporary file path in the current folder for a write test.
					# $testFile - Text, path for the temporary test file.
					[string]$testFile = Join-Path -Path $dir -ChildPath 'write_test.tmp'
					try
					{
						# Try writing a small bit of text to the test file.
						[System.IO.File]::WriteAllText($testFile, 'TestWriteAccess')
						# If writing works, delete the test file right away. -Force skips asking.
						Remove-Item -Path $testFile -Force -ErrorAction Stop
						Write-Verbose "  Directory is writable: '$dir'" -ForegroundColor DarkGray
					}
					catch
					{
						# Handle errors during writing or deleting (probably bad permissions).
						$errorMsg = "  Cannot write to directory '$dir'. Please check permissions. Error: $($_.Exception.Message)"
						Write-Verbose $errorMsg -ForegroundColor Red
						Show-ErrorDialog $errorMsg
						# Try cleaning up the test file just in case it was made but couldn't be deleted.
						if (Test-Path -Path $testFile -PathType Leaf)
						{
							Remove-Item -Path $testFile -Force -ErrorAction SilentlyContinue
						}
						return $false # Can't continue if the folder isn't writable.
					}
				#endregion Step: Test Directory Writability
			} # End of the loop for each directory.
			
			# If the loop finishes without returning false, all folders are ready.
			Write-Verbose "  Base configuration directories initialized and verified successfully." -ForegroundColor Green
			# Set the main state flag.
			$global:DashboardConfig.State.ConfigInitialized = $true
			return $true
		}
		catch
		{
			# Catch any surprise errors during the whole setup process.
			$errorMsg = "  An unexpected error occurred during base configuration directory initialization: $($_.Exception.Message)"
			Write-Verbose $errorMsg -ForegroundColor Red
			Show-ErrorDialog $errorMsg
			return $false
		}
	}
#endregion Function: Initialize-BaseConfig

#endregion Environment Initialization and Checks

#region Module Handling Functions

#region Function: Write-Module
	function Write-Module
	{
		<#
		.SYNOPSIS
			Writes module content (from a source file or Base64 string) to the designated modules directory in %APPDATA%, performing hash checks to avoid redundant writes.
		
		.DESCRIPTION
			This function handles the deployment of module files (e.g., .psm1, .dll, .ico) from their source location or embedded Base64 representation
			to the application's 'modules' directory under %APPDATA% (defined in $global:DashboardConfig.Paths.Modules).
			
			Key operations:
			1. Ensures the target 'modules' directory exists, attempting to create it if necessary.
			2. Retrieves the module content as a byte array, either by reading the source file specified by the -Content parameter or by decoding the Base64 string provided via -ContentBase64.
			3. If the target file already exists in the 'modules' directory:
			a. Compares the file size of the existing file with the size of the new content. If different, an update is needed.
			b. If sizes match, calculates the SHA256 hash of both the existing file and the new content in memory.
			c. If the hashes match, the function logs that no update is needed and returns the path to the existing file, avoiding an unnecessary write operation.
			d. If hashes differ, an update is needed.
			4. If the target file does not exist or an update is required (sizes/hashes differ), the function attempts to write the new content (byte array) to the target path.
			5. Includes a simple retry mechanism (up to 5 seconds) with short delays (100ms) specifically for System.IO.IOException errors during the write attempt, which often indicate temporary file locks.
		
		.PARAMETER ModuleName
			[string] The destination filename for the module in the target directory (e.g., 'ui.psm1', 'ftool.dll', 'icon.ico'). (Mandatory)
		
		.PARAMETER Content
			[string] Used in the 'FilePath' parameter set. The full path to the source file containing the module content to be copied. (Mandatory, ParameterSetName='FilePath')
		
		.PARAMETER ContentBase64
			[string] Used in the 'Base64Content' parameter set. A Base64 encoded string containing the module content to be decoded and written. (Mandatory, ParameterSetName='Base64Content')
		
		.OUTPUTS
			[string] Returns the full path to the successfully written (or verified existing and matching) module file in the target 'modules' directory.
			Returns $null if any critical operation fails (e.g., directory creation, source file reading, Base64 decoding, final write attempt after retries).
		
		.NOTES
			- Uses SHA256 hash comparison for efficient and reliable detection of unchanged files.
			- Error handling is implemented for directory creation, file reading, Base64 decoding, hash calculation, and file writing.
			- The write retry loop is basic and may not handle all concurrent access scenarios perfectly but addresses common temporary locks.
			- Uses [System.IO.File]::ReadAllBytes and ::WriteAllBytes for potentially better performance with binary files (.dll, .ico) compared to Get-Content/Set-Content.
		#>
		[CmdletBinding(DefaultParameterSetName = 'FilePath')] # Default to FilePath if only unnamed inputs are used.
		[OutputType([string])]
		param (
			[Parameter(Mandatory = $true, Position = 0)]
			[string]$ModuleName, # e.g., 'ui.psm1'
		
			[Parameter(Mandatory = $true, ParameterSetName = 'FilePath', Position = 1)]
			[ValidateScript({ Test-Path $_ -PathType Leaf })] # Basic check: make sure path exists and is a file.
			[string]$Content, # Source file path, e.g., 'C:\path\to\source\ui.psm1'
		
			[Parameter(Mandatory = $true, ParameterSetName = 'Base64Content')]
			[string]$ContentBase64 # Base64 encoded content text
		)
		
		# Get the destination folder path from the main config.
		# $modulesDir - Text, destination folder for modules.
		[string]$modulesDir = $global:DashboardConfig.Paths.Modules
		# Build the full path for the destination file.
		# $finalPath - Text, full destination path for the module file.
		[string]$finalPath = Join-Path -Path $modulesDir -ChildPath $ModuleName
		
		Write-Verbose "Executing Write-Module for '$ModuleName' to '$finalPath'" -ForegroundColor Cyan
		try
		{
			#region Step: Ensure Target Directory Exists
				# Check if the destination folder exists; try creating it if not.
				if (-not (Test-Path -Path $modulesDir -PathType Container))
				{
					Write-Verbose "Target module directory not found, attempting creation: '$modulesDir'" -ForegroundColor DarkGray
					try
					{
						$null = New-Item -Path $modulesDir -ItemType Directory -Force -ErrorAction Stop
						Write-Verbose "Target module directory created successfully: '$modulesDir'" -ForegroundColor Green
					}
					catch
					{
						# Major error if folder cannot be created.
						Write-Verbose "Failed to create target module directory '$modulesDir': $($_.Exception.Message)" -ForegroundColor Red
						return $null # Cannot continue.
					}
				}
			#endregion Step: Ensure Target Directory Exists
			
			#region Step: Get Content Bytes from Source (File or Base64)
				# $bytes - Array of bytes that will hold the module content.
				[byte[]]$bytes = $null
				Write-Verbose "  ParameterSetName: $($PSCmdlet.ParameterSetName)" -ForegroundColor DarkGray
				
				# Handle Base64 input
				if ($PSCmdlet.ParameterSetName -eq 'Base64Content')
				{
					if ([string]::IsNullOrEmpty($ContentBase64))
					{
						Write-Verbose "  ModuleName '$ModuleName': ContentBase64 parameter was provided but is empty." -ForegroundColor Yellow
						return $null
					}
					try
					{
						$bytes = [System.Convert]::FromBase64String($ContentBase64)
						Write-Verbose "  Decoded Base64 content for '$ModuleName' ($($bytes.Length) bytes)." -ForegroundColor DarkGray
					}
					catch
					{
						# Major error if Base64 decoding fails.
						Write-Verbose "  Failed to decode Base64 content for '$ModuleName': $($_.Exception.Message)" -ForegroundColor Red
						return $null
					}
				}
				# Handle FilePath input
				elseif ($PSCmdlet.ParameterSetName -eq 'FilePath')
				{
					# File existence already checked by ValidateScript, but double-check path is valid.
					if ([string]::IsNullOrEmpty($Content) -or -not ([System.IO.File]::Exists($Content)) )
					{
						Write-Verbose "  ModuleName '$ModuleName': Source file path '$Content' is invalid or does not exist." -ForegroundColor Red
						return $null # Shouldn't happen with ValidateScript, but good safety check.
					}
					try
					{
						$bytes = [System.IO.File]::ReadAllBytes($Content)
						Write-Verbose "  Read source file content for '$ModuleName' from '$Content' ($($bytes.Length) bytes)." -ForegroundColor DarkGray
					}
					catch
					{
						# Major error if source file cannot be read.
						Write-Verbose "  Failed to read source file '$Content' for '$ModuleName': $($_.Exception.Message)" -ForegroundColor Red
						return $null
					}
				}
				else # Shouldn't get here because of parameter sets
				{
					Write-Verbose "  ModuleName '$ModuleName': Invalid parameter combination or missing content." -ForegroundColor Red
					return $null
				}
				
				# Final check if the byte array got filled.
				if ($null -eq $bytes)
				{
					Write-Verbose "  Failed to obtain content bytes for '$ModuleName'. Source data might be empty or invalid." -ForegroundColor Red
					return $null
				}
			#endregion Step: Get Content Bytes from Source (File or Base64)
			
			#region Step: Check if File Needs Updating (Size and Hash Comparison)
				# $updateNeeded - Flag ($true/$false), decides if the file needs writing.
				[bool]$updateNeeded = $true
				if (Test-Path -Path $finalPath -PathType Leaf) # Check if the destination file exists.
				{
					Write-Verbose "  Target file exists: '$finalPath'. Comparing size and hash..." -ForegroundColor DarkGray
					try
					{
						# Get info about the existing file.
						# $fileInfo - File info object for the existing file.
						$fileInfo = Get-Item -LiteralPath $finalPath -Force -ErrorAction Stop
						
						# 1. Compare file sizes first (quick check).
						if ($fileInfo.Length -eq $bytes.Length)
						{
							Write-Verbose "  File sizes match ($($bytes.Length) bytes). Comparing SHA256 hashes..." -ForegroundColor DarkGray
							# 2. If sizes match, compare SHA256 hashes.
							# $existingHash - Text, SHA256 hash of the file on disk.
							[string]$existingHash = (Get-FileHash -LiteralPath $finalPath -Algorithm SHA256 -ErrorAction Stop).Hash
							
							# Calculate hash of the new content (bytes) in memory.
							# $memStream - Memory stream to feed bytes to Get-FileHash. 'Using' cleans it up.
							$newHash = try
							{
								$memStream = New-Object System.IO.MemoryStream(,$bytes)
								(Get-FileHash -InputStream $memStream -Algorithm SHA256 -ErrorAction Stop).Hash
							}
							finally
							{
								if ($memStream)
								{
									$memStream.Dispose() 
								}
							}
							
							Write-Verbose " - Existing Hash: $existingHash" -ForegroundColor DarkGray
							Write-Verbose " - New Hash:    - $newHash" -ForegroundColor DarkGray
							
							# If hashes match, no update needed.
							if ($existingHash -eq $newHash)
							{
								Write-Verbose "  Hashes match for '$ModuleName'. No update needed." -ForegroundColor DarkGray
								$updateNeeded = $false
								# Return path to the existing, checked file.
								return $finalPath
							}
							else
							{
								Write-Verbose "  Hashes differ for '$ModuleName'. Update required." -ForegroundColor Yellow 
							}
						}
						else
						{
							Write-Verbose "  File sizes differ (Existing: $($fileInfo.Length), New: $($bytes.Length)). Update required." -ForegroundColor Yellow 
						}
					}
					catch
					{
						# Handle errors during size/hash compare (like file locked, permissions).
						# Log a warning and assume an update is needed.
						Write-Verbose "  Could not compare size/hash for '$ModuleName' (Path: '$finalPath'). Will attempt to overwrite. Error: $($_.Exception.Message)" -ForegroundColor Yellow
						$updateNeeded = $true
					}
				}
				else
				{
					Write-Verbose "  Target file does not exist: '$finalPath'. Writing new file." -ForegroundColor DarkGray 
					$updateNeeded = $true
				}
			#endregion Step: Check if File Needs Updating (Size and Hash Comparison)
			
			#region Step: Write File to Target Path (with Retry on IO Exception)
				if ($updateNeeded)
				{
					# Set up retry settings.
					# $timeoutMilliseconds - Number, max time (ms) to spend retrying the write.
					[int]$timeoutMilliseconds = 5000  # 5 seconds total retry time.
					# $retryDelayMilliseconds - Number, delay (ms) between retries.
					[int]$retryDelayMilliseconds = 100 # Wait 100ms before trying again.
					# $startTime - DateTime, when the retry loop started.
					[datetime]$startTime = Get-Date
					# $fileWritten - Flag ($true/$false) if file was written okay within the time limit.
					[bool]$fileWritten = $false
					# $attempts - Number, counts how many times we tried writing.
					[int]$attempts = 0
					
					Write-Verbose "  Attempting to write file: '$finalPath'" -ForegroundColor DarkGray
					while (((Get-Date) - $startTime).TotalMilliseconds -lt $timeoutMilliseconds)
					{
						$attempts++
						try
						{
							# Try writing all bytes to the final path using a .NET method.
							[System.IO.File]::WriteAllBytes($finalPath, $bytes)
							$fileWritten = $true
							Write-Verbose "  Successfully wrote '$ModuleName' to '$finalPath' on attempt $attempts." -ForegroundColor Green
							break # Exit the retry loop if write worked.
						}
						catch [System.IO.IOException]
						{
							# Catch IO errors specifically (probably file lock). Log warning and retry after delay.
							Write-Verbose "  Attempt $($attempts): IO Error writing '$finalPath' (Retrying in $retryDelayMilliseconds ms): $($_.Exception.Message)" -ForegroundColor Red
							# Check if time is almost up before waiting.
							if (((Get-Date) - $startTime).TotalMilliseconds + $retryDelayMilliseconds -ge $timeoutMilliseconds)
							{
								Write-Verbose "  Timeout nearing, breaking retry loop for '$finalPath'." -ForegroundColor Yellow
								break # Don't wait longer than the timeout.
							}
							Start-Sleep -Milliseconds $retryDelayMilliseconds
						}
						catch
						{
							# Catch other surprise, non-retryable errors during write. Log error and stop loop.
							Write-Verbose "  Attempt $($attempts): Non-IO Error writing '$finalPath': $($_.Exception.Message)" -ForegroundColor Red
							$fileWritten = $false # Make sure flag is false.
							break # Exit loop on non-retryable error.
						}
					} # End of while retry loop
					
					# Check if the file was written okay after the loop.
					if (-not $fileWritten)
					{
						Write-Verbose "  Failed to write module '$ModuleName' to '$finalPath' after $attempts attempts within $timeoutMilliseconds ms timeout." -ForegroundColor Red
						return $null # Return null to show it failed.
					}
				} # End if($updateNeeded)
			#endregion Step: Write File to Target Path (with Retry on IO Exception)
			
			# If we get here, the file exists and is current, or it was just written successfully.
			return $finalPath
		}
		catch
		{
			# Catch any surprise errors in the main function part (like input check failed earlier).
			Write-Verbose "  An unexpected error occurred in Write-Module for '$ModuleName': $($_.Exception.Message)" -ForegroundColor Red
			return $null
		}
	}
#endregion Function: Write-Module


#region Function: Import-ModuleUsingReflection
	# ... (Keep Import-ModuleUsingReflection function as it was) ...
	function Import-ModuleUsingReflection
	{
		<#
		.SYNOPSIS
			(Alternative Method) Imports a PowerShell module by reading, modifying (adding no-op Export-ModuleMember), and executing its content directly in the global scope via Invoke-Command.

		.DESCRIPTION
			This function offers another non-standard way to load a .psm1 module, aiming to address issues where `Import-Module` or `InvokeScript` fail due to `$using:` variables.
			Its process involves:
			1. Reading the entire content of the specified .psm1 file into a string.
			2. Storing the original content in $global:DashboardConfig.Resources.LoadedModuleContent.
			3. Prepending a simple, no-operation `Export-ModuleMember` function definition to the beginning of the content string.
			4. Creating a single `ScriptBlock` object from this modified content string.
			5. Executing this `ScriptBlock` directly in the current (global) execution context using `Invoke-Command -ScriptBlock $scriptBlock`. This method is chosen specifically because `Invoke-Command` executed locally *can* resolve `$using:` variables against the caller's scope.

		.PARAMETER Path
			[string] The full path to the .psm1 module file to be imported using this method. (Mandatory)

		.PARAMETER ModuleName
			[string] The logical name of the module being imported (e.g., 'ui.psm1'), used primarily for logging. (Mandatory)

		.OUTPUTS
			[bool] Returns $true if the `Invoke-Command` execution completes without throwing a terminating error.
			Returns $false if a fatal error occurs (e.g., file not found, terminating error during script execution).
			*Note: Returning $true indicates execution finished, but doesn't guarantee the module loaded correctly or that all its functions are available/working.*

		.NOTES
			- Global Scope Pollution: This method directly defines all functions, variables, and aliases from the module into the global scope.
			- Use Case: Fallback specifically intended to handle modules containing `$using:` variables that cause standard import/InvokeScript methods to fail.
			- Error Handling: Relies on catching terminating errors from `Invoke-Command`. Non-terminating errors within the module code will be logged by PowerShell but won't cause this function to return $false unless `-ErrorAction Stop` was used inside the module code itself.
		#>
		[CmdletBinding()]
		[OutputType([bool])]
		param(
			[Parameter(Mandatory = $true)]
			[ValidateScript({ Test-Path $_ -PathType Leaf })] # Make sure path exists and is a file.
			[string]$Path,

			[Parameter(Mandatory = $true)]
			[string]$ModuleName
		)

		Write-Verbose "Attempting reflection-style import (InvokeCommand in global scope) for '$ModuleName'." -ForegroundColor Cyan

		try
		{
			#region Step: Check File Existence (Redundant with ValidateScript but safe)
				if (-not (Test-Path -Path $Path -PathType Leaf))
				{
					Write-Verbose "Import-ModuleUsingReflection: Module file not found or is not a file: '$Path'" -ForegroundColor Red
					return $false
				}
			#endregion Step: Check File Existence

			#region Step: Read and Store Original Module Content
				[string]$moduleContent = [System.IO.File]::ReadAllText($Path)
				if ($null -eq $moduleContent)
				{
					if (Test-Path -Path $Path -PathType Leaf)
					{
						Write-Verbose "Import-ModuleUsingReflection: Module file '$Path' is empty. Considering import successful (no-op)." -ForegroundColor Yellow
						$global:DashboardConfig.Resources.LoadedModuleContent[$ModuleName] = ''
						return $true
					}
					else
					{
						Write-Verbose "Import-ModuleUsingReflection: Failed to read module file '$Path'." -ForegroundColor Red
						return $false
					}
				}
				# Ensure Resources hashtable exists before storing
				if ($global:DashboardConfig -and -not $global:DashboardConfig.ContainsKey('Resources')) {
					$global:DashboardConfig['Resources'] = @{}
				}
				# Ensure LoadedModuleContent hashtable exists
				 if ($global:DashboardConfig -and $global:DashboardConfig.Resources -and -not $global:DashboardConfig.Resources.ContainsKey('LoadedModuleContent')) {
					$global:DashboardConfig.Resources['LoadedModuleContent'] = @{}
				}
				$global:DashboardConfig.Resources.LoadedModuleContent[$ModuleName] = $moduleContent
				Write-Verbose "Read and stored original content for '$ModuleName'." -ForegroundColor DarkGray
			#endregion Step: Read and Store Original Module Content

			#region Step: Prepend No-Op Export-ModuleMember to Content
				# Define a simple Export-ModuleMember to potentially satisfy calls within the script
				# It does NOT actually export anything in the module sense.
				[string]$noOpExportFunc = @"
function Export-ModuleMember { 
param(
[string]`$Function, 
[string]`$Variable, 
[string]`$Alias, 
[string]`$Cmdlet
)
}
"@
				[string]$modifiedContent = @"
$noOpExportFunc

# --- Original Module Content Start ---
$moduleContent
# --- Original Module Content End ---
"@
			#endregion Step: Prepend No-Op Export-ModuleMember to Content

			#region Step: Create ScriptBlock and Execute Globally via Invoke-Command
				Write-Verbose "Creating ScriptBlock and executing modified content globally via Invoke-Command for '$ModuleName'..." -ForegroundColor DarkGray
				[scriptblock]$scriptBlock = [ScriptBlock]::Create($modifiedContent)
				try
				{
					# Execute the script block in the current scope using Invoke-Command
					$null = Invoke-Command -ScriptBlock $scriptBlock
					
					# Check the automatic variable $? to see if any *non-terminating* errors occurred.
					# If $? is false, it's a failure for this import attempt.
					if (-not $?)
					{
						Write-Verbose "Execution of '$ModuleName' content via Invoke-Command completed, but non-terminating errors occurred (see logs above). This is considered a failure." -ForegroundColor Yellow
						return $false
					}
					
					# Log successful completion of the Invoke-Command call
					Write-Verbose "Successfully finished executing modified script block for '$ModuleName' via Invoke-Command." -ForegroundColor Green
					return $true 
				}
				catch # Catch only *terminating* errors from Invoke-Command itself
				{
					Write-Verbose "Terminating error occurred during Invoke-Command execution for '$ModuleName': $($_.Exception.Message)" -ForegroundColor Red
					Write-Verbose "Stack Trace: $($_.ScriptStackTrace)"
					# Return false indicating a fatal error during execution.
					return $false 
				}
			#endregion Step: Create ScriptBlock and Execute Globally via Invoke-Command
		}
		catch # Catch errors during setup (read file, create scriptblock etc.)
		{
			Write-Verbose "FATAL error during reflection-style import (InvokeCommand) setup for '$ModuleName': $($_.Exception.Message)" -ForegroundColor Red
			return $false # Return false indicating setup failure
		}
	}
#endregion Function: Import-ModuleUsingReflection


#region Function: Import-DashboardModules
	function Import-DashboardModules
	{
		<#
		.SYNOPSIS
			Loads all defined dashboard modules according to priority, dependencies, and execution context (Script vs EXE).
		
		.DESCRIPTION
			This crucial function orchestrates the loading of all modules specified in '$global:DashboardConfig.Modules'.
			It performs the following steps:
			1. Initializes tracking variables for loaded and failed modules.
			2. Determines if the script is running as a compiled EXE or a standard .ps1 script, storing the result in '$global:DashboardConfig.State.IsRunningAsExe'. This influences the import strategy.
			3. Sorts the modules based on the 'Order' property defined in their metadata to ensure correct loading sequence.
			4. Iterates through the sorted modules:
			a. Checks if all dependencies listed for the current module are already present in '$global:DashboardConfig.LoadedModules'. If not, skips the module and records the failure. Critical module dependency failures trigger a critical failure flag.
			b. Calls 'Write-Module' to ensure the module file (or resource like .dll, .ico) exists in the %APPDATA%\modules directory, handling source file paths or Base64 content, and using hash checks for efficiency. If Write-Module fails, records the failure. Critical module write failures trigger the critical failure flag.
			c. If Write-Module succeeds, adds the module name and its written path to '$global:DashboardConfig.LoadedModules'. This satisfies dependency checks for subsequent modules, including non-PSM1 files like DLLs or icons.
			d. If the module is a PowerShell module (.psm1):
			i. Attempts multiple import strategies in sequence until one succeeds:
			- Attempt 1 (Preferred): Standard `Import-Module`. If running as EXE, it first modifies the content in memory to prepend a no-op `Export-ModuleMember`, writes this to a temporary file, imports the temp file, and then deletes it. If running as a script, it imports the written module path directly. Success is verified by checking `Get-Module`.
			- Attempt 2 (Alternative): Calls `Import-ModuleUsingReflection` function (InvokeCommand in global scope). **Crucially, after this attempt returns true, this function now performs an additional verification step using `Get-Command` for key functions expected from the module.** If key functions are missing, Attempt 2 is marked as failed, and the process proceeds to Attempt 3.
			- Attempt 3 (Last Resort): Uses `Invoke-Expression` on the module content after attempting to remove/comment out `Export-ModuleMember` calls using string replacement. This attempt includes its own verification and global re-definition of functions. **(Security Risk)**
			ii. If all import attempts fail for a .psm1 module, records the failure, removes the module from '$global:DashboardConfig.LoadedModules' (as it was written but not imported), and triggers the critical failure flag if the module was critical.
			5. After processing all modules, checks the critical failure flag. If set, returns a status object indicating failure.
			6. Logs warnings for any 'Important' modules that failed and informational messages for 'Optional' module failures.
			7. If no critical failures occurred, returns a status object indicating overall success (though non-critical modules may have failed).
		
		.OUTPUTS
			[PSCustomObject] Returns an object with the following properties:
			- Status [bool]: $true if all 'Critical' modules were successfully written and (if applicable) imported without fatal errors. $false if any 'Critical' module failed or if an unhandled exception occurred.
			- LoadedModules [hashtable]: A hashtable containing {ModuleName = Path} entries for all modules that were successfully written to the AppData directory by Write-Module (includes .psm1, .dll, .ico, etc.). Note that for .psm1, inclusion here doesn't guarantee successful *import*, only successful writing/verification. Check FailedModules for import status.
			- FailedModules [hashtable]: A hashtable containing {ModuleName = ErrorMessage} entries for modules that failed during dependency check, writing (Write-Module), or importing (for .psm1 files).
			- CriticalFailure [bool]: $true if a module marked with Priority='Critical' failed at any stage (dependency, write, or import). $false otherwise.
			- Exception [string]: (Optional) Included only if an unexpected, unhandled exception occurred within the Import-DashboardModules function itself. Contains the exception message.
		
		.NOTES
			- The multi-attempt import strategy for .psm1 files adds complexity but aims for robustness, especially in potentially problematic EXE execution environments.
			- Attempt 2 now includes verification. If it passes, Attempt 3 (Invoke-Expression) is skipped.
			- The use of `Invoke-Expression` (Attempt 3) remains a significant security risk and should ideally be avoided by refactoring modules to work with Attempt 1 or a reliable Attempt 2.
			- Dependency checking relies on modules being added to `$global:DashboardConfig.LoadedModules` *after* successful execution of `Write-Module`.
			- Error reporting distinguishes between Critical, Important, and Optional module failures. Only Critical failures halt the application startup process.
		#>
		[CmdletBinding()]
		[OutputType([PSCustomObject])]
		param()
		
		Write-Verbose "Initializing module import process..." -ForegroundColor Cyan
		
		# Set up the return object structure and internal tracking variables.
		# $result - PSCustomObject to return. Start with default failure state.
		$result = [PSCustomObject]@{
			Status          = $false # Default to failure until proven successful.
			LoadedModules   = $global:DashboardConfig.LoadedModules # Use global directly, shows state during the run.
			FailedModules   = @{}    # List to store {ModuleName = ErrorMessage}.
			CriticalFailure = $false # Flag for critical module failures.
			Exception       = $null  # Placeholder for errors we didn't handle.
		}
		# $failedModules - Local reference to the list inside the result object for easier updates.
		[hashtable]$failedModules = $result.FailedModules
		
		try
		{
			#region Step: Determine Execution Context (EXE vs. Script)
				# Get info about the current running process.
				# $currentProcess - Process object for the current PowerShell instance.
				$currentProcess = Get-Process -Id $PID -ErrorAction Stop # Use Get-Process instead of GetCurrentProcess() for consistent MainModule access.

				# $processPath - Text, the full path of the program file for the current process. Use Path property.
				[string]$processPath = $currentProcess.Path # Use Path property, usually more reliable

				# Check if the process path ends with .exe and is NOT a normal PowerShell program.
				# $isRunningAsExe - Flag ($true/$false).
				[bool]$isRunningAsExe = $processPath -like '*.exe' -and ($processPath -notlike '*powershell.exe' -and $processPath -notlike '*pwsh.exe')
				
				# Ensure State exists before setting IsRunningAsExe
				if ($global:DashboardConfig -and -not $global:DashboardConfig.ContainsKey('State')) {
					$global:DashboardConfig['State'] = @{}
				}
				if ($global:DashboardConfig -and $global:DashboardConfig.State) {
					$global:DashboardConfig.State.IsRunningAsExe = $isRunningAsExe # Store globally.
				}
				Write-Verbose "  Execution context detected: $(if($isRunningAsExe){'Compiled EXE'} else {'PowerShell Script'}) (Process Path: '$processPath')" -ForegroundColor DarkGray
			#endregion Step: Determine Execution Context (EXE vs. Script)
			
			#region Step: Sort Modules by Defined 'Order' Property
				Write-Verbose "  Sorting modules based on 'Order' property..." -ForegroundColor DarkGray
				# $sortedModules - A list of module entries (Key/Value pairs) sorted by the 'Order' value in the module's info.
				# Need to handle errors if module config is messed up.
				$sortedModules = $global:DashboardConfig.Modules.GetEnumerator() |
				Where-Object {
					# Basic check: Make sure key exists and value is a hashtable with an 'Order' property.
					$_.Value -is [hashtable] -and $_.Value.ContainsKey('Order') -and $_.Value.Order -is [int]
				} |
				Sort-Object { $_.Value.Order } -ErrorAction SilentlyContinue # Sort based on the number 'Order' value.
				
				if (-not $sortedModules -or $sortedModules.Count -ne $global:DashboardConfig.Modules.Count)
				{
					# Check if sorting failed or if some modules were skipped due to bad structure.
					$invalidModules = $global:DashboardConfig.Modules.GetEnumerator() | Where-Object { -not ($_.Value -is [hashtable] -and $_.Value.ContainsKey('Order') -and $_.Value.Order -is [int]) }
					$errorMessage = "  Failed to sort modules or found invalid module configurations. Check structure in `$global:DashboardConfig.Modules."
					if ($invalidModules)
					{
						$errorMessage += " Invalid modules: $($invalidModules.Key -join ', ')"
					}
					Write-Verbose $errorMessage -ForegroundColor Red
					$result.Status = $false
					$result.CriticalFailure = $true # Treat sorting/config errors as critical.
					$failedModules['Module Sorting/Validation'] = $errorMessage
					return $result # Return failure right away.
				}
				Write-Verbose "  Processing $($sortedModules.Count) modules in defined order." -ForegroundColor DarkGray
			#endregion Step: Sort Modules by Defined 'Order' Property
			
			#region Step: Process Each Module in Sorted Order
				foreach ($entry in $sortedModules)
				{
					# $moduleName - Text, the key/filename of the module (e.g., 'ui.psm1').
					[string]$moduleName = $entry.Key
					# $moduleInfo - Hashtable holding info for this module (Priority, Order, Dependencies, FilePath/Base64Content).
					$moduleInfo = $entry.Value # Already checked as a hashtable during sorting.
					
					Write-Verbose "Processing Module: '$moduleName' (Priority: $($moduleInfo.Priority), Order: $($moduleInfo.Order))" -ForegroundColor Cyan
					
					#region SubStep: Check Dependencies
						Write-Verbose "- Checking dependencies..." -ForegroundColor DarkGray
						# $dependenciesMet - Flag ($true/$false), assume true until a missing dependency found.
						[bool]$dependenciesMet = $true
						# Check if Dependencies key exists, is an array, and has items.
						if ($moduleInfo.Dependencies -and $moduleInfo.Dependencies -is [array] -and $moduleInfo.Dependencies.Count -gt 0)
						{
							Write-Verbose "  - Required: $($moduleInfo.Dependencies -join ', ')" -ForegroundColor DarkGray
							foreach ($dependency in $moduleInfo.Dependencies)
							{
								# Check if the dependency is a key in the *global* loaded modules list.
								if (-not $global:DashboardConfig.LoadedModules.ContainsKey($dependency))
								{
									$errorMessage = "- Dependency NOT MET: Module '$dependency' must be loaded before '$moduleName'."
									Write-Verbose "- $errorMessage" -ForegroundColor Yellow
									$failedModules[$moduleName] = $errorMessage
									$dependenciesMet = $false
									# Check if this failure is critical.
									if ($moduleInfo.Priority -eq 'Critical')
									{
										Write-Verbose "- CRITICAL FAILURE: Critical module '$moduleName' cannot load due to missing dependency '$dependency'." -ForegroundColor Red
										$result.CriticalFailure = $true
									}
									break # No need to check more dependencies for this module.
								}
								else
								{
									Write-Verbose "  - Dependency satisfied: '$dependency' is loaded." -ForegroundColor DarkGray
								}
							}
						}
						else
						{
							Write-Verbose "  - No dependencies listed for '$moduleName'." -ForegroundColor DarkGray
						}
						
						# If dependencies aren't met, skip the rest of this module.
						if (-not $dependenciesMet)
						{
							continue
						} # Go to the next module in the loop.
					
					#endregion SubStep: Check Dependencies
					
					#region SubStep: Write Module to AppData Directory (Using Write-Module)
						# $modulePath - Text, path where module was written/checked. $null on failure.
						[string]$modulePath = $null
						Write-Verbose "- Ensuring module file exists in AppData via Write-Module for '$moduleName'..." -ForegroundColor DarkGray
						
						# Call Write-Module, giving inputs based on module's config (FilePath or Base64Content).
						try
						{
							if ($moduleInfo.ContainsKey('FilePath'))
							{
								[string]$sourceFilePath = $moduleInfo.FilePath
								# --- Add check for source file path ---
								if (-not (Test-Path $sourceFilePath -PathType Leaf)) {
									throw "Source FilePath specified in config does not exist or is not a file: '$sourceFilePath'"
								}
								Write-Verbose "Calling Write-Module with source FilePath: '$sourceFilePath'" -ForegroundColor Cyan
								$modulePath = Write-Module -ModuleName $moduleName -Content $sourceFilePath -ErrorAction Stop # Use Stop to catch errors here.
							}
							elseif ($moduleInfo.ContainsKey('Base64Content'))
							{
								[string]$base64Content = $moduleInfo.Base64Content
								Write-Verbose "Calling Write-Module with Base64Content (Length: $($base64Content.Length))" -ForegroundColor Cyan
								# Make sure content isn't null/empty before passing
								if ([string]::IsNullOrEmpty($base64Content))
								{
									throw "Base64Content for module '$moduleName' is empty."
								}
								$modulePath = Write-Module -ModuleName $moduleName -ContentBase64 $base64Content -ErrorAction Stop
							}
							else
							{
								# Shouldn't get here if sorting check worked.
								throw "Invalid module configuration format for '$moduleName' - missing FilePath or Base64Content."
							}
								
							# Check if Write-Module returned a valid path.
							if ([string]::IsNullOrEmpty($modulePath))
							{
								# Write-Module should ideally error out on failure with ErrorAction Stop, but double-check.
								throw "Write-Module returned null or empty path for '$moduleName', indicating write failure."
							}
								
							Write-Verbose "- [OK] Module file ready/verified: '$modulePath'" -ForegroundColor Green
							# Add/Update path in global loaded modules list. Happens for ALL written files (.psm1, .dll, .ico).
							# This is key for checking dependencies of non-PSM1 files.
							# Ensure LoadedModules hashtable exists
							if ($global:DashboardConfig -and -not $global:DashboardConfig.ContainsKey('LoadedModules')) {
								$global:DashboardConfig['LoadedModules'] = @{}
							}
							if ($global:DashboardConfig -and $global:DashboardConfig.LoadedModules) {
								$global:DashboardConfig.LoadedModules[$moduleName] = $modulePath
							}
								
						}
						catch
						{
							# Catch errors from Write-Module call or the code block above.
							$errorMessage = "- Failed to write or verify module file for '$moduleName'. Error: $($_.Exception.Message)"
							Write-Verbose "- $errorMessage" -ForegroundColor Red
							$failedModules[$moduleName] = $errorMessage
							# Check if this failure is critical.
							if ($moduleInfo.Priority -eq 'Critical')
							{
								Write-Verbose "- CRITICAL FAILURE: Failed to write critical module '$moduleName'." -ForegroundColor Red
								$result.CriticalFailure = $true
							}
							continue # Go to the next module.
						}
					#endregion SubStep: Write Module to AppData Directory (Using Write-Module)
						
					#region SubStep: Import PowerShell Modules (.psm1)
						# Only try PowerShell import steps if the module is a .psm1 file.
						if ($moduleName -like '*.psm1')
						{
							Write-Verbose "Attempting to import PowerShell module '$moduleName' from '$modulePath'..." -ForegroundColor Cyan
							# $importSuccess - Flag ($true/$false) for successful import of this specific PSM1 module.
							[bool]$importSuccess = $false
							# $importErrorDetails - Text to store failure details if all tries fail.
							[string]$importErrorDetails = 'All import attempts failed.'
							[string]$moduleBaseName = [System.IO.Path]::GetFileNameWithoutExtension($moduleName)

							# --- Import Try 1: Standard Import-Module (with EXE changes if needed) ---
							if (-not $importSuccess)
							{
								Write-Verbose "- Attempt 1: Using standard Import-Module..." -ForegroundColor Cyan
								try
								{
									# $effectiveModulePath - Path for Import-Module (might be temp path for EXE).
									[string]$effectiveModulePath = $modulePath
									# $tempModulePath - Path to temp changed file if running as EXE.
									[string]$tempModulePath = $null
										
									if ($isRunningAsExe)
									{
										Write-Verbose "  - (Running as EXE: Prepending no-op Export-ModuleMember to temporary file for import)" -ForegroundColor DarkGray
										# Create a unique temporary file path.
										$tempModulePath = [System.IO.Path]::Combine([System.IO.Path]::GetTempPath(), ('{0}_{1}.psm1' -f $moduleBaseName, [System.Guid]::NewGuid().ToString('N')))
										Write-Verbose "  - Temp file path: $tempModulePath" -ForegroundColor DarkGray
											
										# Read original content (already in global config or re-read to be safe).
										# $originalContent - Text, content of the module.
										# Ensure Resources and LoadedModuleContent exist
										[string]$originalContent = $null
										if ($global:DashboardConfig -and $global:DashboardConfig.Resources -and $global:DashboardConfig.Resources.LoadedModuleContent -and $global:DashboardConfig.Resources.LoadedModuleContent.ContainsKey($moduleName)) {
											$originalContent = $global:DashboardConfig.Resources.LoadedModuleContent[$moduleName]
										}
										if ($null -eq $originalContent)
										{
											$originalContent = [System.IO.File]::ReadAllText($modulePath)
										} # Re-read if not found
											
										# Define the dummy function text.
										$noOpExportFunc = "function Export-ModuleMember { param([Parameter(ValueFromPipeline=`$true)][string[]]`$Function, [string[]]`$Variable, [string[]]`$Alias, [string[]]`$Cmdlet) { Write-Verbose ""Ignoring Export-ModuleMember (EXE Mode Import for '$($using:moduleName)')"" -ForegroundColor Cyan} }"
										# Add to beginning and write to temp file using UTF8 encoding.
										Set-Content -Path $tempModulePath -Value "$noOpExportFunc`n`n# --- Original module content ($moduleName) follows ---`n$originalContent" -Encoding UTF8 -Force -ErrorAction Stop
										$effectiveModulePath = $tempModulePath # Use the temp path for import.
									}
										
									# Run Import-Module. -Force re-imports if already loaded (good for dev/debug).
									Import-Module -Name $effectiveModulePath -Force -ErrorAction Stop
										
									# Check module loaded okay by using Get-Module with the base name.
									if (Get-Module -Name $moduleBaseName -ErrorAction SilentlyContinue)
									{
										$importSuccess = $true
										Write-Verbose "- [OK] Attempt 1: SUCCESS (Standard Import-Module verified for '$moduleBaseName')." -ForegroundColor Green
									}
									else
									{
										# This might happen if Import-Module finishes but the module somehow doesn't show up right.
										Write-Verbose "- Attempt 1: FAILED (Standard Import-Module) - Module '$moduleBaseName' not found via Get-Module after import call." -ForegroundColor Yellow
										$importErrorDetails = "Standard Import-Module completed but module '$moduleBaseName' could not be verified via Get-Module."
										# If import failed, make sure any existing module state is removed before trying next way.
										Remove-Module -Name $moduleBaseName -Force -ErrorAction SilentlyContinue
									}
										
								}
								catch
								{
									Write-Verbose "- Attempt 1: FAILED (Standard Import-Module Error): $($_.Exception.Message)" -ForegroundColor Yellow
									$importErrorDetails = "Standard Import-Module Error: $($_.Exception.Message)"
									# Make sure any partial/failed module state is removed.
									Remove-Module -Name $moduleBaseName -Force -ErrorAction SilentlyContinue
								}
								finally
								{
									# Clean up temp file if one was made for EXE mode.
									if ($tempModulePath -and (Test-Path $tempModulePath))
									{
										Write-Verbose "  - Cleaning up temporary file: $tempModulePath" -ForegroundColor DarkGray
										Remove-Item -Path $tempModulePath -Force -ErrorAction SilentlyContinue
									}
								}
							} # End Try 1
																
							# --- Import Try 2: Import-ModuleUsingReflection (WITH VERIFICATION) ---
							if (-not $importSuccess)
							{
								# Check if the alternative function exists.
								if (Get-Command Import-ModuleUsingReflection -ErrorAction SilentlyContinue)
								{
									Write-Verbose "- Attempt 2: Using alternative Import-ModuleUsingReflection (InvokeCommand)..." -ForegroundColor Yellow
									try
									{
										# Call the reflection import function
										if (Import-ModuleUsingReflection -Path $modulePath -ModuleName $moduleName -ErrorAction Stop)
										{
											# --- Verification Step Added ---
											Write-Verbose "  - Attempt 2: InvokeCommand finished. Verifying key functions globally for '$moduleName'..." -ForegroundColor Magenta

											# Get the list of expected functions for this module (reuse from Attempt 3 logic)
											$keyFunctionsToVerify = @()
											if ($moduleName -eq 'ini.psm1')       { $keyFunctionsToVerify = @('Initialize-IniConfig', 'Get-IniFileContent', 'Read-Config', 'Write-Config', 'Copy-OrderedDictionary', 'LoadDefaultConfigOnError') }
											elseif ($moduleName -eq 'ui.psm1') { $keyFunctionsToVerify = @('Initialize-UI', 'Set-UIElement', 'Show-SettingsForm', 'Hide-SettingsForm', 'Sync-ConfigToUI', 'Sync-UIToConfig', 'Register-UIEventHandlers') }
											elseif ($moduleName -eq 'datagrid.psm1') { $keyFunctionsToVerify = @('Test-ValidParameters', 'Get-ProcessList', 'Remove-TerminatedProcesses', 'New-RowLookupDictionary', 'Update-ExistingRow', 'UpdateRowIndices', 'Add-NewProcessRow', 'Start-WindowStateCheck', 'Find-TargetRow', 'Clear-OldProcessCache', 'Update-DataGrid', 'Start-DataGridUpdateTimer', 'Set-WindowToolStyle', 'Restore-WindowStyles' ) }
											elseif ($moduleName -eq 'launch.psm1')   { $keyFunctionsToVerify = @('Start-ClientLaunch', 'Stop-ClientLaunch') }
											elseif ($moduleName -eq 'login.psm1')    { $keyFunctionsToVerify = @('Restore-Window', 'Set-WindowForeground', 'Wait-ForFileAccess', 'Write-LogWithRetry', 'Invoke-MouseClick', 'Invoke-KeyPress', 'LoginSelectedRow', 'Lock-MousePosition', 'Unlock-MousePosition', 'Update-Progress', 'CheckCancel', 'ParseCoordinates', 'Wait-UntilClientNormalState', 'Wait-UntilWorldLoaded', 'ProcessSingleClient') }
											elseif ($moduleName -eq 'ftool.psm1')    { $keyFunctionsToVerify = @('FtoolSelectedRow', 'Set-Hotkey', 'Resume-AllHotkeys', 'Resume-PausedKeys', 'Resume-HotkeysForOwner', 'Remove-AllHotkeys', 'Test-HotkeyConflict', 'Invoke-FtoolAction', 'PauseAllHotkeys', 'PauseHotkeysForOwner', 'Unregister-HotkeyInstance', 'ToggleSpecificFtoolInstance', 'ToggleInstanceHotkeys', 'Get-VirtualKeyMappings', 'NormalizeKeyString', 'ParseKeyString', 'Get-KeyCombinationString', 'IsModifierKeyCode', 'Show-KeyCaptureDialog', 'LoadFtoolSettings', 'FindOrCreateProfile', 'InitializeExtensionTracking', 'GetNextExtensionNumber', 'FindExtensionKeyByControl', 'LoadExtensionSettings', 'UpdateSettings', 'CreatePositionTimer', 'RepositionExtensions', 'CreateSpammerTimer', 'ToggleButtonState', 'CheckRateLimit', 'AddFormCleanupHandler', 'CleanupInstanceResources', 'Stop-FtoolForm', 'RemoveExtension', 'CreateFtoolForm', 'AddFtoolEventHandlers', 'CreateExtensionPanel', 'AddExtensionEventHandlers') }
											
											[bool]$attempt2VerificationPassed = $true # Assume success until proven otherwise
											[string]$missingFunction = $null

											if ($keyFunctionsToVerify.Count -gt 0) {
												foreach ($funcName in $keyFunctionsToVerify) {
													if (-not (Get-Command -Name $funcName -CommandType Function -ErrorAction SilentlyContinue)) {
														$attempt2VerificationPassed = $false
														$missingFunction = $funcName
														Write-Verbose "  - Attempt 2: VERIFICATION FAILED. Function '$funcName' not found globally after InvokeCommand." -ForegroundColor Red
														$importErrorDetails = "Attempt 2 (InvokeCommand) completed but verification failed: Function '$funcName' not found globally."
														break # Stop checking if one is missing
													}
												}
											} else {
												Write-Verbose "  - Attempt 2: No specific key functions listed for verification for '$moduleName'. Assuming success based on InvokeCommand completion." -ForegroundColor DarkGray
												# If no functions to verify, trust the $true return from Import-ModuleUsingReflection
												$attempt2VerificationPassed = $true 
											}

											# Set final import success based on verification
											if ($attempt2VerificationPassed) {
												Write-Verbose "- [OK] Attempt 2: SUCCESS (InvokeCommand completed AND key functions verified for '$moduleName')." -ForegroundColor Green
												$importSuccess = $true
											} else {
												# Failure already logged above
												$importSuccess = $false
											}
											# --- End Verification Step ---
										}
										else # Import-ModuleUsingReflection returned false (fatal error during its execution)
										{
											Write-Verbose "- Attempt 2: FAILED (Import-ModuleUsingReflection returned false)." -ForegroundColor Yellow
											$importErrorDetails = 'Import-ModuleUsingReflection returned false (fatal execution error).'
											$importSuccess = $false # Ensure flag is false
										}
									}
									catch # Catch errors *calling* Import-ModuleUsingReflection
									{
										Write-Verbose "- Attempt 2: FAILED (Error calling Import-ModuleUsingReflection): $($_.Exception.Message)" -ForegroundColor Yellow
										$importErrorDetails = "Error calling Import-ModuleUsingReflection: $($_.Exception.Message)"
										$importSuccess = $false # Ensure flag is false
									}
								}
								else # Import-ModuleUsingReflection command not found
								{
									Write-Verbose "- Attempt 2: SKIPPED (Import-ModuleUsingReflection function not found)." -ForegroundColor Yellow
								}
							} # End Try 2
								
							# --- Import Try 3: Direct Invoke-Expression (Last Resort - Security Risk!) ---
							# This only runs if $importSuccess is still $false after Attempt 1 and Attempt 2 (including verification)
							if (-not $importSuccess)
							{
								Write-Verbose "- Attempt 3: Using LAST RESORT Invoke-Expression (Security Risk!)..." -ForegroundColor Yellow
								# === Add a variable to track functions caught just in *this* try ===
								$functionsCapturedInThisAttempt = @{}
								try
								{
									# Read module content (might be saved in global config).
									[string]$invokeContent = $null
									if ($global:DashboardConfig -and $global:DashboardConfig.Resources -and $global:DashboardConfig.Resources.LoadedModuleContent -and $global:DashboardConfig.Resources.LoadedModuleContent.ContainsKey($moduleName)) {
										$invokeContent = $global:DashboardConfig.Resources.LoadedModuleContent[$moduleName]
									}
									if ($null -eq $invokeContent)
									{
										$invokeContent = [System.IO.File]::ReadAllText($modulePath)
									} # Re-read if needed.

									# Basic try to disable Export-ModuleMember calls using multi-line regex replace.
									$invokeContent = $invokeContent -replace '(?m)^\s*Export-ModuleMember.*', "# Export-ModuleMember call disabled by Invoke-Expression wrapper for $moduleName"

									# Run the (maybe changed) content directly in the global space.
									Invoke-Expression -Command $invokeContent -ErrorAction Stop

									# First check if IEX finished without MAJOR error
									$iexCompletedWithoutTerminatingError = $?

									# Check key functions right away AND grab them if found
									$keyFunctionsToCapture = @()
									# --- LIST ALL EXPECTED EXPORTED/USED FUNCTIONS FOR EACH MODULE ---
									if ($moduleName -eq 'ini.psm1')       { $keyFunctionsToCapture = @('Initialize-IniConfig', 'Get-IniFileContent', 'Read-Config', 'Write-Config', 'Copy-OrderedDictionary', 'LoadDefaultConfigOnError') }
									elseif ($moduleName -eq 'ui.psm1') { $keyFunctionsToCapture = @('Initialize-UI', 'Set-UIElement', 'Show-SettingsForm', 'Hide-SettingsForm', 'Sync-ConfigToUI', 'Sync-UIToConfig', 'Register-UIEventHandlers') }
									elseif ($moduleName -eq 'datagrid.psm1') { $keyFunctionsToCapture = @('Test-ValidParameters', 'Get-ProcessList', 'Remove-TerminatedProcesses', 'New-RowLookupDictionary', 'Update-ExistingRow', 'UpdateRowIndices', 'Add-NewProcessRow', 'Start-WindowStateCheck', 'Find-TargetRow', 'Clear-OldProcessCache', 'Update-DataGrid', 'Start-DataGridUpdateTimer', 'Set-WindowToolStyle', 'Restore-WindowStyles' ) }
									elseif ($moduleName -eq 'launch.psm1')   { $keyFunctionsToCapture = @('Start-ClientLaunch', 'Stop-ClientLaunch') }
									elseif ($moduleName -eq 'login.psm1')    { $keyFunctionsToCapture = @('Restore-Window', 'Set-WindowForeground', 'Wait-ForFileAccess', 'Write-LogWithRetry', 'Invoke-MouseClick', 'Invoke-KeyPress', 'LoginSelectedRow', 'Lock-MousePosition', 'Unlock-MousePosition', 'Update-Progress', 'CheckCancel', 'ParseCoordinates', 'Wait-UntilClientNormalState', 'Wait-UntilWorldLoaded', 'ProcessSingleClient') }
									elseif ($moduleName -eq 'ftool.psm1')    { $keyFunctionsToCapture = @('FtoolSelectedRow', 'Set-Hotkey', 'Resume-AllHotkeys', 'Resume-PausedKeys', 'Resume-HotkeysForOwner', 'Remove-AllHotkeys', 'Test-HotkeyConflict', 'Invoke-FtoolAction', 'PauseAllHotkeys', 'PauseHotkeysForOwner', 'Unregister-HotkeyInstance', 'ToggleSpecificFtoolInstance', 'ToggleInstanceHotkeys', 'Get-VirtualKeyMappings', 'NormalizeKeyString', 'ParseKeyString', 'Get-KeyCombinationString', 'IsModifierKeyCode', 'Show-KeyCaptureDialog', 'LoadFtoolSettings', 'FindOrCreateProfile', 'InitializeExtensionTracking', 'GetNextExtensionNumber', 'FindExtensionKeyByControl', 'LoadExtensionSettings', 'UpdateSettings', 'CreatePositionTimer', 'RepositionExtensions', 'CreateSpammerTimer', 'ToggleButtonState', 'CheckRateLimit', 'AddFormCleanupHandler', 'CleanupInstanceResources', 'Stop-FtoolForm', 'RemoveExtension', 'CreateFtoolForm', 'AddFtoolEventHandlers', 'CreateExtensionPanel', 'AddExtensionEventHandlers') }

									# Create captured functions storage if it doesn't exist
									if ($global:DashboardConfig -and $global:DashboardConfig.Resources -and -not $global:DashboardConfig.Resources.ContainsKey('CapturedFunctions')) {
										$global:DashboardConfig.Resources['CapturedFunctions'] = @{}
									}

									$captureSuccess = $true # Assume capture worked at first
									$criticalFunctionMissing = $false

									if ($keyFunctionsToCapture.Count -gt 0) {
										Write-Verbose "- Attempt 3: Verifying and capturing key functions for '$moduleName' immediately after IEX..." -ForegroundColor Magenta
										foreach ($funcName in $keyFunctionsToCapture) {
											$funcInfo = Get-Command -Name $funcName -CommandType Function -ErrorAction SilentlyContinue
											if ($funcInfo) {
												$capturedScriptBlock = $funcInfo.ScriptBlock
												Write-Verbose "  - Found and capturing ScriptBlock for '$funcName'." -ForegroundColor Magenta
												# Store globally for possible later use (though direct global definition is main now)
												if ($global:DashboardConfig -and $global:DashboardConfig.Resources -and $global:DashboardConfig.Resources.CapturedFunctions) {
													$global:DashboardConfig.Resources.CapturedFunctions[$funcName] = $capturedScriptBlock
												}
												# === Store locally for immediate global definition ===
												$functionsCapturedInThisAttempt[$funcName] = $capturedScriptBlock
											} else {
												Write-Verbose "  - WARNING: Could not find/capture function '$funcName' immediately after IEX for '$moduleName'." -ForegroundColor Yellow
												$captureSuccess = $false
												# Check if the missing function is critical FOR STARTUP
												# --- Adjusted Critical Function Check ---
												$isCriticalModule = $moduleInfo.Priority -eq 'Critical' 
												# Consider a function critical if it's in a Critical module AND in the key function list
												if ($isCriticalModule) { 
													$criticalFunctionMissing = $true
													$importErrorDetails += "; Critical function '$funcName' not found after IEX in Critical module '$moduleName'"
													Write-Verbose "    - Missing function '$funcName' is considered critical for module '$moduleName'." -ForegroundColor Red
												} else {
													 $importErrorDetails += "; Non-critical function '$funcName' not found after IEX for module '$moduleName'"
												}
												# --- End Adjusted Critical Function Check ---
											}
										}
									}

									# Decide overall success for Try 3
									# Success means IEX didn't have non-terminating errors ($?),
									# capture succeeded, AND no *critical* functions were missing.
									if ($iexCompletedWithoutTerminatingError -and $captureSuccess -and (-not $criticalFunctionMissing)) {
										Write-Verbose "  - Attempt 3: IEX completed and key functions captured/verified for '$moduleName'." -ForegroundColor DarkGreen

										# === Define captured functions globally RIGHT AWAY ===
										Write-Verbose "  - Defining captured functions globally for '$moduleName'..." -ForegroundColor Magenta
										$definitionSuccess = $true # Track success of this small step
										foreach ($kvp in $functionsCapturedInThisAttempt.GetEnumerator()) {
											$funcNameToDefine = $kvp.Key
											$scriptBlockToDefine = $kvp.Value
											try {
												# Define in global function space
												Set-Item -Path "Function:\global:$funcNameToDefine" -Value $scriptBlockToDefine -Force -ErrorAction Stop
												Write-Verbose "    - Defined Function:\global:$funcNameToDefine" -ForegroundColor DarkMagenta
											} catch {
												Write-Verbose "    - FAILED to define Function:\global:$funcNameToDefine globally: $($_.Exception.Message)" -ForegroundColor Red
												$definitionSuccess = $false
												$importErrorDetails += "; Failed to define captured function '$funcNameToDefine' globally."
												# If defining a critical function fails, mark critical failure for the whole import process
												# --- Adjusted Critical Function Check ---
												if ($moduleInfo.Priority -eq 'Critical') {
													$result.CriticalFailure = $true
													Write-Verbose "    - Defining critical function '$funcNameToDefine' failed. Marking import as critical failure." -ForegroundColor Red
												}
												 # --- End Adjusted Critical Function Check ---
												break # Stop trying to define others for this module if one fails
											}
										}

										# Only mark the whole import successful if definitions also worked
										if ($definitionSuccess) {
											$importSuccess = $true
											Write-Verbose "- [OK] Attempt 3: SUCCESS (Invoke-Expression completed, key functions captured AND globally defined for $moduleName)." -ForegroundColor Green
										} else {
											$importSuccess = $false # Failed during definition
											Write-Verbose "- Attempt 3: FAILED during global definition phase for $moduleName." -ForegroundColor Red
										}

									} else { # IEX failed, capture failed, or critical function missing
										Write-Verbose "- Attempt 3: FAILED (IEX completed=$iexCompletedWithoutTerminatingError, CaptureSuccess=$captureSuccess, CriticalMissing=$criticalFunctionMissing) for $moduleName." -ForegroundColor Red
										if (-not $iexCompletedWithoutTerminatingError) { $importErrorDetails += "; IEX failed with non-terminating error detected by `$?."}
										if ($criticalFunctionMissing) { $importErrorDetails += "; Critical function missing prevented Attempt 3 success." }
										if (-not $captureSuccess) { $importErrorDetails += "; Function capture failed during Attempt 3." }
										$importSuccess = $false # Make sure import is marked as failed
									}
								}
								catch # Catch MAJOR errors from Invoke-Expression itself
								{
									Write-Verbose "- Attempt 3: FAILED (Invoke-Expression Error): $($_.Exception.Message)" -ForegroundColor Red
									$importErrorDetails = "Invoke-Expression Error: $($_.Exception.Message)"
									$importSuccess = $false # Make sure success is false if IEX throws major error
								}
							} # End Try 3

							# --- Final Check for PSM1 Import Success --- 
							if ($importSuccess)
							{
								Write-Verbose "- [OK] Successfully imported PSM1 module: '$moduleName'." -ForegroundColor Green
								# Module already added to $global:DashboardConfig.LoadedModules after Write-Module step.
							}
							else
							{
								$errorMessage = "All import methods FAILED for PSM1 module: '$moduleName'. Last error detail: $importErrorDetails"
								Write-Verbose "- $errorMessage" -ForegroundColor Red
								$failedModules[$moduleName] = $errorMessage
								# Critical: Remove from LoadedModules list if import failed after writing okay, as it's not really usable.
								if ($global:DashboardConfig -and $global:DashboardConfig.LoadedModules -and $global:DashboardConfig.LoadedModules.ContainsKey($moduleName))
								{
									Write-Verbose "- Removing '$moduleName' from LoadedModules list due to import failure." -ForegroundColor Yellow
									$global:DashboardConfig.LoadedModules.Remove($moduleName)
								}
								# Check if this failure is critical.
								if ($moduleInfo.Priority -eq 'Critical')
								{
									Write-Verbose "- CRITICAL FAILURE: Failed to import critical PSM1 module '$moduleName'." -ForegroundColor Red
									$result.CriticalFailure = $true
								}
							}
						}
					#endregion SubStep: Import PowerShell Modules (.psm1)
				} # End foreach ($entry in $sortedModules)
			#endregion Step: Process Each Module in Sorted Order
				
			#region Step: Final Status Check and Result Construction
				Write-Verbose "Module import check..." -ForegroundColor Cyan
					
				# Check for Critical Failures gathered during the loop.
				if ($result.CriticalFailure)
				{
					Write-Verbose "  CRITICAL FAILURE: One or more critical modules failed to load or write. Application cannot continue." -ForegroundColor Red
					# Find which critical modules exactly failed.
					$criticalModules = $global:DashboardConfig.Modules.GetEnumerator() | Where-Object { $_.Value.Priority -eq 'Critical' }
					$failedCritical = $criticalModules | Where-Object { $failedModules.ContainsKey($_.Key) }
					if ($failedCritical)
					{
						Write-Verbose "  Failed critical modules: $($failedCritical.Key -join ', ')" -ForegroundColor Red
						$failedCritical | ForEach-Object { Write-Verbose "  - $($_.Key): $($failedModules[$_.Key])" -ForegroundColor Red } 
					}
					$result.Status = $false # Make sure status is false.
					# Return the result object showing critical failure.
					return $result
				}
					
				# Report Important Module Failures (as Warnings).
				$importantModules = $global:DashboardConfig.Modules.GetEnumerator() | Where-Object { $_.Value.Priority -eq 'Important' }
				$failedImportant = $importantModules | Where-Object { $failedModules.ContainsKey($_.Key) }
				if ($failedImportant.Count -gt 0)
				{
					Write-Verbose "  IMPORTANT module failures detected: $($failedImportant.Key -join ', '). Application may have limited functionality." -ForegroundColor Yellow
					# Log details of failures for important modules.
					$failedImportant | ForEach-Object { Write-Verbose "  - $($_.Key): $($failedModules[$_.Key])" -ForegroundColor Yellow } 
				}
					
				# Report Optional Module Failures (as Info/DarkYellow).
				$optionalModules = $global:DashboardConfig.Modules.GetEnumerator() | Where-Object { $_.Value.Priority -eq 'Optional' }
				$failedOptional = $optionalModules | Where-Object { $failedModules.ContainsKey($_.Key) }
				if ($failedOptional.Count -gt 0)
				{
					Write-Verbose "  Optional module failures detected: $($failedOptional.Key -join ', '). Non-essential features might be unavailable." -ForegroundColor DarkYellow
					# Log details.
					$failedOptional | ForEach-Object { Write-Verbose "  - $($_.Key): $($failedModules[$_.Key])" -ForegroundColor DarkGray }
				}
					
				# If no critical failures happened, the whole process is seen as successful for startup.
				$successCount = 0
				if ($global:DashboardConfig -and $global:DashboardConfig.LoadedModules) {
					$successCount = $global:DashboardConfig.LoadedModules.Count
				}
				$failCount = $failedModules.Count
				Write-Verbose "  Module loading phase complete. Modules written/verified: $successCount. Failures (any type): $failCount." -ForegroundColor DarkGray
				if ($successCount -gt 0)
				{
					Write-Verbose "  Successfully written/verified modules: $($global:DashboardConfig.LoadedModules.Keys -join ', ')" -ForegroundColor DarkGray
				}
				if ($failCount -gt 0)
				{
					Write-Verbose "  Failed modules logged above." -ForegroundColor Yellow
				}
					
				# Set final status to true as no critical failures happened.
				$result.Status = $true
				$result.CriticalFailure = $false # Explicitly set false.
				# Return the final result object.
				return $result
			#endregion Step: Final Status Check and Result Construction
		}
		catch
		{
			# Catch surprise, unhandled errors within the main Import-DashboardModules function body.
			$errorMessage = "  FATAL UNHANDLED EXCEPTION in Import-DashboardModules: $($_.Exception.Message)"
			Write-Verbose $errorMessage -ForegroundColor Red
			Write-Verbose "  Stack trace: $($_.ScriptStackTrace)" -ForegroundColor Red
			# Fill and return the result object showing critical failure due to the error.
			$result.Status = $false
			$result.CriticalFailure = $true
			$result.Exception = $_.Exception.Message # Store error message.
			$failedModules['Unhandled Exception'] = $errorMessage # Add to failed modules list.
			return $result
		}
	}
#endregion Function: Import-DashboardModules

#endregion Module Handling Functions

#region UI and Application Lifecycle Functions

#region Function: Start-Dashboard
	function Start-Dashboard
	{
		<#
			.SYNOPSIS
				Initializes and displays the main dashboard user interface (UI) form.
			
			.DESCRIPTION
				This function orchestrates the startup of the application's graphical user interface. It performs these actions:
				1. Checks if the 'Initialize-UI' function, expected to be loaded from the 'ui.psm1' module, exists using `Get-Command`. If not found, it throws a terminating error as the UI cannot be built.
				2. Calls the `Initialize-UI` function. It assumes this function is responsible for creating all UI elements (forms, controls) and populating the '$global:DashboardConfig.UI' hashtable, including setting '$global:DashboardConfig.UI.MainForm'.
				3. Checks the return value of `Initialize-UI`. If it returns $false or null (interpreted as failure), it throws a terminating error.
				4. Verifies that '$global:DashboardConfig.UI.MainForm' exists and is a valid '[System.Windows.Forms.Form]' object after `Initialize-UI` returns successfully. If not, it throws a terminating error.
				5. If the MainForm is valid, it calls the `.Show()` method to make the main window visible and `.Activate()` to bring it to the foreground.
				6. Sets the global state flag '$global:DashboardConfig.State.UIInitialized' to $true.
			
			.OUTPUTS
				[bool] Returns $true if the UI is successfully initialized, the main form is found, shown, and activated.
				Returns $false if any step fails (missing function, initialization failure, missing main form), typically after throwing an error that gets caught by the main execution block.
			
			.NOTES
				- This function has a strong dependency on the 'ui.psm1' module being loaded correctly and functioning as expected (defining `Initialize-UI` and creating `MainForm`).
				- Errors encountered during this process are considered fatal for the application and are thrown to be caught by the main script's try/catch block, which should then display an error using `Show-ErrorDialog`.
		#>
		[CmdletBinding()]
		[OutputType([bool])]
		param()

		Write-Verbose "Starting Dashboard User Interface..." -ForegroundColor Cyan
		try
		{
			#region Step: Check for and Call Initialize-UI Function
				Write-Verbose "- Checking for required Initialize-UI function (from ui.psm1)..." -ForegroundColor DarkGray
				# Check that the Initialize-UI command (function) is available now.
				if (-not (Get-Command Initialize-UI -ErrorAction SilentlyContinue))
				{
					# Throw a major error if the function is missing.
					throw "FATAL: Initialize-UI function not found. Ensure 'ui.psm1' module loaded correctly and defines this function."
				}

				Write-Verbose "- Calling Initialize-UI function..." -ForegroundColor DarkGray
				# Run the UI setup function. Save its return value.
				Initialize-UI # Call directly now

				Write-Verbose "- [OK] Initialize-UI function executed successfully." -ForegroundColor Green
			#endregion Step: Check for and Call Initialize-UI Function

			#region Step: Verify, Show, and Activate Main Form
				Write-Verbose "- Verifying presence and type of UI.MainForm object..." -ForegroundColor DarkGray
				# Check if MainForm property exists in UI config and is a valid Form object.
				if ($null -eq $global:DashboardConfig.UI.MainForm -or -not ($global:DashboardConfig.UI.MainForm -is [System.Windows.Forms.Form]))
				{
					# Throw a major error if main form is missing or invalid after successful Initialize-UI call.
					throw 'FATAL: UI.MainForm object not found or is not a valid System.Windows.Forms.Form in $global:DashboardConfig after successful Initialize-UI call.'
				}

				Write-Verbose "- [OK] UI.MainForm found and is valid. Showing and activating window..." -ForegroundColor Green
				# Make the main app window visible.
				$global:DashboardConfig.UI.MainForm.Show() 
				
				# Update the global state flag to show the UI is now set up and running.
				$global:DashboardConfig.State.UIInitialized = $true
				Write-Verbose "  Dashboard UI started successfully." -ForegroundColor Green
			#endregion Step: Verify, Show, and Activate Main Form

			# Return true showing successful UI startup.
			return $true
		}
		catch
		{
			$errorMsg = "  FATAL: Failed to start dashboard UI. Error: $($_.Exception.Message)"
			Write-Verbose $errorMsg -ForegroundColor Red
			# Throw the error again to send it up to the main run block's catch.
			throw $_ # Use throw $_ to keep original error details.
		}
	}
#endregion Function: Start-Dashboard
	
#region Function: Start-MessageLoop
	function Start-MessageLoop
	{
		<#
			.SYNOPSIS
				Runs the Windows Forms message loop to keep the UI responsive until the main form is closed.
			
			.DESCRIPTION
				This function implements the core message processing loop required for a Windows Forms application. It keeps the UI alive and responsive to user interactions, window events, and timer ticks.
				
				The function first performs pre-checks:
				1. Verifies that the UI has been initialized (`$global:DashboardConfig.State.UIInitialized`).
				2. Verifies that the main form object (`$global:DashboardConfig.UI.MainForm`) exists, is a valid Form, and is not already disposed.
				
				If checks pass, it determines the loop method:
				- Preferred Native Loop: If the 'Native' class (expected from 'classes.psm1') and its required P/Invoke methods (`AsyncExecution`, `PeekMessage`, `TranslateMessage`, `DispatchMessage`) are detected, it uses an efficient loop based on `MsgWaitForMultipleObjectsEx` (wrapped in `AsyncExecution`). This waits for messages or a timeout, processing messages only when they arrive, thus minimizing CPU usage when idle.
				- Fallback DoEvents Loop: If the Native methods are unavailable, it falls back to a loop using `[System.Windows.Forms.Application]::DoEvents()`. This processes all pending messages but does not wait efficiently, potentially consuming more CPU. A short `Start-Sleep` (e.g., 20ms) is added within this loop to prevent 100% CPU usage.
				
				The chosen loop runs continuously as long as the main form (`$global:DashboardConfig.UI.MainForm`) is visible and not disposed.
			
			.OUTPUTS
				[void] This function runs synchronously and blocks execution until the main UI form is closed or disposed. It does not return a value.
			
			.NOTES
				- Requires the main UI form (`$global:DashboardConfig.UI.MainForm`) to be successfully initialized and shown by `Start-Dashboard` before being called.
				- The efficiency of the UI heavily depends on the availability and correctness of the 'Native' class methods from 'classes.psm1'. The `DoEvents` fallback is less performant.
				- Includes basic error handling within the loop itself and a final `DoEvents` fallback attempt if the primary loop method encounters an unhandled exception.
				- Logs the chosen loop method and status messages during execution and upon exit.
		#>
		[CmdletBinding()]
		[OutputType([void])]
		param()
			
		Write-Verbose "`Starting UI message loop..." -ForegroundColor Cyan
			
		#region Step: Pre-Loop Checks for UI State and Main Form Validity
			Write-Verbose "  Checking UI state before starting message loop..." -ForegroundColor DarkGray
			# Check if UI setup flag is set.
			if (-not $global:DashboardConfig.State.UIInitialized)
			{
				Write-Verbose "  UI not marked as initialized ($global:DashboardConfig.State.UIInitialized is $false). Skipping message loop." -ForegroundColor Yellow
				return # Exit function if UI isn't ready.
			}
			# Check if MainForm object exists and is a valid, non-disposed Form.
			$mainForm = $global:DashboardConfig.UI.MainForm # Local variable to make things easier.
			if ($null -eq $mainForm -or -not ($mainForm -is [System.Windows.Forms.Form]))
			{
				Write-Verbose "  MainForm object ($global:DashboardConfig.UI.MainForm) is missing or not a valid Form object. Cannot start message loop." -ForegroundColor Yellow
				return # Exit function if MainForm is invalid.
			}
			if ($mainForm.IsDisposed)
			{
				Write-Verbose "  MainForm ($global:DashboardConfig.UI.MainForm) is already disposed. Cannot start message loop." -ForegroundColor Yellow
				return # Exit function if MainForm is already disposed (cleaned up).
			}
			Write-Verbose "  Pre-loop checks passed. MainForm is valid and UI is initialized." -ForegroundColor Green
		#endregion Step: Pre-Loop Checks for UI State and Main Form Validity
			
		# $loopMethod - Text showing which loop type is used ('Native' or 'DoEvents').
		[string]$loopMethod = 'Unknown'
		try
		{
			#region Step: Determine Loop Method (Efficient Native P/Invoke vs. Fallback DoEvents)
				# $useNativeLoop - Flag ($true/$false), $true if Native methods seem available.
				[bool]$useNativeLoop = $false
				Write-Verbose "Detecting availability of Native methods for efficient loop..." -ForegroundColor Cyan
				try
				{
					# Check if the 'Native' type exists and has the key methods we need.
					# Use GetType() which errors if type not found, unlike PSTypeName.
					$nativeType = [type]'Custom.Native' # Errors if 'Native' class not loaded.
					if (($nativeType.GetMethod('AsyncExecution')) -and
						($nativeType.GetMethod('PeekMessage')) -and
						($nativeType.GetMethod('TranslateMessage')) -and
						($nativeType.GetMethod('DispatchMessage')))
					{
						Write-Verbose "- [OK] Native P/Invoke methods found (requires 'classes.psm1'). Using efficient message loop." -ForegroundColor Green
						$useNativeLoop = $true
						$loopMethod = 'Custom.Native'
					}
					else
					{
						Write-Verbose "- Native class found, but required methods (AsyncExecution, PeekMessage, etc.) are missing. Falling back to DoEvents loop." -ForegroundColor Yellow
						$loopMethod = 'DoEvents'
					}
				}
				catch [System.Management.Automation.RuntimeException]
				{
					# Catch specific error for type not found.
					Write-Verbose "- Native class not found. Falling back to less efficient Application.DoEvents() loop." -ForegroundColor Red
					$loopMethod = 'DoEvents'
				}
				catch
				{
					Write-Verbose "- Error checking for Native methods: $($_.Exception.Message). Falling back to DoEvents loop." -ForegroundColor Red
					$loopMethod = 'DoEvents'
				}
					
				# Make sure WinForms part is loaded if using DoEvents backup.
				if (-not $useNativeLoop)
				{
					Add-Type -AssemblyName System.Windows.Forms -ErrorAction SilentlyContinue # Load if not already loaded.
				}
			#endregion Step: Determine Loop Method (Efficient Native P/Invoke vs. Fallback DoEvents)
				
			#region Step: Run the Chosen Message Loop
				Write-Verbose "Entering message loop (Method: $loopMethod). Loop runs until main form is closed..." -ForegroundColor Cyan
				# Loop keeps going as long as MainForm is valid, visible, and not disposed.
				# Re-check $mainForm validity inside the loop to be safe.
				while ($mainForm -and $mainForm.Visible -and -not $mainForm.IsDisposed)
				{
					if ($useNativeLoop)
					{
						# --- Efficient Native P/Invoke Loop ---
						try
						{
							# Wait efficiently for window messages (QS_ALLINPUT) or a timeout (like 50ms).
							# $result - Return value from AsyncExecution (based on MsgWaitForMultipleObjectsEx).
							# WAIT_OBJECT_0 (0) means a message arrived. WAIT_TIMEOUT (0x102) means timeout.
							$result = [Custom.Native]::AsyncExecution(0, [IntPtr[]]@(), $false, 50, [Custom.Native]::QS_ALLINPUT) # Timeout 50ms
								
							# If a message arrived (result is not WAIT_TIMEOUT).
							if ($result -ne 0x102) # Compare with decimal value of WAIT_TIMEOUT.
							{
								# Handle all waiting messages currently in the queue.
								# $msg - Structure to hold message details (Custom.Native+MSG).
								$msg = New-Object Custom.Native+MSG
								# PeekMessage with PM_REMOVE gets and removes message. Loop while messages exist.
								while ([Custom.Native]::PeekMessage([ref]$msg, [IntPtr]::Zero, 0, 0, [Custom.Native]::PM_REMOVE))
								{
									# Turn virtual-key messages into character messages.
									$null = [Custom.Native]::TranslateMessage([ref]$msg)
									# Send the message to the right window handler.
									$null = [Custom.Native]::DispatchMessage([ref]$msg)
								}
							}
							# If it was a timeout ($result -eq 0x102), the loop just continues and waits again. Nothing needed.
						}
						catch
						{
							# Catch errors *inside* the native loop run (e.g., P/Invoke call failed).
							Write-Verbose "  Error during Native message loop iteration: $($_.Exception.Message). Attempting to fall back to DoEvents..." -ForegroundColor Red
							$useNativeLoop = $false # Switch to DoEvents for the next loops.
							$loopMethod = 'DoEvents'
							Add-Type -AssemblyName System.Windows.Forms -ErrorAction SilentlyContinue # Make sure assembly loaded for backup.
							Start-Sleep -Milliseconds 50 # Add a small pause before maybe starting DoEvents loop next time.
						}
					}
					else # Use Backup DoEvents Loop
					{
						# --- Backup Application.DoEvents() Loop ---
						try
						{
							# Handle all messages currently in the queue. Less efficient as it does everything even if idle.
							[System.Windows.Forms.Application]::DoEvents()
							# Add a small pause to stop this backup loop from using 100% CPU if no messages.
							Start-Sleep -Milliseconds 20 # 20ms pause balances responsiveness and CPU use.
						}
						catch
						{
							# Catch errors during DoEvents() or Start-Sleep.
							Write-Verbose "  Error during DoEvents fallback loop iteration: $($_.Exception.Message). Loop may become unresponsive." -ForegroundColor Red
							# Maybe add longer pause or break if errors keep happening? For now, just log and continue loop.
							Start-Sleep -Milliseconds 100
						}
					}
				} # End while ($mainForm.Visible -and -not $mainForm.IsDisposed)
			#endregion Step: Run the Chosen Message Loop
		}
		catch
		{
			# Catch surprise errors setting up or during the main loop logic (outside the inner try/catch).
			Write-Verbose "  FATAL Error occurred within the UI message loop setup or main structure: $($_.Exception.Message)" -ForegroundColor Red
			# Try a very basic DoEvents loop as a last resort if the main loop structure failed.
			Write-Verbose "  Attempting basic DoEvents fallback loop after critical error..." -ForegroundColor Cyan
			try
			{
				if ($mainForm -and -not $mainForm.IsDisposed)
				{
					Add-Type -AssemblyName System.Windows.Forms -ErrorAction SilentlyContinue 
				}
					
				while ($mainForm -and $mainForm.Visible -and -not $mainForm.IsDisposed)
				{
					[System.Windows.Forms.Application]::DoEvents()
					Start-Sleep -Milliseconds 50 # Slightly longer pause in emergency backup.
				}
			}
			catch
			{
				Write-Verbose "  Emergency fallback DoEvents loop also failed: $($_.Exception.Message)" -ForegroundColor Red
				[System.Windows.Forms.Application]::Run($mainForm)
			}
		}
		finally
		{
			# This block runs when the message loop stops, either normally (window closed) or due to an error caught above.
			# Log the final state of the main form. Use $? to check if $mainForm variable exists before using its properties.
			if ($mainForm -and ($mainForm -is [System.Windows.Forms.Form]))
			{
				Write-Verbose "UI message loop exited (Method: $loopMethod). Final Form State -> Visible: $($mainForm.Visible), Disposed: $($mainForm.IsDisposed)" -ForegroundColor Cyan
			}
			else
			{
				Write-Verbose "UI message loop exited (Method: $loopMethod). MainForm object appears invalid or null upon exit." -ForegroundColor Yellow
			}
			# Mark UI as not initialized anymore *after* the loop finishes.
			$global:DashboardConfig.State.UIInitialized = $false
		}
	}
#endregion Function: Start-MessageLoop
	
#region Function: Stop-Dashboard
	function Stop-Dashboard
	{
		<#
			.SYNOPSIS
				Performs comprehensive cleanup of application resources during shutdown.
			
			.DESCRIPTION
				This function is responsible for gracefully stopping and releasing all resources allocated by the application
				and its modules. It's designed to be called within the main script's `finally` block to ensure cleanup
				happens reliably, even if errors occurred during execution.
				
				Cleanup is performed in a specific order to minimize dependency issues and errors:
				1.  **Ftool Forms:** If the optional 'ftool.psm1' module was loaded and created forms (tracked in `$global:DashboardConfig.Resources.FtoolForms`), it attempts to close and dispose of them. It preferably calls a `Stop-FtoolForm` function (if defined by ftool.psm1) for module-specific cleanup before falling back to basic `.Close()` and `.Dispose()` calls.
				2.  **Timers:** Stops and disposes of all `System.Windows.Forms.Timer` objects registered in `$global:DashboardConfig.Resources.Timers`. Handles nested collections if necessary.
				3.  **Main UI Form:** Disposes of the main application window (`$global:DashboardConfig.UI.MainForm`) if it exists and isn't already disposed.
				4.  **Runspaces & Module Cleanup:**
				*   Disposes of known background runspaces (e.g., `$global:DashboardConfig.Resources.LaunchResources` if used by 'launch.psm1').
				*   Calls specific cleanup functions (e.g., `Stop-ClientLaunch`, `CleanupLogin`, `CleanupFtool`) if they exist (assumed to be defined by the respective modules). These functions are expected to handle module-specific resource release (e.g., closing handles, stopping threads).
				5.  **Application State:** Resets global state flags (`UIInitialized`, `LoginActive`, `LaunchActive`) to $false.
			
			.OUTPUTS
				[bool] Returns $true if all cleanup steps attempted completed without throwing *new* errors during the cleanup process itself.
				Returns $false if any cleanup step encountered an error (logged as a warning). The function attempts to continue subsequent cleanup steps even if one fails.
			
			.NOTES
				- Uses individual `try/catch` blocks around major cleanup sections (Ftool forms, Timers, Main Form, Runspaces/Modules) to ensure robustness. An error in one section should not prevent others from running.
				- Errors encountered *during cleanup* are logged using `Write-Verbose` and cause the function to return $false, but they do not typically halt the entire cleanup process.
				- Relies on modules potentially defining specific cleanup functions (`Cleanup<ModuleName>`) or resources (like `$global:DashboardConfig.Resources.LaunchResources`). These need to be implemented correctly within the modules themselves.
				- The order of operations is important (e.g., dispose child forms before main form, stop timers before disposing forms they might interact with).
			#>
		[CmdletBinding()]
		[OutputType([bool])]
		param()
			
		Write-Verbose "Stopping Dashboard and Cleaning Up Application Resources..." -ForegroundColor Cyan
		# $cleanupOverallSuccess - Flag ($true/$false) to track if *any* cleanup step had an error. Default to true.
		[bool]$cleanupOverallSuccess = $true

		#region Step 0: Clean Up launch recources
		Write-Verbose "Step 0: Cleaning up Launch..." -ForegroundColor Cyan
		if (Get-Command Stop-ClientLaunch -ErrorAction SilentlyContinue)
		{
			Stop-ClientLaunch
		}
		else
		{
			Write-Verbose "  Stop-ClientLaunch function not found. Skipping launch cleanup." -ForegroundColor Yellow
		}
		#endregion Step 0: Clean Up launch recources
			
		#region Step 1: Clean Up Ftool Forms (if Ftool module was loaded/used)
			Write-Verbose "Step 1: Cleaning up Ftool forms..." -ForegroundColor Cyan
			try
			{
				# Check if the FtoolForms list exists and has items. Use .PSObject.Properties to check safely.
				$ftoolForms = $global:DashboardConfig.Resources.FtoolForms
				if ($ftoolForms -and $ftoolForms.Count -gt 0)
				{
					# Check if the special cleanup function from ftool.psm1 exists.
					# $stopFtoolFormCmd - FunctionInfo object or null.
					$stopFtoolFormCmd = Get-Command -Name Stop-FtoolForm -ErrorAction SilentlyContinue
					# Make a copy of the keys to loop over, as we change the list during the loop.
					# $formKeys - List of text (form names).
					[string[]]$formKeys = @($ftoolForms.Keys)
					Write-Verbose "- Found $($formKeys.Count) Ftool form(s) registered. Attempting cleanup..." -ForegroundColor DarkGray
						
					foreach ($key in $formKeys)
					{
						# Get the form object safely.
						# $form - The Ftool form object, maybe null or disposed.
						$form = $ftoolForms[$key]
						# Check if it's a valid, non-disposed Windows Form.
						if ($form -and $form -is [System.Windows.Forms.Form] -and -not $form.IsDisposed)
						{
							$formText = try
							{
								$form.Text 
							}
							catch
							{
								'(Error getting text)' 
							} # Get form text safely.
							Write-Verbose "  - Stopping Ftool form '$formText' (Key: $key)." -ForegroundColor Cyan
							try
							{
								# Use the module's special cleanup function if available.
								if ($stopFtoolFormCmd)
								{
									Write-Verbose "  - Using Stop-FtoolForm function..." -ForegroundColor Cyan
									Stop-FtoolForm -Form $form -ErrorAction Stop # Call specific cleanup.
								}
								else # Basic backup cleanup.
								{
									Write-Verbose "  - Stop-FtoolForm command not found. Performing basic Close() for form '$formText'." -ForegroundColor Yellow
									# Ask the form to close nicely. This triggers FormClosing/FormClosed events.
									$form.Close()
									# Give a tiny moment for events to process, maybe not needed but can help sometimes.
									Start-Sleep -Milliseconds 20
								}
							}
							catch # Catch errors specifically from Stop-FtoolForm or Close().
							{
								Write-Verbose "  - Error during Stop-FtoolForm or Close() for form '$formText': $($_.Exception.Message)" -ForegroundColor Red
								# Mark overall cleanup as possibly failed, but continue to make sure Dispose() is called.
								$cleanupOverallSuccess = $false
							}
							finally # Always try to dispose the form directly, whether Close() worked or not.
							{
								Write-Verbose "  - Ensuring Dispose() is called for form '$formText'." -ForegroundColor Cyan
								try
								{
									if (-not $form.IsDisposed)
									{
										$form.Dispose() 
									}
								}
								catch
								{
									Write-Verbose "  - Error during final Dispose() for form '$formText': $($_.Exception.Message)" -ForegroundColor Red
									$cleanupOverallSuccess = $false
								}
							}
						}
						elseif ($form -and $form -is [System.Windows.Forms.Form] -and $form.IsDisposed)
						{
							Write-Verbose "  - Ftool form with Key '$key' was already disposed." -ForegroundColor DarkGray
						}
						else
						{
							Write-Verbose "  - Ftool form entry with Key '$key' is null or not a valid Form object." -ForegroundColor Yellow
							$cleanupOverallSuccess = $false
						}
							
						# Remove the entry from the tracking list after trying cleanup.
						$ftoolForms.Remove($key) | Out-Null
					} # End foreach form key
					Write-Verbose "- Finished Ftool form cleanup." -ForegroundColor Green
				}
				else
				{
					Write-Verbose "  No active Ftool forms found in configuration to clean up." -ForegroundColor DarkGray 
				}
			}
			catch # Catch errors in the Ftool cleanup part setup (e.g., accessing FtoolForms).
			{
				Write-Verbose "Error during Ftool form cleanup phase setup: $($_.Exception.Message)" -ForegroundColor Red
				$cleanupOverallSuccess = $false
			}
		#endregion Step 1: Clean Up Ftool Forms (if Ftool module was loaded/used)
			
		#region Step 2: Clean Up Application Timers
			Write-Verbose "Step 2: Cleaning up application timers..." -ForegroundColor Cyan
			try
			{
				# Check if the Timers list exists and has items.
				$timersCollection = $global:DashboardConfig.Resources.Timers
				if ($timersCollection -and $timersCollection.Count -gt 0)
				{
					Write-Verbose "- Found $($timersCollection.Count) timer registration(s). Stopping and disposing..." -ForegroundColor Cyan
					# Use a temporary list to gather all unique timer objects, handling possible nesting or duplicates.
					# $uniqueTimers - List of separate timer objects.
					[System.Collections.Generic.List[System.Windows.Forms.Timer]]$uniqueTimers = New-Object System.Collections.Generic.List[System.Windows.Forms.Timer]
						
					# Go through the registered items in the Timers list.
					# Items could be single timers, or nested lists (like hashtables) of timers.
					foreach ($item in $timersCollection.Values)
					{
						if ($item -is [System.Windows.Forms.Timer])
						{
							if (-not $uniqueTimers.Contains($item))
							{
								$uniqueTimers.Add($item) 
							}
						}
						elseif ($item -is [System.Collections.IDictionary])
						{
							# If item is another list, go through its values.
							$item.Values | Where-Object { $_ -is [System.Windows.Forms.Timer] } | ForEach-Object {
								if (-not $uniqueTimers.Contains($_))
								{
									$uniqueTimers.Add($_) 
								}
							}
						}
						# Add checks for other possible list types if used (like ArrayList).
					}
					Write-Verbose "- Found $($uniqueTimers.Count) unique System.Windows.Forms.Timer object(s) to dispose." -ForegroundColor Cyan
						
					# Go through the unique timer objects.
					foreach ($timer in $uniqueTimers)
					{
						try
						{
							# Check if timer object is valid and not already disposed.
							if ($timer -and -not $timer.IsDisposed) # Check IsDisposed before accessing properties like Enabled.
							{
								Write-Verbose "  - Disposing timer (Was Enabled: $($timer.Enabled))." -ForegroundColor Green
								# Stop the timer first if it's running now.
								if ($timer.Enabled)
								{
									$timer.Stop() 
								}
								# Dispose of the timer object to free up resources.
								$timer.Dispose()
							}
							else
							{
								Write-Verbose "  - Skipping already disposed or invalid timer object." -ForegroundColor DarkGray
							}
						}
						catch # Catch errors during individual timer Stop() or Dispose().
						{
							Write-Verbose "  - Error stopping or disposing a timer: $($_.Exception.Message)" -ForegroundColor Red
							$cleanupOverallSuccess = $false # Mark overall cleanup as possibly incomplete.
						}
					} # End foreach timer
						
					# Clear the main timer list in the global config after trying disposal.
					Write-Verbose "- Clearing global timer registration collection." -ForegroundColor Cyan
					$timersCollection.Clear()
					Write-Verbose "- Finished timer cleanup." -ForegroundColor Green
				}
				else
				{
					Write-Verbose "- No active timers found in configuration to clean up." -ForegroundColor DarkGray 
				}
			}
			catch # Catch errors in the timer cleanup part setup.
			{
				Write-Verbose "Error during timer cleanup phase setup: $($_.Exception.Message)" -ForegroundColor Red
				$cleanupOverallSuccess = $false
			}
		#endregion Step 2: Clean Up Application Timers
			
		#region Step 3: Clean Up Main UI Form
			Write-Verbose "Step 3: Cleaning up main UI form..." -ForegroundColor Cyan
			try
			{
				# Check if the main form object exists, is a Form, and is not already disposed.
				$mainForm = $global:DashboardConfig.UI.PSObject.Properties['MainForm']
				if ($mainForm -and $mainForm.Value -is [System.Windows.Forms.Form] -and -not $mainForm.Value.IsDisposed)
				{
					Write-Verbose "- Disposing MainForm object..." -ForegroundColor DarkGray
					# Dispose of the main form object. Should trigger its FormClosed event if not already closed.
					$mainForm.Value.Dispose()
					Write-Verbose "- [OK] MainForm disposed." -ForegroundColor Green
				}
				elseif ($mainForm -and $mainForm.Value -is [System.Windows.Forms.Form] -and $mainForm.Value.IsDisposed)
				{
					Write-Verbose "- MainForm was already disposed." -ForegroundColor Yellow
				}
				else
				{
					Write-Verbose "- MainForm object not found or invalid in configuration." -ForegroundColor Yellow
				}
			}
			catch # Catch errors during main form disposal.
			{
				Write-Verbose "Error disposing main UI form: $($_.Exception.Message)" -ForegroundColor Red
				$cleanupOverallSuccess = $false
			}
		#endregion Step 3: Clean Up Main UI Form
			
		#region Step 4: Reset Application State Flags
			Write-Verbose "Step 5: Resetting application state flags..." -ForegroundColor Cyan
			try
			{
				# Reset flags to show the app is no longer active/set up.
				$global:DashboardConfig.State.UIInitialized = $null
				$global:DashboardConfig.State.LoginActive = $null
				$global:DashboardConfig.State.LaunchActive = $null
				$global:DashboardConfig.State.ConfigInitialized = $null
				$global:DashboardConfig.LoadedModules = $null
				Write-Verbose "- State flags reset." -ForegroundColor Green
			}
			catch # Catch errors during state flag resetting.
			{
				Write-Verbose "  Error resetting global state flags: $($_.Exception.Message)" -ForegroundColor Red
				# Continue cleanup even with this small issue.
				$cleanupOverallSuccess = $false
			}
		#endregion Step 4: Reset Application State Flags
				
		#region Step 5: Final Log Message for Cleanup Status
			# Set log color based on overall cleanup success flag.
			# $finalColor - Text, 'Green' for success, 'Yellow' for partial success/warnings.
			[string]$finalColor = if ($cleanupOverallSuccess)
			{
				'Green' 
			}
			else
			{
				'Yellow' 
			}
			Write-Verbose "--- Dashboard Cleanup Finished. Overall Success: $cleanupOverallSuccess ---" -ForegroundColor $finalColor
		#endregion Step 5: Final Log Message
			
		# Return the overall success status of the cleanup actions.
		return $cleanupOverallSuccess
	}
#endregion Function: Stop-Dashboard

#endregion UI and Application Lifecycle Functions

#region Main Execution Block

# This is the main start point and control flow of the script.
Write-Verbose "=========================================" -ForegroundColor Cyan
Write-Verbose "=== Initializing Entropia Dashboard ===" -ForegroundColor Cyan
Write-Verbose "=== Timestamp: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss') ===" -ForegroundColor Cyan
Write-Verbose "=========================================" -ForegroundColor Cyan
	
# Main try/catch/finally block to manage the app life cycle and ensure cleanup.
try
{
	#region Step 1: Ensure Correct Execution Environment (Admin, 32-bit, Bypass Policy)
		Write-Verbose "--- Step 1: Ensuring Correct Execution Environment ---" -ForegroundColor Cyan
		# Request-Elevation checks and might restart the script. If it restarts, this one exits here.
		Request-Elevation
		# If script continues, Request-Elevation decided no restart needed OR restart failed (error shown, exited).
		# Initialize-ScriptEnvironment does final checks *after* possible restart.
		if (-not (Initialize-ScriptEnvironment))
		{
			# If checks fail even after possible restart try, throw a major error. Show-ErrorDialog was probably called inside.
			throw 'Environment verification failed (Admin/32-bit/Bypass). Cannot continue.'
		}
		Write-Verbose "[OK] Environment verified successfully." -ForegroundColor Green
	#endregion Step 1: Ensure Correct Execution Environment (Admin, 32-bit, Bypass Policy)
		
	#region Step 2: Initialize Base Configuration (AppData Paths)
		Write-Verbose "--- Step 2: Initializing Base Configuration (AppData Paths) ---" -ForegroundColor Cyan
		if (-not (Initialize-BaseConfig))
		{
			# If essential paths can't be made/checked writable, throw major error. Show-ErrorDialog probably called inside.
			throw 'Failed to initialize base application paths in %APPDATA%. Cannot continue.'
		}
		Write-Verbose "[OK] Base configuration paths initialized successfully." -ForegroundColor Green
	#endregion Step 2: Initialize Base Configuration (AppData Paths)
		
	#region Step 2.5: Auto-update Check (Compare local header version with remote)
		Write-Verbose "--- Step 2.5: Checking for script updates ---" -ForegroundColor Cyan
		try {
			# Determine the path to the currently executing script or EXE.
		$executablePath = $null
		if (-not [string]::IsNullOrEmpty($PSCommandPath)) {
			$executablePath = $PSCommandPath
		} elseif (-not [string]::IsNullOrEmpty($MyInvocation.MyCommand.Path)) {
			$executablePath = $MyInvocation.MyCommand.Path
		} else {
			# Fallback for compiled EXEs where other variables might be empty
			try {
				$executablePath = (Get-Process -Id $PID -ErrorAction Stop).Path
			} catch {
				# This could fail in some very restricted environments.
			}
		}

		# If we couldn't find a path, we can't check the version. This happens when code is run from memory (e.g., ISE selection).
		if ([string]::IsNullOrEmpty($executablePath)) {
			Write-Verbose "  Could not determine script/EXE path. Update check will be skipped." -ForegroundColor Yellow
		} else {
			Write-Verbose "  Checking version of: $executablePath" -ForegroundColor DarkGray
			# Read local content and extract Version from the .NOTES header
			$localVersion = '0.0'
			$localContent = Get-Content -Path $executablePath -Raw -ErrorAction SilentlyContinue
			if ($localContent) {
				$lm = [regex]::Match($localContent, '(?m)^\s*Version:\s*([0-9]+(?:\.[0-9]+)*)')
				if ($lm.Success) { $localVersion = $lm.Groups[1].Value }
			}
			# Fetch remote script raw content from GitHub to compare version
			$remoteUrl = 'https://raw.githubusercontent.com/Immortal-Divine/Entropia_Dashboard/refs/heads/main/version'
			$remoteContent = $null
			try {
				$remoteContent = (Invoke-WebRequest -Uri $remoteUrl -UseBasicParsing -ErrorAction Stop).Content
			} catch {
				Write-Verbose "  Update check failed to fetch remote script: $($_.Exception.Message)" -ForegroundColor Yellow
			}
			if ($remoteContent) {
				$rm = [regex]::Match($remoteContent, '(?m)^\s*Version:\s*([0-9]+(?:\.[0-9]+)*)')
				if ($rm.Success) {
					$remoteVersion = $rm.Groups[1].Value
					try {
						if ([version]$localVersion -lt [version]$remoteVersion) {
							Write-Verbose "  Update available: local $localVersion < remote $remoteVersion" -ForegroundColor Yellow
							# Prompt user: Yes = Download (open GitHub), No = Continue without updating
							$promptMsg = "A newer version ($remoteVersion) of Entropia Dashboard is available.`nYou have $localVersion.`n`nPress 'Yes' to open the project page and download the update, or 'No' to continue without updating."
							$caption = "Entropia Dashboard - Update Available"
							$resp = [System.Windows.Forms.MessageBox]::Show($promptMsg, $caption, [System.Windows.Forms.MessageBoxButtons]::YesNo, [System.Windows.Forms.MessageBoxIcon]::Information)
							if ($resp -eq [System.Windows.Forms.DialogResult]::Yes) {
								Start-Process 'https://github.com/Immortal-Divine/Entropia_Dashboard'
								Write-Verbose "  User chose to download update. Exiting to final cleanup." -ForegroundColor Cyan
								# Return from the main try block so the finally block (Step 7) runs and script stops before importing modules.
								return
							} else {
								Write-Verbose "  User chose to continue without updating." -ForegroundColor Cyan
							}
						} else {
							Write-Verbose "  Local script version ($localVersion) is up-to-date (remote $remoteVersion)." -ForegroundColor Green
						}
					} catch {
						Write-Verbose "  Version compare failed: $($_.Exception.Message)" -ForegroundColor Yellow
					}
				} else {
					Write-Verbose "  Remote script did not contain a version header." -ForegroundColor Yellow
				}
			}
		}
		} catch {
			Write-Verbose "  Unexpected error during update check: $($_.Exception.Message)" -ForegroundColor Yellow
		}
	#endregion Step 2.5: Auto-update Check (Compare local header version with remote)
		
	#region Step 3: Load Dashboard Modules (Write to AppData & Import)
		Write-Verbose "--- Step 3: Loading Dashboard Modules ---" -ForegroundColor Cyan
		# $importResult - PSCustomObject holding Status, LoadedModules, FailedModules, CriticalFailure.
		$importResult = Import-DashboardModules
		# $global:DashboardConfig.LoadedModules is updated directly inside Import-DashboardModules.
			
		# Check if the import process reported overall failure (specifically critical failure).
		if (-not $importResult.Status) # Status is false if CriticalFailure is true or an unhandled error happened.
		{
			# If critical modules failed, throw major error. Error details logged inside Import-DashboardModules.
			throw 'Critical module loading failed. Cannot continue.'
		}
		# Non-critical failures were logged as warnings/info inside Import-DashboardModules.
		Write-Verbose "[OK] Core modules loaded successfully (Non-critical failures may exist, see logs)." -ForegroundColor Green
	#endregion Step 3: Load Dashboard Modules (Write to AppData & Import)
		
	#region Step 4: Load INI Configuration File
		Write-Verbose "--- Step 4: Loading INI Configuration ---" -ForegroundColor Cyan
		# Check if the Initialize-IniConfig function (expected from ini.psm1) is available.
		if (Get-Command Initialize-IniConfig -ErrorAction SilentlyContinue) # Just use Get-Command
		{
			Write-Verbose "Calling Initialize-IniConfig..." -ForegroundColor Cyan
			try
			{
				# Run the INI loading function. Assuming it returns true/false or handles errors itself.
				[bool]$iniLoadSuccess = Initialize-IniConfig -ErrorAction Stop # Call directly
				if (-not $iniLoadSuccess)
				{
					# Log a warning if INI loading fails (as function reported), but continue with defaults.
					Write-Verbose "  Initialize-IniConfig reported failure. Default configuration values may be used." -ForegroundColor Yellow
				}
				else
				{
					Write-Verbose "[OK] INI configuration loaded successfully." -ForegroundColor Green 
				}
			}
			catch
			{
				Write-Verbose "  Error occurred during Initialize-IniConfig execution: $($_.Exception.Message). Default configuration values may be used." -ForegroundColor Yellow
			}
		}
		else
		{
			# Log a warning if the function is missing
			Write-Verbose "  Initialize-IniConfig function not found. Skipping INI load, defaults will be used." -ForegroundColor Yellow
		}
	#endregion Step 4: Load INI Configuration File
		
	#region Step 5: Start Dashboard User Interface
		Write-Verbose "--- Step 5: Starting Dashboard UI ---" -ForegroundColor Cyan
		# Start-Dashboard sets up and shows the main window. It errors out on failure.
		if (-not (Start-Dashboard)) # This check is a bit extra as Start-Dashboard errors on failure, but safe.
		{
			# Error should have been thrown by Start-Dashboard and caught by outer catch block.
			# This throw might not be reached but makes sure script stops if Start-Dashboard somehow returned false without erroring.
			throw 'Start-Dashboard returned failure. Cannot continue.'
		}
		Write-Verbose "[OK] Dashboard UI started successfully." -ForegroundColor Green
	#endregion Step 5: Start Dashboard User Interface
		
	#region Step 6: Run UI Message Loop

		Write-Verbose "Attempting to bring MainForm to foreground using SetForegroundWindow..." -ForegroundColor Cyan
		$mainForm = $global:DashboardConfig.UI.MainForm
		$handle = $mainForm.Handle
		
		if ($handle -ne [IntPtr]::Zero) {
			# Give the window a moment to finish initializing after Show()
			Start-Sleep -Milliseconds 200 # Slightly longer delay might help
		
			# 1. Ensure the window is not minimized
			if ([Custom.Native]::IsWindowMinimized($handle)) {
				Write-Verbose "Window is minimized, restoring..." -ForegroundColor DarkGray
				[Custom.Native]::ShowWindow($handle, [Custom.Native]::SW_RESTORE) | Out-Null
				Start-Sleep -Milliseconds 150 # Extra delay after restore
			}
		
			# 2. Initial SetForegroundWindow attempt
			$success = [Custom.Native]::SetForegroundWindow($handle)
			Write-Verbose "Initial SetForegroundWindow result: $success" -ForegroundColor DarkGray
		
			# 3. If initial attempt failed, try the Alt-key simulation workaround
			if (-not $success) {
				Write-Verbose "Initial SetForegroundWindow failed. Attempting Alt-key simulation..." -ForegroundColor Yellow
				try {
					# Simulate Alt key press and release
					[Custom.Native]::keybd_event([Custom.Native]::VK_MENU, 0, [Custom.Native]::KEYEVENTF_EXTENDEDKEY, [IntPtr]::Zero)
					Start-Sleep -Milliseconds 50
					[Custom.Native]::keybd_event([Custom.Native]::VK_MENU, 0, ([Custom.Native]::KEYEVENTF_EXTENDEDKEY -bor [Custom.Native]::KEYEVENTF_KEYUP), [IntPtr]::Zero)
					Start-Sleep -Milliseconds 100 # Slightly longer pause after Alt release
		
					# Retry SetForegroundWindow - this is the crucial attempt
					$success = [Custom.Native]::SetForegroundWindow($handle)
					Write-Verbose "SetForegroundWindow result after Alt-key simulation: $success" -ForegroundColor DarkGray
		
				} catch {
					Write-Verbose "Error during Alt-key simulation or second SetForegroundWindow: $_" -ForegroundColor Red
					$success = $false
				}
			}
		
			# 4. Final Fallback: Use WinForms Activate if all else failed
			if (-not $success) {
				Write-Verbose "All SetForegroundWindow attempts failed. Using Activate() as fallback..." -ForegroundColor Yellow
				try {
					$mainForm.Activate()
					Write-Verbose "Activate() called." -ForegroundColor DarkGray
				} catch {
					Write-Verbose "Error calling Activate(): $_" -ForegroundColor Red
				}
			}
		} else {
			Write-Verbose "MainForm handle is zero, cannot force focus." -ForegroundColor Yellow
		}
		Write-Verbose "--- Step 6: Running UI Message Loop ---" -ForegroundColor Cyan
		# Start-MessageLoop pauses execution here until the main UI window is closed by user or code.
		# It handles UI responsiveness.
		Start-MessageLoop
		# Execution continues here only *after* the UI message loop has stopped (main window closed/disposed).
		Write-Verbose "UI Message loop finished. Proceeding to final cleanup..." -ForegroundColor Green
	#endregion Step 6: Run UI Message Loop
}
catch
{
	# --- Main Catch Block ---
	# Catches any unhandled major errors from the main setup or run steps (Steps 1-6).
	$errorMessage = "`nFATAL UNHANDLED ERROR during application lifecycle: $($_.Exception.Message)"
	Write-Verbose $errorMessage -ForegroundColor Red
		
	# Try showing the critical error in a pop-up box for the user to see.
	try
	{
		Show-ErrorDialog ($errorMessage + "`n`nPlease check console logs for details.`n`nStack Trace:`n" + $($_.ScriptStackTrace))
	}
	catch
	{
		# If even the error pop-up fails, log that failure to the error output.
		Write-Verbose "  Failed to show final error dialog. The critical error was: $errorMessage" -ForegroundColor Red
	}
	# App will then go to the 'finally' block for cleanup.
}
finally
{
	# --- Main Finally Block ---
	# This block *always* runs, whether the 'try' block finished okay,
	# threw an error caught by 'catch', or quit early via 'exit' (though cleanup after 'exit' can be iffy).
	# Very important to make sure resource cleanup happens.
	#region Step 7: Final Application Cleanup
		Write-Verbose "--- Step 7: Entering Final Application Cleanup ---" -ForegroundColor Cyan
		# Ensure ftool hotkeys are unregistered.
		if (Get-Command Remove-AllHotkeys -ErrorAction SilentlyContinue)
		{
			Write-Verbose "  Unregistering all ftool hotkeys." -ForegroundColor Cyan
			Remove-AllHotkeys
		}
		else
		{
			Write-Verbose "  Remove-AllHotkeys function not found. Ftool hotkeys may not be fully unregistered." -ForegroundColor Yellow
		}

		# Make sure Stop-Dashboard function exists before calling it.
		if (Get-Command Stop-Dashboard -ErrorAction SilentlyContinue)
		{
			# Call the main cleanup function.
			$cleanupStatus = Stop-Dashboard # Save return status (true/false) if needed.
			Write-Verbose "[OK] Stop-Dashboard execution completed (Overall Success: $cleanupStatus)." -ForegroundColor Green
		}
		else
		{
			# Log a warning if the main cleanup function is missing (shouldn't happen if modules loaded).
			Write-Verbose "  Stop-Dashboard function not found! Full resource cleanup may not occur." -ForegroundColor Yellow
			# Try minimal essential backup cleanup if possible (like dispose main form).
			Write-Verbose "  Attempting basic MainForm dispose as fallback..." -ForegroundColor Cyan
			try
			{
				$finalMainForm = $global:DashboardConfig.UI.PSObject.Properties['MainForm']
				if ($finalMainForm -and $finalMainForm.Value -is [System.Windows.Forms.Form] -and -not $finalMainForm.Value.IsDisposed)
				{
					$finalMainForm.Value.Dispose()
					Write-Verbose "  Fallback MainForm dispose successful." -ForegroundColor Red
				}
				else
				{
					Write-Verbose "  Fallback MainForm dispose skipped (form null, invalid, or already disposed)."  -ForegroundColor Red
				}
			}
			catch
			{
				Write-Verbose "  Fallback MainForm dispose attempt failed: $($_.Exception.Message)"  -ForegroundColor Red
			}
		}
			
		# Optional: Explicitly exit the Windows Forms app context if it was used.
		# Check if the assembly is loaded before calling Application static methods.
		if ([System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms'))
		{
			Write-Verbose "Requesting Windows Forms application context exit..." -ForegroundColor Cyan
			try
			{
				[System.Windows.Forms.Application]::ExitThread() 
			}
			catch
			{
				Write-Verbose "  Error calling Application.ExitThread(): $($_.Exception.Message)" -ForegroundColor Red
			} # ExitThread is often better in PS scripts than Exit().
			# try { [System.Windows.Forms.Application]::Exit() } catch { Write-Verbose "Error calling Application.Exit(): $($_.Exception.Message)"} -ForegroundColor Red
		}
			
		Write-Verbose "=========================================" -ForegroundColor Cyan
		Write-Verbose "=== Entropia Dashboard Exited ===" -ForegroundColor Cyan
		Write-Verbose "=== Timestamp: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss') ===" -ForegroundColor Cyan
		Write-Verbose "=========================================" -ForegroundColor Cyan
	#endregion Step 7: Final Application Cleanup
}

#endregion Main Execution Block